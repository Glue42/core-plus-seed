/*! For license information please see main.53930050.js.LICENSE.txt */
!function(){var e={692:function(e,t,n){var r=n(215).default,i=n(424).default,o=n(861).default,a=n(61).default,s=n(156).default,u=n(122).default,c=n(704).default,l=n(115).default,d=n(588).default,p=n(808).default,f=n(655).default,h=n(389).default,v=n(690).default,g=n(728).default,y=["latest_fdc3_type"],m=["intent"];e.exports=function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};function t(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var w=function(){return w=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},w.apply(this,arguments)};function b(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function k(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return u([e,t])}}function u(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function x(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var _={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function S(e){return e.type===_.TIMESTAMP?"timestamp":e.type===_.NUMBER?"number":e.type===_.STRING?"string":e.type===_.OBJECT?"object":"unknown"}function I(e){return e.constructor===Date?"timestamp":"number"===typeof e?"number":"string"===typeof e?"string":"object"===typeof e?"object":"string"}function C(e){var t={},n=S(e);if("object"===n){var r=Object.keys(e.value).reduce((function(t,n){var r=I(e.value[n]);if("object"===r){var i=T(e.value[n]);t[n]={type:"object",description:"",context:{},composite:i}}else t[n]={type:r,description:"",context:{}};return t}),{});t.composite=r}return t.name=A(e.path.join("/")+"/"+e.name),t.type=n,t.description=e.description,t.context={},t}function T(e){return Object.keys(e).reduce((function(t,n){var r=I(e[n]);return t[n]="object"===r?{type:"object",description:"",context:{},composite:T(e[n])}:{type:r,description:"",context:{}},t}),{})}function A(e){return"undefined"!==typeof e&&e.length>0&&"/"!==e[0]?"/"+e:e}function E(e){return"timestamp"===S(e)?Date.now():P(e.value)}function P(e){return"object"!==typeof e?e:Object.keys(e).reduce((function(t,n){var r=e[n];return"object"===typeof r&&r.constructor!==Date?t[n]=P(r):r.constructor===Date?t[n]=new Date(r).getTime():r.constructor===Boolean?t[n]=r.toString():t[n]=r,t}),{})}function M(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?M(t):t)}),[])}function R(e){return e.sort((function(e,t){return e.state?t.state?t.state-e.state:-1:1}))[0]}function O(e){var t="";return e.forEach((function(e,n,r){var i=e.path.join(".");n===r.length-1?t+=i+"."+e.name+": "+e.description:t+=i+"."+e.name+": "+e.description+","})),t.length>100?t.slice(0,100)+"...":t}function j(e){var t=M(e.root.getAggregateState()),n=R(t);return{description:O(t),value:n.state}}function N(e,t){var n,r,i=this;if(!e||"object"!==typeof e)throw new Error("Connection is required parameter");var o=function(i){var o;n=new Promise((function(e){o=e})),(r=e.domain("metrics")).onJoined((function(e){!e&&o&&(o(),o=void 0);var t={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};r.send(t),e&&a(i)})),r.join({system:t.system,service:t.service,instance:t.instance})},a=function(e){s(e.root)},s=function e(t){u(t),t.metrics.forEach((function(e){l(e)})),t.subSystems.forEach((function(t){e(t)}))},u=function(e){return b(i,void 0,void 0,(function(){var t,i;return k(this,(function(o){switch(o.label){case 0:return void 0===e.parent?[2]:[4,n];case 1:return o.sent(),t={name:A(e.path.join("/")+"/"+e.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},i={type:"define",metrics:[t]},r.send(i),[2]}}))}))},c=function(t,o){return b(i,void 0,void 0,(function(){var i,a,s;return k(this,(function(u){switch(u.label){case 0:return[4,n];case 1:return u.sent(),i={type:"publish",values:[{name:A(t.path.join("/")+"/"+t.name+"/State"),value:{Description:o.description,Value:o.state},timestamp:Date.now()}]},r.send(i),a=j(t),s={type:"publish",peer_id:e.peerId,values:[{name:"/State",value:{Description:a.description,Value:a.value},timestamp:Date.now()}]},r.send(s),[2]}}))}))},l=function(e){return b(i,void 0,void 0,(function(){var t,i,o;return k(this,(function(a){switch(a.label){case 0:return t=f(e),[4,n];case 1:return a.sent(),i=C(t),o={type:"define",metrics:[i]},r.send(o),"undefined"!==typeof t.value&&p(t),[2]}}))}))},d=function(e){return b(i,void 0,void 0,(function(){var t;return k(this,(function(r){switch(r.label){case 0:return t=f(e),[4,n];case 1:return r.sent(),p(t),[2]}}))}))},p=function(e){if(h()){var t=E(e),n={type:"publish",values:[{name:A(e.path.join("/")+"/"+e.name),value:t,timestamp:Date.now()}]};return r.sendFireAndForget(n)}return Promise.resolve()},f=function(e){var t=w({},e);return"object"===typeof e.value&&null!==e.value&&(t.value=w({},e.value)),t},h=function(){var e;try{return(null!==(e=t.canUpdateMetric)&&void 0!==e?e:function(){return!0})()}catch(n){return!0}};return{init:o,createSystem:u,updateSystem:c,createMetric:l,updateMetric:d}}var L={validate:function(e,t,n){if(null===e||"object"!==typeof e)throw new Error("Missing definition");if(null===t||"object"!==typeof t)throw new Error("Missing parent");if(null===n||"object"!==typeof n)throw new Error("Missing transport")}},D=function(){function e(e,t,n,r,i){this.definition=e,this.system=t,this.transport=n,this.value=r,this.type=i,this.path=[],L.validate(e,t,n),this.path=t.path.slice(0),this.path.push(t.name),this.name=e.name,this.description=e.description,n.createMetric(this)}return Object.defineProperty(e.prototype,"repo",{get:function(){var e;return null===(e=this.system)||void 0===e?void 0:e.repo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.system.path+"/"+name},enumerable:!0,configurable:!0}),e.prototype.update=function(e){return this.value=e,this.transport.updateMetric(this)},e}(),W=function(e){function n(t,n,r,i){return e.call(this,t,n,r,i,_.NUMBER)||this}return t(n,e),n.prototype.incrementBy=function(e){this.update(this.value+e)},n.prototype.increment=function(){this.incrementBy(1)},n.prototype.decrement=function(){this.incrementBy(-1)},n.prototype.decrementBy=function(e){this.incrementBy(-1*e)},n}(D),F=function(e){function n(t,n,r,i){return e.call(this,t,n,r,i,_.OBJECT)||this}return t(n,e),n.prototype.update=function(e){return this.mergeValues(e),this.transport.updateMetric(this)},n.prototype.mergeValues=function(e){var t=this;return Object.keys(this.value).forEach((function(n){"undefined"!==typeof e[n]&&(t.value[n]=e[n])}))},n}(D),q=function(e){function n(t,n,r,i){return e.call(this,t,n,r,i,_.STRING)||this}return t(n,e),n}(D),U=function(e){function n(t,n,r,i){return e.call(this,t,n,r,i,_.TIMESTAMP)||this}return t(n,e),n.prototype.now=function(){this.update(new Date)},n}(D);function z(e,t,n,r,i){if(!t)throw new Error("Repository is required");if(!n)throw new Error("Transport is required");var o=n,a=e,s=i||"",u=t,c=r,l=S(r),d={},p=I(l,"/")+e,f=t.root,h=[],v=[];function g(e,t){if(!e||0===e.length)throw new Error("name is required");var n=h.filter((function(t){return t.name===e}));if(n.length>0)return n[0];var r=z(e,u,o,T,t);return h.push(r),r}function y(e,t){d={state:e,description:t},o.updateSystem(T,d)}function m(e,t){return x(e,_.STRING,t,(function(e){return new q(e,T,o,t)}))}function w(e,t){return x(e,_.NUMBER,t,(function(e){return new W(e,T,o,t)}))}function b(e,t){return x(e,_.OBJECT,t,(function(e){return new F(e,T,o,t)}))}function k(e,t){return x(e,_.TIMESTAMP,t,(function(e){return new U(e,T,o,t)}))}function x(e,t,n,r){var i={name:""};i="string"===typeof e?{name:e}:e;var o=v.filter((function(e){return e.name===i.name}));if(o.length>0){var a=o[0];if(a.type!==t)throw new Error("A metric named "+i.name+" is already defined with different type.");return"undefined"!==typeof n&&a.update(n).catch((function(){})),a}var s=r(i);return v.push(s),s}function S(e){if(!e||!e.parent)return[];var t=S(e.parent);return t.push(e.name),t}function I(e,t){return e&&e.length>0?e.join(t):""}function C(){var e=[];return Object.keys(d).length>0&&e.push({name:a,path:l,state:d.state,description:d.description}),h.forEach((function(t){var n=t.getAggregateState();n.length>0&&e.push.apply(e,n)})),e}var T={get name(){return a},get description(){return s},get repo(){return u},get parent(){return c},path:l,id:p,root:f,get subSystems(){return h},get metrics(){return v},subSystem:g,getState:function(){return d},setState:y,stringMetric:m,timestampMetric:k,objectMetric:b,numberMetric:w,getAggregateState:C};return o.createSystem(T),T}var G=function(){function e(e,t){t.init(this),this.root=z("",this,t),this.addSystemMetrics(this.root,e.clickStream||void 0===e.clickStream)}return e.prototype.addSystemMetrics=function(e,t){if("undefined"!==typeof navigator&&e.stringMetric("UserAgent",navigator.userAgent),t&&"undefined"!==typeof document){var n=e.subSystem("ClickStream"),r=function(e){var t;if(e.target){var r=e.target,i=r&&null!==(t=r.getAttribute("class"))&&void 0!==t?t:"";n.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:i,id:r.id,type:"<"+r.tagName.toLowerCase()+">",href:r.href||""}})}};n.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",r):document.attachEvent("onclick",r)}e.stringMetric("StartTime",(new Date).toString());var i=e.stringMetric("StartURL",""),o=e.stringMetric("AppName","");if("undefined"!==typeof window){if("undefined"!==typeof window.location){var a=window.location.href;i.update(a)}"undefined"!==typeof window.glue42gd&&o.update(window.glue42gd.appName)}},e}(),B=function(){function e(){}return e.prototype.init=function(e){},e.prototype.createSystem=function(e){return Promise.resolve()},e.prototype.updateSystem=function(e,t){return Promise.resolve()},e.prototype.createMetric=function(e){return Promise.resolve()},e.prototype.updateMetric=function(e){return Promise.resolve()},e}(),H=function(){function e(e,t,n){this.api=e,this.lastCount=0,this.initialPublishTimeout=1e4,this.publishInterval=6e4,this.initialPublishTimeout=null!==t&&void 0!==t?t:this.initialPublishTimeout,this.publishInterval=null!==n&&void 0!==n?n:this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}return e.prototype.scheduleCollection=function(){var e=this;setTimeout((function(){e.collect(),setInterval((function(){e.collect()}),e.publishInterval)}),this.initialPublishTimeout)},e.prototype.collect=function(){try{this.collectMemory(),this.collectEntries()}catch(e){}},e.prototype.collectMemory=function(){var e=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:e.totalJSHeapSize,usedJSHeapSize:e.usedJSHeapSize}))},e.prototype.collectEntries=function(){var e=window.performance.getEntries();if(!(e.length<=this.lastCount)){this.lastCount=e.length;var t=e.map((function(e){return e.toJSON()}));this.system.stringMetric("entries",JSON.stringify(t))}},e}(),V=function(e){var t;t=e.connection&&"object"===typeof e.connection?N(e.connection,e):new B;var n=new G(e,t).root;e.disableAutoAppSystem||(n=n.subSystem("App"));var r=K(n);return J(r,e.pagePerformanceMetrics),r};function J(e,t){var n,r;if("undefined"!==typeof window){var i=null===(r=null===(n=null===window||void 0===window?void 0:window.glue42gd)||void 0===n?void 0:n.metrics)||void 0===r?void 0:r.pagePerformanceMetrics;i&&(t=i),(null===t||void 0===t?void 0:t.enabled)&&new H(e,t.initialPublishTimeout,t.publishInterval)}}function K(e){var t,n=e.subSystem("reporting"),r={name:"features"},i=function(e,i,o){if("undefined"===typeof e||""===e)throw new Error("name is mandatory");if("undefined"===typeof i||""===i)throw new Error("action is mandatory");if("undefined"===typeof o||""===o)throw new Error("payload is mandatory");t?t.update({name:e,action:i,payload:o}):t=n.objectMetric(r,{name:e,action:i,payload:o})};return e.featureMetric=i,e}function Q(e){if(e&&e.errorHandling&&"function"!==typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"===typeof e.errorHandling&&e.errorHandling,n={};function r(e,t,r){var i=n[e];return i||(i=[],n[e]=i),i.push(t),r&&setTimeout((function(){r.forEach((function(r){var i;if(null===(i=n[e])||void 0===i?void 0:i.includes(t))try{Array.isArray(r)?t.apply(void 0,r):t.apply(void 0,[r])}catch(a){o(a,e)}}))}),0),function(){var r=n[e];r&&(0===(r=r.reduce((function(e,n,r){return n===t&&e.length===r||e.push(n),e}),[])).length?delete n[e]:n[e]=r)}}function i(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i=n[e];if(!i||0===i.length)return[];var a=[];return i.forEach((function(n){try{var r=n.apply(void 0,t);a.push(r)}catch(i){a.push(void 0),o(i,e)}})),a}function o(n,r){var i=n instanceof Error?n:new Error(n);if(t)t(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}function a(){n={}}function s(e){n[e]&&delete n[e]}return{add:r,execute:i,clear:a,clearKey:s}}Q.default=Q;var $=Q,Y=function(){function e(e,t){var n=this;this.registry=$(),this.gw=e.facade,this.gw.connect((function(e,t){n.messageHandler(t)})).then((function(e){n.client=e}))}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.sendObject=function(e){return this.client?(this.client.send(e),Promise.resolve(void 0)):Promise.reject("not connected")},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"in-memory"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),X=function(){function e(e,t){var n=this;this.logger=t,this.registry=$(),this.worker=new SharedWorker(e),this.worker.port.onmessage=function(e){n.messageHandler(e.data)}}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.sendObject=function(e){return this.worker.port.postMessage(e),Promise.resolve()},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"shared-worker"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),Z=function(){function e(){}return e.getGDMajorVersion=function(){if("undefined"!==typeof window&&window.glueDesktop&&window.glueDesktop.version){var e=Number(window.glueDesktop.version.substr(0,1));return isNaN(e)?void 0:e}},e.isNode=function(){if("undefined"!==typeof e._isNode)return e._isNode;if("undefined"!==typeof window)return e._isNode=!1,!1;try{e._isNode="[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){e._isNode=!1}return e._isNode},e}(),ee=function(){function e(){var e=this;this.rejected=!1,this.resolved=!1,this.promise=new Promise((function(t,n){e.resolve=function(n){e.resolved=!0,t(n)},e.reject=function(t){e.rejected=!0,n(t)}}))}return e.delay=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Object.defineProperty(e.prototype,"ended",{get:function(){return this.rejected||this.resolved},enumerable:!0,configurable:!0}),e}(),te={};function ne(){return te}function re(e){var t=te[e];if(t)return t;var n=[];function r(){return(new Date).getTime()}var i,o,a=r();function s(){return u("end",i=r()),o=i-a}function u(e,t){var i=null!==t&&void 0!==t?t:r(),o=0;n.length>0&&(o=i-n[n.length-1].time),n.push({name:e,time:i,diff:o})}u("start",a);var c={get startTime(){return a},get endTime(){return i},get period(){return o},stop:s,mark:u,marks:n};return te[e]=c,c}var ie=Z.isNode()?null:window.WebSocket,oe=function(){function e(e,t){if(this.startupTimer=re("connection"),this._running=!0,this._registry=$(),this.wsRequests=[],this.settings=e,this.logger=t,!this.settings.ws)throw new Error("ws is missing")}return e.prototype.onMessage=function(e){return this._registry.add("onMessage",e)},e.prototype.send=function(e,t){var n=this;return new Promise((function(t,r){n.waitForSocketConnection((function(){var i;try{null===(i=n.ws)||void 0===i||i.send(e),t()}catch(o){r(o)}}),r)}))},e.prototype.open=function(){var e=this;return this.logger.info("opening ws..."),this._running=!0,new Promise((function(t,n){e.waitForSocketConnection(t,n)}))},e.prototype.close=function(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()},e.prototype.onConnectedChanged=function(e){return this._registry.add("onConnectedChanged",e)},e.prototype.name=function(){return this.settings.ws},e.prototype.reconnect=function(){var e;null===(e=this.ws)||void 0===e||e.close();var t=new ee;return this.waitForSocketConnection((function(){t.resolve()})),t.promise},e.prototype.waitForSocketConnection=function(e,t){var n;t=null!==t&&void 0!==t?t:function(){},this._running?1!==(null===(n=this.ws)||void 0===n?void 0:n.readyState)?(this.wsRequests.push({callback:e,failed:t}),this.wsRequests.length>1||this.openSocket()):e():t("wait for socket on "+this.settings.ws+" failed - socket closed by user")},e.prototype.openSocket=function(e,t){return b(this,void 0,void 0,(function(){var n=this;return k(this,(function(r){switch(r.label){case 0:if(this.startupTimer.mark("opening-socket"),void 0===e&&(e=this.settings.reconnectInterval),"undefined"===typeof t&&(t=this.settings.reconnectAttempts),void 0!==t){if(0===t)return this.notifyForSocketState("wait for socket on "+this.settings.ws+" failed - no more retries left"),[2];this.logger.debug("will retry "+t+" more times (every "+e+" ms)")}r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.initiateSocket()];case 2:return r.sent(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState(),[3,4];case 3:return r.sent(),setTimeout((function(){var r=void 0===t?void 0:t-1;n.openSocket(e,r)}),e),[3,4];case 4:return[2]}}))}))},e.prototype.initiateSocket=function(){var e=this,t=new ee;return this.logger.debug("initiating ws to "+this.settings.ws+"..."),this.ws=new ie(this.settings.ws||""),this.ws.onerror=function(n){var r="";try{r=JSON.stringify(n)}catch(a){var i=new WeakSet,o=function(e,t){if("object"===typeof t&&null!==t){if(i.has(t))return;i.add(t)}return t};r=JSON.stringify(n,o)}t.reject("error"),e.notifyStatusChanged(!1,r)},this.ws.onclose=function(n){e.logger.info("ws closed "+n),t.reject("closed"),e.notifyStatusChanged(!1)},this.ws.onopen=function(){var n;e.startupTimer.mark("ws-opened"),e.logger.info("ws opened "+(null===(n=e.settings.identity)||void 0===n?void 0:n.application)),t.resolve(),e.notifyStatusChanged(!0)},this.ws.onmessage=function(t){e._registry.execute("onMessage",t.data)},t.promise},e.prototype.notifyForSocketState=function(e){this.wsRequests.forEach((function(t){e?t.failed&&t.failed(e):t.callback()})),this.wsRequests=[]},e.prototype.notifyStatusChanged=function(e,t){this._registry.execute("onConnectedChanged",e,t)},e}();function ae(e,t){return e(t={exports:{}},t.exports),t.exports}var se=1;function ue(){return(se=(9301*se+49297)%233280)/233280}function ce(e){se=e}var le,de,pe,fe={nextValue:ue,seed:ce},he="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function ve(){pe=!1}function ge(e){if(e){if(e!==le){if(e.length!==he.length)throw new Error("Custom alphabet for shortid must be "+he.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+he.length+" unique characters. These characters were not unique: "+t.join(", "));le=e,ve()}}else le!==he&&(le=he,ve())}function ye(e){return ge(e),le}function me(e){fe.seed(e),de!==e&&(ve(),de=e)}function we(){le||ge(he);for(var e,t=le.split(""),n=[],r=fe.nextValue();t.length>0;)r=fe.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function be(){return pe||(pe=we())}function ke(e){return be()[e]}var xe={characters:ye,seed:me,lookup:ke,shuffled:be},_e="object"===typeof window&&(window.crypto||window.msCrypto);function Se(){if(!_e||!_e.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return _e.getRandomValues(e),48&e[0]}var Ie=Se;function Ce(e,t){for(var n,r=0,i="";!n;)i+=e(t>>4*r&15|Ie()),n=t<Math.pow(16,r+1),r++;return i}var Te=Ce;function Ae(e){var t=xe.shuffled();return{version:15&t.indexOf(e.substr(0,1)),worker:15&t.indexOf(e.substr(1,1))}}var Ee=Ae;function Pe(e){if(!e||"string"!==typeof e||e.length<6)return!1;for(var t=xe.characters(),n=e.length,r=0;r<n;r++)if(-1===t.indexOf(e[r]))return!1;return!0}var Me=Pe,Re=ae((function(e){var t,n,r=1459707606518,i=6,o=0;function a(){var e="",a=Math.floor(.001*(Date.now()-r));return a===n?t++:(t=0,n=a),e+=Te(xe.lookup,i),e+=Te(xe.lookup,o),t>0&&(e+=Te(xe.lookup,t)),e+=Te(xe.lookup,a)}function s(t){return xe.seed(t),e.exports}function u(t){return o=t,e.exports}function c(e){return void 0!==e&&xe.characters(e),xe.shuffled()}e.exports=a,e.exports.generate=a,e.exports.seed=s,e.exports.worker=u,e.exports.characters=c,e.exports.decode=Ee,e.exports.isValid=Me}));Re.generate,Re.seed,Re.worker,Re.characters,Re.decode,Re.isValid;var Oe=Re;function je(e,t,n,r,i){null==e&&(e="global"),r=r||["success"],i=i||["error"];var o,a=!1,s=!1,u=!1,c=$();t.disconnected(h),t.loggedIn(v),t.on("success",(function(e){return w(e)})),t.on("error",(function(e){return m(e)})),t.on("result",(function(e){return w(e)})),r&&r.forEach((function(e){t.on(e,(function(e){return w(e)}))})),i&&i.forEach((function(e){t.on(e,(function(e){return m(e)}))}));var l={};function d(t){return o=t,new Promise((function(r,i){var o;a?r():("global"===e?o=u?Promise.resolve({}):Promise.reject("not connected to gateway"):(n.debug("joining domain "+e),o=k({type:"join",destination:e,domain:"global",options:t})),o.then((function(){f(),r()})).catch((function(t){n.debug("error joining "+e+" domain: "+JSON.stringify(t)),i(t)})))}))}function p(){return"global"===e?Promise.resolve():(n.debug("stopping session "+e+"..."),s=!1,k({type:"leave",destination:e,domain:"global"}).then((function(){a=!1,c.execute("onLeft")})).catch((function(){a=!1,c.execute("onLeft")})))}function f(){n.debug("did join "+e),a=!0;var t=s;s=!1,c.execute("onJoined",t)}function h(){u=!1,n.debug("connection is down"),a=!1,s=!0,c.execute("onLeft",{disconnected:!0})}function v(){u=!0,s&&(n.debug("connection is now up - trying to reconnect..."),d(o))}function g(e){return a&&e(!1),c.add("onJoined",e)}function y(e){return a||e(),c.add("onLeft",e)}function m(t){if(e===t.domain){var n=t.request_id;if(n){var r=l[n];r&&r.error(t)}}}function w(t){if(t.domain===e){var n=t.request_id;if(n){var r=l[n];r&&r.success(t)}}}function b(){return Oe()}function k(r,i,o){o=o||{},r.request_id=r.request_id||b(),r.domain=r.domain||e,o.skipPeerId||(r.peer_id=t.peerId);var a=r.request_id;return new Promise((function(e,s){l[a]={success:function(t){delete l[a],t._tag=i,e(t)},error:function(e){n.warn("GW error - "+JSON.stringify(e)+" for request "+JSON.stringify(r)),delete l[a],e._tag=i,s(e)}},t.send(r,o).catch((function(e){l[a].error({err:e})}))}))}function x(n){return n.request_id=n.request_id?n.request_id:b(),n.domain=n.domain||e,n.peer_id=t.peerId,t.send(n)}return{join:d,leave:p,onJoined:g,onLeft:y,send:k,sendFireAndForget:x,on:function(r,i){t.on(r,(function(t){if(t.domain===e)try{i(t)}catch(r){n.error("Callback  failed: "+r+" \n "+r.stack+" \n msg was: "+JSON.stringify(t),r)}}))},loggedIn:function(e){return t.loggedIn(e)},connected:function(e){return t.connected(e)},disconnected:function(e){return t.disconnected(e)},get peerId(){return t.peerId},get domain(){return e}}}var Ne=function(){function e(e,t,n){var r=this;this.connection=e,this.settings=t,this.logger=n,this.protocolVersion=3,this.datePrefix="#T42_DATE#",this.datePrefixLen=this.datePrefix.length,this.dateMinLen=this.datePrefixLen+1,this.datePrefixFirstChar=this.datePrefix[0],this.registry=$(),this._isLoggedIn=!1,this.shouldTryLogin=!0,this.initialLogin=!0,this.initialLoginAttempts=3,this.sessions=[],e.disconnected((function(){r.handleDisconnected()})),this.ping()}return Object.defineProperty(e.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!0,configurable:!0}),e.prototype.processStringMessage=function(e){var t=this,n=JSON.parse(e,(function(e,n){if("string"!==typeof n)return n;if(n.length<t.dateMinLen)return n;if(n[0]!==t.datePrefixFirstChar)return n;if(n.substring(0,t.datePrefixLen)!==t.datePrefix)return n;try{var r=parseInt(n.substring(t.datePrefixLen,n.length),10);return isNaN(r)?n:new Date(r)}catch(i){return n}}));return{msg:n,msgType:n.type}},e.prototype.createStringMessage=function(e){var t=Date.prototype.toJSON;try{var n=this.datePrefix;return Date.prototype.toJSON=function(){return n+this.getTime()},JSON.stringify(e)}finally{Date.prototype.toJSON=t}},e.prototype.processObjectMessage=function(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}},e.prototype.createObjectMessage=function(e){return e},e.prototype.login=function(e,t){return b(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l,d;return k(this,(function(p){switch(p.label){case 0:if(this.logger.debug("logging in..."),this.loginConfig=e,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0,n={},this.connection.gatewayToken=e.gatewayToken,!e.gatewayToken)return[3,5];if(!t)return[3,4];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.getNewGWToken()];case 2:return c=p.sent(),e.gatewayToken=c,[3,4];case 3:return r=p.sent(),this.logger.warn("failed to get GW token when reconnecting "+((null===r||void 0===r?void 0:r.message)||r)),[3,4];case 4:return n.method="gateway-token",n.token=e.gatewayToken,this.connection.gatewayToken=e.gatewayToken,[3,10];case 5:return"sspi"!==e.flowName?[3,9]:(n.provider="win",n.method="access-token",e.flowCallback&&e.sessionId?(i=n,[4,e.flowCallback(e.sessionId,null)]):[3,7]);case 6:return i.token=p.sent().data.toString("base64"),[3,8];case 7:throw new Error("Invalid SSPI config");case 8:return[3,10];case 9:if(e.token)n.method="access-token",n.token=e.token;else if(e.username)n.method="secret",n.login=e.username,n.secret=e.password;else{if(!e.provider)throw new Error("invalid auth message"+JSON.stringify(e));n.provider=e.provider,n.providerContext=e.providerContext}p.label=10;case 10:o={type:"hello",identity:this.settings.identity,authentication:n},e.sessionId&&(o.request_id=e.sessionId),this.globalDomain=je("global",this.connection,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]),a={skipPeerId:!0},this.initialLogin&&(a.retryInterval=this.settings.reconnectInterval,a.maxRetries=this.settings.reconnectAttempts),p.label=11;case 11:p.trys.push([11,19,20,21]),s=void 0,p.label=12;case 12:return[4,this.globalDomain.send(o,void 0,a)];case 13:return"authentication-request"!==(u=p.sent()).type?[3,16]:(c=Buffer.from(u.authentication.token,"base64"),e.flowCallback&&e.sessionId?(l=o.authentication,[4,e.flowCallback(e.sessionId,c)]):[3,15]);case 14:l.token=p.sent().data.toString("base64"),p.label=15;case 15:return o.request_id=e.sessionId,[3,12];case 16:if("welcome"===u.type)return s=u,[3,18];throw"error"===u.type?new Error("Authentication failed: "+u.reason):new Error("Unexpected message type during authentication: "+u.type);case 17:return[3,12];case 18:return this.initialLogin=!1,this.logger.debug("login successful with peerId "+s.peer_id),this.connection.peerId=s.peer_id,this.connection.resolvedIdentity=s.resolved_identity,this.connection.availableDomains=s.available_domains,s.options&&(this.connection.token=s.options.access_token,this.connection.info=s.options.info),this.setLoggedIn(!0),[2,s.resolved_identity];case 19:throw d=p.sent(),this.logger.error("error sending hello message - "+(d.message||d.msg||d.reason||d),d),d;case 20:return e&&e.flowCallback&&e.sessionId&&e.flowCallback(e.sessionId,null),[7];case 21:return[2]}}))}))},e.prototype.logout=function(){return b(this,void 0,void 0,(function(){var e;return k(this,(function(t){switch(t.label){case 0:return this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer),e=this.sessions.map((function(e){e.leave()})),[4,Promise.all(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this._isLoggedIn&&e(),this.registry.add("onLoggedIn",e)},e.prototype.domain=function(e,t,n,r){var i=this.sessions.filter((function(t){return t.domain===e}))[0];return i||(i=je(e,this.connection,t,n,r),this.sessions.push(i)),i},e.prototype.handleDisconnected=function(){var e=this;if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.connection.login(this.loginConfig,!0).catch((function(){setTimeout(e.handleDisconnected.bind(e),e.settings.reconnectInterval||1e3)}))}},e.prototype.setLoggedIn=function(e){this._isLoggedIn=e,this._isLoggedIn&&this.registry.execute("onLoggedIn")},e.prototype.ping=function(){var e=this;this.shouldTryLogin&&(this._isLoggedIn&&this.connection.send({type:"ping"}),this.pingTimer=setTimeout((function(){e.ping()}),3e4))},e.prototype.authToken=function(){var e={type:"create-token"};return this.globalDomain?this.globalDomain.send(e).then((function(e){return e.token})):Promise.reject(new Error("no global domain session"))},e.prototype.getNewGWToken=function(){if(void 0!==typeof window){var e=window.glue42gd;if(e)return e.getGWToken()}return Promise.reject(new Error("not running in GD"))},e}(),Le=function(){function e(e){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var t=0,n=e;t<n.length;t++){var r=n[t];this.specs[r.name]=r,this.specsNames.push(r.name)}}return e.prototype.init=function(e){var t=this;this.connection=e;for(var n=0,r=this.specsNames;n<r.length;n++)for(var i=r[n],o=function(n){var r=a.subsRefCount[n];if(r||(r=0),r+=1,a.subsRefCount[n]=r,r>1)return"continue";var i=e.on(n,(function(e){return t.processMessage(n,e)}));a.subs[n]=i},a=this,s=0,u=this.specs[i].types;s<u.length;s++)o(u[s])},e.prototype.processMessage=function(e,t){if(!this.isDone&&t)for(var n=0,r=this.specsNames;n<r.length;n++){var i=r[n];if(-1!==this.specs[i].types.indexOf(e)){var o=this.messages[i]||[];this.messages[i]=o,o.push(t)}}},e.prototype.drain=function(e,t){var n;t&&(this.messages[e]||[]).forEach(t),delete this.messages[e];for(var r=0,i=this.specs[e].types;r<i.length;r++){var o=i[r];this.subsRefCount[o]-=1,this.subsRefCount[o]<=0&&(null===(n=this.connection)||void 0===n||n.off(this.subs[o]),delete this.subs[o],delete this.subsRefCount[o])}delete this.specs[e],this.specs.length||(this.isDone=!0)},e}(),De=function(e,t,n){return new Promise((function(r,i){var o=setTimeout((function(){i(n||"Promise timeout hit: "+t)}),t);new Promise(e).then((function(e){clearTimeout(o),r(e)})).catch((function(e){clearTimeout(o),i(e)}))}))},We=function(){function e(e,t,n){this.settings=e,this.logger=t,this.identity=n,this.iAmConnected=!1,this.parentReady=!1,this.rejected=!1,this.children=[],this.extContentAvailable=!1,this.extContentConnecting=!1,this.extContentConnected=!1,this.parentInExtMode=!1,this.webNamespace="g42_core_web",this.parentPingTimeout=5e3,this.connectionRequestTimeout=7e3,this.defaultTargetString="*",this.registry=$(),this.messages={connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:this.handleParentReady.bind(this)},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:this.handleClientUnload.bind(this)},manualUnload:{name:"manualUnload",handle:this.handleManualUnload.bind(this)},extConnectionResponse:{name:"extConnectionResponse",handle:this.handleExtConnectionResponse.bind(this)},extSetupRequest:{name:"extSetupRequest",handle:this.handleExtSetupRequest.bind(this)},gatewayDisconnect:{name:"gatewayDisconnect",handle:this.handleGatewayDisconnect.bind(this)},gatewayInternalConnect:{name:"gatewayInternalConnect",handle:this.handleGatewayInternalConnect.bind(this)}},this.extContentAvailable=!!window.glue42ext,this.setUpMessageListener(),this.setUpUnload(),this.setupPlatformUnloadListener(),this.settings.port||(this.parent=window.opener||window.top,this.parentType=window.opener?"opener":-1!==window.name.indexOf("#wsp")?"workspace":"top")}return e.prototype.manualSetReadyState=function(){this.iAmConnected=!0,this.parentReady=!0},Object.defineProperty(e.prototype,"transportWindowId",{get:function(){return this.publicWindowId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"communicationId",{get:function(){return this._communicationId},enumerable:!0,configurable:!0}),e.prototype.sendObject=function(e){return b(this,void 0,void 0,(function(){return k(this,(function(t){if(this.extContentConnected)return[2,window.postMessage({glue42ExtOut:e},this.defaultTargetString)];if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");return this.port.postMessage(e),[2]}))}))},Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.send=function(){return Promise.reject("not supported")},e.prototype.onConnectedChanged=function(e){return this.registry.add("onConnectedChanged",e)},e.prototype.open=function(){return b(this,void 0,void 0,(function(){return k(this,(function(e){switch(e.label){case 0:return this.logger.debug("opening a connection to the web platform gateway."),[4,this.connect()];case 1:return e.sent(),this.notifyStatusChanged(!0),[2]}}))}))},e.prototype.close=function(){var e,t,n={glue42core:{type:this.messages.gatewayDisconnect.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};return null===(t=this.port)||void 0===t||t.postMessage(n),this.parentReady=!1,this.notifyStatusChanged(!1,"manual reconnection"),Promise.resolve()},e.prototype.name=function(){return"web-platform"},e.prototype.reconnect=function(){return b(this,void 0,void 0,(function(){return k(this,(function(e){switch(e.label){case 0:return[4,this.close()];case 1:return e.sent(),[2,Promise.resolve()]}}))}))},e.prototype.connect=function(){return b(this,void 0,void 0,(function(){return k(this,(function(e){switch(e.label){case 0:return this.settings.port?[4,this.initiateInternalConnection()]:[3,2];case 1:return e.sent(),this.logger.debug("internal web platform connection completed"),[2];case 2:if(!this.parentType||!this.parent)throw new Error("Cannot initiate a connection, because there is no opener, no top and no port.");return this.logger.debug("opening a "+("opener"===this.parentType?"child":"grandchild")+" client web platform connection"),[4,this.waitParent(this.parent,this.parentType)];case 3:return e.sent(),this.parentInExtMode?[4,this.requestConnectionPermissionFromExt()]:[3,5];case 4:e.sent(),e.label=5;case 5:return[4,this.initiateRemoteConnection(this.parent,this.parentType)];case 6:return e.sent(),this.logger.debug("the "+("opener"===this.parentType?"child":"grandchild")+" client is connected"),[2]}}))}))},e.prototype.initiateInternalConnection=function(){var e=this;return new Promise((function(t,n){e.logger.debug("opening an internal web platform connection"),e.port=e.settings.port,e.iAmConnected?e.logger.warn("cannot open a new connection, because this client is currently connected"):(e.port.onmessage=function(r){var i,o;if(!e.iAmConnected||(null===(i=r.data)||void 0===i?void 0:i.glue42core)){var a=null===(o=r.data)||void 0===o?void 0:o.glue42core;a&&(a.type===e.messages.gatewayInternalConnect.name&&a.success&&(e.publicWindowId=e.settings.windowId,e.identity&&e.publicWindowId&&(e.identity.windowId=e.publicWindowId,e.identity.instance=e.publicWindowId),t()),a.type===e.messages.gatewayInternalConnect.name&&a.error&&n(a.error))}else e.registry.execute("onMessage",r.data)},e.port.postMessage({glue42core:{type:e.messages.gatewayInternalConnect.name}}))}))},e.prototype.initiateRemoteConnection=function(e,t){var n=this;return De((function(r,i){var o;n.connectionResolve=r,n.connectionReject=i,n.myClientId=null!==(o=n.myClientId)&&void 0!==o?o:Oe();var a="workspace"===n.parentType?window.name.substring(0,window.name.indexOf("#wsp")):window.name,s={glue42core:{type:n.messages.connectionRequest.name,clientId:n.myClientId,clientType:"top"===t||"workspace"===t?"grandChild":"child",bridgeInstanceId:a}};if(n.logger.debug("sending connection request to "+t),n.extContentConnecting)return s.glue42core.clientType="child",s.glue42core.bridgeInstanceId=n.myClientId,s.glue42core.parentWindowId=n.parentWindowId,window.postMessage(s,n.defaultTargetString);e.postMessage(s,n.defaultTargetString)}),this.connectionRequestTimeout,"The connection to the opener/top window timed out")},e.prototype.waitParent=function(e,t){return b(this,void 0,void 0,(function(){var n,r,i=this;return k(this,(function(o){switch(o.label){case 0:if(n="Cannot initiate glue, because this window was not opened or created by a glue client",(r=De((function(r,o){var a=window.self!==window.top;if("top"===t&&!a)return o(n);i.parentPingResolve=r;var s={glue42core:{type:"opener"===t?i.messages.platformPing.name:i.messages.parentPing.name}};i.logger.debug("checking for "+t+" window availability"),i.parentPingInterval=setInterval((function(){e.postMessage(s,i.defaultTargetString)}),1e3)}),this.parentPingTimeout,n)).catch((function(){i.parentPingInterval&&(clearInterval(i.parentPingInterval),delete i.parentPingInterval)})),!this.extContentAvailable)return[2,r];o.label=1;case 1:return o.trys.push([1,3,,5]),[4,r];case 2:return o.sent(),[2];case 3:return o.sent(),this.logger.debug("the parent check failed, but there is an associated extension content script, requesting permission..."),[4,this.requestConnectionPermissionFromExt()];case 4:return o.sent(),[3,5];case 5:return[2]}}))}))},e.prototype.setUpMessageListener=function(){var e=this;this.settings.port?this.logger.debug("skipping generic message listener, because this is an internal client"):window.addEventListener("message",(function(t){var n,r=null===(n=t.data)||void 0===n?void 0:n.glue42core;if(r&&!e.rejected)if(e.checkMessageTypeValid(r.type)){var i=r.type;e.logger.debug("received valid glue42core message of type: "+i),e.messages[i].handle(t)}else e.logger.error("cannot handle the incoming glue42 core message, because the type is invalid: "+r.type)}))},e.prototype.setUpUnload=function(){var e=this;this.settings.port?this.logger.debug("skipping unload event listener, because this is an internal client"):window.addEventListener("beforeunload",(function(){var t,n;if(!e.extContentConnected){var r={glue42core:{type:e.messages.clientUnload.name,data:{clientId:e.myClientId,ownWindowId:null===(t=e.identity)||void 0===t?void 0:t.windowId}}};e.parent&&e.parent.postMessage(r,e.defaultTargetString),null===(n=e.port)||void 0===n||n.postMessage(r)}}))},e.prototype.handleParentReady=function(e){var t;this.logger.debug("handling the ready signal from the parent, by resoling the pending promise."),this.parentReady=!0;var n=null===(t=e.data)||void 0===t?void 0:t.glue42core;n&&n.extMode&&(this.logger.debug("my parent is connected to its content script, fetching windowId and proceeding with content script connection"),this.parentWindowId=n.extMode.windowId,this.parentInExtMode=!0),this.parentPingResolve&&(this.parentPingResolve(),delete this.parentPingResolve),this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval)},e.prototype.handlePlatformReady=function(){this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve&&(this.parentPingResolve(),delete this.parentPingResolve),this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval)},e.prototype.handleConnectionAccepted=function(e){var t,n=null===(t=e.data)||void 0===t?void 0:t.glue42core;return this.myClientId===n.clientId?this.handleAcceptanceOfMyRequest(n):this.handleAcceptanceOfGrandChildRequest(n,e)},e.prototype.handleAcceptanceOfMyRequest=function(e){var t,n,r,i=this;if(this.logger.debug("handling a connection accepted signal targeted at me."),this.isPreferredActivated=e.isPreferredActivated,this.extContentConnecting)return this.processExtContentConnection(e);if(e.port){if(this.publicWindowId="opener"===this.parentType?window.name:"top"===this.parentType?e.parentWindowId:window.name.substring(0,window.name.indexOf("#wsp")),this.identity&&"top"!==this.parentType&&(this.identity.windowId=null!==(t=this.identity.windowId)&&void 0!==t?t:this.publicWindowId,this.identity.instance=null!==(n=this.identity.instance)&&void 0!==n?n:this.publicWindowId),this.identity&&"top"===this.parentType&&(this.identity.instance=null!==(r=this.identity.instance)&&void 0!==r?r:Oe()),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),this._communicationId=e.communicationId,this.port=e.port,this.port.onmessage=function(e){return i.registry.execute("onMessage",e.data)},this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve;this.logger.error("unable to call the connection resolve, because no connection promise was found")}else this.logger.error("cannot set up my connection, because I was not provided with a port")},e.prototype.processExtContentConnection=function(e){var t=this;if(this.logger.debug("handling a connection accepted signal targeted at me for extension content connection."),this.extContentConnecting=!1,this.extContentConnected=!0,this.publicWindowId=this.parentWindowId||this.myClientId,this.extContentConnecting&&this.identity&&(this.identity.windowId=this.publicWindowId),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),window.addEventListener("message",(function(e){var n,r=null===(n=e.data)||void 0===n?void 0:n.glue42ExtInc;r&&t.registry.execute("onMessage",r)})),this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve},e.prototype.handleAcceptanceOfGrandChildRequest=function(e,t){if(this.extContentConnecting||this.extContentConnected)this.logger.debug("cannot process acceptance of a grandchild, because I am connected to a content script");else{this.logger.debug("handling a connection accepted signal targeted at a grandchild: "+e.clientId);var n=this.children.find((function(t){return t.grandChildId===e.clientId}));n?(n.connected=!0,this.logger.debug("the grandchild connection for "+e.clientId+" is set up, forwarding the success message and the gateway port"),e.parentWindowId=this.publicWindowId,n.source.postMessage(t.data,n.origin,[e.port])):this.logger.error("cannot handle connection accepted for grandchild: "+e.clientId+", because there is no grandchild with this id")}},e.prototype.handleConnectionRejected=function(){this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),this.connectionReject&&(this.connectionReject("The platform connection was rejected. Most likely because this window was not created by a glue API call"),delete this.connectionReject)},e.prototype.handleConnectionRequest=function(e){if(this.extContentConnecting)this.logger.debug("This connection request event is targeted at the extension content");else{var t=e.source,n=e.data.glue42core;if(!n.clientType||"grandChild"!==n.clientType)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source was not opened by a glue API call");if(!n.clientId)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source did not provide a valid id");if("opener"!==this.parentType||!this.parent)return this.rejectConnectionRequest(t,e.origin,"Cannot forward the connection request, because no direct connection to the platform was found");this.logger.debug("handling a connection request for a grandchild: "+n.clientId),this.children.push({grandChildId:n.clientId,source:t,connected:!1,origin:e.origin}),this.logger.debug("grandchild: "+n.clientId+" is prepared, forwarding connection request to the platform"),this.parent.postMessage(e.data,this.defaultTargetString)}},e.prototype.handleParentPing=function(e){if(this.parentReady)if(this.iAmConnected){var t={glue42core:{type:this.messages.parentReady.name}};this.extContentConnected&&(t.glue42core.extMode={windowId:this.myClientId});var n=e.source;this.logger.debug("responding to a parent ping with a ready message"),n.postMessage(t,e.origin)}else this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");else this.logger.debug("my parent is not ready, I am ignoring the parent ping")},e.prototype.setupPlatformUnloadListener=function(){var e=this;this.onMessage((function(t){"platformUnload"===t.type&&(e.logger.debug("detected a web platform unload"),e.parentReady=!1,e.notifyStatusChanged(!1,"Gateway unloaded"))}))},e.prototype.handleManualUnload=function(){var e,t,n={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};if(this.extContentConnected)return window.postMessage({glue42ExtOut:n},this.defaultTargetString);null===(t=this.port)||void 0===t||t.postMessage(n)},e.prototype.handleClientUnload=function(e){var t=e.data.glue42core,n=null===t||void 0===t?void 0:t.data.clientId;n?this.children.find((function(e){return e.grandChildId===n}))?(this.logger.debug("handling grandchild unload for id: "+n),this.children=this.children.filter((function(e){return e.grandChildId!==n}))):this.logger.warn("cannot process grand child unload, because this client is unaware of this grandchild"):this.logger.warn("cannot process grand child unload, because the provided id was not valid")},e.prototype.handlePlatformPing=function(){this.logger.error("cannot handle platform ping, because this is not a platform calls handling component")},e.prototype.notifyStatusChanged=function(e,t){this.iAmConnected=e,this.registry.execute("onConnectedChanged",e,t)},e.prototype.checkMessageTypeValid=function(e){return"string"===typeof e&&!!this.messages[e]},e.prototype.rejectConnectionRequest=function(e,t,n){this.rejected=!0,this.logger.error(n);var r={glue42core:{type:this.messages.connectionRejected.name}};e.postMessage(r,t)},e.prototype.requestConnectionPermissionFromExt=function(){var e=this;return this.waitForContentScript().then((function(){return De((function(t,n){e.extConnectionResolve=t,e.extConnectionReject=n;var r={glue42core:{type:"extSetupRequest"}};e.logger.debug("permission request to the extension content script was sent"),window.postMessage(r,e.defaultTargetString)}),e.parentPingTimeout,"Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection timed out")}))},e.prototype.handleExtConnectionResponse=function(e){var t;if(!(null===(t=e.data)||void 0===t?void 0:t.glue42core).approved&&this.extConnectionReject)return this.extConnectionReject("Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection was rejected");this.extConnectionResolve&&(this.extContentConnecting=!0,this.logger.debug("The extension connection was approved, proceeding."),this.extConnectionResolve(),delete this.extConnectionResolve)},e.prototype.handleExtSetupRequest=function(){},e.prototype.handleGatewayDisconnect=function(){},e.prototype.handleGatewayInternalConnect=function(){},e.prototype.waitForContentScript=function(){var e;return(null===(e=window.glue42ext)||void 0===e?void 0:e.content)?Promise.resolve():De((function(e){window.addEventListener("Glue42EXTReady",(function(){e()}))}),this.connectionRequestTimeout,"The content script was available, but was never heard to be ready")},e}(),Fe=function(e,t){var n=e;return function(){0===--n&&t()}},qe=function(){function e(e){void 0===e&&(e=0),this.minSequenceInterval=e,this.queue=[],this.isExecutingQueue=!1}return e.prototype.enqueue=function(e){var t=this;return new Promise((function(n,r){t.queue.push({action:e,resolve:n,reject:r}),t.executeQueue()}))},e.prototype.executeQueue=function(){return b(this,void 0,void 0,(function(){var e,t,n;return k(this,(function(r){switch(r.label){case 0:if(this.isExecutingQueue)return[2];this.isExecutingQueue=!0,r.label=1;case 1:if(!this.queue.length)return[3,7];if(!(e=this.queue.shift()))return this.isExecutingQueue=!1,[2];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,e.action()];case 3:return t=r.sent(),e.resolve(t),[3,5];case 4:return n=r.sent(),e.reject(n),[3,5];case 5:return[4,this.intervalBreak()];case 6:return r.sent(),[3,1];case 7:return this.isExecutingQueue=!1,[2]}}))}))},e.prototype.intervalBreak=function(){var e=this;return new Promise((function(t){return setTimeout(t,e.minSequenceInterval)}))},e}(),Ue=function(){function e(e,t){if(this.settings=e,this.logger=t,this.messageHandlers={},this.ids=1,this.registry=$(),this._connected=!1,this.isTrace=!1,this._swapTransport=!1,this._switchInProgress=!1,this._transportSubscriptions=[],this._sequelizer=new qe,(e=e||{}).reconnectAttempts=e.reconnectAttempts||10,e.reconnectInterval=e.reconnectInterval||1e3,e.inproc)this.transport=new Y(e.inproc,t.subLogger("inMemory"));else if(e.sharedWorker)this.transport=new X(e.sharedWorker,t.subLogger("shared-worker"));else if(e.webPlatform)this.transport=new We(e.webPlatform,t.subLogger("web-platform"),e.identity);else{if(void 0===e.ws)throw new Error("No connection information specified");this.transport=new oe(e,t.subLogger("ws"))}this.isTrace=t.canPublish("trace"),t.debug("starting with "+this.transport.name()+" transport"),this.protocol=new Ne(this,e,t.subLogger("protocol"));var n=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),r=this.transport.onMessage(this.handleTransportMessage.bind(this));this._transportSubscriptions.push(n),this._transportSubscriptions.push(r),this._defaultTransport=this.transport}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;return null===(e=this.protocol)||void 0===e?void 0:e.protocolVersion},enumerable:!0,configurable:!0}),e.prototype.switchTransport=function(e){return b(this,void 0,void 0,(function(){var t=this;return k(this,(function(n){return[2,this._sequelizer.enqueue((function(){return b(t,void 0,void 0,(function(){var t,n,r;return k(this,(function(i){switch(i.label){case 0:if(!e||"object"!==typeof e)throw new Error("Cannot switch transports, because the settings are missing or invalid.");if("undefined"===typeof e.type)throw new Error("Cannot switch the transport, because the type is not defined");return this.logger.trace("Starting transport switch with settings: "+JSON.stringify(e)),t="secondary"===e.type?this.getNewSecondaryTransport(e):this._defaultTransport,this._targetTransport=t,this._targetAuth="secondary"===e.type?this.getNewSecondaryAuth(e):this._defaultAuth,n=this.verifyConnection(),this._swapTransport=!0,this._switchInProgress=!0,this.logger.trace("The new transport has been set, closing the current transport"),[4,this.transport.close()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,n];case 3:return i.sent(),r=this.transport===t,this.logger.info("The reconnection after the switch was completed. Was the switch a success: "+r),this._switchInProgress=!1,[2,{success:r}];case 4:return i.sent(),this.logger.info("The reconnection after the switch timed out, reverting back to the default transport."),this.switchTransport({type:"default"}),this._switchInProgress=!1,[2,{success:!1}];case 5:return[2]}}))}))}))]}))}))},e.prototype.onLibReAnnounced=function(e){return this.registry.add("libReAnnounced",e)},e.prototype.setLibReAnnounced=function(e){this.registry.execute("libReAnnounced",e)},e.prototype.send=function(e,t){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){var n=this.protocol.createObjectMessage(e);return this.isTrace&&this.logger.trace(">> "+JSON.stringify(n)),this.transport.sendObject(n,t)}var r=this.protocol.createStringMessage(e);return this.isTrace&&this.logger.trace(">> "+r),this.transport.send(r,t)},e.prototype.on=function(e,t){e=e.toLowerCase(),void 0===this.messageHandlers[e]&&(this.messageHandlers[e]={});var n=this.ids++;return this.messageHandlers[e][n]=t,{type:e,id:n}},e.prototype.off=function(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.protocol.isLoggedIn},enumerable:!0,configurable:!0}),e.prototype.connected=function(e){var t=this;return this.protocol.loggedIn((function(){var n=t.transport.name();e(n)}))},e.prototype.disconnected=function(e){return this.registry.add("disconnected",e)},e.prototype.login=function(e,t){return b(this,void 0,void 0,(function(){var n,r,i;return k(this,(function(o){switch(o.label){case 0:this._defaultAuth||(this._defaultAuth=e),this._swapTransport&&(this.logger.trace("Detected a transport swap, swapping transports"),n=this.transportSwap(),e=null!==n&&void 0!==n?n:e),this.logger.trace("Starting login for transport: "+this.transport.name()+" and auth "+JSON.stringify(e)),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.transport.open()];case 2:return o.sent(),this.logger.trace("Transport: "+this.transport.name()+" opened, logging in"),re("connection").mark("transport-opened"),[4,this.protocol.login(e,t)];case 3:return r=o.sent(),this.logger.trace("Logged in with identity: "+JSON.stringify(r)),re("connection").mark("protocol-logged-in"),[2,r];case 4:throw i=o.sent(),this._switchInProgress&&(this.logger.trace("An error while logging in after a transport swap, preparing a default swap."),this.prepareDefaultSwap()),new Error(i);case 5:return[2]}}))}))},e.prototype.logout=function(){return b(this,void 0,void 0,(function(){return k(this,(function(e){switch(e.label){case 0:return[4,this.protocol.logout()];case 1:return e.sent(),[4,this.transport.close()];case 2:return e.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this.protocol.loggedIn(e)},e.prototype.domain=function(e,t,n){return this.protocol.domain(e,this.logger.subLogger("domain="+e),t,n)},e.prototype.authToken=function(){return this.protocol.authToken()},e.prototype.reconnect=function(){return this.transport.reconnect()},e.prototype.distributeMessage=function(e,t){var n=this,r=this.messageHandlers[t.toLowerCase()];void 0!==r&&Object.keys(r).forEach((function(t){var i=r[t];if(void 0!==i)try{i(e)}catch(o){try{n.logger.error("Message handler failed with "+o.stack,o)}catch(a){console.log("Message handler failed",o)}}}))},e.prototype.handleConnectionChanged=function(e){this._connected!==e&&(this._connected=e,e?(this.settings.replaySpecs&&this.settings.replaySpecs.length&&(this.replayer=new Le(this.settings.replaySpecs),this.replayer.init(this)),this.registry.execute("connected")):this.registry.execute("disconnected"))},e.prototype.handleTransportMessage=function(e){var t;t="string"===typeof e?this.protocol.processStringMessage(e):this.protocol.processObjectMessage(e),this.isTrace&&this.logger.trace("<< "+JSON.stringify(t)),this.distributeMessage(t.msg,t.msgType)},e.prototype.verifyConnection=function(){var e=this;return De((function(t){var n,r=Fe(2,(function(){n&&n(),t()}));n=e.onLibReAnnounced((function(e){return"interop"===e.name||"contexts"===e.name?r():void 0}))}),1e4,"Transport switch timed out waiting for all libraries to be re-announced")},e.prototype.getNewSecondaryTransport=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.url))throw new Error("Missing secondary transport URL.");return new oe(Object.assign({},this.settings,{ws:e.transportConfig.url,reconnectAttempts:1}),this.logger.subLogger("ws-secondary"))},e.prototype.getNewSecondaryAuth=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.auth))throw new Error("Missing secondary transport auth information.");return e.transportConfig.auth},e.prototype.transportSwap=function(){if(this._swapTransport=!1,this._targetTransport&&this._targetAuth){this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport=this._targetTransport;var e=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),t=this.transport.onMessage(this.handleTransportMessage.bind(this));return this._transportSubscriptions.push(e),this._transportSubscriptions.push(t),this._targetAuth}this.logger.warn("Error while switching transports - either the target transport or auth is not defined: transport defined -> "+!!this._defaultTransport+", auth defined -> "+!!this._targetAuth+". Staying on the current one.")},e.prototype.prepareDefaultSwap=function(){var e=this;this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport.close().catch((function(t){return e.logger.warn("Error closing the "+e.transport.name()+" transport after a failed connection attempt: "+JSON.stringify(t))})),this._targetTransport=this._defaultTransport,this._targetAuth=this._defaultAuth,this._swapTransport=!0},e}(),ze=["trace","debug","info","warn","error","off"],Ge=function(){function e(e,t,n){this.name=e,this.parent=t,this.subLoggers=[],this.logFn=console,this.customLogFn=!1,this.name=e,this.path=t?t.path+"."+e:e,this.loggerFullName="["+this.path+"]",this.includeTimeAndLevel=!n,n&&(this.logFn=n,this.customLogFn=!0)}return e.prototype.subLogger=function(t){var n=this.subLoggers.filter((function(e){return e.name===t}))[0];if(void 0!==n)return n;Object.keys(this).forEach((function(e){if(e===t)throw new Error("This sub logger name is not allowed.")}));var r=new e(t,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(r),r},e.prototype.publishLevel=function(e){var t;return e&&(this._publishLevel=e),this._publishLevel||(null===(t=this.parent)||void 0===t?void 0:t.publishLevel())},e.prototype.consoleLevel=function(e){var t;return e&&(this._consoleLevel=e),this._consoleLevel||(null===(t=this.parent)||void 0===t?void 0:t.consoleLevel())},e.prototype.log=function(e,t,n){this.publishMessage(t||"info",e,n)},e.prototype.trace=function(e){this.log(e,"trace")},e.prototype.debug=function(e){this.log(e,"debug")},e.prototype.info=function(e){this.log(e,"info")},e.prototype.warn=function(e){this.log(e,"warn")},e.prototype.error=function(e,t){this.log(e,"error")},e.prototype.canPublish=function(e,t){return ze.indexOf(e)>=ze.indexOf(t||this.consoleLevel()||"trace")},e.prototype.publishMessage=function(t,n,r){var i=this.loggerFullName;if("error"===t&&!r){var o=new Error;o.stack&&(n=n+"\n"+o.stack.split("\n").slice(3).join("\n"))}if(this.canPublish(t,this.publishLevel())){var a=e.Interop;if(a)try{a.methods({name:e.InteropMethodName}).length>0&&a.invoke(e.InteropMethodName,{msg:""+n,logger:i,level:t})}catch(l){}}if(this.canPublish(t)){var s="";if(this.includeTimeAndLevel){var u=new Date;s="["+u.getHours()+":"+u.getMinutes()+":"+u.getSeconds()+":"+u.getMilliseconds()+"] ["+t+"] "}var c=""+s+i+": "+n;switch(t){case"trace":this.logFn.debug(c);break;case"debug":this.logFn.debug?this.logFn.debug(c):this.logFn.log(c);break;case"info":this.logFn.info(c);break;case"warn":this.logFn.warn(c);break;case"error":this.logFn.error(c,r)}}},e.InteropMethodName="T42.AppLogger.Log",e}(),Be="create-context",He="created",Ve="destroyed",Je="context-created",Ke="context-added",Qe="subscribe-context",$e="subscribed-context",Ye="unsubscribe-context",Xe="destroy-context",Ze="context-destroyed",et="update-context",tt="context-updated",nt="joined",rt={get name(){return"context"},get types(){return[Be,He,Ve,Je,Ke,Qe,$e,Ye,Xe,Ze,et,tt,nt]}},it="5.7.8";function ot(e,t,n){var r,i,o,a,s;if(Z.isNode()){var u={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}._GD_STARTING_CONTEXT_;if(u)try{s=JSON.parse(u)}catch(m){}}function c(){var r,i,o,a,u,c,l,p,f,h,v,g=e.gateway,y=null!==(r=null===g||void 0===g?void 0:g.protocolVersion)&&void 0!==r?r:3,m=null===g||void 0===g?void 0:g.reconnectInterval,w=null===g||void 0===g?void 0:g.reconnectAttempts,b="ws://localhost:8385",k=null===g||void 0===g?void 0:g.ws,x=null===g||void 0===g?void 0:g.sharedWorker,_=null===g||void 0===g?void 0:g.inproc,S=null!==(i=null===g||void 0===g?void 0:g.webPlatform)&&void 0!==i?i:void 0;n&&(k=n.gwURL),Z.isNode()&&s&&s.gwURL&&(k=s.gwURL),k||x||_||(k=b);var I=d(),C=I;"undefined"!==typeof n?(p=n.windowId,f=n.pid,n.env&&(h=n.env.env,v=n.env.region),C=null!==(o=n.application)&&void 0!==o?o:"glue-app",l=n.appInstanceId):Z.isNode()?(f=process.pid,s&&(h=s.env,v=s.region,l=s.instanceId)):"undefined"!==typeof(null===window||void 0===window?void 0:window.glue42electron)&&(p=null===window||void 0===window?void 0:window.glue42electron.instanceId,f=null===window||void 0===window?void 0:window.glue42electron.pid,h=null===window||void 0===window?void 0:window.glue42electron.env,v=null===window||void 0===window?void 0:window.glue42electron.region,C=null!==(a=null===window||void 0===window?void 0:window.glue42electron.application)&&void 0!==a?a:"glue-app",l=null===window||void 0===window?void 0:window.glue42electron.instanceId);var T=null!==(c=null===(u=e.gateway)||void 0===u?void 0:u.replaySpecs)&&void 0!==c?c:[];T.push(rt);var A={application:C,applicationName:I,windowId:p,instance:l,process:f,region:v,environment:h,api:t.version||it};return e.identity&&(A=Object.assign(A,e.identity)),{identity:A,reconnectInterval:m,ws:k,sharedWorker:x,webPlatform:S,inproc:_,protocolVersion:y,reconnectAttempts:w,replaySpecs:T}}function l(){return"undefined"===typeof e.contexts||"boolean"===typeof e.contexts&&e.contexts?{reAnnounceKnownContexts:!0}:"object"===typeof e.contexts&&Object.assign({},{reAnnounceKnownContexts:!0},e.contexts)}function d(){if(e.application)return e.application;if(n)return n.applicationName;if("undefined"!==typeof window&&"undefined"!==typeof window.glue42electron)return window.glue42electron.application;var t=Oe();return Z.isNode()?s?s.applicationConfig.name:"NodeJS"+t:"undefined"!==typeof window&&"undefined"!==typeof document?document.title+" ("+t+")":t}function p(){var t,n,r;return"string"===typeof e.auth?{token:e.auth}:e.auth?e.auth:Z.isNode()&&s&&s.gwToken?{gatewayToken:s.gwToken}:(null===(t=e.gateway)||void 0===t?void 0:t.webPlatform)||(null===(n=e.gateway)||void 0===n?void 0:n.inproc)||(null===(r=e.gateway)||void 0===r?void 0:r.sharedWorker)?{username:"glue42",password:"glue42"}:void 0}function f(){var t,r,i,o=e.logger,a="warn";return o||(o=a),n&&(i=n.consoleLogLevel),"string"===typeof o?{console:null!==i&&void 0!==i?i:o,publish:a}:{console:null!==(t=null!==i&&void 0!==i?i:o.console)&&void 0!==t?t:a,publish:null!==(r=o.publish)&&void 0!==r?r:a}}var h=c(),v=d();if("undefined"!==typeof window){var g=window,y=g.htmlContainer?g.htmlContainer.containerName+"."+g.htmlContainer.application:null===(r=null===g||void 0===g?void 0:g.glue42gd)||void 0===r?void 0:r.application;y&&(v=y)}return{bus:null!==(i=e.bus)&&void 0!==i&&i,application:v,auth:p(),logger:f(),connection:h,metrics:null===(o=e.metrics)||void 0===o||o,contexts:l(),version:t.version||it,libs:null!==(a=t.libs)&&void 0!==a?a:[],customLogger:e.customLogger}}var at=function(){function e(e,t,n,r){this.updateCallbacks={},this.contextId=e,this.name=t,this.isAnnounced=n,this.activityId=r,this.context={}}return e.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},e.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},e}();function st(e,t,n){try{if((null===n||void 0===n?void 0:n.canPublish("trace"))&&(null===n||void 0===n||n.trace("applying context delta "+JSON.stringify(t)+" on context "+JSON.stringify(e))),!t)return e;if(t.reset)return e=w({},t.reset);if(e=ut(e,void 0),t.commands){for(var r=0,i=t.commands;r<i.length;r++){var o=i[r];"remove"===o.type?ft(e,o.path):"set"===o.type&&dt(e,o.value,o.path)}return e}var a=t.added,s=t.updated,u=t.removed;return a&&Object.keys(a).forEach((function(t){e[t]=a[t]})),s&&Object.keys(s).forEach((function(t){ct(t,e,s)})),u&&u.forEach((function(t){delete e[t]})),e}catch(c){return null===n||void 0===n||n.error("error applying context delta "+JSON.stringify(t)+" on context "+JSON.stringify(e),c),e}}function ut(e,t){if(t=t||new WeakMap,Object(e)!==e)return e;if(e instanceof Set)return new Set(e);if(t.has(e))return t.get(e);var n=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e.constructor?new e.constructor:Object.create(null);return t.set(e,n),e instanceof Map&&Array.from(e,(function(e){var r=e[0],i=e[1];return n.set(r,ut(i,t))})),Object.assign.apply(Object,x([n],Object.keys(e).map((function(n){var r;return(r={})[n]=ut(e[n],t),r}))))}var ct=function(e,t,n){var r=n[e];if(void 0===r)return t;var i=t[e];return i&&r?"string"===typeof i||"number"===typeof i||"boolean"===typeof i||"string"===typeof r||"number"===typeof r||"boolean"===typeof r||Array.isArray(i)||Array.isArray(r)?(t[e]=r,t):(t[e]=Object.assign({},i,r),t):(t[e]=r,t)};function lt(e,t){if(e===t)return!0;if(!(e instanceof Object)||!(t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n]){if("object"!==typeof e[n])return!1;if(!lt(e[n],t[n]))return!1}}for(var n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}function dt(e,t,n){var r,i=n.split(".");for(r=0;r<i.length-1;r++)e[i[r]]||(e[i[r]]={}),"object"!==typeof e[i[r]]&&(e[i[r]]={}),e=e[i[r]];e[i[r]]=t}function pt(e,t){return Object.keys(t).every((function(n){return"object"===typeof t[n]?pt((null===e||void 0===e?void 0:e[n])||{},t[n]||{}):t[n]===(null===e||void 0===e?void 0:e[n])}))}function ft(e,t){var n,r=t.split(".");for(n=0;n<r.length-1;n++){if(!e[r[n]])return;e=e[r[n]]}delete e[r[n]]}var ht,vt=function(){function e(e){var t,n=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._contextNameToId={},this._contextIdToName={},this._protocolVersion=void 0,this._contextsTempCache={},this._contextsSubscriptionsCache=[],this._connection=e.connection,this._logger=e.logger,this._trackAllContexts=e.trackAllContexts,this._reAnnounceKnownContexts=e.reAnnounceKnownContexts,this._gw3Session=this._connection.domain("global",[Je,$e,Ze,tt]),this._gw3Session.disconnected(this.resetState.bind(this)),this._gw3Session.onJoined((function(e){if(e)return n._reAnnounceKnownContexts?void n.reInitiateState().then((function(){return n._connection.setLibReAnnounced({name:"contexts"})})):n._connection.setLibReAnnounced({name:"contexts"})})),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(t=this._connection.replayer)||void 0===t||t.drain(rt.name,(function(e){var t=e.type;t&&(t===Je||t===Ke||t===He?n.handleContextCreatedMessage(e):t===$e||t===tt||t===nt?n.handleContextUpdatedMessage(e):t!==Ze&&t!==Ve||n.handleContextDestroyedMessage(e))}))}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;if(!this._protocolVersion){var t=this._connection.availableDomains.find((function(e){return"context"===e.uri}));this._protocolVersion=null!==(e=null===t||void 0===t?void 0:t.version)&&void 0!==e?e:1}return this._protocolVersion},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this.protocolVersion>=2},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var e=0,t=this._gw3Subscriptions;e<t.length;e++){var n=t[e];this._connection.off(n)}for(var r in this._gw3Subscriptions.length=0,this._contextNameToData)this._contextNameToId.hasOwnProperty(r)&&delete this._contextNameToData[r]},e.prototype.createContext=function(e,t){var n=this;return this._gw3Session.send({type:Be,domain:"global",name:e,data:t,lifetime:"retained"}).then((function(r){n._contextNameToId[e]=r.context_id,n._contextIdToName[r.context_id]=e;var i=n._contextNameToData[e]||new at(r.context_id,e,!0,void 0);return i.isAnnounced=!0,i.name=e,i.contextId=r.context_id,i.context=r.data||t,i.hasReceivedSnapshot=!0,n._contextNameToData[e]=i,r.context_id}))},e.prototype.all=function(){var e=this;return Object.keys(this._contextNameToData).filter((function(t){return e._contextNameToData[t].isAnnounced}))},e.prototype.update=function(e,t){var n;return b(this,void 0,void 0,(function(){var r,i,o,a=this;return k(this,(function(s){switch(s.label){case 0:return(r=this._contextNameToData[e])&&r.isAnnounced?(i=r.context,r.hasCallbacks()?[3,2]:[4,this.get(r.name)]):[2,this.createContext(e,t)];case 1:i=s.sent(),s.label=2;case 2:return o=2===this.protocolVersion?this.calculateContextDeltaV2(i,t):this.calculateContextDeltaV1(i,t),Object.keys(o.added).length||Object.keys(o.updated).length||o.removed.length||(null===(n=o.commands)||void 0===n?void 0:n.length)?[2,this._gw3Session.send({type:et,domain:"global",context_id:r.contextId,delta:o},{},{skipPeerId:!1}).then((function(e){a.handleUpdated(r,o,{updaterId:e.peer_id})}))]:[2,Promise.resolve()]}}))}))},e.prototype.set=function(e,t){var n=this,r=this._contextNameToData[e];return r&&r.isAnnounced?this._gw3Session.send({type:et,domain:"global",context_id:r.contextId,delta:{reset:t}},{},{skipPeerId:!1}).then((function(e){n.handleUpdated(r,{reset:t,added:{},removed:[],updated:{}},{updaterId:e.peer_id})})):this.createContext(e,t)},e.prototype.setPath=function(e,t,n){return this.setPathSupported?this.setPaths(e,[{path:t,value:n}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")},e.prototype.setPaths=function(e,t){var n=this;if(!this.setPathSupported)return Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later");var r=this._contextNameToData[e];if(!r||!r.isAnnounced){for(var i={},o=0,a=t;o<a.length;o++)dt(i,(l=a[o]).value,l.path);return this.createContext(e,i)}for(var s=[],u=0,c=t;u<c.length;u++){var l;null===(l=c[u]).value?s.push({type:"remove",path:l.path}):s.push({type:"set",path:l.path,value:l.value})}return this._gw3Session.send({type:et,domain:"global",context_id:r.contextId,delta:{commands:s}},{},{skipPeerId:!1}).then((function(e){n.handleUpdated(r,{added:{},removed:[],updated:{},commands:s},{updaterId:e.peer_id})}))},e.prototype.get=function(e){var t,n=this,r=this._contextNameToData[e];if(!r||!r.isAnnounced)return Promise.resolve({});if(r&&(!r.hasCallbacks()||!r.hasReceivedSnapshot))return new Promise((function(t){n.subscribe(e,(function(e,r,i,o){n.unsubscribe(o),t(e)}))}));var i=null!==(t=null===r||void 0===r?void 0:r.context)&&void 0!==t?t:{};return Promise.resolve(i)},e.prototype.subscribe=function(e,t,n){var r=this,i="undefined"===typeof n?this._nextCallbackSubscriptionNumber:n;"undefined"===typeof n&&(this._nextCallbackSubscriptionNumber+=1),this._contextsSubscriptionsCache.every((function(e){return e.subKey!==r._nextCallbackSubscriptionNumber}))&&this._contextsSubscriptionsCache.push({contextName:e,subKey:i,callback:t});var o=this._contextNameToData[e];if(!o||!o.isAnnounced)return o=o||new at(void 0,e,!1,void 0),this._contextNameToData[e]=o,o.updateCallbacks[i]=t,Promise.resolve(i);var a,s=o.hasCallbacks();return o.updateCallbacks[i]=t,s||o.joinedActivity||o.context&&o.sentExplicitSubscription?(o.hasReceivedSnapshot&&t(a=ut(o.context),a,[],i),Promise.resolve(i)):this.sendSubscribe(o).then((function(){return i}))},e.prototype.unsubscribe=function(e){this._contextsSubscriptionsCache=this._contextsSubscriptionsCache.filter((function(t){return t.subKey!==e}));for(var t=0,n=Object.keys(this._contextNameToData);t<n.length;t++){var r=n[t],i=this._contextNameToData[r];if(!i)return;var o=i.hasCallbacks();delete i.updateCallbacks[e],i.isAnnounced&&o&&!i.hasCallbacks()&&i.sentExplicitSubscription&&this.sendUnsubscribe(i),i.isAnnounced||i.hasCallbacks()||delete this._contextNameToData[r]}},e.prototype.destroy=function(e){var t=this._contextNameToData[e];return t?this._gw3Session.send({type:Xe,domain:"global",context_id:t.contextId}).then((function(e){})):Promise.reject("context with "+e+" does not exist")},e.prototype.handleUpdated=function(e,t,n){var r=e.context;e.context=st(e.context,t,this._logger),e.hasReceivedSnapshot=!0,this._contextNameToData[e.name]!==e||lt(r,e.context)||this.invokeUpdateCallbacks(e,t,n)},e.prototype.subscribeToContextCreatedMessages=function(){for(var e=0,t=[Ke,Je,He];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextCreatedMessage=function(e){var t=this,n=e.type;n===He?(this._contextNameToId[e.activity_id]=e.context_id,this._contextIdToName[e.context_id]=e.activity_id):n===Ke&&(this._contextNameToId[e.name]=e.context_id,this._contextIdToName[e.context_id]=e.name);var r=this._contextIdToName[e.context_id];if(!r)throw new Error("Received created event for context with unknown name: "+e.context_id);if(!this._contextNameToId[r])throw new Error("Received created event for context with unknown id: "+e.context_id);var i=this._contextNameToData[r];if(i){if(i.isAnnounced)return;if(!i.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");i.isAnnounced=!0,i.contextId=e.context_id,i.activityId=e.activity_id,i.sentExplicitSubscription||this.sendSubscribe(i)}else this._contextNameToData[r]=i=new at(e.context_id,r,!0,e.activity_id),this._trackAllContexts&&this.subscribe(r,(function(){})).then((function(e){return t._systemContextsSubKey=e}))},e.prototype.subscribeToContextUpdatedMessages=function(){for(var e=0,t=[tt,$e,nt];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextUpdatedMessage=function(e){var t=e.type,n=e.context_id,r=this._contextNameToData[this._contextIdToName[n]],i=!r||!r.isAnnounced;if(t===nt)r?(r.contextId=n,r.isAnnounced=!0,r.activityId=e.activity_id):(r=new at(n,e.activity_id,!0,e.activity_id),this._contextNameToData[e.activity_id]=r,this._contextIdToName[n]=e.activity_id,this._contextNameToId[e.activity_id]=n),r.joinedActivity=!0;else if(!r||!r.isAnnounced)return void(t===$e?((r=r||new at(n,e.name,!0,void 0)).sentExplicitSubscription=!0,this._contextNameToData[e.name]=r,this._contextIdToName[n]=e.name,this._contextNameToId[e.name]=n):this._logger.error("Received 'update' for unknown context: "+n));var o=r.context;if(r.hasReceivedSnapshot=!0,t===$e)r.context=e.data||{};else if(t===nt)r.context=e.context_snapshot||{};else{if(t!==tt)throw new Error("Unrecognized context update message "+t);r.context=st(r.context,e.delta,this._logger)}!i&&lt(r.context,o)&&t!==$e||this.invokeUpdateCallbacks(r,e.delta,{updaterId:e.updater_id})},e.prototype.invokeUpdateCallbacks=function(e,t,n){if((t=t||{added:{},updated:{},reset:{},removed:[]}).commands){t.added=t.updated=t.reset={},t.removed=[];for(var r=0,i=t.commands;r<i.length;r++){var o=i[r];"remove"===o.type?(-1===o.path.indexOf(".")&&t.removed.push(o.path),dt(t.updated,null,o.path)):"set"===o.type&&dt(t.updated,o.value,o.path)}}for(var a in e.updateCallbacks)if(e.updateCallbacks.hasOwnProperty(a))try{(0,e.updateCallbacks[a])(ut(e.context),Object.assign({},t.added||{},t.updated||{},t.reset||{}),t.removed,parseInt(a,10),n)}catch(s){this._logger.debug("callback error: "+JSON.stringify(s))}},e.prototype.subscribeToContextDestroyedMessages=function(){for(var e=0,t=[Ze,Ve];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextDestroyedMessage=function(e){var t,n;if(e.type===Ve){if(n=e.activity_id,!(t=this._contextNameToId[n]))return void this._logger.error("Received 'destroyed' for unknown activity: "+e.activity_id)}else if(t=e.context_id,!(n=this._contextIdToName[t]))return void this._logger.error("Received 'destroyed' for unknown context: "+e.context_id);delete this._contextIdToName[t],delete this._contextNameToId[n];var r=this._contextNameToData[n];delete this._contextNameToData[n],r&&r.isAnnounced||this._logger.error("Received 'destroyed' for unknown context: "+t)},e.prototype.sendSubscribe=function(e){return e.sentExplicitSubscription=!0,this._gw3Session.send({type:Qe,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.sendUnsubscribe=function(e){return e.sentExplicitSubscription=!1,this._gw3Session.send({type:Ye,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.calculateContextDeltaV1=function(e,t){var n={added:{},updated:{},removed:[],reset:void 0};if(e)for(var r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];-1===Object.keys(t).indexOf(o)||null===t[o]||lt(e[o],t[o])||(n.updated[o]=t[o])}for(var a=0,s=Object.keys(t);a<s.length;a++)o=s[a],e&&-1!==Object.keys(e).indexOf(o)?null===t[o]&&n.removed.push(o):null!==t[o]&&(n.added[o]=t[o]);return n},e.prototype.calculateContextDeltaV2=function(e,t){for(var n,r,i={added:{},updated:{},removed:[],reset:void 0,commands:[]},o=0,a=Object.keys(t);o<a.length;o++){var s=a[o];null!==t[s]?lt(e?e[s]:null,t[s])||null===(n=i.commands)||void 0===n||n.push({type:"set",path:s,value:t[s]}):null===(r=i.commands)||void 0===r||r.push({type:"remove",path:s})}return i},e.prototype.resetState=function(){for(var e=this,t=0,n=this._gw3Subscriptions;t<n.length;t++){var r=n[t];this._connection.off(r)}this._systemContextsSubKey&&(this.unsubscribe(this._systemContextsSubKey),delete this._systemContextsSubKey),this._gw3Subscriptions=[],this._contextNameToId={},this._contextIdToName={},delete this._protocolVersion,this._contextsTempCache=Object.keys(this._contextNameToData).reduce((function(t,n){return t[n]=e._contextNameToData[n].context,t}),{}),this._contextNameToData={}},e.prototype.reInitiateState=function(){var e;return b(this,void 0,void 0,(function(){var t,n,r,i,o,a=this;return k(this,(function(s){switch(s.label){case 0:return this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(e=this._connection.replayer)||void 0===e||e.drain(rt.name,(function(e){var t=e.type;t&&(t===Je||t===Ke||t===He?a.handleContextCreatedMessage(e):t===$e||t===tt||t===nt?a.handleContextUpdatedMessage(e):t!==Ze&&t!==Ve||a.handleContextDestroyedMessage(e))})),[4,Promise.all(this._contextsSubscriptionsCache.map((function(e){return a.subscribe(e.contextName,e.callback,e.subKey)})))];case 1:return s.sent(),[4,this.flushQueue()];case 2:for(n in s.sent(),t=[],this._contextsTempCache)t.push(n);r=0,s.label=3;case 3:return r<t.length?(i=t[r],"object"!==typeof this._contextsTempCache[i]||0===Object.keys(this._contextsTempCache[i]).length?[3,6]:(o=this._contextsTempCache[i],this._logger.info("Re-announcing known context: "+i),[4,this.flushQueue()])):[3,7];case 4:return s.sent(),[4,this.update(i,o)];case 5:s.sent(),s.label=6;case 6:return r++,[3,3];case 7:return this._contextsTempCache={},this._logger.info("Contexts are re-announced"),[2]}}))}))},e.prototype.flushQueue=function(){return new Promise((function(e){return setTimeout((function(){return e()}),0)}))},e}(),gt=function(){function e(e){this._bridge=new vt(e)}return e.prototype.all=function(){return this._bridge.all()},e.prototype.update=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.update(e,t)},e.prototype.set=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.set(e,t)},e.prototype.setPath=function(e,t,n){return this.checkName(e),this.checkPath(t),""===t?(this.checkData(n),this.set(e,n)):this._bridge.setPath(e,t,n)},e.prototype.setPaths=function(e,t){if(this.checkName(e),!Array.isArray(t))throw new Error("Please provide the paths as an array of PathValues!");for(var n=0,r=t;n<r.length;n++){var i=r[n],o=i.path,a=i.value;this.checkPath(o),""===o&&this.checkData(a)}return this._bridge.setPaths(e,t)},e.prototype.subscribe=function(e,t){var n=this;if(this.checkName(e),"function"!==typeof t)throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(e,(function(e,r,i,o,a){return t(e,r,i,(function(){return n._bridge.unsubscribe(o)}),a)})).then((function(e){return function(){n._bridge.unsubscribe(e)}}))},e.prototype.get=function(e){return this.checkName(e),this._bridge.get(e)},e.prototype.ready=function(){return Promise.resolve(this)},e.prototype.destroy=function(e){return this.checkName(e),this._bridge.destroy(e)},Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this._bridge.setPathSupported},enumerable:!0,configurable:!0}),e.prototype.checkName=function(e){if("string"!==typeof e||""===e)throw new Error("Please provide the name as a non-empty string!")},e.prototype.checkPath=function(e){if("string"!==typeof e)throw new Error("Please provide the path as a dot delimited string!")},e.prototype.checkData=function(e){if("object"!==typeof e)throw new Error("Please provide the data as an object!")},e}();function yt(e,t,n){return"function"!==typeof t&&"function"!==typeof n?e:("function"!==typeof t?t=function(){}:"function"!==typeof n&&(n=function(){}),e.then(t,n))}function mt(e,t,n){var r;void 0===e&&(e=0);var i=function(){r&&clearTimeout(r)};return t.then((function(){i()})).catch((function(){i()})),new Promise((function(t,i){r=setTimeout((function(){return i(n)}),e)}))}!function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(ht||(ht={}));var wt=function(){function e(e,t,n,r){this.protocol=e,this.repo=t,this.instance=n,this.configuration=r}return e.prototype.subscribe=function(e,t,n,r,i){var o=this,a=function(e,n,r,a){var s;t.methodResponseTimeout=null!==(s=t.methodResponseTimeout)&&void 0!==s?s:t.waitTimeoutMs,o.protocol.client.subscribe(n,t,e,r,a,i)};return yt(new Promise((function(n,r){var i,s=function(e){n(e)},u=function(e){r(e)};if(e)if((i="string"===typeof e?{name:e}:e).name){void 0===t&&(t={});var c=t.target;if(void 0===c&&(c="best"),"string"!==typeof c||"all"===c||"best"===c){void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=t.method_response_timeout,void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=o.configuration.methodResponseTimeout)),void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=t.wait_for_method_timeout,void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=o.configuration.waitTimeoutMs));var l=500,d=0,p=o.getServerMethodsByFilterAndTarget(i,c);if(p.length>0)a(p,p[0].methods[0],s,u);else{var f=function n(){if(c&&t.waitTimeoutMs)if(d+=l,(p=o.getServerMethodsByFilterAndTarget(i,c)).length>0){var r=p[0].methods[0];a(p,r,s,u)}else d>=t.waitTimeoutMs?a(p,"string"===typeof e?{name:e}:e,s,u):setTimeout(n,l)};setTimeout(f,l)}}else r(new Error('"'+c+'" is not a valid target. Valid targets are "all", "best", or an instance.'))}else r("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");else r("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.")})),n,r)},e.prototype.servers=function(e){var t=void 0===e?void 0:w({},e);return this.getServers(t).map((function(e){return e.server.instance}))},e.prototype.methods=function(e){return e="string"===typeof e?{name:e}:w({},e),this.getMethods(e)},e.prototype.methodsForInstance=function(e){return this.getMethodsForInstance(e)},e.prototype.methodAdded=function(e){return this.repo.onMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.repo.onMethodRemoved(e)},e.prototype.serverAdded=function(e){return this.repo.onServerAdded(e)},e.prototype.serverRemoved=function(e){return this.repo.onServerRemoved((function(t,n){e(t,n)}))},e.prototype.serverMethodAdded=function(e){return this.repo.onServerMethodAdded((function(t,n){e({server:t,method:n})}))},e.prototype.serverMethodRemoved=function(e){return this.repo.onServerMethodRemoved((function(t,n){e({server:t,method:n})}))},e.prototype.invoke=function(e,t,n,r,i,o){return b(this,void 0,void 0,(function(){var a,s=this;return k(this,(function(u){return a=function(){return b(s,void 0,void 0,(function(){var i,o,a,s,u,c,l,d,p,f,h,v,g=this;return k(this,(function(y){switch(y.label){case 0:if(!(i="string"===typeof e?{name:e}:w({},e)).name)return[2,Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.")];if(t||(t={}),n||(n="best"),"string"===typeof n&&"all"!==n&&"best"!==n&&"skipMine"!==n)return[2,Promise.reject(new Error('"'+n+'" is not a valid target. Valid targets are "all" and "best".'))];if(r||(r={}),void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=r.method_response_timeout,void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=r.wait_for_method_timeout,void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=this.configuration.waitTimeoutMs)),void 0!==r.waitTimeoutMs&&"number"!==typeof r.waitTimeoutMs)return[2,Promise.reject(new Error('"'+r.waitTimeoutMs+'" is not a valid number for "waitTimeoutMs" '))];if("object"!==typeof t)return[2,Promise.reject(new Error("The method arguments must be an object. method: "+i.name))];if(0!==(o=this.getServerMethodsByFilterAndTarget(i,n)).length)return[3,4];y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.tryToAwaitForMethods(i,n,r)];case 2:return o=y.sent(),[3,4];case 3:return y.sent(),a=w(w({},i),{getServers:function(){return[]},supportsStreaming:!1,objectTypes:null!==(f=i.objectTypes)&&void 0!==f?f:[],flags:null!==(v=null===(h=i.flags)||void 0===h?void 0:h.metadata)&&void 0!==v?v:{}}),s={method:a,called_with:t,message:"Can not find a method matching "+JSON.stringify(e)+" with server filter "+JSON.stringify(n),executed_by:void 0,returned:void 0,status:void 0},[2,Promise.reject(s)];case 4:return u=r.methodResponseTimeoutMs,c=r,l=o.map((function(e){var n=Oe(),r=e.methods[0],i=e.server,o=g.protocol.client.invoke(n,r,t,i,c);return Promise.race([o,mt(u,o,{invocationId:n,message:"Invocation timeout ("+u+" ms) reached for method name: "+(null===r||void 0===r?void 0:r.name)+", target instance: "+JSON.stringify(i.instance)+", options: "+JSON.stringify(c),status:ht.Error})])})),[4,Promise.all(l)];case 5:return d=y.sent(),p=this.getInvocationResultObj(d,i,t),d.every((function(e){return e.status===ht.Error}))?[2,Promise.reject(p)]:[2,p]}}))}))},[2,yt(a(),i,o)]}))}))},e.prototype.getInvocationResultObj=function(e,t,n){var r=e.filter((function(e){return e.status===ht.Success})).reduce((function(e,r){return e=x(e,[{executed_by:r.instance,returned:r.result,called_with:n,method:t,message:r.message,status:r.status}])}),[]),i=e.filter((function(e){return e.status===ht.Error})).reduce((function(e,r){return e=x(e,[{executed_by:r.instance,called_with:n,name:t.name,message:r.message}])}),[]),o=e[0];return{method:t,called_with:n,returned:o.result,executed_by:o.instance,all_return_values:r,all_errors:i,message:o.message,status:o.status}},e.prototype.tryToAwaitForMethods=function(e,t,n){var r=this;return new Promise((function(i,o){if(0!==n.waitTimeoutMs)var a=500,s=0,u=setInterval((function(){s+=a;var c=r.getServerMethodsByFilterAndTarget(e,t);if(c.length>0)clearInterval(u),i(c);else if(s>=(n.waitTimeoutMs||1e4))return clearInterval(u),void o()}),a);else o()}))},e.prototype.filterByTarget=function(e,t){var n=this;if("string"!==typeof e)return(Array.isArray(e)?e:[e]).reduce((function(e,r){var i=t.filter((function(e){return n.instanceMatch(r,e.server.instance)}));return e.concat(i)}),[]);if("all"===e)return x(t);if("best"===e){var r=t.find((function(e){return e.server.instance.isLocal}));if(r)return[r];if(void 0!==t[0])return[t[0]]}else if("skipMine"===e)return t.filter((function(e){return e.server.instance.peerId!==n.instance.peerId}));return[]},e.prototype.instanceMatch=function(e,t){return this.containsProps(e,t)},e.prototype.methodMatch=function(e,t){return this.containsProps(e,t)},e.prototype.containsProps=function(e,t){return Object.keys(e).filter((function(t){return void 0!==e[t]&&null!==e[t]&&"function"!==typeof e[t]&&"object_types"!==t&&"display_name"!==t&&"id"!==t&&"gatewayId"!==t&&"identifier"!==t&&"_"!==t[0]})).every((function(n){var r,i=e[n],o=t[n];switch(n){case"objectTypes":r=(i||[]).every((function(e){return(o||[]).includes(e)}));break;case"flags":r=pt(o||{},i||{});break;default:r=String(i).toLowerCase()===String(o).toLowerCase()}return r}))},e.prototype.getMethods=function(e){var t=this;return void 0===e?this.repo.getMethods():this.repo.getMethods().filter((function(n){return t.methodMatch(e,n)}))},e.prototype.getMethodsForInstance=function(e){var t=this,n=this.repo.getServers().filter((function(n){return t.instanceMatch(e,n.instance)}));if(0===n.length)return[];var r={};return 1===n.length?r=n[0].methods:n.forEach((function(e){Object.keys(e.methods).forEach((function(t){var n=e.methods[t];r[n.identifier]=n}))})),Object.keys(r).map((function(e){return r[e]}))},e.prototype.getServers=function(e){var t=this,n=this.repo.getServers();return void 0===e?n.map((function(e){return{server:e,methods:[]}})):n.reduce((function(n,r){var i=Object.values(r.methods).filter((function(n){return t.methodMatch(e,n)}));return i.length>0&&n.push({server:r,methods:i}),n}),[])},e.prototype.getServerMethodsByFilterAndTarget=function(e,t){var n=this.getServers(e);return this.filterByTarget(t,n)},e}(),bt=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.subscription=n}return Object.defineProperty(e.prototype,"stream",{get:function(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instance",{get:function(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance},enumerable:!0,configurable:!0}),e.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},e.prototype.push=function(e){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,e)},e}(),kt=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.requestContext=n,this.arguments=n.arguments,this.instance=n.instance}return e.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},e.prototype.acceptOnBranch=function(e){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,e)},e.prototype.reject=function(e){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,e)},e}(),xt=function(){function e(e,t){var n=this;this.protocol=e,this.server=t,e.server.onSubRequest((function(e,t){return n.handleSubRequest(e,t)})),e.server.onSubAdded((function(e,t){return n.handleSubAdded(e,t)})),e.server.onSubRemoved((function(e,t){return n.handleSubRemoved(e,t)}))}return e.prototype.handleSubRequest=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionRequestHandler){var n=new kt(this.protocol,t,e);t.streamCallbacks.subscriptionRequestHandler(n)}},e.prototype.handleSubAdded=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionAddedHandler){var n=new bt(this.protocol,t,e);t.streamCallbacks.subscriptionAddedHandler(n)}},e.prototype.handleSubRemoved=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionRemovedHandler){var n=new bt(this.protocol,t,e);t.streamCallbacks.subscriptionRemovedHandler(n)}},e}(),_t=function(){function e(e,t,n){this.key=e,this.protocol=t,this.repoMethod=n}return e.prototype.subscriptions=function(){var e=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map((function(t){return new bt(e.protocol,e.repoMethod,t)}))},e.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},e.prototype.push=function(e){this.protocol.server.pushData(this.repoMethod,e,[this.key])},e}(),St=function(){function e(e,t,n){this._protocol=e,this._repoMethod=t,this._server=n,this.name=this._repoMethod.definition.name}return e.prototype.branches=function(e){var t=this,n=this._protocol.server.getBranchList(this._repoMethod);return e?n.indexOf(e)>-1?new _t(e,this._protocol,this._repoMethod):void 0:n.map((function(e){return new _t(e,t._protocol,t._repoMethod)}))},e.prototype.branch=function(e){return this.branches(e)},e.prototype.subscriptions=function(){var e=this;return this._protocol.server.getSubscriptionList(this._repoMethod).map((function(t){return new bt(e._protocol,e._repoMethod,t)}))},Object.defineProperty(e.prototype,"definition",{get:function(){var e,t=this._repoMethod.definition;return{accepts:t.accepts,description:t.description,displayName:t.displayName,name:t.name,objectTypes:t.objectTypes,returns:t.returns,supportsStreaming:t.supportsStreaming,flags:null===(e=t.flags)||void 0===e?void 0:e.metadata}},enumerable:!0,configurable:!0}),e.prototype.close=function(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)},e.prototype.push=function(e,t){if("string"!==typeof t&&!Array.isArray(t)&&void 0!==t)throw new Error("invalid branches should be string or string array");if("object"!==typeof e)throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,e,t)},e.prototype.updateRepoMethod=function(e){this._repoMethod=e},e}(),It=function(){function e(e,t){this.protocol=e,this.serverRepository=t,this.invocations=0,this.currentlyUnregistering={},this.streaming=new xt(e,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return e.prototype.createStream=function(e,t,n,r,i){var o=this;return yt(new Promise((function(n,r){if(e){var a;if(!(a="string"===typeof e?{name:""+e}:w({},e)).name)return r("The \u201cname\u201d property is required for the \u201cstreamDefinition\u201d object and must be unique. Stream definition: "+JSON.stringify(a));if(o.serverRepository.getList().some((function(e){return e.definition.name===a.name})))return r('A stream with the name "'+a.name+'" already exists! Please, provide a unique name for the stream.');a.supportsStreaming=!0,t||(t={}),"function"!==typeof t.subscriptionRequestHandler&&(t.subscriptionRequestHandler=function(e){e.accept()});var s=o.serverRepository.add({definition:a,streamCallbacks:t,protocolState:{}});o.protocol.server.createStream(s).then((function(){var e;i?(e=i,i.updateRepoMethod(s)):e=new St(o.protocol,s,o),s.stream=e,n(e)})).catch((function(e){s.repoId&&o.serverRepository.remove(s.repoId),r(e)}))}else r("The stream name must be unique! Please, provide either a unique string for a stream name to \u201cglue.interop.createStream()\u201d or a \u201cmethodDefinition\u201d object with a unique \u201cname\u201d property for the stream.")})),n,r)},e.prototype.register=function(e,t){var n=this;if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");if("function"!==typeof t)return Promise.reject("The second parameter must be a callback function. Method: "+("string"===typeof e?e:e.name));var r=function(e,r){return b(n,void 0,void 0,(function(){var n,i,o;return k(this,(function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),(n=t(e.args,e.instance))&&"function"===typeof n.then?[4,n]:[3,2];case 1:return i=a.sent(),r(void 0,i),[3,3];case 2:r(void 0,n),a.label=3;case 3:return[3,5];case 4:return(o=a.sent())||(o=""),r(o,o),[3,5];case 5:return[2]}}))}))};return r.userCallback=t,this.registerCore(e,r)},e.prototype.registerAsync=function(e,t){if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");if("function"!==typeof t)return Promise.reject("The second parameter must be a callback function. Method: "+("string"===typeof e?e:e.name));var n=function(e,n){try{var r=!1,i=function(e){r||n(void 0,e),r=!0},o=function(e){r||(e||(e=""),n(e,e)),r=!0},a=t(e.args,e.instance,i,o);a&&"function"===typeof a.then&&a.then(i).catch(o)}catch(s){n(s,void 0)}};return n.userCallbackAsync=t,this.registerCore(e,n)},e.prototype.unregister=function(e,t){return void 0===t&&(t=!1),b(this,void 0,void 0,(function(){var n,r;return k(this,(function(i){switch(i.label){case 0:return void 0===e?[2,Promise.reject("Please, provide either a unique string for a name or an object containing a \u201cname\u201d property.")]:"function"!==typeof e?[3,2]:[4,this.unregisterWithPredicate(e,t)];case 1:case 3:return i.sent(),[2];case 2:return void 0===(n="string"===typeof e?{name:e}:e).name?[2,Promise.reject("Method name is required. Cannot find a method if the method name is undefined!")]:(r=this.serverRepository.getList().find((function(e){return e.definition.name===n.name&&(e.definition.supportsStreaming||!1)===t})))?[4,this.removeMethodsOrStreams([r])]:[2,Promise.reject('Method with a name "'+n.name+'" does not exist or is not registered by your application!')]}}))}))},e.prototype.unregisterWithPredicate=function(e,t){return b(this,void 0,void 0,(function(){var n;return k(this,(function(r){switch(r.label){case 0:return(n=this.serverRepository.getList().filter((function(t){return e(t.definition)})).filter((function(e){return(e.definition.supportsStreaming||!1)===t})))&&0!==n.length?[4,this.removeMethodsOrStreams(n)]:[2,Promise.reject("Could not find a "+(t?"stream":"method")+" matching the specified condition!")];case 1:return r.sent(),[2]}}))}))},e.prototype.removeMethodsOrStreams=function(e){var t=this,n=[];return e.forEach((function(e){var r=t.protocol.server.unregister(e).then((function(){e.repoId&&t.serverRepository.remove(e.repoId)}));n.push(r),t.addAsCurrentlyUnregistering(e.definition.name,r)})),Promise.all(n)},e.prototype.addAsCurrentlyUnregistering=function(e,t){return b(this,void 0,void 0,(function(){var n,r=this;return k(this,(function(i){return n=new Promise((function(e){return setTimeout(e,5e3)})),this.currentlyUnregistering[e]=Promise.race([t,n]).then((function(){delete r.currentlyUnregistering[e]})),[2]}))}))},e.prototype.registerCore=function(e,t){return b(this,void 0,void 0,(function(){var n,r,i,o=this;return k(this,(function(a){switch(a.label){case 0:return(n="string"===typeof e?{name:""+e}:w({},e)).name?(r=this.currentlyUnregistering[n.name])?[4,r]:[3,2]:[2,Promise.reject("Please, provide a (unique) string value for the \u201cname\u201d property in the \u201cmethodDefinition\u201d object: "+JSON.stringify(e))];case 1:a.sent(),a.label=2;case 2:return this.serverRepository.getList().some((function(e){return e.definition.name===n.name}))?[2,Promise.reject('A method with the name "'+n.name+'" already exists! Please, provide a unique name for the method.')]:n.supportsStreaming?[2,Promise.reject("When you create methods with \u201cglue.interop.register()\u201d or \u201cglue.interop.registerAsync()\u201d the property \u201csupportsStreaming\u201d cannot be \u201ctrue\u201d. If you want \u201c"+n.name+"\u201d to be a stream, please use the \u201cglue.interop.createStream()\u201d method.")]:(i=this.serverRepository.add({definition:n,theFunction:t,protocolState:{}}),[2,this.protocol.server.register(i).catch((function(e){throw(null===i||void 0===i?void 0:i.repoId)&&o.serverRepository.remove(i.repoId),e}))])}}))}))},e.prototype.onMethodInvoked=function(e,t,n){var r=this;e&&e.theFunction&&e.theFunction(n,(function(n,i){if(void 0!==n&&null!==n)if(n.message&&"string"===typeof n.message)n=n.message;else if("string"!==typeof n)try{n=JSON.stringify(n)}catch(o){n="un-stringifyable error in onMethodInvoked! Top level prop names: "+Object.keys(n)}i?("object"!==typeof i||Array.isArray(i))&&(i={_value:i}):i={},r.protocol.server.methodInvocationResult(e,t,n,i)}))},e}(),Ct=function(){function e(e,t,n){var r=this;this.wrapped={},this.wrapped.getMethods=function(){return e.methodsForInstance(this)},this.wrapped.getStreams=function(){return e.methodsForInstance(this).filter((function(e){return e.supportsStreaming}))},t&&this.refreshWrappedObject(t),n&&(n.loggedIn((function(){r.refresh(n)})),this.refresh(n))}return e.prototype.unwrap=function(){return this.wrapped},e.prototype.refresh=function(e){if(e){var t=null===e||void 0===e?void 0:e.resolvedIdentity,n=Object.assign({},null!==t&&void 0!==t?t:{},{peerId:null===e||void 0===e?void 0:e.peerId});this.refreshWrappedObject(n)}},e.prototype.refreshWrappedObject=function(e){var t,n,r,i,o=this;Object.keys(e).forEach((function(t){o.wrapped[t]=e[t]})),this.wrapped.user=e.user,this.wrapped.instance=e.instance,this.wrapped.application=null!==(t=e.application)&&void 0!==t?t:Oe(),this.wrapped.applicationName=e.applicationName,this.wrapped.pid=null!==(r=null!==(n=e.pid)&&void 0!==n?n:e.process)&&void 0!==r?r:Math.floor(1e10*Math.random()),this.wrapped.machine=e.machine,this.wrapped.environment=e.environment,this.wrapped.region=e.region,this.wrapped.windowId=e.windowId,this.wrapped.isLocal=null===(i=e.isLocal)||void 0===i||i,this.wrapped.api=e.api,this.wrapped.service=e.service,this.wrapped.peerId=e.peerId},e}(),Tt=function(e){return w(w({},e),{flags:e.flags.metadata||{}})},At=function(){function e(e,t){this.logger=e,this.API=t,this.servers={},this.methodsCount={},this.callbacks=$();var n=this.API.instance.peerId;this.myServer={id:n,methods:{},instance:this.API.instance,wrapper:this.API.unwrappedInstance},this.servers[n]=this.myServer}return e.prototype.addServer=function(e,t){this.logger.debug("adding server "+t);var n=this.servers[t];if(n)return n.id;var r=new Ct(this.API,e),i={id:t,methods:{},instance:r.unwrap(),wrapper:r};return this.servers[t]=i,this.callbacks.execute("onServerAdded",i.instance),t},e.prototype.removeServerById=function(e,t){var n=this,r=this.servers[e];r?(this.logger.debug("removing server "+e),Object.keys(r.methods).forEach((function(t){n.removeServerMethod(e,t)})),delete this.servers[e],this.callbacks.execute("onServerRemoved",r.instance,t)):this.logger.warn("not aware of server "+e+", my state "+JSON.stringify(Object.keys(this.servers)))},e.prototype.addServerMethod=function(e,t){var n,r=this.servers[e];if(!r)throw new Error("server does not exists");if(!r.methods[t.id]){var i=this.createMethodIdentifier(t),o=this,a={identifier:i,gatewayId:t.id,name:t.name,displayName:t.display_name,description:t.description,version:t.version,objectTypes:t.object_types||[],accepts:t.input_signature,returns:t.result_signature,supportsStreaming:"undefined"!==typeof t.flags&&t.flags.streaming,flags:null!==(n=t.flags)&&void 0!==n?n:{},getServers:function(){return o.getServersByMethod(i)}};a.object_types=a.objectTypes,a.display_name=a.displayName,a.version=a.version,r.methods[t.id]=a;var s=Tt(a);return this.methodsCount[i]||(this.methodsCount[i]=0,this.callbacks.execute("onMethodAdded",s)),this.methodsCount[i]=this.methodsCount[i]+1,this.callbacks.execute("onServerMethodAdded",r.instance,s),a}},e.prototype.removeServerMethod=function(e,t){var n=this.servers[e];if(!n)throw new Error("server does not exists");var r=n.methods[t];delete n.methods[t];var i=Tt(r);this.methodsCount[r.identifier]=this.methodsCount[r.identifier]-1,0===this.methodsCount[r.identifier]&&this.callbacks.execute("onMethodRemoved",i),this.callbacks.execute("onServerMethodRemoved",n.instance,i)},e.prototype.getMethods=function(){return this.extractMethodsFromServers(Object.values(this.servers)).map(Tt)},e.prototype.getServers=function(){return Object.values(this.servers).map(this.hideServerMethodSystemFlags)},e.prototype.onServerAdded=function(e){var t=this.callbacks.add("onServerAdded",e),n=this.getServers().map((function(e){return e.instance}));return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onMethodAdded=function(e){var t=this.callbacks.add("onMethodAdded",e),n=this.getMethods();return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onServerMethodAdded=function(e){var t=this.callbacks.add("onServerMethodAdded",e),n=!1,r=this.getServers();return setTimeout((function(){r.forEach((function(t){var r=t.methods;Object.keys(r).forEach((function(i){n||e(t.instance,r[i])}))}))}),0),function(){n=!0,t()}},e.prototype.onMethodRemoved=function(e){return this.callbacks.add("onMethodRemoved",e)},e.prototype.onServerRemoved=function(e){return this.callbacks.add("onServerRemoved",e)},e.prototype.onServerMethodRemoved=function(e){return this.callbacks.add("onServerMethodRemoved",e)},e.prototype.getServerById=function(e){return this.hideServerMethodSystemFlags(this.servers[e])},e.prototype.reset=function(){var e,t=this;Object.keys(this.servers).forEach((function(e){t.removeServerById(e,"reset")})),this.servers=((e={})[this.myServer.id]=this.myServer,e),this.methodsCount={}},e.prototype.createMethodIdentifier=function(e){var t,n,r=null!==(t=e.input_signature)&&void 0!==t?t:"",i=null!==(n=e.result_signature)&&void 0!==n?n:"";return(e.name+r+i).toLowerCase()},e.prototype.getServersByMethod=function(e){var t=[];return Object.values(this.servers).forEach((function(n){Object.values(n.methods).forEach((function(r){r.identifier===e&&t.push(n.instance)}))})),t},e.prototype.returnUnsubWithDelayedReplay=function(e,t,n){var r=!1;return setTimeout((function(){t.forEach((function(e){r||n(e)}))}),0),function(){r=!0,e()}},e.prototype.hideServerMethodSystemFlags=function(e){var t={};return Object.entries(e.methods).forEach((function(e){var n=e[0],r=e[1];t[n]=Tt(r)})),w(w({},e),{methods:t})},e.prototype.extractMethodsFromServers=function(e){return Object.values(e).reduce((function(e,t){return x(e,Object.values(t.methods))}),[])},e}(),Et=function(){function e(){this.nextId=0,this.methods=[]}return e.prototype.add=function(e){return e.repoId=String(this.nextId),this.nextId+=1,this.methods.push(e),e},e.prototype.remove=function(e){if("string"!==typeof e)return new TypeError("Expecting a string");this.methods=this.methods.filter((function(t){return t.repoId!==e}))},e.prototype.getById=function(e){if("string"===typeof e)return this.methods.find((function(t){return t.repoId===e}))},e.prototype.getList=function(){return this.methods.map((function(e){return e}))},e.prototype.length=function(){return this.methods.length},e.prototype.reset=function(){this.methods=[]},e}(),Pt="onSubscriptionRequest",Mt="onSubscriptionAdded",Rt="onSubscriptionRemoved",Ot=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.serverRepository=n,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=$(),this.nextStreamId=0,e.on("add-interest",(function(e){r.handleAddInterest(e)})),e.on("remove-interest",(function(e){r.handleRemoveInterest(e)}))}return e.prototype.acceptRequestOnBranch=function(e,t,n){if("string"!==typeof n&&(n=""),"object"!==typeof t.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(t.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var r=this.getStreamId(t,n),i=e.msg.subscription_id,o={id:i,arguments:e.arguments,instance:e.instance,branchKey:n,streamId:r,subscribeMsg:e.msg};t.protocolState.subscriptionsMap[i]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:i,stream_id:r}),this.callbacks.execute(Mt,o,t)},e.prototype.rejectRequest=function(e,t,n){"string"!==typeof n&&(n=""),this.sendSubscriptionFailed("Subscription rejected by user. "+n,e.msg.subscription_id)},e.prototype.pushData=function(e,t,n){var r=this;if("object"===typeof e&&Array.isArray(e.protocolState.branchKeyToStreamIdMap)){if("object"!==typeof t)throw new Error("Invalid arguments. Data must be an object.");"string"===typeof n?n=[n]:(!Array.isArray(n)||n.length<=0)&&(n=[]),e.protocolState.branchKeyToStreamIdMap.filter((function(e){return!n||0===n.length||n.indexOf(e.key)>=0})).map((function(e){return e.streamId})).forEach((function(e){var n={type:"publish",stream_id:e,data:t};r.session.sendFireAndForget(n)}))}},e.prototype.pushDataToSingle=function(e,t,n){if("object"!==typeof n)throw new Error("Invalid arguments. Data must be an object.");var r={type:"post",subscription_id:t.id,data:n};this.session.sendFireAndForget(r)},e.prototype.closeSingleSubscription=function(e,t){e.protocolState.subscriptionsMap&&delete e.protocolState.subscriptionsMap[t.id];var n={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(n),t.instance,this.callbacks.execute(Rt,t,e)},e.prototype.closeMultipleSubscriptions=function(e,t){var n=this;if("object"===typeof e&&"object"===typeof e.protocolState.subscriptionsMap&&e.protocolState.subscriptionsMap){var r=e.protocolState.subscriptionsMap,i=Object.keys(r).map((function(e){return r[e]}));"string"===typeof t&&(i=i.filter((function(e){return e.branchKey===t}))),i.forEach((function(e){delete r[e.id];var t={type:"drop-subscription",subscription_id:e.id,reason:"Server dropping all subscriptions on stream_id: "+e.streamId};n.session.sendFireAndForget(t)}))}},e.prototype.getSubscriptionList=function(e,t){if("object"!==typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var n=e.protocolState.subscriptionsMap,r=Object.keys(n).map((function(e){return n[e]}));return"string"!==typeof t?r:r.filter((function(e){return e.branchKey===t}))},e.prototype.getBranchList=function(e){if("object"!==typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var t=e.protocolState.subscriptionsMap,n=Object.keys(t).map((function(e){return t[e]})),r=[];return n.forEach((function(e){var t="";"object"===typeof e&&"string"===typeof e.branchKey&&(t=e.branchKey),-1===r.indexOf(t)&&r.push(t)})),r},e.prototype.onSubAdded=function(e){this.onSubscriptionLifetimeEvent(Mt,e)},e.prototype.onSubRequest=function(e){this.onSubscriptionLifetimeEvent(Pt,e)},e.prototype.onSubRemoved=function(e){this.onSubscriptionLifetimeEvent(Rt,e)},e.prototype.handleRemoveInterest=function(e){var t=this.serverRepository.getById(e.method_id);if("string"===typeof e.subscription_id&&"object"===typeof t&&t.protocolState.subscriptionsMap&&"object"===typeof t.protocolState.subscriptionsMap[e.subscription_id]){var n=t.protocolState.subscriptionsMap[e.subscription_id];delete t.protocolState.subscriptionsMap[e.subscription_id],this.callbacks.execute(Rt,n,t)}},e.prototype.onSubscriptionLifetimeEvent=function(e,t){this.callbacks.add(e,t)},e.prototype.getNextStreamId=function(){return this.nextStreamId+++""},e.prototype.handleAddInterest=function(e){var t=this.repository.getServerById(e.caller_id).instance,n={msg:e,arguments:e.arguments_kv||{},instance:t},r=this.serverRepository.getById(e.method_id);if(void 0!==r)r.protocolState.subscriptionsMap&&r.protocolState.subscriptionsMap[e.subscription_id]?this.sendSubscriptionFailed("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id):this.callbacks.execute(Pt,n,r);else{var i="No method with id "+e.method_id+" on this server.";this.sendSubscriptionFailed(i,e.subscription_id)}},e.prototype.sendSubscriptionFailed=function(e,t){var n={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:e,request_id:t};this.session.sendFireAndForget(n)},e.prototype.getStreamId=function(e,t){if("string"!==typeof t&&(t=""),!e.protocolState.branchKeyToStreamIdMap)throw new Error("streaming "+e.definition.name+" method without protocol state");var n=e.protocolState.branchKeyToStreamIdMap.filter((function(e){return e.key===t}))[0],r=n?n.streamId:void 0;return"string"===typeof r&&""!==r||(r=this.getNextStreamId(),e.protocolState.branchKeyToStreamIdMap.push({key:t,streamId:r})),r},e}(),jt=function(){function e(e,t,n,r){var i=this;this.session=e,this.clientRepository=t,this.serverRepository=n,this.logger=r,this.callbacks=$(),this.streaming=new Ot(e,t,n),this.session.on("invoke",(function(e){return i.handleInvokeMessage(e)}))}return e.prototype.createStream=function(e){return e.protocolState.subscriptionsMap={},e.protocolState.branchKeyToStreamIdMap=[],this.register(e,!0)},e.prototype.register=function(e,t){var n,r=this,i=e.definition,o=Object.assign({},{metadata:null!==(n=i.flags)&&void 0!==n?n:{}},{streaming:t||!1}),a={type:"register",methods:[{id:e.repoId,name:i.name,display_name:i.displayName,description:i.description,version:i.version,flags:o,object_types:i.objectTypes||i.object_types,input_signature:i.accepts,result_signature:i.returns,restrictions:void 0}]};return this.session.send(a,{methodId:e.repoId}).then((function(){r.logger.debug("registered method "+e.definition.name+" with id "+e.repoId)})).catch((function(t){throw r.logger.warn("failed to register method "+e.definition.name+" with id "+e.repoId+" - "+JSON.stringify(t)),t}))},e.prototype.onInvoked=function(e){this.callbacks.add("onInvoked",e)},e.prototype.methodInvocationResult=function(e,t,n,r){var i;i=n||""===n?{type:"error",request_id:t,reason_uri:"agm.errors.client_error",reason:n,context:r,peer_id:void 0}:{type:"yield",invocation_id:t,peer_id:this.session.peerId,result:r,request_id:void 0},this.session.sendFireAndForget(i)},e.prototype.unregister=function(e){return b(this,void 0,void 0,(function(){var t;return k(this,(function(n){switch(n.label){case 0:return t={type:"unregister",methods:[e.repoId]},[4,this.session.send(t)];case 1:return n.sent(),[2]}}))}))},e.prototype.getBranchList=function(e){return this.streaming.getBranchList(e)},e.prototype.getSubscriptionList=function(e,t){return this.streaming.getSubscriptionList(e,t)},e.prototype.closeAllSubscriptions=function(e,t){this.streaming.closeMultipleSubscriptions(e,t)},e.prototype.pushData=function(e,t,n){this.streaming.pushData(e,t,n)},e.prototype.pushDataToSingle=function(e,t,n){this.streaming.pushDataToSingle(e,t,n)},e.prototype.closeSingleSubscription=function(e,t){this.streaming.closeSingleSubscription(e,t)},e.prototype.acceptRequestOnBranch=function(e,t,n){this.streaming.acceptRequestOnBranch(e,t,n)},e.prototype.rejectRequest=function(e,t,n){this.streaming.rejectRequest(e,t,n)},e.prototype.onSubRequest=function(e){this.streaming.onSubRequest(e)},e.prototype.onSubAdded=function(e){this.streaming.onSubAdded(e)},e.prototype.onSubRemoved=function(e){this.streaming.onSubRemoved(e)},e.prototype.handleInvokeMessage=function(e){var t=e.invocation_id,n=e.caller_id,r=e.method_id,i=e.arguments_kv,o=this.serverRepository.getList().filter((function(e){return e.repoId===r}))[0];if(void 0!==o){var a={args:i,instance:this.clientRepository.getServerById(n).instance};this.callbacks.execute("onInvoked",o,t,a)}},e}(),Nt=function(){function e(e,t){this.repository=e,this.subscriptionData=t}return Object.defineProperty(e.prototype,"requestArguments",{get:function(){return this.subscriptionData.params.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"servers",{get:function(){var e=this;return this.subscriptionData.trackedServers.filter((function(e){return e.subscriptionId})).map((function(t){return e.repository.getServerById(t.serverId).instance}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverInstance",{get:function(){return this.servers[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stream",{get:function(){return this.subscriptionData.method},enumerable:!0,configurable:!0}),e.prototype.onData=function(e){if("function"!==typeof e)throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(e),1===this.subscriptionData.handlers.onData.length&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach((function(t){e(t)}))},e.prototype.onClosed=function(e){if("function"!==typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(e)},e.prototype.onFailed=function(e){},e.prototype.onConnected=function(e){if("function"!==typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(e)},e.prototype.close=function(){this.subscriptionData.close()},e.prototype.setNewSubscription=function(e){this.subscriptionData=e},e}(),Lt=function(){function e(e){this.config=e,this.cache=[],this.timeoutIds=[]}return e.prototype.add=function(e){var t=this,n=Oe();this.cache.push({id:n,element:e});var r=setTimeout((function(){var e=t.cache.findIndex((function(e){return e.id===n}));e<0||t.cache.splice(e,1)}),this.config.ELEMENT_TTL_MS);this.timeoutIds.push(r)},e.prototype.flush=function(){var e=this.cache.map((function(e){return e.element}));return this.timeoutIds.forEach((function(e){return clearInterval(e)})),this.cache=[],this.timeoutIds=[],e},e}(),Dt="awaitingAccept",Wt="subscribed",Ft="Subscription failed.",qt="Subscription rejected.",Ut="ServerInitiated",zt="ClientInitiated",Gt=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.logger=n,this.subscriptionsList={},this.timedCache=new Lt({ELEMENT_TTL_MS:1e4}),this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(e){var t=e._tag,n=t.subLocalKey,i=r.subscriptionsList[n];if("object"===typeof i&&(i.trackedServers=i.trackedServers.filter((function(e){return e.serverId!==t.serverId})),i.trackedServers.length<=0)){if(clearTimeout(i.timeoutId),i.status===Dt){var o="string"===typeof e.reason&&""!==e.reason?' Publisher said "'+e.reason+'".':" No reason given.",a="object"===typeof i.params.arguments?JSON.stringify(i.params.arguments):"{}";i.error({message:qt+o+" Called with:"+a,called_with:i.params.arguments,method:i.method})}else i.status===Wt&&r.callOnClosedHandlers(i);delete r.subscriptionsList[n]}},this.handleSubscribed=function(e){var t=e._tag.subLocalKey,n=r.subscriptionsList[t];if("object"===typeof n){var i=e._tag.serverId,o=n.trackedServers.filter((function(e){return e.serverId===i}))[0];if("object"===typeof o){o.subscriptionId=e.subscription_id,r.subscriptionIdToLocalKeyMap[e.subscription_id]=t;var a=n.status===Dt;if(n.status=Wt,a){var s=!1,u=n.subscription;u?(u.setNewSubscription(n),n.success(u),s=!0):(u=new Nt(r.repository,n),n.subscription=u,n.success(u));for(var c=0,l=n.handlers.onConnected;c<l.length;c++){var d=l[c];try{d(u.serverInstance,s)}catch(p){}}}}}},this.handleEventData=function(e){var t=r.subscriptionIdToLocalKeyMap[e.subscription_id];if("undefined"!==typeof t){var n=r.subscriptionsList[t];if("object"===typeof n){var i=n.trackedServers.filter((function(t){return t.subscriptionId===e.subscription_id}));if(1===i.length){var o=e.oob,a=i[0].serverId,s=function(){return{data:e.data,server:r.repository.getServerById(a).instance,requestArguments:n.params.arguments,message:void 0,private:o}},u=n.handlers.onData,c=n.queued.data;u.length>0?u.forEach((function(e){"function"===typeof e&&e(s())})):c.push(s())}}}},this.handleSubscriptionCancelled=function(e){var t=r.subscriptionIdToLocalKeyMap[e.subscription_id];if("undefined"!==typeof t){var n=r.subscriptionsList[t];if("object"===typeof n){var i=n.trackedServers.length-1;n.trackedServers=n.trackedServers.filter((function(t){return t.subscriptionId!==e.subscription_id||(n.queued.closers.push(t.serverId),!1)})),n.trackedServers.length===i&&(n.trackedServers.length<=0&&(r.timedCache.add(n),clearTimeout(n.timeoutId),r.callOnClosedHandlers(n),delete r.subscriptionsList[t]),delete r.subscriptionIdToLocalKeyMap[e.subscription_id])}}},e.on("subscribed",this.handleSubscribed),e.on("event",this.handleEventData),e.on("subscription-cancelled",this.handleSubscriptionCancelled)}return e.prototype.subscribe=function(e,t,n,r,i,o){var a=this;if(0!==n.length){var s=this.getNextSubscriptionLocalKey(),u=this.registerSubscription(s,e,t,r,i,t.methodResponseTimeout||1e4,o);"object"===typeof u?n.forEach((function(n){var r=n.server.id,i=n.methods.find((function(t){return t.name===e.name}));if(i){u.trackedServers.push({serverId:r,subscriptionId:void 0});var o={type:"subscribe",server_id:r,method_id:i.gatewayId,arguments_kv:t.arguments};a.session.send(o,{serverId:r,subLocalKey:s}).then((function(e){return a.handleSubscribed(e)})).catch((function(e){return a.handleErrorSubscribing(e)}))}else a.logger.error("can not find method "+e.name+" for target "+n.server.id)})):i({method:e,called_with:t.arguments,message:Ft+" Unable to register the user callbacks."})}else i({method:e,called_with:t.arguments,message:Ft+" No available servers matched the target params."})},e.prototype.drainSubscriptions=function(){var e=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},e},e.prototype.drainSubscriptionsCache=function(){return this.timedCache.flush()},e.prototype.getNextSubscriptionLocalKey=function(){var e=this.nextSubLocalKey;return this.nextSubLocalKey+=1,e},e.prototype.registerSubscription=function(e,t,n,r,i,o,a){var s=this,u={localKey:e,status:Dt,method:t,params:n,success:r,error:i,trackedServers:[],handlers:{onData:(null===a||void 0===a?void 0:a.handlers.onData)||[],onClosed:(null===a||void 0===a?void 0:a.handlers.onClosed)||[],onConnected:(null===a||void 0===a?void 0:a.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:function(){return s.closeSubscription(e)},subscription:null===a||void 0===a?void 0:a.subscription};return a||(n.onData&&u.handlers.onData.push(n.onData),n.onClosed&&u.handlers.onClosed.push(n.onClosed),n.onConnected&&u.handlers.onConnected.push(n.onConnected)),this.subscriptionsList[e]=u,u.timeoutId=setTimeout((function(){if(void 0!==s.subscriptionsList[e]){var r=s.subscriptionsList[e];r.status===Dt?(i({method:t,called_with:n.arguments,message:Ft+" Subscription attempt timed out after "+o+" ms."}),delete s.subscriptionsList[e]):r.status===Wt&&r.trackedServers.length>0&&(r.trackedServers=r.trackedServers.filter((function(e){return"undefined"!==typeof e.subscriptionId})),delete r.timeoutId,r.trackedServers.length<=0&&(s.callOnClosedHandlers(r),delete s.subscriptionsList[e]))}}),o),u},e.prototype.callOnClosedHandlers=function(e,t){var n,r=e.queued.closers.length,i=r>0?e.queued.closers[r-1]:null;void 0!==i&&"string"===typeof i&&(n=this.repository.getServerById(i).instance),e.handlers.onClosed.forEach((function(r){"function"===typeof r&&r({message:t||Ut,requestArguments:e.params.arguments||{},server:n,stream:e.method})}))},e.prototype.closeSubscription=function(e){var t=this,n=this.subscriptionsList[e];"object"===typeof n&&(n.trackedServers.forEach((function(e){"undefined"!==typeof e.subscriptionId&&(n.queued.closers.push(e.serverId),t.session.sendFireAndForget({type:"unsubscribe",subscription_id:e.subscriptionId,reason_uri:"",reason:zt}),delete t.subscriptionIdToLocalKeyMap[e.subscriptionId])})),n.trackedServers=[],this.callOnClosedHandlers(n,zt),delete this.subscriptionsList[e])},e}(),Bt=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.logger=n,e.on("peer-added",(function(e){return r.handlePeerAdded(e)})),e.on("peer-removed",(function(e){return r.handlePeerRemoved(e)})),e.on("methods-added",(function(e){return r.handleMethodsAddedMessage(e)})),e.on("methods-removed",(function(e){return r.handleMethodsRemovedMessage(e)})),this.streaming=new Gt(e,t,n)}return e.prototype.subscribe=function(e,t,n,r,i,o){this.streaming.subscribe(e,t,n,r,i,o)},e.prototype.invoke=function(e,t,n,r){var i=this,o=r.id,a={type:"call",server_id:o,method_id:t.gatewayId,arguments_kv:n};return this.session.send(a,{invocationId:e,serverId:o}).then((function(e){return i.handleResultMessage(e)})).catch((function(e){return i.handleInvocationError(e)}))},e.prototype.drainSubscriptions=function(){return this.streaming.drainSubscriptions()},e.prototype.drainSubscriptionsCache=function(){return this.streaming.drainSubscriptionsCache()},e.prototype.handlePeerAdded=function(e){var t=e.new_peer_id,n=e.identity,r=!e.meta||e.meta.local,i=Number(n.process),o={machine:n.machine,pid:isNaN(i)?n.process:i,instance:n.instance,application:n.application,applicationName:n.applicationName,environment:n.environment,region:n.region,user:n.user,windowId:n.windowId,peerId:t,api:n.api,isLocal:r};this.repository.addServer(o,t)},e.prototype.handlePeerRemoved=function(e){var t=e.removed_id,n=e.reason;this.repository.removeServerById(t,n)},e.prototype.handleMethodsAddedMessage=function(e){var t=this,n=e.server_id;e.methods.forEach((function(e){t.repository.addServerMethod(n,e)}))},e.prototype.handleMethodsRemovedMessage=function(e){var t=this,n=e.server_id,r=e.methods,i=this.repository.getServerById(n);Object.keys(i.methods).forEach((function(e){var o=i.methods[e];r.indexOf(o.gatewayId)>-1&&t.repository.removeServerMethod(n,e)}))},e.prototype.handleResultMessage=function(e){var t=e._tag.invocationId,n=e.result,r=e._tag.serverId;return{invocationId:t,result:n,instance:this.repository.getServerById(r).instance,status:ht.Success,message:""}},e.prototype.handleInvocationError=function(e){if(this.logger.debug("handle invocation error "+JSON.stringify(e)),"_tag"in e){var t=e._tag.invocationId,n=e._tag.serverId,r=this.repository.getServerById(n),i=e.reason;return{invocationId:t,result:e.context,instance:r.instance,status:ht.Error,message:i}}return{invocationId:"",message:e.message,status:ht.Error,error:e}},e}();function Ht(e,t,n,r,i,o){var a,s=i.logger.subLogger("gw3-protocol"),u=new Promise((function(e){a=e})),c=t.domain("agm",["subscribed"]),l=new jt(c,n,r,s.subLogger("server")),d=new Bt(c,n,s.subLogger("client"));function p(){return b(this,void 0,void 0,(function(){var e,t,n,i,a,u,c,l,p,f,h;return k(this,(function(v){switch(v.label){case 0:for(s.info("reconnected - will replay registered methods and subscriptions"),d.drainSubscriptionsCache().forEach((function(e){var t=e.method,n=Object.assign({},e.params);s.info("trying to soft-re-subscribe to method "+t.name+", with params: "+JSON.stringify(n)),o.client.subscribe(t,n,void 0,void 0,e).then((function(){return s.info("soft-subscribing to method "+t.name+" DONE")})).catch((function(e){return s.warn("subscribing to method "+t.name+" failed: "+JSON.stringify(e)+"}")}))})),e=[],t=d.drainSubscriptions(),n=function(t){var n=t.method,r=Object.assign({},t.params);s.info("trying to re-subscribe to method "+n.name+", with params: "+JSON.stringify(r)),e.push(o.client.subscribe(n,r,void 0,void 0,t).then((function(){return s.info("subscribing to method "+n.name+" DONE")})))},i=0,a=t;i<a.length;i++)u=a[i],n(u);for(c=r.getList(),r.reset(),l=function(t){var n=t.definition;s.info("re-publishing method "+n.name),t.stream?e.push(o.server.createStream(n,t.streamCallbacks,void 0,void 0,t.stream).then((function(){return s.info("subscribing to method "+n.name+" DONE")}))):t.theFunction&&t.theFunction.userCallback?e.push(o.register(n,t.theFunction.userCallback).then((function(){return s.info("subscribing to method "+n.name+" DONE")}))):t.theFunction&&t.theFunction.userCallbackAsync&&e.push(o.registerAsync(n,t.theFunction.userCallbackAsync).then((function(){return s.info("subscribing to method "+n.name+" DONE")}))),s.info("re-publishing method "+n.name+" DONE")},p=0,f=c;p<f.length;p++)h=f[p],l(h);return[4,Promise.all(e)];case 1:return v.sent(),s.info("Interop is re-announced"),[2]}}))}))}function f(){a&&(a({client:d,server:l}),a=void 0)}return c.onJoined((function(r){n.addServer(e,t.peerId),r?p().then((function(){return t.setLibReAnnounced({name:"interop"})})).catch((function(e){return s.warn("Error while re-announcing interop: "+JSON.stringify(e))})):f()})),c.onLeft((function(){n.reset()})),c.join(),u}var Vt=function(){function e(e){var t=this;if("undefined"===typeof e)throw new Error("configuration is required");if("undefined"===typeof e.connection)throw new Error("configuration.connections is required");var n,r=e.connection;if("number"!==typeof e.methodResponseTimeout&&(e.methodResponseTimeout=3e4),"number"!==typeof e.waitTimeoutMs&&(e.waitTimeoutMs=3e4),this.unwrappedInstance=new Ct(this,void 0,r),this.instance=this.unwrappedInstance.unwrap(),this.clientRepository=new At(e.logger.subLogger("cRep"),this),this.serverRepository=new Et,3!==r.protocolVersion)throw new Error("protocol "+r.protocolVersion+" not supported");n=Ht(this.instance,r,this.clientRepository,this.serverRepository,e,this),this.readyPromise=n.then((function(n){return t.protocol=n,t.client=new wt(t.protocol,t.clientRepository,t.instance,e),t.server=new It(t.protocol,t.serverRepository),t}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.serverRemoved=function(e){return this.client.serverRemoved(e)},e.prototype.serverAdded=function(e){return this.client.serverAdded(e)},e.prototype.serverMethodRemoved=function(e){return this.client.serverMethodRemoved(e)},e.prototype.serverMethodAdded=function(e){return this.client.serverMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.client.methodRemoved(e)},e.prototype.methodAdded=function(e){return this.client.methodAdded(e)},e.prototype.methodsForInstance=function(e){return this.client.methodsForInstance(e)},e.prototype.methods=function(e){return this.client.methods(e)},e.prototype.servers=function(e){return this.client.servers(e)},e.prototype.subscribe=function(e,t,n,r){return this.client.subscribe(e,t,n,r)},e.prototype.createStream=function(e,t,n,r){return this.server.createStream(e,t,n,r)},e.prototype.unregister=function(e){return this.server.unregister(e)},e.prototype.registerAsync=function(e,t){return this.server.registerAsync(e,t)},e.prototype.register=function(e,t){return this.server.register(e,t)},e.prototype.invoke=function(e,t,n,r,i,o){return this.client.invoke(e,t,n,r,i,o)},e.prototype.waitForMethod=function(e){var t=new ee,n=this.client.methodAdded((function(r){r.name===e&&(n(),t.resolve(r))}));return t.promise},e}(),Jt=["subscribed","success"],Kt=function(){function e(e,t){var n=this;this.publish=function(e,t,r){var i=r||{},o=i.routingKey,a=i.target,s=n.removeEmptyValues({type:"publish",topic:e,data:t,peer_id:n.peerId,routing_key:o,target_identity:a});n.session.send(s)},this.subscribe=function(e,t,r){return new Promise((function(i,o){var a=r||{},s=a.routingKey,u=a.target,c=n.removeEmptyValues({type:"subscribe",topic:e,peer_id:n.peerId,routing_key:s,source:u});n.session.send(c).then((function(r){var o=r.subscription_id;n.subscriptions.push({subscription_id:o,topic:e,callback:t,source:u}),i({unsubscribe:function(){return n.session.send({type:"unsubscribe",subscription_id:o,peer_id:n.peerId}),n.subscriptions=n.subscriptions.filter((function(e){return e.subscription_id!==o})),Promise.resolve()}})})).catch((function(e){return o(e)}))}))},this.watchOnEvent=function(){n.session.on("event",(function(e){var t=e.data,r=e.subscription_id,i=e["publisher-identity"],o=n.subscriptions.find((function(e){return e.subscription_id===r}));o&&(o.source?n.keysMatch(o.source,i)&&o.callback(t,o.topic,i):o.callback(t,o.topic,i))}))},this.connection=e,this.logger=t,this.peerId=e.peerId,this.subscriptions=[],this.session=e.domain("bus",Jt),this.readyPromise=this.session.join(),this.readyPromise.then((function(){n.watchOnEvent()}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.removeEmptyValues=function(e){var t={};return Object.keys(e).forEach((function(n){void 0!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t},e.prototype.keysMatch=function(e,t){var n=Object.keys(e),r=!0;return n.forEach((function(n){e[n]!==t[n]&&(r=!1)})),r},e}(),Qt=function e(t,n){var r,i=Z.getGDMajorVersion(),o=Promise.resolve();if(i){if(i<3)throw new Error("GD v2 is not supported. Use v4 of the API to run in that context.");i>=3&&(r=window.glue42gd,o=window.gdPreloadPromise||o)}var a,s,u,c,l,d,p,f=re("glue"),h=ot(t=t||{},n=n||{},r),v={};function g(t,n,r){(p=u.canPublish("trace"))&&u.trace("registering "+t+" module");var i=function(){n.initTime=r.stop(),n.initEndTime=r.endTime,n.marks=r.marks,p&&u.trace(t+" is ready - "+(r.endTime-r.startTime))};n.initStartTime=r.startTime,n.ready?n.ready().then((function(){i()})):i(),Array.isArray(t)||(t=[t]),t.forEach((function(t){v[t]=n,e[t]=n}))}function y(){var e=re("connection");a=new Ue(h.connection,u.subLogger("connection"));var t=Promise.resolve(h.auth);return h.connection&&!h.auth&&(r?t=r.getGWToken().then((function(e){return{gatewayToken:e}})):"undefined"!==typeof window&&(null===window||void 0===window?void 0:window.glue42electron)?"string"===typeof window.glue42electron.gwToken&&(t=Promise.resolve({gatewayToken:window.glue42electron.gwToken})):t=Promise.reject("You need to provide auth information")),t.then((function(t){var n;if(e.mark("auth-promise-resolved"),"[object Object]"!==Object.prototype.toString.call(t))throw new Error("Invalid auth object - "+JSON.stringify(t));return n=t,a.login(n)})).then((function(){return g("connection",a,e),h})).catch((function(e){throw a&&a.logout(),e}))}function m(){var e,t=re("logger");return(u=new Ge(""+(null===(e=h.connection.identity)||void 0===e?void 0:e.application),void 0,h.customLogger)).consoleLevel(h.logger.console),u.publishLevel(h.logger.publish),u.canPublish("debug")&&u.debug("initializing glue..."),g("logger",u,t),Promise.resolve(void 0)}function w(){var e,t,n,i,o,s=re("metrics"),l=h.metrics,d=null===r||void 0===r?void 0:r.getMetricsPublishingEnabled,p=h.connection.identity,f=d||function(){return!0},v=null!==(e="boolean"!==typeof l&&l.disableAutoAppSystem)&&void 0!==e&&e;return g("metrics",c=V({connection:l?a:void 0,logger:u.subLogger("metrics"),canUpdateMetric:f,system:"Glue42",service:null!==(n=null!==(t=null===p||void 0===p?void 0:p.service)&&void 0!==t?t:null===r||void 0===r?void 0:r.applicationName)&&void 0!==n?n:h.application,instance:null!==(o=null!==(i=null===p||void 0===p?void 0:p.instance)&&void 0!==i?i:null===p||void 0===p?void 0:p.windowId)&&void 0!==o?o:Oe(),disableAutoAppSystem:v,pagePerformanceMetrics:"boolean"!==typeof l?null===l||void 0===l?void 0:l.pagePerformanceMetrics:void 0}),s),Promise.resolve()}function x(){var e=re("interop"),t={connection:a,logger:u.subLogger("interop")};return s=new Vt(t),Ge.Interop=s,g(["interop","agm"],s,e),Promise.resolve()}function _(){var e=h.activities&&3===a.protocolVersion;if(h.contexts||e){var t=re("contexts");return g("contexts",l=new gt({connection:a,logger:u.subLogger("contexts"),trackAllContexts:"object"===typeof h.contexts&&h.contexts.trackAllContexts,reAnnounceKnownContexts:"object"===typeof h.contexts&&h.contexts.reAnnounceKnownContexts}),t),l}var n=a.replayer;n&&n.drain(rt.name)}function S(){return b(this,void 0,void 0,(function(){var e;return k(this,(function(t){return h.bus?(e=re("bus"),g("bus",d=new Kt(a,u.subLogger("bus")),e),[2,Promise.resolve()]):[2,Promise.resolve()]}))}))}function I(e){try{return e.forEach((function(e){C(e.name,e.create)})),Promise.resolve()}catch(t){return Promise.reject(t)}}function C(e,t){var n=re(e),r=t(v);r&&g(e,r,n)}function T(){var e=Object.keys(v).map((function(e){var t=v[e];return t.ready?t.ready():Promise.resolve()}));return Promise.all(e)}function A(){var e=function(e){s&&s.invoke("T42.ACS.Feedback",e,"best")},i={coreVersion:it,version:h.version};f.stop();var o={feedback:e,info:i,logger:u,interop:s,agm:s,connection:a,metrics:c,contexts:l,bus:d,version:h.version,userConfig:t,done:function(){return null===u||void 0===u||u.info("done called by user..."),a.logout()}};if(o.performance={get glueVer(){return h.version},get glueConfig(){return JSON.stringify(t)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var e=ne();return Object.keys(e).map((function(t){var n=e[t];return{name:t,duration:n.endTime-n.startTime,marks:n.marks,startTime:n.startTime,endTime:n.endTime}}))}},Object.keys(v).forEach((function(e){var t=v[e];o[e]=t})),o.config={},Object.keys(h).forEach((function(e){o.config[e]=h[e]})),n&&n.extOptions&&Object.keys(n.extOptions).forEach((function(e){o.config[e]=null===n||void 0===n?void 0:n.extOptions[e]})),(null===n||void 0===n?void 0:n.enrichGlue)&&n.enrichGlue(o),r&&r.updatePerfData&&r.updatePerfData(o.performance),o.agm){var p=function(e,t,n){return function(){return o.logger.warn("glue.js - 'glue.agm."+t+"' method is deprecated, use 'glue.interop."+n+"' instead."),e.apply(o.agm,arguments)}},g=o.agm;g.method_added=p(o.agm.methodAdded,"method_added","methodAdded"),g.method_removed=p(o.agm.methodRemoved,"method_removed","methodRemoved"),g.server_added=p(o.agm.serverAdded,"server_added","serverAdded"),g.server_method_aded=p(o.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),g.server_method_removed=p(o.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return o}function E(){return b(this,void 0,void 0,(function(){var e,n,r;return k(this,(function(i){switch(i.label){case 0:if(e="T42.ACS.RegisterInstance",!Z.isNode()||"undefined"!==typeof{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}._GD_STARTING_CONTEXT_||"undefined"===typeof(null===t||void 0===t?void 0:t.application))return[3,4];if(!(s.methods({name:e}).length>0))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,s.invoke(e,{appName:null===t||void 0===t?void 0:t.application,pid:process.pid})];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),r=n,u.error("Cannot register as an instance: "+JSON.stringify(r.message)),[3,4];case 4:return[2]}}))}))}return o.then(m).then(y).then((function(){return Promise.all([w(),x(),_(),S()])})).then((function(){return s.readyPromise})).then((function(){return E()})).then((function(){return I(h.libs||[])})).then(T).then(A).catch((function(e){return Promise.reject({err:e,libs:v})}))};"undefined"!==typeof window&&(window.GlueCore=Qt),Qt.version=it,Qt.default=Qt;var $t=function(){function e(t){v(this,e),this._id=t}return g(e,[{key:"id",get:function(){return this._id}},{key:"_update",value:function(e){if(e._id!==this._id)throw Error("Can not update from entity with different id.");this._updateCore(e)}},{key:"_updateCore",value:function(e){}},{key:"_beforeDelete",value:function(e){}}]),e}();function Yt(e){return"number"===typeof e}function Xt(e){return"string"===typeof e}function Zt(e){return"object"===typeof e&&null!==e}function en(e){return Array.isArray?Array.isArray(e):"[object Array]"===toString.call(e)}function tn(e){return"undefined"===typeof e}function nn(e){return null===e||"undefined"===typeof e}function rn(e){return"string"!==typeof e||!e||0===e.length||/^\s*$/.test(e)}function on(e){return!0===e||!1===e||"[object Boolean]"===toString.call(e)}function an(e){return!!(e&&e.constructor&&e.call&&e.apply)}function sn(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n))return!0;return!1}function un(e,t){"undefined"!==typeof e&&t(e)}function cn(e,t,n){if("function"!==typeof t&&"function"!==typeof n)return e;"function"!==typeof t?t=function(){}:"function"!==typeof n&&(n=function(){}),e.then(t,n)}var ln=function(e){f(n,e);var t=h(n);function n(e,r,i,o){var a;return v(this,n),(a=t.call(this,e))._name=e,a._description=o,a._ownerWindow=r,a._helperWindows=i||[],a}return g(n,[{key:"name",get:function(){return this._name}},{key:"description",get:function(){return this._description}},{key:"helperWindows",get:function(){var e=this;return this._helperWindows.map((function(t){return e.covertToWindowDef(t)}))}},{key:"ownerWindow",get:function(){return this.covertToWindowDef(this._ownerWindow)}},{key:"initiate",value:function(e,t,n){return this._manager.initiate(this._name,e,t,n)}},{key:"_updateCore",value:function(e){var t=this;d(p(n.prototype),"_updateCore",this).call(this,e),un(e._description,(function(e){return t._description=e})),un(e._ownerWindow,(function(e){return t._ownerWindow=e})),un(e._helperWindows,(function(e){return t._helperWindows=e}))}},{key:"covertToWindowDef",value:function(e){var t,n;return{type:null===(t=null===e||void 0===e?void 0:e.id)||void 0===t?void 0:t.type,name:null===(n=null===e||void 0===e?void 0:e.id)||void 0===n?void 0:n.name}}}]),n}($t),dn=function(e){f(n,e);var t=h(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e))._name=e,i._appByWindowTypeGetter=r,i}return g(n,[{key:"name",get:function(){return this._name}},{key:"config",get:function(){return this._appByWindowTypeGetter(this._name)}},{key:"windows",get:function(){return this._manager.getWindows({type:this._name})}},{key:"create",value:function(e,t){var n=Object.assign({type:this.name,name:this.name,isIndependent:!1},t);return this._manager.createWindow(e,n)}}]),n}($t),pn=g((function e(t,n){v(this,e),this.entity=t,this.context=n})),fn=g((function e(t){v(this,e),this.type=t})),hn=function(e){f(n,e);var t=h(n);function n(e,r){var i;return v(this,n),(i=t.call(this,gn.StatusChange)).newStatus=e,i.oldStatus=r,i}return g(n)}(fn),vn=function(e){f(n,e);var t=h(n);function n(e,r,i){var o;return v(this,n),(o=t.call(this,gn.ActivityContextChange)).context="string"===typeof e?JSON.parse(e):e,o.updated=r,o.removed=i,o}return g(n)}(fn),gn=g((function e(){v(this,e)}));gn.Added="added",gn.Removed="removed",gn.Updated="updated",gn.Closed="closed",gn.StatusChange="statusChange",gn.ActivityContextChange="activityContextUpdate",gn.ActivityWindowEvent="activityWindowEvent",gn.ActivityWindowJoinedActivity="joined",gn.ActivityWindowLeftActivity="left";var yn=g((function e(){v(this,e)}));yn.Created="created",yn.Started="started",yn.Destroyed="destroyed";var mn=function(){function e(t){v(this,e),this._activity=t}return g(e,[{key:"register",value:function(t,n){this._ensureHasAgm(),e.AGM.register(t,n)}},{key:"servers",value:function(){return this._ensureHasAgm(),nn(this._activity)?[]:this._activity.windows.map((function(e){return e.instance}))}},{key:"methods",value:function(){var e=this;if(this._ensureHasAgm(),nn(this._activity))return[];var t=this._activity.windows,n=[],r=[];return t.forEach((function(t){e.methodsForWindow(t).forEach((function(e){-1===n.indexOf(e.name)&&(n.push(e.name),r.push(e))}))})),r}},{key:"methodsForWindow",value:function(t){return this._ensureHasAgm(),t.instance?e.AGM.methodsForInstance(t.instance):[]}},{key:"invoke",value:function(t,n,r,i,o,a){this._ensureHasAgm();var s=this.servers();if(nn(r)&&(r="activity.all"),Xt(r))if("activity.all"===r);else{if("activity.best"!==r){if("all"===r||"best"===r)return cn(e.AGM.invoke(t,n,r,i),o,a);throw new Error("Invalid invoke target "+r)}var u=s.filter((function(n){return e.AGM.methodsForInstance(n).filter((function(e){return e.name===t})).length>0}));u.length>0&&u[0]}else if(en(r)){if(r.length>=0){var c=r[0];if(this._isInstance(c))r.map((function(e){return e}));else{if(!this._isActivityWindow(c))throw new Error("Unknown target object");r.map((function(e){return e.instance}))}}}else if(this._isInstance(r));else{if(!this._isActivityWindow(r))throw new Error("Unknown target object");r.instance}throw new Error("Not implemented")}},{key:"unregister",value:function(t){return this._ensureHasAgm(),e.AGM.unregister(t)}},{key:"createStream",value:function(t,n,r){this._ensureHasAgm(),e.AGM.createStream(t,{subscriptionAddedHandler:n,subscriptionRemovedHandler:r,subscriptionRequestHandler:void 0})}},{key:"subscribe",value:function(t,n,r){return this._ensureHasAgm(),e.AGM.subscribe(t,n)}},{key:"_ensureHasAgm",value:function(){if(nn(e.AGM))throw new Error("Agm should be configured to be used in activity")}},{key:"_isInstance",value:function(e){return void 0!==e.application}},{key:"_isActivityWindow",value:function(e){return void 0!==e.instance}}]),e}(),wn=function(){function e(t,n,r){v(this,e),this._manager=t,this._ownerActivityId=n,this._state=r}return g(e,[{key:"ownerId",get:function(){return this._state.ownerId}},{key:"windowIds",get:function(){return this._state.windowIds}},{key:"frameColor",get:function(){return this._state.frameColor}},{key:"context",get:function(){return this._state.context}},{key:"tag",get:function(){return this._state.tag}},{key:"detach",value:function(e){var t=this;e=e||{};var n={};return Object.keys(this._state).forEach((function(e){n[e]=t._state[e]})),n.context=e.context||n.context,n.frameColor=e.frameColor||n.frameColor,this._manager.detachActivities(this._ownerActivityId,n)}}]),e}(),bn=function(e){setTimeout(e,0)};function kn(e,t){if(!an(t))return e;e.then((function(e){bn((function(){t(null,e)}))}),(function(e){bn((function(){t(e,null)}))}))}var xn=function(e){f(n,e);var t=h(n);function n(e,r,i,o,a){var s;return v(this,n),(s=t.call(this,e))._id=e,s._actType=r,s._status=i,s._context=o,s._ownerId=a,s._agm=new mn(l(s)),s}return g(n,[{key:"type",get:function(){if(this._manager)return this._manager.getActivityType(this._actType)}},{key:"context",get:function(){return this._context}},{key:"status",get:function(){return this._status}},{key:"owner",get:function(){return this._ownerId?this._manager.getWindows({id:this._ownerId})[0]:null}},{key:"windows",get:function(){return this._manager.getWindows({activityId:this._id})}},{key:"agm",get:function(){return this._agm}},{key:"addWindow",value:function(e,t){return this._manager.addWindowToActivity(this,e,t)}},{key:"createWindow",value:function(e,t){return this._manager.createWindow(this,e,t)}},{key:"createStackedWindows",value:function(e,t,n){return this._manager.createStackedWindows(this,e,t,n)}},{key:"leave",value:function(e,t){return this._manager.leaveWindowFromActivity(this,e,t)}},{key:"getWindowsByType",value:function(e){var t={activityId:this._id,type:e};return this._manager.getWindows(t)}},{key:"setContext",value:function(e,t){return this._manager.setActivityContext(this,e,t)}},{key:"updateContext",value:function(e,t){return this._manager.updateActivityContext(this,e,t)}},{key:"onStatusChange",value:function(e){var t=this;return this._manager.subscribeActivityEvents((function(n,r,i){n.id===t.id&&e(n,r,i)}))}},{key:"onWindowEvent",value:function(e){var t=this;return this._manager.subscribeWindowEvents((function(n,r,i){n.id===t.id&&e(n,r,i)}))}},{key:"onContextChanged",value:function(e){var t=this;this._manager.subscribeActivityContextChanged((function(n,r,i,o){n.id===t.id&&e(r,i,o,n)}));try{e(this.context,this.context,[],this)}catch(n){return}}},{key:"stop",value:function(){this._manager.stopActivity(this)}},{key:"clone",value:function(e){return this._manager.clone(this,e)}},{key:"attach",value:function(e,t){var n;return n="string"===typeof e?e:e.id,this._manager.attachActivities(n,this.id,t)}},{key:"onActivityAttached",value:function(e){var t=this;this._manager.subscribeActivitiesAttached((function(n,r,i){n===t._id&&e(i)}))}},{key:"onDetached",value:function(e){var t=this;this._manager.subscribeActivitiesDetached((function(n,r,i){r.id===t._id&&e(n,i)}))}},{key:"_updateCore",value:function(e){var t=this;d(p(n.prototype),"_updateCore",this).call(this,e),un(e._actType,(function(e){return t._actType=e})),un(e._context,(function(e){return t._context=e})),un(e._ownerId,(function(e){return t._ownerId=e})),!e._status||this._status&&this._status.state===e._status.state||(this._status=e._status)}},{key:"_updateDescriptors",value:function(e){var t=this;this._attached=e.map((function(e){return new wn(t._manager,t._id,e)}))}},{key:"attached",get:function(){return this._attached}},{key:"setFrameColor",value:function(e,t){var n=this;return kn(new Promise((function(t,r){var i=n.windows.length;0===i&&t(n),n.windows.forEach((function(r){r.underlyingWindow.setFrameColor(e,(function(){--i<=0&&t(n)}))})),setTimeout((function(){i>0&&r(n.id+" - timed out waiting for setFrameColor with"+e)}),5e3)})),t)}},{key:"getFrameColor",value:function(){return this.windows&&0!==this.windows.length?this.windows[0].underlyingWindow.frameColor:""}}]),n}($t),_n=g((function e(){v(this,e)}));_n.Trace="trace",_n.Debug="debug",_n.Info="info",_n.Warn="warn",_n.Error="error";var Sn=function(){function e(t){v(this,e),this._name=t,nn(e.GlueLogger)||(this._glueLogger=e.GlueLogger.subLogger(t))}return g(e,[{key:"trace",value:function(t){nn(this._glueLogger)?e.Level===_n.Trace&&console.info(this._getMessage(t,_n.Trace)):this._glueLogger.trace(t)}},{key:"debug",value:function(t){nn(this._glueLogger)?e.Level!==_n.Debug&&e.Level!==_n.Trace||console.info(this._getMessage(t,_n.Debug)):this._glueLogger.debug(t)}},{key:"info",value:function(t){nn(this._glueLogger)?e.Level!==_n.Debug&&e.Level!==_n.Trace&&e.Level!==_n.Info||console.info(this._getMessage(t,_n.Info)):this._glueLogger.info(t)}},{key:"warn",value:function(t){nn(this._glueLogger)?e.Level!==_n.Debug&&e.Level!==_n.Trace&&e.Level!==_n.Info&&e.Level!==_n.Warn||console.info(this._getMessage(t,_n.Info)):this._glueLogger.warn(t)}},{key:"error",value:function(e){nn(this._glueLogger)?(console.error(this._getMessage(e,_n.Error)),console.trace()):this._glueLogger.error(e)}},{key:"_getMessage",value:function(e,t){return"["+t+"] "+this._name+" - "+e}}],[{key:"GetNamed",value:function(t){return new e(t)}},{key:"Get",value:function(t){return new e(e.GetTypeName(t))}},{key:"GetTypeName",value:function(e){var t=/function (.{1,})\(/.exec(e.constructor.toString());return t&&t.length>1?t[1]:""}}]),e}();Sn.Level=_n.Info;var In=function(e){f(n,e);var t=h(n);function n(e,r,i,o,a,s,u,c){var l;return v(this,n),(l=t.call(this,e))._logger=Sn.Get("window"),l._type=i,l._activityId=o,l._name=r,l._instance=a,l._isIndependent=s,l._windowGetter=u,l._hcWindowId=c,l}return g(n,[{key:"getBounds",value:function(){return this._manager.getWindowBounds(this.id)}},{key:"name",get:function(){return this._name}},{key:"isIndependent",get:function(){return this._isIndependent}},{key:"type",get:function(){if(this._manager)return this._manager.getWindowType(this._type)}},{key:"activity",get:function(){if(!tn(this._activityId))return this._manager.getActivityById(this._activityId)}},{key:"isOwner",get:function(){var e=this.activity;return!tn(e)&&e.owner.id===this.id}},{key:"setVisible",value:function(e,t){return this._manager.setWindowVisibility(this.id,e)}},{key:"activate",value:function(e){return this._manager.activateWindow(this.id,e)}},{key:"setBounds",value:function(e,t){return this._manager.setWindowBounds(this.id,e,t)}},{key:"close",value:function(){return this._manager.closeWindow(this.id)}},{key:"instance",get:function(){return this._instance}},{key:"underlyingWindow",get:function(){var e=this._windowGetter();return e||{id:this._hcWindowId}}},{key:"onActivityJoined",value:function(e){this._subscribeForActivityWindowEvent(gn.ActivityWindowJoinedActivity,e)}},{key:"onActivityRemoved",value:function(e){this._subscribeForActivityWindowEvent(gn.ActivityWindowLeftActivity,e)}},{key:"_updateCore",value:function(e){var t=this;un(e._activityId,(function(e){return t._activityId=e})),un(e._isIndependent,(function(e){return t._isIndependent=e})),un(e._hcWindowId,(function(e){return t._hcWindowId=e})),un(e._type,(function(e){return t._type=e})),un(e._name,(function(e){return t._name=e})),nn(e._instance)||(this._instance=e._instance)}},{key:"_subscribeForActivityWindowEvent",value:function(e,t){var n=this;this._manager.subscribeWindowEvents((function(r,i,o){i.id===n.id&&o===e&&t(r)}))}},{key:"_beforeDelete",value:function(e){this._hcWindowId=e._hcWindowId}}]),n}($t),Cn=function(){function e(t,n,r){v(this,e),this.state=t,this.message=n,this.time=r}return g(e,[{key:"getState",value:function(){return this.state}},{key:"getMessage",value:function(){return this.message}},{key:"getTime",value:function(){return this.time}}]),e}(),Tn="error",An="add-types",En="types-added",Pn="remove-types",Mn="types-removed",Rn="created",On="destroyed",jn="initiated",Nn="join-activity",Ln="joined",Dn="activity-joined",Wn="leave-activity",Fn="left",qn="merge",Un="split",zn="owner-changed",Gn="add-peer-factories",Bn="peer-factories-added",Hn="remove-peer-factories",Vn="peer-factories-removed",Jn="create",Kn="create-peer",Qn="peer-requested",$n="ready",Yn="peer-created",Xn="destroy",Zn="dispose-peer",er="destroy-peer",tr=function(){function e(t){var n=this;if(v(this,e),this._activityChangeCallbacks=[],this._activityTypeStatusChangeCallbacks=[],this._activityWindowChangeCallbacks=[],this._windowTypeStatusChangeCallbacks=[],this._peerIdAndFactoryIdToPeerType={},this._peerFactoriesRegisteredByUs={},this._gw3Subscriptions=[],this._contextSubscriptions={},this._activityTypesInitiatedFromMe={},this._config=t,this._connection=t.connection,this._logger=t.logger,this._contexts=t.contexts,this._windows=t.windows,this._sessionJoinedPromise=new Promise((function(e){n._sessionJoinedPromiseResolve=e})),this._activityJoinedPromise=new Promise((function(e){n._activityJoinedPromiseResolve=e})),this._config.activityId||this._activityJoinedPromiseResolve({}),this._gw3Session=this._connection.domain("activity",["joined","initiated","peer-created","token"]),"undefined"!==typeof window){var r=window.glue42gd;r&&r.activityInfo&&("function"===typeof r.addRefreshHandler&&r.addRefreshHandler((function(e,t){n._gw3Session.send({type:"reload"}).then((function(n){if(n.token){try{r.setGWToken(n.token)}catch(i){return void t(i.message||i)}e()}else t("Expected gateway token for refreshing.")}),t)})),r&&"function"===typeof r.addWillNavigateHandler&&r.addWillNavigateHandler((function(e,t){n._gw3Session.send({type:"reload"}).then((function(n){if(n.token){try{r.setGWToken(n.token)}catch(i){return void t(i.message||i)}e()}else t("Expected gateway token for refreshing.")}),t)})))}}return g(e,[{key:"bridgeType",get:function(){return"GW3"}},{key:"init",value:function(){var e=this;this.forwardActivityTypeMessagesToStatusEventHandlers(),this.subscribe(Rn,this.handleActivityCreatedMessage),this.subscribe(On,this.handleActivityDestroyedMessage),this.forwardActivityMessagesToStatusEventHandlers(),this.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers(),this.forwardPeerFactoryMessagesToStatusEventHandlers(),this.forwardPeerFactoryMessagesToPeerFactoryRequests(),this.subscribe(Bn,this.handlePeerFactoriesAdded),this.subscribe(Vn,this.handlePeerFactoriesRemoved),this.forwardActivityWindowMessagesToEventHandlers(),this.subscribe(Zn,(function(){if("dispose"!==e._config.disposeRequestHandling){if("exit"===e._config.disposeRequestHandling){if(e._windows&&"undefined"!==typeof e._windows.my())return void e._windows.my().close();if("undefined"!==typeof window&&"function"===typeof window.close)return void window.close();if("undefined"!==typeof process&&"function"===typeof process.exit)return void process.exit()}}else e.dispose()})),this._gw3Session.onJoined((function(){"trackMyOnly"===e._config.mode||"trackMyTypeAndInitiatedFromMe"===e._config.mode?e._sessionJoinedPromiseResolve(e):e._gw3Session.send({type:"subscribe",activity_types:"trackAll"===e._config.mode?[]:"trackTypes"===e._config.mode?e._config.typesToTrack:[]}).then((function(){e._sessionJoinedPromiseResolve(e)}))})),this._gw3Session.join()}},{key:"dispose",value:function(){var e=this;this._gw3Subscriptions.forEach((function(t){return t&&e._connection.off(t)})),this._gw3Subscriptions.length=0}},{key:"ready",value:function(){return Promise.all([this._sessionJoinedPromise,this._activityJoinedPromise])}},{key:"initReady",value:function(){return this._sessionJoinedPromise}},{key:"onActivityTypeStatusChange",value:function(e){this._activityTypeStatusChangeCallbacks.push(e)}},{key:"registerActivityType",value:function(t,n,r,i,o){var a=this,s={};s.name=t;var u=function(e){return{type:e.type,name:e.name,configuration:e}};return s.owner_type=u(n),s.helper_types=r.map(u),this._gw3Session.send({type:An,types:[s]}).then((function(){var t=e.activityTypeGwMessageEntityToActivityType(s,o);return a.invokeCallbacks(a._activityTypeStatusChangeCallbacks,new pn(t,new fn(gn.Added)),An),t}))}},{key:"unregisterActivityType",value:function(e){var t=this;return this._gw3Session.send({type:Pn,types:[e]}).then((function(){var n=new ln(e,void 0,void 0,void 0);t.invokeCallbacks(t._activityTypeStatusChangeCallbacks,new pn(n,new fn(gn.Removed)),An)}))}},{key:"onWindowTypeStatusChange",value:function(e){this._windowTypeStatusChangeCallbacks.push(e)}},{key:"registerWindowFactory",value:function(t,n,r){var i=this;if(this._peerFactoriesRegisteredByUs[t])return Promise.reject(new Error("Factory for windowType ".concat(t," already registered.")));this._peerFactoriesRegisteredByUs[t]=n;var o={id:t,peer_type:t,configuration:r};return this._gw3Session.send({type:Gn,factories:[o]}).then((function(){i.invokeCallbacks(i._windowTypeStatusChangeCallbacks,new pn(e.peerFactoryGwMessageEntityToWindowType(o),new fn(gn.Added)),Gn)})).catch((function(){delete i._peerFactoriesRegisteredByUs[t]}))}},{key:"unregisterWindowFactory",value:function(e){var t=this;return this._peerFactoriesRegisteredByUs[e]?(delete this._peerFactoriesRegisteredByUs[e],this._gw3Session.send({type:Hn,factory_ids:[e]}).then((function(){t.invokeCallbacks(t._windowTypeStatusChangeCallbacks,new pn(new dn(e,void 0),new fn(gn.Removed)),Gn)}))):Promise.reject(new Error("Factory for windowType ".concat(e," not registered.")))}},{key:"onActivityStatusChange",value:function(e){this._activityChangeCallbacks.push(e)}},{key:"initiateActivity",value:function(e,t,n){var r=this,i={type:Jn,activity_type:e,initial_context:t};return this.isOverrideTypeDefinition(n)?i.types_override={owner_type:{type:n.owner.type,name:n.owner.name,configuration:n.owner},helper_types:n.helpers&&n.helpers.map((function(e){return{type:e.type,name:e.name,configuration:e}}))}:i.configuration=n&&n.map((function(e){return{type:e.type,name:e.name,configuration:e}})),this.sendCreateAndMapResultingMessagesToPromise(i,jn,(function(e,t){return e.request_id===t}),Rn,(function(e,t,n){return e.activity_id===n.activity_id}),On,(function(e,t,n){return e.activity_id===n.activity_id}),(function(e){return e.activity_id}),null).then((function(t){return"trackMyTypeAndInitiatedFromMe"!==r._config.mode||r._activityTypesInitiatedFromMe[e]?t:(r._activityTypesInitiatedFromMe[e]=!0,r._gw3Session.send({type:"subscribe",activity_types:[e]}).then((function(){return t})))}))}},{key:"stopActivity",value:function(e){return this._gw3Session.send({type:Xn,activity_id:e.id,reason_uri:"com.tick42.glue.activity.constants.destroyReason.general",reason:"Destroying activity"}).then((function(e){return!0}))}},{key:"updateActivityContext",value:function(e,t,n,r){if(n)return this._contexts.set(e.id,t);var i,o=c(r=r||[]);try{for(o.s();!(i=o.n()).done;)t[i.value]=null}catch(a){o.e(a)}finally{o.f()}return this._contexts.update(e.id,t)}},{key:"announceWindow",value:function(e,t){throw new Error("Invalid operation 'announceWindow' for GW3 protocol")}},{key:"registerWindow",value:function(e,t,n){var r="undefined"!==typeof this._connection.gatewayToken,i=this._connection.peerId;if("undefined"!==typeof window){var o=window.glue42gd;o&&(r="undefined"!==typeof o.activityInfo)}return r&&this._gw3Session.send({type:$n}),this.invokeCallbacks(this._activityWindowChangeCallbacks,new pn(new In(i,t,e,void 0,this.getAgmInstance(i),n,this.generateWindowGetter(i),void 0),new fn(gn.Added)),"register window"),Promise.resolve(i)}},{key:"onActivityWindowChange",value:function(e){this._activityWindowChangeCallbacks.push(e)}},{key:"createWindow",value:function(e,t){var n=this;t.layout||(t.left||t.width||t.height||t.top)&&(t.layout={mode:"pixels",cellSize:1});var r=function(r){if(e)return n.joinActivity(e,r,t.name).then((function(){return r}))};return this.sendCreateAndMapResultingMessagesToPromise({type:Kn,peer_type:t.type,peer_name:t.name||t.type,configuration:t,activity_id:e},void 0,void 0,Yn,(function(e,t){return e.request_id===t}),void 0,void 0,(function(e){return e.created_id}),r).then(r)}},{key:"closeWindow",value:function(e){return this._gw3Session.send({type:er,destroy_peer_id:e}).then((function(e){}))}},{key:"getAnnouncementInfo",value:function(){var e=this._config.activityId||this._config.announcementInfo&&this._config.announcementInfo.activityId,t=this._config.announcementInfo&&this._config.announcementInfo.activityWindowType,n=this._config.announcementInfo&&this._config.announcementInfo.activityWindowIndependent,r=this._config.announcementInfo&&this._config.announcementInfo.activityWindowName;if("undefined"!==typeof window&&"undefined"!==typeof window.location&&window.location.search&&"function"===typeof URLSearchParams){var i=new URLSearchParams(location.search.slice(1));t=(t=t||i.get("t42PeerType"))||i.get("t42ActivityWindowType"),"undefined"===typeof n&&(n=i.get("t42ActivityWindowIndependent")),r=r||i.get("t42ActivityWindowName"),e=e||i.get("t42ActivityId")}return{activityWindowId:void 0,activityId:e,activityWindowType:t=t||"unknown",activityWindowIndependent:n=n||!1,activityWindowName:r=r||this._connection.peerId}}},{key:"joinActivity",value:function(e,t,n){var r=this,i=n&&{name:n}||{};return this._gw3Session.send(u({type:Nn,target_id:t,activity_id:e},i)).then((function(){r.invokeCallbacks(r._activityWindowChangeCallbacks,new pn(new In(t,void 0,void 0,e,r.getAgmInstance(t),void 0,r.generateWindowGetter(t),void 0),new fn(gn.ActivityWindowJoinedActivity)),"activity joined - ActivityWindow"),r.invokeCallbacks(r._activityChangeCallbacks,new pn(new xn(e,void 0,new Cn("created",void 0,void 0),void 0,void 0),new fn(gn.Updated)),"activity joined - Activity")}))}},{key:"leaveActivity",value:function(e,t){var n=this;return this._gw3Session.send({type:Wn,target_id:t,activity_id:e}).then((function(){n.invokeCallbacks(n._activityWindowChangeCallbacks,new pn(new In(t,void 0,void 0,null,n.getAgmInstance(t),void 0,n.generateWindowGetter(t),void 0),new fn(gn.ActivityWindowLeftActivity)),"activity left - ActivityWindow"),n.invokeCallbacks(n._activityChangeCallbacks,new pn(new xn(e,void 0,new Cn("created",void 0,void 0),void 0,void 0),new fn(gn.Updated)),"activity left - Activity")}))}},{key:"getActivityTypes",value:function(){return Promise.resolve([])}},{key:"getWindowTypes",value:function(){return Promise.resolve([])}},{key:"getActivities",value:function(){return Promise.resolve([])}},{key:"getActivityWindows",value:function(){return Promise.resolve([])}},{key:"createStackedWindows",value:function(e,t,n){}},{key:"getWindowBounds",value:function(e){}},{key:"setWindowBounds",value:function(e,t){}},{key:"activateWindow",value:function(e,t){}},{key:"setWindowVisibility",value:function(e,t){}},{key:"cloneActivity",value:function(e,t){}},{key:"attachActivities",value:function(e,t,n){return this._gw3Session.send({type:qn,into:t,merge:e})}},{key:"detachActivities",value:function(e,t){return this._gw3Session.send({type:Un,from:e}).then((function(){return""}))}},{key:"onActivitiesAttached",value:function(e){}},{key:"onActivitiesDetached",value:function(e){}},{key:"onActivityAttachedDescriptorsRefreshed",value:function(e){}},{key:"getAttachedDescriptors",value:function(){return Promise.resolve([])}},{key:"getRandomRequestId",value:function(){return this._connection.peerId+":"+Math.floor(1e9*Math.random())}},{key:"forwardAddedAndRemovedMessagesToEventHandler",value:function(e,t,n,r){var i=function(e){return function(t){return new pn(t,new fn(e?gn.Added:gn.Removed))}};return[e&&this.forwardMessageToEventHandler(e,(function(e){return n(e,!0)}),i(!0),r),t&&this.forwardMessageToEventHandler(t,(function(e){return n(e,!1)}),i(!1),r)].filter((function(e){return e}))}},{key:"forwardMessageToEventHandler",value:function(e,t,n,r){return this.subscribe(e,(function(e){t(e).forEach((function(t){return r.forEach((function(r){return r(n(t,e))}))}))}))}},{key:"sendCreateAndMapResultingMessagesToPromise",value:function(e,t,n,r,i,o,a,s,u){var c,l,d,p,f,h,v=this,g=this.getRandomRequestId(),y=new Promise((function(e,t){c=e,l=t})),m=null,w=function(){v.dropSubscription(d),u||v.dropSubscription(p),v.dropSubscription(f),v.dropSubscription(h)};d=t&&this.subscribe(t,(function(e){n(e,g)&&(m=e,v.dropSubscription(d))}));var b=!1;p=this.subscribe(r,(function(e){i(e,g,m)&&(b?u&&u(s(e)):(b=!0,c(s(e))))})),f=o&&this.subscribe(o,(function(e){a(e,g,m)&&l(e)})),h=o&&this.subscribe(Tn,(function(e){e.request_id===g&&l(e)})),e.request_id=g;var k=this._gw3Session.send(e).then((function(){return y}));return k.then(w,w),k}},{key:"peerFactoryIdAndOwnerIdToWindowType",value:function(e,t){var n=this._peerIdAndFactoryIdToPeerType[t+":"+e];return n?new dn(n,void 0):null}},{key:"subscribe",value:function(e,t){var n=this,r=this._connection.on(e,(function(e){return t.bind(n)(e)}));return this._gw3Subscriptions.push(r),r}},{key:"dropSubscription",value:function(e){e&&(this._connection.off(e),delete this._gw3Subscriptions[this._gw3Subscriptions.indexOf(e)])}},{key:"invokeCallbacks",value:function(e,t,n){var r=this;e.forEach((function(e){try{e(t)}catch(i){r._logger.error("Error in ".concat(n||t.context.type," callback: ")+JSON.stringify(i))}}))}},{key:"handleActivityCreatedMessage",value:function(e){e.context_id?this._contextSubscriptions[e.activity_id]||this.subscribeToContext(e):this._logger.error("Activity created with unknown context_id: "+e.activity_id)}},{key:"subscribeToContext",value:function(){var e=s(a().mark((function e(t){var n,r=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.activity_id,e.next=3,this._contexts.subscribe(n,(function(e,t,i){var o=new pn(new xn(n,void 0,void 0,e,void 0),new vn(e,t,i));r.invokeCallbacks(r._activityChangeCallbacks,o,"context updated")}));case 3:this._contextSubscriptions[n]=e.sent;case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleActivityDestroyedMessage",value:function(e){var t=this._contextSubscriptions[e.activity_id];"function"===typeof t&&t(),delete this._contextSubscriptions[e.activity_id]}},{key:"handlePeerFactoriesAdded",value:function(e){var t=this;e.factories.forEach((function(n){t._peerIdAndFactoryIdToPeerType[e.owner_id+":"+n.id]=n.peer_type}))}},{key:"handlePeerFactoriesRemoved",value:function(e){var t=this;e.factory_ids.forEach((function(n){delete t._peerIdAndFactoryIdToPeerType[e.owner_id+":"+n]}))}},{key:"forwardActivityTypeMessagesToStatusEventHandlers",value:function(){this.forwardAddedAndRemovedMessagesToEventHandler(En,Mn,(function(t,n){return n?t.types.map((function(t){return e.activityTypeGwMessageEntityToActivityType(t,void 0)})):t.types.map((function(e){return new ln(e.name,void 0,void 0,void 0)}))}),this._activityTypeStatusChangeCallbacks)}},{key:"forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers",value:function(){for(var e=this,t=0,n=[Rn,Ln,zn];t<n.length;t++){var r=n[t];this.forwardMessageToEventHandler(r,(function(t){return[t.owner||u(u({},t),{},{type:t.peer_type,name:t.peer_name,peer_id:t.owner_id})].concat(t.participants||[]).map((function(n){return new In(n.peer_id,n.name,n.type,t.activity_id,e.getAgmInstance(n.peer_id),void 0,e.generateWindowGetter(n.peer_id),void 0)}))}),(function(e,t){return new pn(e,new fn(gn.ActivityWindowJoinedActivity))}),this._activityWindowChangeCallbacks)}}},{key:"forwardActivityMessagesToStatusEventHandlers",value:function(){for(var t=0,n=[Rn,Ln];t<n.length;t++){var r=n[t];this.forwardMessageToEventHandler(r,(function(t){return[e.activityGwMessageToActivity(t,new Cn("started","",new Date))]}),(function(t,n){return e.activityToActivityStatusChangeEvent(t)}),this._activityChangeCallbacks)}this.forwardMessageToEventHandler(On,(function(t){return[e.activityGwMessageToActivity(t,new Cn("destroyed",t.reason,new Date))]}),(function(t,n){return e.activityToActivityStatusChangeEvent(t)}),this._activityChangeCallbacks),this.forwardMessageToEventHandler(jn,(function(t){return[e.activityGwMessageToActivity(t,new Cn("created","",new Date))]}),(function(t,n){return e.activityToActivityStatusChangeEvent(t)}),this._activityChangeCallbacks),this.forwardMessageToEventHandler(zn,(function(t){return[e.activityGwMessageToActivity(t,new Cn("created","",new Date))]}),(function(t,n){return e.activityToActivityStatusChangeEvent(t)}),this._activityChangeCallbacks)}},{key:"forwardPeerFactoryMessagesToStatusEventHandlers",value:function(){var t=this;this.forwardAddedAndRemovedMessagesToEventHandler(Bn,Vn,(function(n,r){return r?n.factories.map(e.peerFactoryGwMessageEntityToWindowType):n.factory_ids.map((function(e){return t.peerFactoryIdAndOwnerIdToWindowType(e,n.owner_id)})).filter((function(e){return null!=e}))}),this._windowTypeStatusChangeCallbacks)}},{key:"forwardPeerFactoryMessagesToPeerFactoryRequests",value:function(){var e=this;this.subscribe(Qn,(function(t){var n=e._peerFactoriesRegisteredByUs[t.peer_factory];if(n)try{var r=t.configuration||{};r.gateway_token=r.gateway_token||t.gateway_token,r.peer_factory=r.peer_factory||t.peer_factory;var i=n({activityId:t.activity&&t.activity.id,activityType:t.activity&&t.activity.type,type:t.configuration&&t.configuration.type,gwToken:r.gateway_token,configuration:r});i&&i.then&&i.catch&&i.catch((function(n){return e._gw3Session.send({type:Tn,request_id:t.request_id,reason:n&&(n.message||JSON.stringify(n))})}))}catch(o){e._gw3Session.send({type:Tn,request_id:t.request_id,reason:o&&(o.message||JSON.stringify(o))})}else e._gw3Session.send({type:Tn,request_id:t.request_id,reason:"Unknown peer factory ".concat(t.peer_factory)})}))}},{key:"forwardActivityWindowMessagesToEventHandlers",value:function(){for(var e=this,t=function(){var t=r[n];e.subscribe(t,(function(n){var r=t===Dn?n.joined_id:n.peer_id,i=t===Dn?n.joined_type:n.peer_type,o=t===Dn?n.joined_name:n.peer_name,a=new In(r,o,i,n.activity_id,e.getAgmInstance(r),void 0,e.generateWindowGetter(r),void 0);e._contextSubscriptions[n.activity_id]?t===Ln&&e._activityJoinedPromiseResolve({}):e.subscribeToContext(n).then((function(){t===Ln&&e._activityJoinedPromiseResolve({})})),e.invokeCallbacks(e._activityWindowChangeCallbacks,new pn(a,new fn(gn.ActivityWindowJoinedActivity)),t)}))},n=0,r=[Dn,Ln];n<r.length;n++)t();this.subscribe(Fn,(function(t){var n=new In(t.left_id,void 0,void 0,null,e.getAgmInstance(t.left_id),void 0,e.generateWindowGetter(t.left_id),void 0);e.invokeCallbacks(e._activityWindowChangeCallbacks,new pn(n,new fn(gn.ActivityWindowLeftActivity)),Fn)})),this.forwardAddedAndRemovedMessagesToEventHandler(Yn,void 0,(function(t){return[new In(t.created_id,void 0,void 0,void 0,void 0,void 0,e.generateWindowGetter(t.created_id),void 0)]}),this._activityWindowChangeCallbacks)}},{key:"getAgmInstance",value:function(e){return this._config.agm.servers().find((function(t){return t.peerId===e||t.windowId===e}))}},{key:"generateWindowGetter",value:function(e){var t=this;return function(){var n=t.getAgmInstance(e);if(n){var r=n.windowId;return t._config.windows.list().filter((function(e){return e.id===r}))[0]}}}},{key:"isOverrideTypeDefinition",value:function(e){return"undefined"!==typeof e&&!!e.owner}}],[{key:"activityTypeGwMessageEntityToActivityType",value:function(e,t){var n=function(e){return new dn(e,void 0)};return new ln(e.name,e.owner_type&&n(e.owner_type),e.helper_types&&e.helper_types.map(n),t)}},{key:"peerFactoryGwMessageEntityToWindowType",value:function(e){return new dn(e.peer_type,(function(e){}))}},{key:"activityGwMessageToActivity",value:function(e,t){var n=void 0!==e.owner?e.owner.peer_id:e.owner_id;return new xn(e.activity_id,e.activity_type,t,e.context_snapshot,n)}},{key:"activityToActivityStatusChangeEvent",value:function(e){return new pn(e,new hn(e.status,void 0))}}]),e}(),nr=function(){function e(t,n){var r=this;v(this,e),this._myAttached=[],this._myDetached=[],this._myAttachedTo=[],this._myDetachedFrom=[],this._myActivityFrameColorChanged=[],this._myActivityJoinedCallbacks=[],this._myActivityRemovedCallbacks=[],this._myContextUpdateCallbacks=[],this._logger=Sn.Get(this),this._m=t,t.ready().then((function(e){e.subscribeActivityContextChanged(r._subscribeMyContextChanged.bind(r)),e.subscribeWindowEvents(r._subscribeMyWindowEvent.bind(r)),e.subscribeActivitiesAttached(r._subscribeActivitiesAttached.bind(r)),e.subscribeActivitiesDetached(r._subscribeActivitiesDetached.bind(r)),n&&n.onWindowFrameColorChanged(r._subscribeWindowFrameColorChanged.bind(r))}))}return g(e,[{key:"window",get:function(){if(nn(this._w)){var e=this._m.announcedWindows;e.length>0&&(this._w=e[0])}return this._w}},{key:"activity",get:function(){var e=this.window;if(!nn(e))return e.activity}},{key:"createWindow",value:function(e){return this._m.createWindow(this.activity,e)}},{key:"createStackedWindows",value:function(e,t){return this._m.createStackedWindows(this.activity,e,t)}},{key:"context",get:function(){var e=this.activity;return tn(e)?{}:e.context}},{key:"updateContext",value:function(e,t){var n=this.activity;return tn(n)?new Promise((function(e,t){t("Not in activity")})):n.updateContext(e,t)}},{key:"setContext",value:function(e,t){var n=this.activity;return tn(n)?new Promise((function(e,t){t("Not in activity")})):n.setContext(e,t)}},{key:"onActivityJoined",value:function(e){this._myActivityJoinedCallbacks.push(e);var t=this.window;nn(t)||nn(t.activity)||e(t.activity)}},{key:"onActivityLeft",value:function(e){this._myActivityRemovedCallbacks.push(e)}},{key:"onContextChanged",value:function(e){this._myContextUpdateCallbacks.push(e);var t=this.window;if(!nn(t)){var n=t.activity;nn(n)||e(n.context,n.context,[],n)}}},{key:"clone",value:function(e,t){var n=this.activity;return this._m.clone(n,e,t)}},{key:"attach",value:function(e,t){var n;return n="string"===typeof e?e:e.id,this._m.attachActivities(n,this.activity.id,t)}},{key:"onActivityAttached",value:function(e){this._myAttached.push(e)}},{key:"onActivityDetached",value:function(e){this._myDetached.push(e)}},{key:"onAttachedToActivity",value:function(e){this._myAttachedTo.push(e)}},{key:"onDetachedFromActivity",value:function(e){this._myDetachedFrom.push(e)}},{key:"attached",get:function(){return this.activity?this.activity.attached:[]}},{key:"setFrameColor",value:function(e,t){return this.activity?this.activity.setFrameColor(e,t):Promise.resolve(null)}},{key:"getFrameColor",value:function(){return this.activity?this.activity.getFrameColor():""}},{key:"onFrameColorChanged",value:function(e){this._myActivityFrameColorChanged.push(e)}},{key:"_subscribeMyContextChanged",value:function(e,t,n,r){var i=this.window;if(!nn(i)){var o=i.activity;nn(o)||e.id===o.id&&this._notifyMyContextChanged(e,t,n,r)}}},{key:"_subscribeMyWindowEvent",value:function(e,t,n){nn(this.window)||this.window.id===t.id&&(n===gn.ActivityWindowJoinedActivity?(this._notifyMyWindowEvent(e,this._myActivityJoinedCallbacks),this._notifyMyContextChanged(e,e.context,null,null)):n===gn.ActivityWindowLeftActivity&&this._notifyMyWindowEvent(e,this._myActivityRemovedCallbacks))}},{key:"_notifyMyWindowEvent",value:function(e,t){var n=this;t.forEach((function(t){try{t(e,event)}catch(r){n._logger.warn("error in user callback "+r)}}))}},{key:"_notifyMyContextChanged",value:function(e,t,n,r){var i=this;n=n||{},r=r||[],this._myContextUpdateCallbacks.forEach((function(o){try{o(t,n,r,e)}catch(a){i._logger.warn("error in user callback "+a)}}))}},{key:"_notifyAttached",value:function(e){var t=this;this._myAttached.forEach((function(n){try{n(e)}catch(r){t._logger.warn("error in user callback "+r)}}))}},{key:"_notifyDetached",value:function(e){var t=this;this._myDetached.forEach((function(n){try{n(e)}catch(r){t._logger.warn("error in user callback "+r)}}))}},{key:"_notifyAttachedTo",value:function(e){var t=this;this._myAttachedTo.forEach((function(n){try{n(t.activity,e)}catch(r){t._logger.warn("error in user callback "+r)}}))}},{key:"_notifyDetachedFrom",value:function(e,t,n){var r=this;this._myDetachedFrom.forEach((function(i){try{i(e,t,n)}catch(o){r._logger.warn("error in user callback "+o)}}))}},{key:"_subscribeActivitiesAttached",value:function(e,t){var n=this.window;if(!nn(n)){var r=n.activity;nn(r)||e.id===r.id&&(t.windowIds.indexOf(n.id)>=0?this._notifyAttachedTo(t):this._notifyAttached(t))}}},{key:"_subscribeActivitiesDetached",value:function(e,t,n){var r=this.window;if(!nn(r)){var i=r.activity;nn(i)||(t.id===i.id&&this._notifyDetached(n),e.id===i.id&&this._notifyDetachedFrom(e,t,n))}}},{key:"_subscribeWindowFrameColorChanged",value:function(e){var t=this.activity;t&&t.owner&&t.owner.underlyingWindow.id===e.id&&this._myActivityFrameColorChanged.forEach((function(t){t(e.frameColor)}))}}]),e}(),rr=function(){function e(t,n){if(v(this,e),this._logger=Sn.Get("ReadyMarker ["+t+"]"),this._logger.debug("Initializing ready marker for '"+t+"' with "+n+" signals to wait"),n<=0)throw new Error("Invalid signal number. Should be > 0");this._signals=n,this._callbacks=[],this._name=t}return g(e,[{key:"setCallback",value:function(e){this.isSet()?e(void 0):this.isError()?e(this._error):this._callbacks.push(e)}},{key:"signal",value:function(e){if(this._logger.debug("Signaled - "+e+" - signals left "+(this._signals-1)),this._signals--,this._signals<0)throw new Error("Error in ready marker '"+this._name+" - signals are "+this._signals);this.isSet()&&this._callbacks.forEach((function(e){e(void 0)}))}},{key:"error",value:function(e){this._error=e,this._callbacks.forEach((function(t){t(e)}))}},{key:"isSet",value:function(){return!this.isError()&&0===this._signals}},{key:"isError",value:function(){return!tn(this._error)}},{key:"getError",value:function(){return this._error}}]),e}(),ir=function(){function e(t){v(this,e),this._items={},this._listeners=[],this._processNew=t}return g(e,[{key:"addOne",value:function(e){this.add([e])}},{key:"add",value:function(e){var t=this;e.forEach((function(e){t.process(new pn(e,new fn(gn.Added)))}))}},{key:"process",value:function(e){var t=e.context,n=t.type,r=e.entity;if(n===gn.StatusChange&&!t.oldStatus){var i=this._items[r.id];i&&(t.oldStatus=i.status)}n===gn.StatusChange&&t.oldStatus&&t.newStatus&&t.oldStatus.state===t.newStatus.state&&(t.type=gn.Updated),"undefined"===typeof htmlContainer&&(n===gn.ActivityWindowJoinedActivity&&this._items[r.id]&&this._items[r.id].activity&&(t.type=gn.Updated),n===gn.ActivityWindowLeftActivity&&this._items[r.id]&&!this._items[r.id].activity&&(t.type=gn.Updated));var o=this._updateInternalCollections(r,n,t);return this._notifyListeners(o,t),o}},{key:"get",value:function(){var e=[];for(var t in this._items)if(this._items.hasOwnProperty(t)){var n=this._items[t];e.push(n)}return e}},{key:"getByName",value:function(e){for(var t in this._items)if(t===e)return this._items[t]}},{key:"getOrWait",value:function(e){var t=this;return new Promise((function(n){var r=function r(i){i.id===e&&(n(i),t.unsubscribe(r))};t.subscribe(r);var i=t.getByName(e);if(i)return t.unsubscribe(r),void n(i)}))}},{key:"subscribe",value:function(e){var t=this;return this._listeners.push(e),Object.keys(this._items).forEach((function(n){var r=t._items[n];e(r,new fn(gn.Added.toString()))})),function(){t.unsubscribe(e)}}},{key:"unsubscribe",value:function(e){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},{key:"_notifyListeners",value:function(e,t){this._listeners.forEach((function(n){try{n(e,t)}catch(r){return}}))}},{key:"_updateInternalCollections",value:function(e,t,n){var r=e,i=t===gn.StatusChange&&r.status&&r.status.state===yn.Destroyed||t===gn.StatusChange&&n&&n.newStatus&&n.newStatus.state===yn.Destroyed,o=t===gn.Closed;if(t===gn.Removed&&"undefined"===typeof r.isIndependent||o||i){var a=this._items[e.id];return delete this._items[e.id],this._processNew(e),a&&e._beforeDelete(a),e}var s=e.id;return this._items.hasOwnProperty(s)?this._items[e.id]._update(e):(this._processNew(e),this._items[e.id]=e),this._items[e.id]}}]),e}(),or=function(){function e(t,n,r){var i=this;v(this,e),this._logger=Sn.Get("activityManager"),this._announcedWindows=[],this._attachedCallbacks=[],this._detachedCallbacks=[],this._frameColorChangesCallbacks=[],this._windowHandlers=[],this._bridge=t,this._activityTypes=new ir((function(e){return i._grabEntity(e)})),this._windowTypes=new ir((function(e){return i._grabEntity(e)})),this._activities=new ir((function(e){return i._grabEntity(e)})),this._windows=new ir((function(e){return i._grabEntity(e)})),this._dataReadyMarker=new rr("Activity Manager Data",["GetActivityTypes","GetWindowTypes","GetActivities","GetWindows"].length),this._descriptorsMarker=new rr("Attached Activities Descriptors",["GetDescriptors"].length),n?(this._readyMarker=new rr("Activity Manager Announce",["Announcement"].length),this._dataReadyMarker.setCallback((function(e){e&&i._readyMarker.error(e),i._descriptorsMarker.setCallback((function(e){e&&i._readyMarker.error(e),i._logger.debug("Auto announcing window"),i.announceWindow().then((function(e){i._announcedWindows.push(e),i._readyMarker.signal("Successfully announced window with id '"+e.id+"'")})).catch((function(e){i._logger.debug("Will not announce window - "+e),i._readyMarker.signal()}))})),i.refreshDescriptors()}))):this._readyMarker=this._dataReadyMarker,this._bridge.onActivitiesAttached((function(e){i._handleActivitiesAttached(e)})),this._bridge.onActivitiesDetached((function(e){i._handleActivitiesDetached(e)})),this._bridge.onActivityAttachedDescriptorsRefreshed((function(e){i._handleActivityDescriptorsRefreshed(e)})),r&&r.onWindowFrameColorChanged(this._handleWindowFrameColorChanged.bind(this)),this._bridge.init(),this._subscribeForData(),this._bridge.initReady().then((function(e){i._getInitialData()})).catch((function(e){console.log(e)}))}return g(e,[{key:"usingHc",get:function(){return"HC"===this._bridge.bridgeType}},{key:"announcedWindows",get:function(){return this._announcedWindows},set:function(e){throw new Error("not allowed")}},{key:"ready",value:function(e){var t=this,n=new Promise((function(e,n){t._readyMarker.setCallback((function(r){r?n(t._readyMarker.getError()):e(t)}))}));return kn(Promise.all([this._bridge.ready(),n]).then((function(){return t})),e)}},{key:"getActivityTypes",value:function(){return this._activityTypes.get()}},{key:"getActivityType",value:function(e){return this._activityTypes.getByName(e)}},{key:"registerActivityType",value:function(e,t,n,r,i,o){var a=this;return kn(new Promise((function(o,s){var u;if(nn(e))s("activityTypeName argument can not be undefined");else if(Xt(e))if(nn(a.getActivityType(e)))if(tn(t))s("Owner window type can not be undefined");else{u=Xt(t)?{type:t,name:"",isIndependent:!1,arguments:{}}:t;var c=[];if(!tn(n)&&en(n))for(var l in n){var d=n[l];if(Xt(d)){var p={type:d,name:"",isIndependent:!1,arguments:{},relativeTo:"",relativeDirection:"",windowStyleAttributes:{}};c.push(p)}else c.push(d)}a._bridge.registerActivityType(e,u,c,r,i).then((function(e){a._grabEntity(e),o(e)})).catch((function(e){s(e)}))}else s("Activity type '"+e+"' already exists");else s("activityTypeName should be string")})),o)}},{key:"unregisterActivityType",value:function(e,t){var n=this;return kn(new Promise((function(t,r){var i=n.getActivityType(e);tn(i)?r("Activity type '"+e+"' does not exists"):n._bridge.unregisterActivityType(e).then((function(){return t(i)}),r)})),t)}},{key:"initiate",value:function(e,t,n,r){var i=this;return kn(new Promise((function(n,o){tn(i.getActivityType(e))?o("Activity type '"+e+"' does not exists"):i._bridge.initiateActivity(e,t,r).then((function(e){i._activities.getOrWait(e).then((function(e){n(e)})).catch((function(e){return o(e)}))})).catch((function(e){o(e)}))})),n)}},{key:"subscribeActivityTypeEvents",value:function(e){this._activityTypes.subscribe((function(t,n){e(t,n.type)}))}},{key:"getWindowTypes",value:function(){return this._windowTypes.get()}},{key:"getWindowType",value:function(e){return this._windowTypes.getByName(e)}},{key:"registerWindowFactory",value:function(e,t,n){var r=this;return kn(new Promise((function(n,i){if(nn(e))i("no windowType specified");else{if(Zt(e))e=e.getName();else if(!Xt(e))return void i("windowType should be string or object that has getName method");r._bridge.registerWindowFactory(e,t).then((function(e){n(e)})).catch((function(e){i(e)}))}})),n)}},{key:"unregisterWindowFactory",value:function(e,t){var n=this;return kn(new Promise((function(t,r){nn(e)?r("no windowType specified"):Xt(e)?n._bridge.unregisterWindowFactory(e).then((function(e){t(e)})).catch((function(e){r(e)})):r("windowType should be a string")})),t)}},{key:"getActivities",value:function(e){var t=this._activities.get();if(t=t.filter((function(e){return e._ownerId})),!e)return t;var n=e;if(Xt(e))n=[e];else if(e instanceof ln)n=[e.name];else if(!(e instanceof Array))throw new Error("Invalid input argument 'activityType' = "+e);return t.filter((function(e){var t=e.type;return sn(n,(function(e){return t.id===e.id}))}))}},{key:"getActivityById",value:function(e){return this._activities.getByName(e)}},{key:"announceWindow",value:function(e,t){var n=this;return new Promise((function(r,i){var o=n._bridge.getAnnouncementInfo();if(tn(e)&&(e=o.activityWindowId),tn(t)&&(t=o.activityWindowType),nn(t))throw new Error("Can not announce - unknown windowType");var a=o&&o.activityId;if(nn(e))n._logger.debug("Registering window with type:'"+t+"', name:'"+o.activityWindowName+"', ind.:'"+o.activityWindowIndependent+"'"),n._bridge.registerWindow(t,o.activityWindowName,o.activityWindowIndependent).then(n._windows.getOrWait.bind(n._windows)).then((function(e){return a?n._activities.getOrWait(a).then((function(t){return e})):e})).then((function(e){r(e)})).catch((function(e){n._logger.error(e)}));else{n._logger.debug("Announcing window with id '"+e+"' and type '"+t+"'");var s=n._windows.getByName(e);if(!nn(s))return n._logger.debug("Window with id '"+e+"' already announced - reusing the window"),void r(s);var u=function t(o,a,s){e===a.id&&s===gn.ActivityWindowJoinedActivity&&(tn(a.activity)&&i("UNDEFINED ACTIVITY"),n._logger.trace("Got joined event for id '"+e+"'"),r(a),n.unsubscribeWindowEvents(t))};n.subscribeWindowEvents(u),n._logger.trace("Waiting for joined event for id '"+e+"'"),n._bridge.announceWindow(t,e)}}))}},{key:"subscribeWindowTypeEvents",value:function(e){this._windowTypes.subscribe((function(t,n){e(t,n.type)}))}},{key:"subscribeActivityEvents",value:function(e){var t=this;return this._activities.subscribe((function(n,r){if(r.type===gn.StatusChange){var i=r;e(n,i.newStatus,i.oldStatus)}if(r.type===gn.Removed||r.type===gn.StatusChange&&r.newStatus.getState()===yn.Destroyed){var o,a=c(t._windows.get());try{for(a.s();!(o=a.n()).done;){var s=o.value;s.activity&&s.activity.id===n.id&&t._windows.process(new pn(s,new fn(gn.ActivityWindowLeftActivity)))}}catch(u){a.e(u)}finally{a.f()}}}))}},{key:"subscribeWindowEvents",value:function(e){var t=function(t,n){var r=n.type;r===gn.Added&&(r="opened"),e(t.activity,t,r)};return this._windowHandlers.push([e,t]),this._windows.subscribe(t)}},{key:"unsubscribeWindowEvents",value:function(e){var t=this._windowHandlers.find((function(t){return t[0]===e}));t&&(this._windowHandlers.splice(this._windowHandlers.indexOf(t),1),this._windows.unsubscribe(t[1]))}},{key:"createWindow",value:function(e,t,n){var r=this;return kn(new Promise((function(n,i){var o,a;if(nn(t)&&i("windowType is undefined"),Xt(t))o={type:t,name:"",isIndependent:!1,arguments:{}};else if(t instanceof dn)o={type:t.type||t.id,name:t.name||t.type||t.id,isIndependent:!1};else{var s=["url"],u={};Object.keys(t).forEach((function(e){-1===s.indexOf(e)&&(u[e]=t[e])})),o=u}if(!nn(o.relativeTo))if("string"===typeof(a=o.relativeTo)){var c=r.getWindows({type:a});!nn(c)&&c.length>0&&(o.relativeTo=c[0].id)}else if(nn(a.type))nn(a.windowId)||(o.relativeTo=a.windowId);else{var l=r.getWindows({type:a.type});!nn(l)&&l.length>0&&(o.relativeTo=l[0].id)}r._bridge.createWindow(e&&e.id,o).then((function(t){r._logger.debug("Window created, waiting for window entity with id "+t);var i=function i(o,a){o.id!==t||e&&!o.activity||(r._logger.debug("Got entity window with id "+t),n(o),r._windows.unsubscribe(i))};r._windows.subscribe(i)})).catch((function(e){i(e)}))})),n)}},{key:"createStackedWindows",value:function(e,t,n,r){var i=this;return kn(new Promise((function(r,o){nn(e)&&o("activity is undefined"),nn(t)&&o("relativeWindowTypes is undefined"),Array.isArray(t)||o("relativeWindowTypes has to be an array"),nn(n)&&(n=2e4);var a=[];t.forEach((function(e){var t,r;if((t=Xt(e)?{type:e,name:"",isIndependent:!1,arguments:{}}:e).stackedWindow=!0,t.timeout=n,!nn(t.relativeTo))if(nn((r=t.relativeTo).type)){if(!nn(r.windowId)){var o=i.getWindows({id:r.windowId});!nn(o)&&o.length>0&&(t.relativeTo=o[0].type.name)}}else t.relativeTo=r.type;a.push(t)}));var s=[];a.forEach((function(t){return s.push(i.createWindow(e,t))})),Promise.all(s).then(r).catch(o)})),r)}},{key:"addWindowToActivity",value:function(e,t,n){var r=this._bridge.joinActivity(e.id,t.id).then((function(){return t}));return kn(r,n),r}},{key:"leaveWindowFromActivity",value:function(e,t,n){var r=this._bridge.leaveActivity(e.id,t.id).then((function(){return t}));return kn(r,n),r}},{key:"setActivityContext",value:function(e,t,n){var r=this;return kn(new Promise((function(n,i){nn(e)&&i("activity can not be null"),r._bridge.updateActivityContext(e,t,!0).then((function(t){n(e)})).catch((function(e){i(e)}))})),n)}},{key:"updateActivityContext",value:function(e,t,n){var r=this;return kn(new Promise((function(n,i){nn(e)&&i("activity can not be null");var o=[];for(var a in t)t.hasOwnProperty(a)&&null===t[a]&&o.push(a);for(var s=0,u=o;s<u.length;s++){var c=u[s];delete t[c]}r._bridge.updateActivityContext(e,t,!1,o).then((function(t){n(e)})).catch((function(e){i(e)}))})),n)}},{key:"subscribeActivityContextChanged",value:function(e){this._activities.subscribe((function(t,n){if(n.type===gn.ActivityContextChange){var r=n;e(t,r.context,r.updated,r.removed)}}))}},{key:"stopActivity",value:function(e,t){return kn(this._bridge.stopActivity(e),t)}},{key:"getWindows",value:function(e){return tn(e)?this._windows.get():tn(e.id)?this._windows.get().filter((function(t){if(!tn(e.type)&&t.type.id!==e.type)return!1;if(!tn(e.name)&&t.name!==e.name)return!1;if(!tn(e.activityId)){if(nn(t.activity))return!1;if(t.activity.id!==e.activityId)return!1}return!0})):[this._windows.getByName(e.id)]}},{key:"getWindowBounds",value:function(e){return this._bridge.getWindowBounds(e)}},{key:"setWindowBounds",value:function(e,t,n){var r=this;return kn(new Promise((function(n,i){r._bridge.setWindowBounds(e,t).then((function(){return n()})).catch((function(e){return i(e)}))})),n)}},{key:"closeWindow",value:function(e){return this._bridge.closeWindow(e)}},{key:"activateWindow",value:function(e,t){return this._bridge.activateWindow(e,t)}},{key:"setWindowVisibility",value:function(e,t){return this._bridge.setWindowVisibility(e,t)}},{key:"clone",value:function(e,t,n){var r=this;return kn(new Promise((function(n,i){e||i("activity can not be null"),r._bridge.cloneActivity(e.id,t).then((function(e){r._activities.getOrWait(e).then((function(e){n(e)})).catch((function(e){return i(e)}))})).catch((function(e){return i(e)}))})),n)}},{key:"attachActivities",value:function(e,t,n,r){var i=this;return n=n||{},kn(new Promise((function(r,o){if(i._activities.getByName(e)){if(i._activities.getByName(t))return i._bridge.attachActivities(e,t,n).then((function(e){var t=e.to,n=e.descriptor,o=e.descriptors;i._activities.getOrWait(t).then((function(e){e._updateDescriptors(o);var t=e.attached.filter((function(e){return e.ownerId===n.ownerId}))[0];r(t)}))})).catch((function(e){o(e)}));o("can not find activity with id "+t)}else o("can not find activity with id "+e)})),r)}},{key:"detachActivities",value:function(e,t,n){var r=this;return kn(new Promise((function(n,i){return r._bridge.detachActivities(e,t).then((function(){var e=void 0,t=void 0,o=void 0;r._activities.getOrWait(e).then((function(e){e._updateDescriptors(o),r._activities.getOrWait(t).then((function(e){n(e)}))})).catch((function(e){return i(e)}))})).catch((function(e){i(e)}))})),n)}},{key:"subscribeActivitiesAttached",value:function(e){this._attachedCallbacks.push(e)}},{key:"subscribeActivitiesDetached",value:function(e){this._detachedCallbacks.push(e)}},{key:"subscribeActivityFrameColorChanged",value:function(e){this._frameColorChangesCallbacks.push(e)}},{key:"_grabEntity",value:function(e){e._manager=this}},{key:"_getInitialData",value:function(){var e=this;this._logger.debug("Request initial data..."),this._bridge.getActivityTypes().then((function(t){e._activityTypes.add(t),e._dataReadyMarker.signal("Got act types")})).catch((function(t){e._logger.error(t),e._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity types -"+t)})),this._bridge.getWindowTypes().then((function(t){e._windowTypes.add(t),e._dataReadyMarker.signal("Got window types")})).catch((function(t){e._logger.error(t),e._dataReadyMarker.error("Can not initialize ActivityManager - error getting window types  "+t)})),this._bridge.getActivities().then((function(t){e._activities.add(t),e._dataReadyMarker.signal("Got activities")})).catch((function(t){e._logger.error(t),e._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity instances -"+t)})),this._bridge.getActivityWindows().then((function(t){e._windows.add(t),e._dataReadyMarker.signal("Got windows")})).catch((function(t){e._logger.error(t),e._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity windows -"+t)}))}},{key:"_subscribeForData",value:function(){var e=this;this._logger.debug("Subscribe for data..."),this._bridge.onActivityTypeStatusChange((function(t){e._activityTypes.process(t)})),this._bridge.onWindowTypeStatusChange((function(t){e._windowTypes.process(t)})),this._bridge.onActivityWindowChange((function(t){e._windows.process(t)})),this._bridge.onActivityStatusChange((function(t){e._activities.process(t)}))}},{key:"_handleActivitiesAttached",value:function(e){var t=this,n=e.to,r=e.descriptor,i=e.descriptors;this._activities.getOrWait(n).then((function(e){e._updateDescriptors(i);var n=e.attached.filter((function(e){return e.ownerId===r.ownerId}))[0];t._attachedCallbacks.forEach((function(t){try{t(e,n)}catch(r){return}}))}))}},{key:"_handleActivitiesDetached",value:function(e){var t=this,n=e.oldActivityId,r=e.newActivityId,i=e.descriptors,o=e.descriptor;this._activities.getOrWait(n).then((function(e){e._updateDescriptors(i),t._activities.getOrWait(r).then((function(n){t._detachedCallbacks.forEach((function(t){try{t(n,e,o)}catch(r){return}}))}))}))}},{key:"_handleActivityDescriptorsRefreshed",value:function(e){var t=e.id,n=e.descriptors,r=this._activities.getByName(t);r&&r._updateDescriptors(n)}},{key:"refreshDescriptors",value:function(){var e=this;this._bridge.getAttachedDescriptors().then((function(t){t&&Object.keys(t).forEach((function(n){var r=n,i=t[n],o=e._activities.getByName(r);o&&o._updateDescriptors(i)})),e._descriptorsMarker.signal("Successfully got descriptors")})).catch((function(t){e._descriptorsMarker.error("failed to get descriptors - "+t)}))}},{key:"_handleWindowFrameColorChanged",value:function(e){if(e.activityId){var t=this._activities.getByName(e.activityId);t&&t.owner&&t.owner.underlyingWindow.id===e.id&&this._frameColorChangesCallbacks.forEach((function(n){try{n(t,e.frameColor)}catch(r){return}}))}}}]),e}(),ar=function(){function e(t,n){v(this,e),this._m=t,this._my=n,this.activityTypes={get:this._getActivityTypesWrapper.bind(this),register:this._m.registerActivityType.bind(this._m),unregister:this._m.unregisterActivityType.bind(this._m),subscribe:this._m.subscribeActivityTypeEvents.bind(this._m),unsubscribe:void 0,initiate:this._m.initiate.bind(this._m)},this.windowTypes={get:this._getWindowTypesWrapper.bind(this),registerFactory:this._m.registerWindowFactory.bind(this._m),unregisterFactory:this._m.unregisterWindowFactory.bind(this._m),subscribe:this._m.subscribeWindowTypeEvents.bind(this._m),unsubscribe:void 0},this.windows={get:this._m.getWindows.bind(this._m),subscribe:this._m.subscribeWindowEvents.bind(this._m),announce:this._m.announceWindow.bind(this._m),unsubscribe:void 0,create:this._m.createWindow.bind(this._m)},this.instances={get:this._m.getActivities.bind(this._m),subscribe:this._m.subscribeActivityEvents.bind(this._m),unsubscribe:void 0}}return g(e,[{key:"onAttached",value:function(e){this._m.subscribeActivitiesAttached(e)}},{key:"onDetached",value:function(e){this._m.subscribeActivitiesDetached(e)}},{key:"onActivityFrameColorChanged",value:function(e){this._m.subscribeActivityFrameColorChanged(e)}},{key:"_getActivityTypesWrapper",value:function(e){return tn(e)?this._m.getActivityTypes():this._m.getActivityType(e)}},{key:"_getWindowTypesWrapper",value:function(e){return tn(e)?this._m.getWindowTypes():this._m.getWindowType(e)}}]),e}(),sr=function(){function e(t,n){v(this,e),this._mgr=t,this._my=n,this.all=new ar(t,n)}return g(e,[{key:"ready",value:function(e){var t=this;return kn(new Promise((function(e,n){t._mgr.ready().then((function(){e(t)})).catch((function(e){n(e)}))})),e)}},{key:"my",get:function(){return this._my}},{key:"aware",get:function(){return void 0!==this._my.window}},{key:"inActivity",get:function(){return this.aware&&void 0!==this._my.activity}},{key:"agm",get:function(){if(this.aware)return this.inActivity?this._my.activity.agm:new mn(null)}},{key:"getAvailableFrameColors",value:function(){return[]}}]),e}(),ur=function(){function e(t){var n,r=this;if(v(this,e),!t)throw new Error("config can not be null");if(tn(t.logLevel)||(Sn.Level=t.logLevel),nn(t.logger)||(Sn.GlueLogger=t.logger),this._isUsingHCImplementation=2===t.gdMajorVersion,this._isUsingGW3Implementation=e.checkIsUsingGW3Implementation(t.connection),this._isUsingHCImplementation)throw new Error("GD2 not supported");if(!this._isUsingGW3Implementation)throw new Error("Unable to instantiate activity bridge implementation");if(!(n=new tr(t)))throw new Error("A bridge to native activity is needed to create activity lib.");mn.AGM=t.agm;var i=new or(n,!t.disableAutoAnnounce,t.windows),o=new nr(i,t.windows);this._api=new sr(i,o),this._readyPromise=i.ready().then((function(e){return r}))}return g(e,[{key:"api",get:function(){return this._api},set:function(e){this._api=e}},{key:"isUsingHCImplementation",get:function(){return this._isUsingHCImplementation}},{key:"isUsingGW3Implementation",get:function(){return this._isUsingGW3Implementation}},{key:"ready",value:function(e){return kn(this._readyPromise,e)}}],[{key:"checkIsUsingGW3Implementation",value:function(e){return 3===e.protocolVersion}}]),e}(),cr="T42.ACS.Shutdown",lr="T42.ACS.OnGDShutdown",dr="T42.ACS.Restart",pr="T42.ACS.GetConfigurationRegion",fr="T42.ACS.SetConfigurationRegion",hr="T42.ACS.GetUser",vr="T42.ACS.GetBranches",gr="T42.ACS.GetCurrentBranch",yr="T42.ACS.SetCurrentBranch",mr="T42.ACS.GetFunctionalEntitlement",wr="T42.ACS.CanI",br="T42.ACS.StartApplication",kr="T42.ACS.StopApplication",xr="T42.ACS.ActivateApplication",_r="T42.ACS.OnEvent",Sr="T42.ACS.GetApplications";function Ir(e){if(e&&e.errorHandling&&"function"!==typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"===typeof e.errorHandling&&e.errorHandling,n={};function r(e,t,r){var i=n[e];return i||(i=[],n[e]=i),i.push(t),r&&setTimeout((function(){r.forEach((function(r){var i;if(null===(i=n[e])||void 0===i?void 0:i.includes(t))try{Array.isArray(r)?t.apply(void 0,r):t.apply(void 0,[r])}catch(a){o(a,e)}}))}),0),function(){var r=n[e];r&&(0===(r=r.reduce((function(e,n,r){return n===t&&e.length===r||e.push(n),e}),[])).length?delete n[e]:n[e]=r)}}function i(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i=n[e];if(!i||0===i.length)return[];var a=[];return i.forEach((function(n){try{var r=n.apply(void 0,t);a.push(r)}catch(i){a.push(void 0),o(i,e)}})),a}function o(n,r){var i=n instanceof Error?n:new Error(n);if(t)t(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}function a(){n={}}function s(e){n[e]&&delete n[e]}return{add:r,execute:i,clear:a,clearKey:s}}Ir.default=Ir;var Cr=Ir;function Tr(e){return e?Object.keys(e).map((function(t){return e[t]})):[]}function Ar(e){var t;try{t=JSON.parse(JSON.stringify(e||{}))}catch(n){t={}}return t}var Er=function(){function e(t,n,r){var i=this;v(this,e),this._appManager=t,this._name=n,this._agm=r,this._registry=Cr(),t.onInstanceStarted((function(e){e.application&&e.application.name!==i._name||i._registry.execute("instanceStarted",e)})),t.onInstanceStopped((function(e){e.application&&e.application.name!==i._name||i._registry.execute("instanceStopped",e)})),t.onAppRemoved((function(e){e.name===i._name&&i._registry.execute("appRemoved",e)})),t.onAppChanged((function(e){e.name===i._name&&i._registry.execute("appChanged",e)})),t.onAppAvailable((function(e){e.name===i._name&&(i._props.IsReady=!0,i._registry.execute("appAvailable",e))})),t.onAppUnavailable((function(e){e.name===i._name&&(i._props.IsReady=!1,i._registry.execute("appUnavailable",e))}))}return g(e,[{key:"name",get:function(){return this._name}},{key:"title",get:function(){return this._props.Title}},{key:"version",get:function(){return this._props.Version}},{key:"autoStart",get:function(){return this._props.AutoStart}},{key:"isShell",get:function(){return this._props.IsShell}},{key:"caption",get:function(){return this._props.Caption}},{key:"hidden",get:function(){return this._props.IsHidden}},{key:"container",get:function(){return this._props.ApplicationName}},{key:"activityType",get:function(){return this._props.ActivityType}},{key:"activityWindowType",get:function(){return this._props.ActivityWindowType}},{key:"windowSettings",get:function(){return this._props.Arguments?Ar(this._props.Arguments):{}}},{key:"allowMultiple",get:function(){return this._props.AllowMultiple}},{key:"available",get:function(){return this._props.IsReady||!0}},{key:"icon",get:function(){return this._props.Icon}},{key:"iconURL",get:function(){return this._props.IconUrl}},{key:"sortOrder",get:function(){return this._props.SortOrder}},{key:"userProperties",get:function(){return this._props.UserProperties?Ar(this._props.UserProperties):{}}},{key:"keywords",get:function(){return this._props.Keywords?this._props.Keywords:[]}},{key:"isActivity",get:function(){return void 0!==this._props.ActivityType&&""!==this._props.ActivityType}},{key:"configuration",get:function(){return{autoStart:this._props.AutoStart,caption:this._props.Caption,hidden:this._props.IsHidden,container:this._props.ApplicationName,activityType:this._props.ActivityType,allowMultiple:this._props.AllowMultiple}}},{key:"instances",get:function(){var e=this;return this._appManager.instances().filter((function(t){return t.application.name===e._name}))}},{key:"type",get:function(){return this._props.Type}},{key:"mode",get:function(){if(!this._props)return"unknown";if(this._props.Mode&&"string"===typeof this._props.Mode)return this._props.Mode.toLowerCase();if(this.isActivity)return"unknown";if(this._props.Arguments&&this._props.Arguments.mode&&"string"===typeof this._props.Arguments.mode)return this._props.Arguments.mode.toLowerCase();var e=this._props.WindowStyleAttributes;if(e){var t='mode:"',n=(e=e.split(" ").join("")).indexOf(t);if(-1!==n){var r=n+t.length,i=e.indexOf('"',r),o=e.substr(r,i-r);if(o&&"string"===typeof o)return o.toLowerCase()}}return"flat"}},{key:"updateFromProps",value:function(e){var t=this;this._props||(this._props={Name:e.Name}),Object.keys(e).forEach((function(n){t._props[n]=e[n]}))}},{key:"start",value:function(e,t){var n=this;return new Promise(function(){var r=s(a().mark((function r(i,o){var s,u,c,l,d,p,f,h;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=n._name,c=6e4,!nn(e)){r.next=6;break}e={},r.next=8;break;case 6:if("object"===typeof e){r.next=8;break}return r.abrupt("return",o(new Error('Invalid "context" parameter - must be an object.')));case 8:if(!nn(t)){r.next=12;break}t={},r.next=14;break;case 12:if("object"===typeof t){r.next=14;break}return r.abrupt("return",o(new Error('Invalid "options" parameter - must be an object.')));case 14:return l=null===(s=t.waitForAGMReady)||void 0===s||s,d=function(e){var t,r=setTimeout((function(){t&&t(),o("timed out while waiting for instance id ".concat(e," for app ").concat(n.name))}),c),a=function(n){n.id===e&&(t&&(t(),t=void 0),clearTimeout(r),i(n))};t=l?n._appManager.onInstanceAgmServerReady(a):n._appManager.onInstanceStarted(a)},r.next=18,n._agm.invoke(br,{Name:u,Context:e,Options:t},"best",{methodResponseTimeoutMs:c});case 18:p=r.sent,"undefined"!==typeof(f=p.returned).timeout&&(c=1e3*f.timeout),"undefined"!==typeof f.waitForInterop&&"undefined"===typeof t.waitForAGMReady&&(l=f.waitForInterop),f&&f.Id?"startOnly"===n._appManager.mode?(h=n._appManager.handleInstanceStarted({ActivityId:void 0,IsActivityOwner:void 0,Context:void 0,Title:void 0,AgmServers:void 0,Id:f.Id,Name:f.Name}),i(h)):d(f.Id):i(void 0);case 23:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"onInstanceStarted",value:function(e){return this._registry.add("instanceStarted",e)}},{key:"onInstanceStopped",value:function(e){return this._registry.add("instanceStopped",e)}},{key:"onAvailable",value:function(e){var t=this;return this._props.IsReady&&setTimeout((function(){t._registry.execute("appAvailable",t)}),0),this._registry.add("appAvailable",e)}},{key:"onUnavailable",value:function(e){var t=this;return!1===this._props.IsReady&&setTimeout((function(){t._registry.execute("appUnavailable",t)}),0),this._registry.add("appUnavailable",e)}},{key:"onChanged",value:function(e){this._registry.add("appChanged",e)}},{key:"onRemoved",value:function(e){this._registry.add("appRemoved",e)}}]),e}(),Pr=function(){function e(t,n,r,i,o,a,s){var u=this;v(this,e),this._id=t,this._appName=n,this._appManager=r,this._agm=i,this._activities=o,this._windows=a,this._registry=Cr(),s||(this._unsubscribeInstanceStopped=this._appManager.onInstanceStopped((function(e){e.id===u._id&&u._registry.execute("stopped",e)})),this._unsubscribeInstanceAgmServerReady=this._appManager.onInstanceAgmServerReady((function(e){e.id===u._id&&u._registry.execute("agmReady",e)})))}return g(e,[{key:"id",get:function(){return this._id}},{key:"application",get:function(){return this._appManager.application(this._appName)}},{key:"activity",get:function(){var e=this;if(!this._activities)throw new Error("This method requires glue.activities library to be enabled.");return this._activities.all.instances.get().filter((function(t){return t.id===e._activityId}))[0]}},{key:"isActivityOwner",get:function(){return this._isActivityOwner}},{key:"activityInstances",get:function(){var e=this;return this._appManager.instances().filter((function(t){return"activity"!==t.application.type&&t.activityId&&t.activityId===e._activityId}))}},{key:"activityOwnerInstance",get:function(){if(this._activityId)return this.activityInstances.filter((function(e){var t;return null===(t=e)||void 0===t?void 0:t.isActivityOwner}))[0]}},{key:"window",get:function(){var e=this;if(!this._windows)throw new Error("This method requires glue.windows library to be enabled.");var t=this._windows.list().filter((function(t){return t.id===e._id}))[0];return!t&&this._activities&&this.activity&&this.activityOwnerInstance&&(t=this.activityOwnerInstance.window),t}},{key:"context",get:function(){var e,t,n;return null!==(n=null!==(e=this._startUpContext)&&void 0!==e?e:null===(t=this.window)||void 0===t?void 0:t.context)&&void 0!==n?n:{}}},{key:"title",get:function(){return this._title}},{key:"isActivityInstance",get:function(){return this._isActivityInstance}},{key:"activityId",get:function(){return this._activityId}},{key:"inActivity",get:function(){return this._inActivity}},{key:"isSingleWindowApp",get:function(){return!this._inActivity}},{key:"agm",get:function(){return this._agmInstance}},{key:"onAgmReady",value:function(e){var t=this;return this._agmInstance&&setTimeout((function(){t._registry.execute("agmReady",t)}),0),this._registry.add("agmReady",e)}},{key:"onStopped",value:function(e){return this._registry.add("stopped",e)}},{key:"getWindow",value:function(){var e=this;return new Promise((function(t,n){var r=e.window;if(r)t(r);else var i=function(e,r){e&&n(e),r&&t(r),setTimeout((function(){clearTimeout(o),a()}),0)},o=setTimeout((function(){i(new Error("can not find a window with id ".concat(e._id)))}),3e4),a=e._windows.onWindowAdded((function(t){t.id===e._id&&i(void 0,t)}))}))}},{key:"updateFromProps",value:function(e){this._startUpContext=e.Context,this._title=e.Title,this._isActivityInstance=!1,e.ActivityId&&""!==e.ActivityId&&(this._activityId=e.ActivityId,this._isActivityInstance=!0),this._isActivityOwner=e.IsActivityOwner,!this._activityId&&this._startUpContext&&this._startUpContext.activityId&&(this._activityId=this._startUpContext.activityId),this._inActivity=Boolean(this._activityId),this.updateAgmInstanceFromProps(e)}},{key:"updateAgmInstanceFromProps",value:function(e){if(e.AgmServers){var t=e.AgmServers;t&&t.length>0&&!nn(t[0])&&(this._agmInstance=t[0])}}},{key:"stop",value:function(){var e=this;return new Promise((function(t,n){var r=e._appManager.onInstanceStopped((function(n){n.id===e._id&&(r(),t())}));e._agm.invoke(kr,{Name:e._appName,Id:e._id}).then((function(){"startOnly"===e._appManager.mode&&(e._appManager.handleInstanceStopped({Name:e._appName,Id:e.id,Context:void 0,Title:void 0,ActivityId:void 0,IsActivityOwner:void 0,AgmServers:void 0}),t())})).catch((function(e){return n(e)}))}))}},{key:"activate",value:function(){return this._agm.invoke(xr,{Name:this._appName,Id:this._id})}},{key:"done",value:function(){this._registry.clear(),this._unsubscribeInstanceAgmServerReady(),this._unsubscribeInstanceStopped()}},{key:"getContext",value:function(){return Promise.resolve(this.context)}}]),e}(),Mr=function(){function e(t,n,r,i,o,a){var s=this;v(this,e),this.mode=t,this._agm=n,this._activities=r,this._windows=i,this._logger=o,this._gdMajorVersion=a,this._apps={},this._instances=[],this._registry=Cr(),this.application=function(e){if("string"!==typeof e)throw new Error('"name" must be string');return s._apps[e]},this.applications=function(){return Object.keys(s._apps).map((function(e){return s._apps[e]}))},this.instances=function(){return s._instances},this.getMyInstance=function(){var e="undefined"!==typeof window&&window.glue42gd;if(!e){var t=s._agm.instance.instance;return s._instances.find((function(e){return e.id===t}))}if(s._gdMajorVersion>=3){var n=e.appInstanceId;return s._instances.find((function(e){return e.id===n}))}},this.handleAppAdded=function(e){var t=s._getAppId(e);s._logger.trace("adding app ".concat(t)),s._apps[t]=new Er(s,t,s._agm);var n=s._updateAppFromProps(e);s._registry.execute("appAdded",n),s._registry.execute("appAvailable",n)},this.handleAppUpdated=function(e){var t=s._updateAppFromProps(e);s._registry.execute("appChanged",t)},this.handleAppRemoved=function(e){var t=s._getAppId(e);s._logger.trace("removing app ".concat(t));var n=s.application(t);s._instances=s._instances.filter((function(e){return e.application.name!==n.name})),delete s._apps[t],s._registry.execute("appRemoved",n)},this.handleAppReady=function(e){var t=s._getAppId(e),n=s._getAppOrThrow(t);n.updateFromProps(e),n.available?s._registry.execute("appAvailable",n):s._registry.execute("appUnavailable",n)},this.handleInstanceStarted=function(e){s._logger.trace("started app ".concat(e.Name," ").concat(e.Id));var t=s._getInstanceId(e),n=s._getInstanceAppName(e),r=new Pr(t,n,s,s._agm,s._activities,s._windows);return s._updateInstanceFromProps(r,e),s._instances.push(r),s._registry.execute("instanceStarted",r),r},this.handleInstanceStopped=function(e){s._logger.trace("failed to start app ".concat(e.Name," ").concat(e.Id));var t=s._getInstanceId(e),n=s._getInstanceAppName(e),r=s._getInstanceOrThrow(t,n);s._instances=s._instances.filter((function(e){return!s._matchInstance(e,t,n)})),s._registry.execute("instanceStopped",r),r.done()},this.handleInstanceAgmServerReady=function(e){var t=s._getInstanceId(e),n=s._getInstanceAppName(e),r=s._getInstanceOrThrow(t,n);r.updateAgmInstanceFromProps(e),s._registry.execute("instanceAgmServerReady",r)},this.handleInstanceStartFailed=function(e){var t=s._getInstanceId(e),n=s._getInstanceAppName(e),r=new Pr(t,n,void 0,void 0,void 0,void 0,!0);s._updateInstanceFromProps(r,e),s._registry.execute("instanceStartFailed",r)},this.handleInstanceUpdated=function(e){var t=s._getInstanceId(e),n=s._getInstanceAppName(e),r=s._getInstanceOrThrow(t,n);s._updateInstanceFromProps(r,e)},this.onInstanceStarted=function(e){return s._registry.add("instanceStarted",e,s._instances)},this.onInstanceStartFailed=function(e){return s._registry.add("instanceStartFailed",e)},this.onInstanceStopped=function(e){return s._registry.add("instanceStopped",e)},this.onInstanceUpdated=function(e){return s._registry.add("instanceChanged",e)},this.onInstanceAgmServerReady=function(e){return s._registry.add("instanceAgmServerReady",e)},this.onAppAdded=function(e){return s._registry.add("appAdded",e,Object.values(s._apps))},this.onAppRemoved=function(e){return s._registry.add("appRemoved",e)},this.onAppAvailable=function(e){return s._registry.add("appAvailable",e)},this.onAppUnavailable=function(e){return s._registry.add("appUnavailable",e)},this.onAppChanged=function(e){return s._registry.add("appChanged",e)}}return g(e,[{key:"_getAppOrThrow",value:function(e){var t=this.application(e);if(!t)throw Error("app with id ".concat(e," not found"));return t}},{key:"_getAppId",value:function(e){return e.Name}},{key:"_matchInstance",value:function(e,t,n){return e.id===t&&e.application.name===n}},{key:"_getInstanceByIdAndName",value:function(e,t){var n=this;return this._instances.filter((function(r){return n._matchInstance(r,e,t)}))[0]}},{key:"_getInstanceOrThrow",value:function(e,t){var n=this._getInstanceByIdAndName(e,t);if(!n)throw Error("instance with id ".concat(e," not found"));return n}},{key:"_getInstanceId",value:function(e){return e.Id}},{key:"_getInstanceAppName",value:function(e){return e.Name}},{key:"_updateAppFromProps",value:function(e){var t=this._getAppId(e);this._logger.trace("updating app with  + ".concat(t,", ").concat(e));var n=this._getAppOrThrow(t);return n.updateFromProps(e),n}},{key:"_updateInstanceFromProps",value:function(e,t){this._logger.trace("updating instance with "+this._getInstanceId(t)+" for app "+this._getInstanceAppName(t)),e.updateFromProps(t)}}]),e}();function Rr(e,t,n){var r=function(e){return!!(e&&e.constructor&&e.call&&e.apply)};return r(t)||r(n)?(r(t)?r(n)||(n=function(){}):t=function(){},e.then(t,n)):e}var Or=function(){function e(t){var n=this;v(this,e),this._agm=t,this._registry=Cr(),this._isMethodRegistered=!1,this.handleBranchModified=function(e){n._registry.execute("branchChanged",e)},this.handleBranchesModified=function(e){n._registry.execute("branchesChanged",e)},this.getRegion=function(e,t){return Rr(n._agmInvoke(pr,(function(e){return e.returned.Region})),e,t)},this.getBranches=function(e,t){return Rr(n._agmInvoke(vr,(function(e){var t=e.returned.Branches;return Object.keys(t).map((function(e){return t[e]}))})),e,t)},this.getCurrentBranch=function(e,t){return Rr(n._agmInvoke(gr,(function(e){return e.returned.Branch}),void 0),e,t)},this.setRegion=function(e,t,r){return Rr(n._agmInvoke(fr,(function(e){return e.returned.ResultMessage}),{Region:e}),t,r)},this.setCurrentBranch=function(e,t,r){return Rr(n._agmInvoke(yr,(function(e){return e.returned.ResultMessage}),{Branch:e}),t,r)},this.currentUser=function(e,t){return Rr(n._agmInvoke(hr),e,t)},this.getFunctionalEntitlement=function(e,t,r){return Rr(n._agmInvoke(mr,(function(e){return e.returned.Entitlement}),{Function:e}),t,r)},this.getFunctionalEntitlementBranch=function(e,t,r,i){return Rr(n._agmInvoke(mr,(function(e){return e.returned.Entitlement}),{Function:e,Branch:t}),r,i)},this.canI=function(e,t,r){return Rr(n._agmInvoke(wr,(function(e){return e.returned.Result}),{Function:e}),t,r)},this.canIBranch=function(e,t,r,i){return Rr(n._agmInvoke(wr,(function(e){return e.returned.Result}),{Function:e,Branch:t}),r,i)},this.onBranchesChanged=function(e){return n._registry.add("branchesChanged",e)},this.onBranchChanged=function(e){return n._registry.add("branchChanged",e)},this.exit=function(e){return n._agmInvoke(cr,null,e)},this.onShuttingDown=function(e){return n.registerMethod(),n._registry.add("onShuttingDown",e)},this.restart=function(e){return n._agmInvoke(dr,null,e)},this._agmInvoke=function(e,t,r){return r=r||{},new Promise((function(i,o){var a=function(e){return o(e)};n._agm.invoke(e,r).then((function(e){t||(t=function(e){return e.returned}),i(t(e))})).catch(a)}))}}return g(e,[{key:"registerMethod",value:function(){var e=this;this._isMethodRegistered||(this._agm.register(lr,function(){var t=s(a().mark((function t(n){var r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all(e._registry.execute("onShuttingDown",n));case 3:return r=t.sent,i=r.some((function(e){return e.prevent})),t.abrupt("return",{prevent:i});case 8:t.prev=8,t.t0=t.catch(0);case 10:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}()),this._isMethodRegistered=!0)}}]),e}();function jr(e,t){return new Promise((function(n,r){e.invoke(Sr,{skipIcon:!0}).then((function(e){var r=e.returned;r||n();var i=r.applications;i||n(),Tr(i).map((function(e){return t.handleAppAdded(e)})),n()})).catch((function(e){return r("Error getting application snapshot: ".concat(e.message))}))}))}var Nr="OnBranchChanged",Lr="OnBranchesModified",Dr="OnApplicationAdded",Wr="OnApplicationRemoved",Fr="OnApplicationChanged",qr="OnApplicationReady",Ur="OnApplicationStarted",zr="OnApplicationAgmServerReady",Gr="OnApplicationUpdated",Br="OnApplicationStopped",Hr="OnApplicationStartFailed";function Vr(e,t,n,r){var i,o=!1;return{start:function(){var a,s,u=new Promise((function(e,t){a=e,s=t}));return e.subscribe(_r,{arguments:{skipIcon:r},waitTimeoutMs:1e4}).then((function(r){(i=r).onData((function(r){var i=r.data,s=Tr(i[Dr]);s.map((function(e){return t.handleAppAdded(e)})),Tr(i[Fr]).map((function(e){return t.handleAppUpdated(e)})),Tr(i[Wr]).map((function(e){return t.handleAppRemoved(e)})),Tr(i[qr]).map((function(e){return t.handleAppReady(e)}));var u=Tr(i[Ur]);if(u.map((function(e){return t.handleInstanceStarted(e)})),Tr(i[Hr]).map((function(e){return t.handleInstanceStartFailed(e)})),Tr(i[Br]).map((function(e){return t.handleInstanceStopped(e)})),Tr(i[Gr]).map((function(e){return t.handleInstanceUpdated(e)})),Tr(i[zr]).map((function(e){return t.handleInstanceAgmServerReady(e)})),Tr(i[Nr]).map((function(e){return n.handleBranchModified(e)})),Tr(i[Lr]).map((function(e){return n.handleBranchesModified(e)})),!o){o=!0;var c=s.some((function(t){return t.Name===e.instance.application})),l=u.some((function(t){return t.Id===e.instance.instance}));if(c)if(l)a();else var d=t.onInstanceStarted((function(t){t.id===e.instance.instance&&(d(),a())}));else a()}})),i.onFailed((function(e){return s(e)}))})).catch((function(e){var t;return s("Error subscribing for ".concat(_r," stream. Err: ").concat(null!==(t=e.message)&&void 0!==t?t:e))})),u},stop:function(){i&&i.close()}}}var Jr="T42.ACS.InMemoryStoreCommand",Kr=function(){function e(t){v(this,e),this.interop=t}return g(e,[{key:"import",value:function(e,t){if(!e||!Array.isArray(e))return Promise.reject("invalid apps argument - should be an array of application definitions");if(t&&"replace"!==t&&"merge"!==t)return Promise.reject("invalid mode argument - should be 'replace' or 'merge'");var n={command:"import",args:{apps:e,mode:t=null!==t&&void 0!==t?t:"replace"}};return this.interop.invoke(Jr,n).then((function(e){return e.returned}))}},{key:"export",value:function(){return this.interop.invoke(Jr,{command:"export"}).then((function(e){return e.returned.apps}))}},{key:"remove",value:function(e){if(!e||"string"!==typeof e)return Promise.reject("invalid app name, should be a string value");var t={command:"remove",args:{apps:[e]}};return this.interop.invoke(Jr,t).then((function(e){return e.returned}))}},{key:"clear",value:function(){var e={command:"clear"};return this.interop.invoke(Jr,e).then((function(e){return e.returned}))}},{key:"createAppDef",value:function(e,t){return t||(t="https://google.com"),{name:e,type:"window",title:e,details:{url:t}}}}]),e}(),Qr=function(e){if(!e)throw Error("config not set");if(!e.agm)throw Error("config.agm is missing");var t="startOnly",n="skipIcons",r="full",i=e.mode||t;if(i!==t&&i!==n&&i!==r)throw new Error("Invalid mode for appManager lib - ".concat(i," is not supported"));var o,a=e.activities,s=e.agm,u=e.logger,c=e.windows,l=new Mr(i,s,a,c,u.subLogger("applications"),e.gdMajorVersion),d=new Or(s);if(i===t)o=jr(s,l);else{var p=Vr(s,l,d,i===n);o=p.start()}return{ready:function(){return o},applications:l.applications,application:l.application,onAppAdded:l.onAppAdded,onAppRemoved:l.onAppRemoved,onAppChanged:l.onAppChanged,onAppAvailable:l.onAppAvailable,onAppUnavailable:l.onAppUnavailable,instances:l.instances,get myInstance(){return l.getMyInstance()},onInstanceStarted:l.onInstanceStarted,onInstanceStopped:l.onInstanceStopped,onInstanceUpdated:l.onInstanceUpdated,onInstanceStartFailed:l.onInstanceStartFailed,getRegion:d.getRegion,getBranches:d.getBranches,getCurrentBranch:d.getCurrentBranch,getFunctionalEntitlement:d.getFunctionalEntitlement,getFunctionalEntitlementBranch:d.getFunctionalEntitlementBranch,setCurrentBranch:d.setCurrentBranch,setRegion:d.setRegion,currentUser:d.currentUser,canI:d.canI,canIBranch:d.canIBranch,onBranchesChanged:d.onBranchesChanged,exit:d.exit,restart:d.restart,onShuttingDown:d.onShuttingDown,inMemory:new Kr(s)}};function $r(e,t){return e(t={exports:{}},t.exports),t.exports}var Yr=1;function Xr(){return(Yr=(9301*Yr+49297)%233280)/233280}function Zr(e){Yr=e}var ei,ti,ni,ri={nextValue:Xr,seed:Zr},ii="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function oi(){ni=!1}function ai(e){if(e){if(e!==ei){if(e.length!==ii.length)throw new Error("Custom alphabet for shortid must be "+ii.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+ii.length+" unique characters. These characters were not unique: "+t.join(", "));ei=e,oi()}}else ei!==ii&&(ei=ii,oi())}function si(e){return ai(e),ei}function ui(e){ri.seed(e),ti!==e&&(oi(),ti=e)}function ci(){ei||ai(ii);for(var e,t=ei.split(""),n=[],r=ri.nextValue();t.length>0;)r=ri.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function li(){return ni||(ni=ci())}function di(e){return li()[e]}var pi={characters:si,seed:ui,lookup:di,shuffled:li},fi="object"===typeof window&&(window.crypto||window.msCrypto);function hi(){if(!fi||!fi.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return fi.getRandomValues(e),48&e[0]}var vi=hi;function gi(e,t){for(var n,r=0,i="";!n;)i+=e(t>>4*r&15|vi()),n=t<Math.pow(16,r+1),r++;return i}var yi=gi;function mi(e){var t=pi.shuffled();return{version:15&t.indexOf(e.substr(0,1)),worker:15&t.indexOf(e.substr(1,1))}}var wi,bi,ki=mi,xi=1459707606518,_i=6;function Si(e){var t="",n=Math.floor(.001*(Date.now()-xi));return n===bi?wi++:(wi=0,bi=n),t+=yi(pi.lookup,_i),t+=yi(pi.lookup,e),wi>0&&(t+=yi(pi.lookup,wi)),t+=yi(pi.lookup,n)}var Ii=Si;function Ci(e){if(!e||"string"!==typeof e||e.length<6)return!1;for(var t=pi.characters(),n=e.length,r=0;r<n;r++)if(-1===t.indexOf(e[r]))return!1;return!0}var Ti=Ci,Ai=$r((function(e){var t=0;function n(t){return pi.seed(t),e.exports}function r(n){return t=n,e.exports}function i(e){return void 0!==e&&pi.characters(e),pi.shuffled()}function o(){return Ii(t)}e.exports=o,e.exports.generate=o,e.exports.seed=n,e.exports.worker=r,e.exports.characters=i,e.exports.decode=ki,e.exports.isValid=Ti}));Ai.generate,Ai.seed,Ai.worker,Ai.characters,Ai.decode,Ai.isValid;var Ei=Ai,Pi="T42.JumpList.Action",Mi=function(){function e(){v(this,e),this._groupActionCallbacks=new Map,this._registered=!1}return g(e,[{key:"init",value:function(e,t,n){this._executor=e,this._agm=t,this._logger=n,this.registerCallbackMethod()}},{key:"setEnabled",value:function(e,t){var n={enabled:t};return this._executor.updateJumpList(e,n)}},{key:"createCategory",value:function(e,t,n){this.validateActions(t,n);var r={category:{title:t,operation:"create",actions:this.toUpdateActions(e,"create",t,n)}};return this._executor.updateJumpList(e,r)}},{key:"removeCategory",value:function(e,t){var n={category:{title:t,operation:"remove",actions:[]}};return this.manageActionCallback(e,n.category.operation,t),this._executor.updateJumpList(e,n)}},{key:"createActions",value:function(e,t,n){this.validateActions(t,n);var r={category:{title:t,operation:"update",actions:this.toUpdateActions(e,"create",t,n)}};return this._executor.updateJumpList(e,r)}},{key:"removeActions",value:function(e,t,n){var r={category:{title:t,operation:"update",actions:this.toUpdateActions(e,"remove",t,n)}};return this._executor.updateJumpList(e,r)}},{key:"getActions",value:function(){var e=s(a().mark((function e(t,n){var r,i,o,s=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],e.next=3,this.getJumpListSettings(t);case 3:return i=e.sent,(o=i.categories.find((function(e){return e.title===n})))&&o.actions.forEach((function(e){var t=s.getActionCallback(e.callbackId);t&&(e.callback=t.callback),r.push({icon:e.icon,callback:e.callback,singleInstanceTitle:e.singleInstanceTitle,multiInstanceTitle:e.multiInstanceTitle})})),e.abrupt("return",Promise.resolve(r));case 7:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getJumpListSettings",value:function(e){return this._executor.getJumpList(e)}},{key:"toUpdateActions",value:function(e,t,n,r){var i=this;return r.map((function(r){var o={icon:r.icon,callback:r.callback,callbackId:Ei.generate(),singleInstanceTitle:r.singleInstanceTitle,multiInstanceTitle:r.multiInstanceTitle,operation:t};return i.manageActionCallback(e,t,n,o),o}))}},{key:"manageActionCallback",value:function(e,t,n,r){var i,o="".concat(n,"-").concat(e);if("create"===t)this._groupActionCallbacks.has(o)||this._groupActionCallbacks.set(o,[]),this._groupActionCallbacks.get(o).push({callbackId:r.callbackId,callback:r.callback});else if("remove"===t)if(r){var a=null!==(i=this._groupActionCallbacks.get(o))&&void 0!==i?i:[];0===(a=a.filter((function(e){return e.callbackId!==r.callbackId}))).length?this._groupActionCallbacks.delete(o):this._groupActionCallbacks.set(o,a)}else this._groupActionCallbacks.delete(o)}},{key:"registerCallbackMethod",value:function(){var e=this;if(!this._registered){this._registered=!0;try{this._agm.register(Pi,(function(t,n){var r=e.getActionCallback(t.callbackId);if(r)try{r.callback()}catch(i){e._logger.error("Unable to execute user callback for jump list action!",i)}}))}catch(t){return this._logger.error("Unable to register method ".concat(Pi," for invoking jump list action callbacks!"),t),Promise.reject(t)}}}},{key:"getActionCallback",value:function(e){var t;return o(this._groupActionCallbacks.values()).forEach((function(n){var r=n.find((function(t){return t.callbackId===e}));r&&(t=r)})),t}},{key:"validateActions",value:function(e,t){if(!(t&&t.length>0))throw new Error("Category '".concat(e,"' doesn't contain any actions!"));t.forEach((function(t){if(!t.singleInstanceTitle)throw new Error("Category '".concat(e,"' contains an action with undefined singleInstanceTitle!"));if(!t.multiInstanceTitle)throw new Error("Category '".concat(e,"' contains an action with undefined multiInstanceTitle!"));if(!t.callback)throw new Error("Category '".concat(e,"' contains an action with undefined callback function!"))}))}}]),e}(),Ri=new Mi,Oi=function(){function e(){v(this,e),this.waitForTimeoutInMilliseconds=6e4,this._windows={},this._pendingWindows={},this._pendingWindowsStates={},this._registry=Cr()}return g(e,[{key:"init",value:function(e){this._logger=e}},{key:"get",value:function(e){return this._windows[e]||this._pendingWindows[e]}},{key:"getIfReady",value:function(e){return this._windows[e]}},{key:"list",get:function(){return this._windows}},{key:"add",value:function(e){if(this._pendingWindows[e.API.id])this._logger.error("trying to add window with id ".concat(e.API.id," from windowStore, which already exists"));else{var t="remote"===e.API.windowType;this._pendingWindows[e.API.id]=e,this._pendingWindowsStates[e.API.id]={ready:!1,urlChanged:t},this._registry.execute("on-added",e)}}},{key:"remove",value:function(e){delete this._windows[e.API.id],delete this._pendingWindows[e.API.id],delete this._pendingWindowsStates[e.API.id],this._registry.execute("on-removed",e)}},{key:"setReadyState",value:function(e){var t=this._pendingWindowsStates[e];"undefined"!==typeof t&&(t.ready=!0,t.urlChanged&&this.markReadyToShow(e))}},{key:"setUrlChangedState",value:function(e){var t=this._pendingWindowsStates[e];"undefined"!==typeof t&&(t.urlChanged=!0,t.ready&&this.markReadyToShow(e))}},{key:"waitFor",value:function(e){var t=this;return new Promise((function(n,r){var i,o=setTimeout((function(){i(),r("waitFor timed out.")}),t.waitForTimeoutInMilliseconds),a=t._windows[e];a?(clearTimeout(o),n(a)):i=t.onReadyWindow((function(t){t.API.id===e&&(clearTimeout(o),i(),n(t))}))}))}},{key:"onReadyWindow",value:function(e){return this._registry.add("on-ready",e)}},{key:"onAdded",value:function(e){return this._registry.add("on-added",e)}},{key:"onRemoved",value:function(e){return this._registry.add("on-removed",e)}},{key:"markReadyToShow",value:function(e){this._pendingWindows[e]&&(this._windows[e]=this._pendingWindows[e],delete this._pendingWindows[e],delete this._pendingWindowsStates[e]),this._registry.execute("on-ready",this._windows[e])}}]),e}(),ji=new Oi,Ni=function(){function e(){v(this,e)}return g(e,null,[{key:"getGDMajorVersion",value:function(){if("undefined"===typeof window)return-1;if(!window.glueDesktop)return-1;if(!window.glueDesktop.version)return-1;var e=Number(window.glueDesktop.version.substr(0,1));return isNaN(e)?-1:e}},{key:"callbackifyPromise",value:function(e,t,n){var r=function(e){var t=e;if(e instanceof Error&&(t=e.message),"function"!==typeof n)return Promise.reject(t);n(t)};try{return e().then((function(e){return"function"===typeof t&&t(e),e})).catch((function(e){return r(e)}))}catch(i){return r(i)}}},{key:"getMonitor",value:function(e,t){var n=this;return t.map((function(t){var r=t.left,i=t.top,o=t.workingAreaWidth,a=t.workingAreaHeight;return{monitor:t,totalOverlap:n.calculateTotalOverlap({left:r,top:i,width:o,height:a},e)}})).sort((function(e,t){return t.totalOverlap-e.totalOverlap}))[0].monitor}},{key:"getDisplayCenterOfScreen",value:function(e,t,n){var r=e.width/t.scaleFactor,i=e.height/t.scaleFactor,o=t.workArea.left/n.scaleFactor,a=t.workArea.top/n.scaleFactor,s=t.workArea.width/t.scaleFactor,u=t.workArea.height/t.scaleFactor,c=Math.max((s-r)/2,0),l=Math.max((u-i)/2,0),d=Math.floor(o+c),p=Math.floor(a+l);return{left:d*n.scaleFactor,top:p*n.scaleFactor,width:e.width,height:e.height}}},{key:"isNode",value:function(){if("undefined"!==typeof e._isNode)return e._isNode;if("undefined"!==typeof window)return e._isNode=!1,!1;try{e._isNode="[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){e._isNode=!1}return e._isNode}},{key:"calculateTotalOverlap",value:function(e,t){var n=e.left,r=e.top,i=n+e.width,o=r+e.height,a=t.left,s=t.top,u=a+t.width,c=s+t.height;return Math.max(0,Math.min(i,u)-Math.max(n,a))*Math.max(0,Math.min(o,c)-Math.max(r,s))}}]),e}(),Li=function(){function e(t,n){v(this,e),this.windowId=t,this._categoryTitle=n.title}return g(e,[{key:"list",value:function(){return Ri.getActions(this.windowId,this._categoryTitle)}},{key:"create",value:function(e){return Ri.createActions(this.windowId,this._categoryTitle,e)}},{key:"remove",value:function(e){return Ri.removeActions(this.windowId,this._categoryTitle,e)}}]),e}(),Di=function(){function e(t){v(this,e),this.windowId=t}return g(e,[{key:"list",value:function(){return this.getCategories()}},{key:"create",value:function(e,t){return Ri.createCategory(this.windowId,e,t)}},{key:"remove",value:function(e){return Ri.removeCategory(this.windowId,e)}},{key:"find",value:function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCategories();case 2:return n=e.sent,e.abrupt("return",n.find((function(e){return e.title===t})));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getCategories",value:function(){var e=s(a().mark((function e(){var t,n=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,Ri.getJumpListSettings(this.windowId);case 3:return e.sent.categories.forEach((function(e){t.push({title:e.title,actions:new Li(n.windowId,e)})})),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),Wi=function(){function e(t){v(this,e),this.windowId=t,this._categories=new Di(t)}return g(e,[{key:"categories",get:function(){return this._categories}},{key:"isEnabled",value:function(){var e=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ri.getJumpListSettings(this.windowId);case 2:return t=e.sent,e.abrupt("return",t.enabled);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setEnabled",value:function(e){return Ri.setEnabled(this.windowId,e)}}]),e}(),Fi=function(e,t,n,r,i,o,u,c){var l,d,p,f,h,v,g=Cr(),y=r.subLogger("window ".concat(e)),m=function(){var e=u();if(!e)throw new Error("To use this method you need to enable channels API - set the channels property to true when initializing the Glue42 library");return e},w=e,b=t.name,k=t.mode,x=t.bounds,_=t.url,S=t.title,I=null!==(l=t.context)&&void 0!==l?l:{},C=t.frameColor,T=t.focus,A=null!==(d=t.neighbours)&&void 0!==d?d:{},E=t.groupId,P=t.isGroupHeaderVisible,M=t.isTabHeaderVisible,R=null!==(p=t.isTabSelected)&&void 0!==p&&p,O=t.settings,j=t.applicationName,N=t.isVisible,L=t.isSticky,D=t.isCollapsed,W=t.state,F=t.tabGroupId,q=t.tabIndex,U=t.frameId,z=t.isLocked,G=null!==(f=t.frameButtons)&&void 0!==f?f:[],B=t.zoomFactor,H=t.placementSettings,V=new Wi(e);function J(t,r){return Ni.callbackifyPromise((function(){if(!e)throw new Error("The window is already closed.");return n.close(h)}),t,r)}function K(e,t,r){if("function"===typeof t)return Ni.callbackifyPromise((function(){if(rn(e))throw new Error("The new URL must be a non-empty string.");return n.navigate(h,e)}),t,r);if(rn(e))throw new Error("The new URL must be a non-empty string.");return n.navigate(h,e,t)}function Q(e,t,r){return Ni.callbackifyPromise((function(){if(!e||0===Object.keys(e).length||Object.keys(e).every((function(e){return!e})))throw new Error("Invalid style arguments: "+JSON.stringify(e));if(e&&void 0!==e.focus){if("boolean"!==typeof e.focus)throw new Error("Focus must be a boolean value. Currently, only `focus: true` is supported.");!1===e.focus&&y.warn("`focus: false` is not supported!")}if(e&&void 0!==e.hidden&&"boolean"!==typeof e.hidden)throw new Error("The `hidden` property must hold a boolean value.");for(var t=0,r=["minHeight","maxHeight","minWidth","maxWidth"];t<r.length;t++){var i=r[t],o=e,a=o[i];if(i in e){if(nn(a)){delete o[i];continue}if(!Yt(o[i]))throw new Error('"'.concat(i,'" must be a number'))}}return n.setStyle(h,e)}),t,r)}function $(e,t,r){return Ni.callbackifyPromise((function(){return n.resetButtons(h,e)}),t,r)}function Y(e,t,r){return Ni.callbackifyPromise((function(){if("boolean"!==typeof e)throw new Error("`onTop` must hold a boolean value.");return n.setOnTop(h,e)}),t,r)}function X(e,t,r){return Ni.callbackifyPromise((function(){if(!e||Object.keys(e).every((function(e){return void 0===e})))throw new Error("The properties of `constraints` cannot be null or undefined.");return n.setSizeConstraints(h,e)}),t,r)}function Z(e,t,r){return Ni.callbackifyPromise((function(){if(nn(e))throw new Error("`newTitle` must not be null or undefined.");return e===S?Promise.resolve(h):n.setTitle(h,e)}),t,r)}function ee(e,t,r){return Ni.callbackifyPromise((function(){if("boolean"!==typeof e)throw new Error("`isSticky` must hold a boolean value.");return n.setSticky(h,e)}),t,r)}function te(e,t,r){return Ni.callbackifyPromise((function(){if(nn(e))throw new Error("The properties of `bounds` cannot be null or undefined.");return n.moveResize(h,e)}),t,r)}function ne(e,t,r){return Ni.callbackifyPromise((function(){if("undefined"===typeof e||0===Object.keys(e).length)throw new Error("Button info is not available.");if(rn(e.buttonId))throw new Error("`buttonId` must not be null or undefined.");if(rn(e.imageBase64))throw new Error("`imageBase64` must not be null or undefined.");return n.addFrameButton(h,e)}),t,r)}function re(e,t,r){return Ni.callbackifyPromise((function(){if(rn(e))throw new Error("`buttonId` must not be null or undefined.");return n.removeFrameButton(h,e)}),t,r)}function ie(e,t){return Ni.callbackifyPromise((function(){return T?Promise.resolve(h):n.activate(h)}),e,t)}function oe(e,t){return Ni.callbackifyPromise((function(){return T?Promise.resolve(h):n.focus(h)}),e,t)}function ae(e,t){return Ni.callbackifyPromise((function(){return n.maximizeRestore(h)}),e,t)}function se(e,t){return Ni.callbackifyPromise((function(){return"maximized"===W?Promise.resolve(h):n.maximize(h)}),e,t)}function ue(e,t){return Ni.callbackifyPromise((function(){return"normal"===W?Promise.resolve(h):n.restore(h)}),e,t)}function ce(e,t){return Ni.callbackifyPromise((function(){return"minimized"===W?Promise.resolve(h):n.minimize(h)}),e,t)}function le(e,t){return Ni.callbackifyPromise((function(){return D?Promise.resolve(h):n.collapse(h)}),e,t)}function de(e,t){return Ni.callbackifyPromise((function(){return D?n.expand(h):Promise.resolve(h)}),e,t)}function pe(e,t){return Ni.callbackifyPromise((function(){return n.toggleCollapse(h)}),e,t)}function fe(e,t,r,i){return Ni.callbackifyPromise((function(){if(nn(e))throw new Error("A target window is not specified - ".concat(e));if("string"===typeof e){var r=ji.get(e);if(!r)throw new Error('Invalid "target" parameter or no such window. Invoked with: '.concat(e));e=r.API}return n.snap(h,e,t)}),r,i)}function he(e,t,r,i){return Ni.callbackifyPromise((function(){var r,i,o='Invalid "tab" parameter - must be an object with an "id" property or a string. Invoked for source window with ID:';if(nn(e))throw new Error(o+e);if("string"===typeof e){if(nn(i=null===(r=ji.get(e))||void 0===r?void 0:r.API))throw new Error(o+i)}else{if(nn(e.id))throw new Error(o);i=e}var a={};return nn(t)||("number"===typeof t?a.index=t:(a.selected=t.selected,a.index=t.index)),n.attachTab(h,i,a)}),r,i)}function ve(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;return Ni.callbackifyPromise((function(){var t={};function r(e){return void 0!==e.relativeTo}return r(e)?("string"===typeof e.relativeTo?t.relativeTo=e.relativeTo:nn(e.relativeTo.id)||(t.relativeTo=e.relativeTo.id),nn(e.relativeDirection)||(t.relativeDirection=e.relativeDirection),nn(e.width)||(t.width=e.width),nn(e.height)||(t.height=e.height)):nn(e.bounds)||(t.bounds=e.bounds),nn(e.hideTabHeader)||(t.hideTabHeader=e.hideTabHeader),n.detachTab(h,t)}),t,r)}function ge(e,t,r){return Ni.callbackifyPromise((function(){return n.setVisible(h,e)}),t,r)}function ye(e){return me.apply(this,arguments)}function me(){return(me=s(a().mark((function e(t){var n,r,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o(),e.next=3,n.getPrimary();case 3:return r=e.sent,e.next=6,h.getDisplay();case 6:return i=e.sent,e.abrupt("return",te(Ni.getDisplayCenterOfScreen(h.bounds,t||i,r)));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(e){return n.showLoader(h,e)}function be(){return n.hideLoader(h)}function ke(e,t,r){return Ni.callbackifyPromise((function(){if(nn(e))throw new Error('"context" must not be null or undefined.');return n.updateContext(h,e,!1)}),t,r)}function xe(e,t){return Ni.callbackifyPromise((function(){return n.lock(h)}),e,t)}function _e(e,t){return Ni.callbackifyPromise((function(){return n.unlock(h)}),e,t)}function Se(e,t){return Ni.callbackifyPromise((function(){return n.getIcon(h)}),e,t)}function Ie(e,t,r){return Ni.callbackifyPromise((function(){if(rn(e))throw new Error('"base64Image" must be a non-empty string.');return n.setIcon(h,e)}),t,r)}function Ce(e,t,r){return Ni.callbackifyPromise((function(){if(rn(e))throw new Error('"frameColor" must be a non-empty string');return n.setFrameColor(h,e)}),t,r)}function Te(e,t,r){return Ni.callbackifyPromise((function(){if("boolean"!==typeof e)throw new Error('"toBeTabHeaderVisible" must hold a boolean value.');return n.setTabHeaderVisible(h,e)}),t,r)}function Ae(e){return Ee.apply(this,arguments)}function Ee(){return(Ee=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!rn(t)){e.next=2;break}throw new Error('"'.concat(t,'" must not be null or undefined'));case 2:return e.abrupt("return",n.setTabTooltip(h,t));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pe(e){return n.showPopup(h,e)}function Me(e){return n.createFlydown(h.id,e)}function Re(e){return n.setModalState(h.id,e||!1)}function Oe(e,t){return Ni.callbackifyPromise((function(){return n.zoomIn(h)}),e,t)}function je(e,t){return Ni.callbackifyPromise((function(){return n.zoomOut(h)}),e,t)}function Ne(e,t,r){return Ni.callbackifyPromise((function(){if(isNaN(e))throw new Error("zoomFactor is not a number");return n.setZoomFactor(h,e)}),t,r)}function Le(){return n.showDevTools(h)}function De(e){return n.capture(h,e)}function We(e,t){var r={shouldFlash:!0,mode:"auto"};return"boolean"===typeof e&&(r.shouldFlash=e),"undefined"!==typeof t&&(r.mode=t),n.flash(h,r)}function Fe(e){return n.print(h,e)}function qe(e){return n.printToPDF(h,e)}function Ue(t){return new Promise((function(r,i){var o=vt((function(t,n,i){e===t.id&&(o(),r(h))}));n.ungroup(h,t).catch((function(e){o(),i(e)}))}))}function ze(e){return n.place(h,e)}function Ge(e){return n.refresh(h,e)}function Be(e,t){return n.download(h,e,t)}function He(e){return n.configureWindow(h,e)}function Ve(e){return xt("onTitleChanged",e,[h.title,h])}function Je(t){if(!an(t))throw new Error("callback should be a function");return void 0===e&&t(h),g.add("onClose",t)}function Ke(e){return xt("onUrlChanged",e)}function Qe(e){return xt("onFrameButtonAdded",e)}function $e(e){return xt("onFrameButtonRemoved",e)}function Ye(e){return xt("onFrameButtonClicked",e)}function Xe(e){if(!an(e))throw new Error("callback should be a function");return D&&e(h),g.add("collapsed",e)}function Ze(e){if(!an(e))throw new Error("callback should be a function");return D||e(h),g.add("expanded",e)}function et(e){return"maximized"===W?xt("maximized",e,[h]):xt("maximized",e)}function tt(e){return"minimized"===W?xt("minimized",e,[h]):xt("minimized",e)}function nt(e){return"normal"===W?xt("normal",e,[h]):xt("normal",e)}function rt(e){return xt("attached",e)}function it(e){return xt("detached",e)}function ot(e){return xt("visibility-changed",e)}function at(e){return xt("context-updated",e)}function st(e){return xt("lock-changed",e)}function ut(e){return xt("bounds-changed",e)}function ct(e){return xt("focus-changed",e)}function lt(e){return xt("sticky-changed",e)}function dt(e){return xt("frame-color-changed",e)}function pt(e){return xt("tab-header-visibility-changed",e)}function ft(e){return xt("window-attached",e)}function ht(e){return xt("window-detached",e)}function vt(e){return xt("group-changed",e)}function gt(e){return xt("tab-selection-changed",e)}function yt(t){if(!an(t))throw new Error("callback must be a function");var r=function(e,n){var r=t();r&&r.then?r.then(e).catch(n):e()};return n.onClosing(r,e)}function mt(t){if(!an(t))throw new Error("callback must be a function");var r=function(e,n,r){var i=t(r);i&&i.then?i.then(e).catch(n):e()};return n.onRefreshing(r,e)}function wt(e){return xt("zoom-factor-changed",e)}function bt(e){return xt("placementSettingsChanged",e)}function kt(e){return xt("neighbours-changed",e)}function xt(e,t,n){if(!an(t))throw new Error("callback must be a function");return g.add(e,t,n)}function _t(t){if(!an(t))throw new Error("callback must be a function");var r=function(e,n,r,i){var o=t(i);o&&o.then?o.then(e).catch(n):e()};return n.onNavigating(r,e)}function St(){return n.goBack(h)}function It(){return n.goForward(h)}function Ct(e){_=e.url,S=e.title,I=e.context||{},x=e.bounds,C=e.frameColor,T=e.focus,A=e.neighbours||{},E=e.groupId,P=e.isGroupHeaderVisible,M=e.isTabHeaderVisible,R=e.isTabSelected,O=e.settings,N=e.isVisible,L=e.isSticky,D=e.isCollapsed,W=e.state,F=e.tabGroupId,U=e.frameId,z=e.isLocked,B=e.zoomFactor,H=e.placementSettings}function Tt(e){S=e,n.finished.finally((function(){g.execute("onTitleChanged",e,h)}))}function At(e){_=e,g.execute("onUrlChanged",e,h)}function Et(e){e!==N&&(N=e,g.execute("visibility-changed",h))}function Pt(e){O=e,g.execute("settings-changed",h)}function Mt(e){I=e,g.execute("context-updated",I,h)}function Rt(){void 0!==e&&(g.execute("onClose",h),e=void 0)}function Ot(e){var t=["buttonId","imageBase64","order","tooltip"].reduce((function(t,n){return t[n]=e[n],t}),{});-1===G.map((function(e){return e.buttonId})).indexOf(e.buttonId)&&G.push(t),g.execute("onFrameButtonAdded",t,h)}function jt(e){var t;G=G.reduce((function(n,r){return r.buttonId===e?t=r:n.push(r),n}),[]),void 0!==t&&g.execute("onFrameButtonRemoved",t,h)}function Nt(e){var t=G.filter((function(t){return t.buttonId===e.buttonId}));t.length>0&&g.execute("onFrameButtonClicked",t[0],h)}function Lt(e){return Dt.apply(this,arguments)}function Dt(){return(Dt=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"collapsed"===t?D=!0:"expanded"===t?D=!1:W=t,e.next=3,n.finished;case 3:g.execute(t,h);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wt(e){z=e,g.execute("lock-changed",h)}function Ft(e){x.top===e.top&&x.left===e.left&&x.width===e.width&&x.height===e.height||(x=e,g.execute("bounds-changed",h))}function qt(e){T=e,g.execute("focus-changed",h)}function Ut(e){L=e,g.execute("sticky-changed",e,h)}function zt(e){C=e,g.execute("frame-color-changed",h)}function Gt(e,t,n){F=e,U=t,M=n,g.execute("frame-attached",h)}function Bt(e){A=e.neighbors||{},q=e.index,g.execute("neighbours-changed",A,h)}function Ht(e){P=e}function Vt(e){M!==e&&(M=e,g.execute("tab-header-visibility-changed",h))}function Jt(e,t){return Kt.apply(this,arguments)}function Kt(){return(Kt=s(a().mark((function t(r,i){var o,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r===e?(R=!0,o=h):(R=!1,o=ji.get(r)?ji.get(r).API:void 0),s=ji.get(i)?ji.get(i).API:void 0,t.next=4,n.finished;case 4:g.execute("tab-selection-changed",o,s,h);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Qt(e,t,n,r,i){return $t.apply(this,arguments)}function $t(){return($t=s(a().mark((function e(t,r,i,o,s){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F=t,M=i,U=r,"undefined"!==typeof o&&(z=o),e.next=6,n.finished;case 6:s.forEach((function(e){e.Events.handleWindowAttached(h)})),g.execute("attached",h);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xt(e){g.execute("window-attached",e)}function Zt(e,t){return en.apply(this,arguments)}function en(){return(en=s(a().mark((function e(t,r){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F=void 0,R=!1,"undefined"!==typeof t&&(z=t),e.next=5,n.finished;case 5:r.forEach((function(e){e.Events.handleWindowDetached(h)})),g.execute("detached",h);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tn(e){g.execute("window-detached",e)}function on(e){B=e,g.execute("zoom-factor-changed",h)}function sn(e){var t,n=e;if(n.display){var r=o();if(r){var i=n.display-1;t=new Promise((function(e,t){r.all().then((function(t){var n=t.find((function(e){return e.index===i}));e(n)})).catch(t)}))}else t=Promise.resolve(void 0)}else t=Promise.resolve(void 0);t.then((function(e){n.display=e,H=n,g.execute("placementSettingsChanged",h)}))}function un(e,t){v=e,E=null===e||void 0===e?void 0:e.id,nn(e)||nn(t)||g.execute("group-changed",h,e,t)}function cn(){var e=ji.list;return"tab"!==k.toLowerCase()?[]:Object.keys(e).reduce((function(t,n){var r=e[n];return r&&r.API.tabGroupId&&"undefined"!==typeof r.API.tabGroupId&&"undefined"!==typeof h.tabGroupId&&r.API.tabGroupId===h.tabGroupId&&t.push(r.API),t}),[]).sort((function(e,t){if(e.tabIndex!==t.tabIndex){if(-1===e.tabIndex)return Number.MAX_SAFE_INTEGER;if(-1===t.tabIndex)return Number.MIN_SAFE_INTEGER}return e.tabIndex-t.tabIndex}))}function ln(e){return e.reduce((function(e,t){var n=ji.get(t);return n&&e.push(n.API),e}),[])}function dn(e){var t=A[e];if("undefined"!==typeof t)return ln(t)}function pn(){var t;if(j)return j;if(I._APPLICATION_NAME)return I._APPLICATION_NAME;if(I&&I._t42&&I._t42.application)return I._t42.application;var n=fn();if(n&&n.applicationName)return n.applicationName;var r=i();if(r){var o=r.instances().find((function(t){return e===t.id}));if(o)return null===(t=o.application)||void 0===t?void 0:t.name}}function fn(){if("undefined"!==typeof window&&window.glue42gd&&window.glue42gd.getWindowInfo){var t=window.glue42gd.getWindowInfo(e);return t||void 0}}return h={get id(){return w},get name(){return b},get application(){var e=i(),t=pn();if(t&&e)return e.application(t)},get hostInstance(){return n.hostInstance},get agmInstance(){var e=this;if("undefined"!==typeof window&&window.glue42gd)return c.servers().find((function(t){return t.windowId===e.id}));var t=pn();return t?{application:t}:void 0},get url(){return _},get title(){return S},get windowStyleAttributes(){return O},get settings(){return O},get tabGroupId(){return"tab"===k.toLowerCase()?F:void 0},get tabIndex(){return"tab"===k.toLowerCase()?q:void 0},get frameId(){return U},get frameButtons(){return G},get mode(){return k},get state(){return W},get isCollapsed(){return D},get isVisible(){return N},get isLocked(){return z},get context(){return I},get bounds(){return x},get minHeight(){return O.minHeight},get maxHeight(){return O.maxHeight},get minWidth(){return O.minWidth},get maxWidth(){return O.maxWidth},get isFocused(){return T},get frameColor(){return C},get opened(){return void 0!==h.id},get group(){return v},get groupId(){return E},get isSticky(){return L},get topNeighbours(){return dn("top")},get leftNeighbours(){return dn("left")},get rightNeighbours(){return dn("right")},get bottomNeighbours(){return dn("bottom")},get isGroupHeaderVisible(){return P},get activityId(){if(I._t42)return I._t42.activityId;var e=fn();return e?e.activityId:void 0},get activityWindowId(){if(I._t42)return I._t42.activityWindowId;var e=fn();return e?e.activityWindowId:void 0},get windowType(){return t.windowType||"electron"},get zoomFactor(){return B},get screen(){if("undefined"!==typeof window&&window.glue42gd)return Ni.getMonitor(h.bounds,window.glue42gd.monitors)},get placementSettings(){return Object.assign({},H)},get jumpList(){return V},maximize:se,restore:ue,minimize:ce,maximizeRestore:ae,collapse:le,expand:de,toggleCollapse:pe,focus:oe,activate:ie,moveResize:te,setTitle:Z,setStyle:Q,setOnTop:Y,resetButtons:$,setSizeConstraints:X,navigate:K,addFrameButton:ne,removeFrameButton:re,setVisible:ge,show:function(){return ge(!0)},hide:function(){return ge(!1)},center:ye,close:J,snap:fe,showLoader:we,hideLoader:be,updateContext:ke,lock:xe,unlock:_e,getIcon:Se,setIcon:Ie,setFrameColor:Ce,setTabTooltip:Ae,attachTab:he,detachTab:ve,setTabHeaderVisible:Te,showPopup:Pe,createFlydown:Me,setModalState:Re,setZoomFactor:Ne,zoomIn:Oe,zoomOut:je,showDevTools:Le,capture:De,flash:We,setSticky:ee,print:Fe,printToPDF:qe,place:ze,ungroup:Ue,refresh:Ge,goBack:St,goForward:It,download:Be,configure:He,getChannel:function(){var e=s(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m().getWindowsWithChannels({windowIds:[w]});case 2:return n=e.sent,e.abrupt("return",null===(t=n[0])||void 0===t?void 0:t.channel);case 4:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),onClose:Je,onUrlChanged:Ke,onTitleChanged:Ve,onFrameButtonAdded:Qe,onFrameButtonRemoved:$e,onFrameButtonClicked:Ye,onCollapsed:Xe,onExpanded:Ze,onMinimized:tt,onMaximized:et,onNormal:nt,onAttached:rt,onDetached:it,onVisibilityChanged:ot,onContextUpdated:at,onLockingChanged:st,onBoundsChanged:ut,onFrameColorChanged:dt,onFocusChanged:ct,onStickyChanged:lt,onGroupChanged:vt,onWindowAttached:ft,onWindowDetached:ht,onTabSelectionChanged:gt,onTabHeaderVisibilityChanged:pt,onClosing:yt,onRefreshing:mt,onZoomFactorChanged:wt,onPlacementSettingsChanged:bt,onNeighboursChanged:kt,onNavigating:_t,get tabs(){return cn()},get isTabHeaderVisible(){return M},get isTabSelected(){return R},getURL:function(){return Promise.resolve(_)},getTitle:function(){return Promise.resolve(S)},getBounds:function(){return Promise.resolve(x)},getContext:function(){return Promise.resolve(I)},setContext:function(e){if(nn(e))throw new Error('"context" must not be null or undefined, set to empty object if you want to clear it out.');return n.updateContext(h,e,!0)},getDisplay:function(){return o().getByWindowId(e)},resizeTo:function(e,t){return te({width:e,height:t})},moveTo:function(e,t){return te({top:e,left:t})},getParentWindow:function(){return s(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=O.parentInstanceId){e.next=3;break}return e.abrupt("return",void 0);case 3:return e.abrupt("return",null===(t=ji.list[n])||void 0===t?void 0:t.API);case 4:case"end":return e.stop()}}),e)})))()},getChildWindows:function(){return s(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object.keys(ji.list).map((function(e){return ji.list[e].API})).filter((function(t){return t.settings.parentInstanceId===e})));case 1:case"end":return t.stop()}}),t)})))()},joinChannel:function(t){return m().join(t,e)},leaveChannel:function(){return m().leave(e)}},{API:h,Events:{handleUpdate:Ct,handleWindowClose:Rt,handleWindowChangeState:Lt,handleTitleChanged:Tt,handleVisibilityChanged:Et,handleUrlChanged:At,handleWindowSettingsChanged:Pt,handleContextUpdated:Mt,handleFrameIsLockedChanged:Wt,handleBoundsChanged:Ft,handleFocusChanged:qt,handleFrameButtonAdded:Ot,handleFrameButtonRemoved:jt,handleFrameButtonClicked:Nt,handleFrameColorChanged:zt,handleFrameAttached:Gt,handleFrameSelectionChanged:Jt,handleCompositionChanged:Bt,handleGroupHeaderVisibilityChanged:Ht,handleTabHeaderVisibilityChanged:Vt,handleGroupChanged:un,handleAttached:Qt,handleDetached:Zt,handleWindowAttached:Xt,handleWindowDetached:tn,handleZoomFactorChanged:on,handleIsStickyChanged:Ut,handlePlacementSettingsChanged:sn}}},qi=function(){function e(){v(this,e),this._registry=Cr(),this._finished=Promise.resolve(),this.unsubCallbacks={}}return g(e,[{key:"hostInstance",get:function(){return this.agmTarget}},{key:"finished",get:function(){return this._finished}},{key:"init",value:function(e,t){var n=this;this.agm=e,this.agmTarget=t,this._registry.add("event",(function(e){"Closed"===e.type&&Object.keys(n.unsubCallbacks).forEach((function(t){t.startsWith(e.windowId)&&delete n.unsubCallbacks[t]}))}))}},{key:"handleEvent",value:function(e){this._registry.execute("event",e)}},{key:"open",value:function(){var e=s(a().mark((function e(t){var n,r,i,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._finished=new Promise((function(e){n=e})),e.prev=1,e.next=4,this.agm.invoke("T42.Wnd.Create",t,this.agmTarget);case 4:if(void 0!==(r=e.sent).returned){e.next=7;break}throw new Error("failed to execute T42.Wnd.Create - unknown reason");case 7:return i=r.returned.id,e.next=10,ji.waitFor(i);case 10:return o=e.sent,setTimeout((function(){"electron"===o.API.windowType&&o.Events.handleUrlChanged(o.API.url)}),0),e.abrupt("return",o.API);case 15:throw e.prev=15,e.t0=e.catch(1),e.t0;case 18:return e.prev=18,n(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[1,15,18,21]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("close",{windowId:t.id},"Closed");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"navigate",value:function(){var e=s(a().mark((function e(t,n,r){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("navigate",{windowId:t.id,options:{url:n,urlLoadOptions:r}},"UrlChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"setStyle",value:function(){var e=s(a().mark((function e(t,n){var r,i,o,s,u,c,l,d,p,f,h,v,g,y;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],o=function(e){return i.push(e)},nn(n.focus)||t.isFocused||o(t.focus()),nn(n.hidden)||(s=!n.hidden,o(t.setVisible(s))),nn(n.onTop)||o(t.setOnTop(n.onTop)),rn(n.tabTooltip)&&rn(n.tabToolTip)||(u=null!==(r=n.tabTooltip)&&void 0!==r?r:n.tabToolTip,o(t.setTabTooltip(u))),rn(n.tabTitle)||o(this.execute("setTabTitle",{windowId:t.id,options:{tabTitle:n.tabTitle}})),c=n.maxWidth,l=n.maxHeight,d=n.minWidth,p=n.minHeight,f=n.allowClose,h=n.allowCollapse,v=n.allowLockUnlock,g=n.allowMaximize,y=n.allowMinimize,o(t.setSizeConstraints({maxWidth:c,maxHeight:l,minWidth:d,minHeight:p})),o(t.resetButtons({allowClose:f,allowCollapse:h,allowLockUnlock:v,allowMaximize:g,allowMinimize:y})),e.next=12,Promise.all(i);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setSizeConstraints",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("setSizeConstraints",{windowId:t.id,options:n});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setTabTooltip",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("setTabTooltip",{windowId:t.id,options:{tabTooltip:n}});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"resetButtons",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("resetButtons",{windowId:t.id,options:n});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setOnTop",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("setOnTop",{windowId:t.id,options:{onTop:n}});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setTitle",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={windowId:t.id,options:{title:n}},e.next=3,this.execute("setTitle",r,"TitleChanged");case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setSticky",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={windowId:t.id,options:{isSticky:n}},e.next=3,this.execute("setSticky",r);case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"moveResize",value:function(){var e=s(a().mark((function e(t,n){var r=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("undefined"!==typeof window&&window.glueDesktop.versionNum<31200)){e.next=4;break}return e.abrupt("return",new Promise(function(){var e=s(a().mark((function e(i,o){var s,u,c,l,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.areBoundsEqual(n,t),u=!1,c=function(){u||(u=!0,d&&(d(),d=void 0),i(t),l&&(clearTimeout(l),l=void 0))},s||(d=t.onBoundsChanged((function(e){r.areBoundsEqual(n,e)&&c()}))),e.prev=4,e.next=7,r.execute("moveResize",{windowId:t.id,options:{bounds:n}});case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(4),o(e.t0),e.abrupt("return");case 13:if(!s){e.next=16;break}return c(),e.abrupt("return");case 16:l=setTimeout((function(){c()}),1e3);case 17:case"end":return e.stop()}}),e,null,[[4,9]])})));return function(t,n){return e.apply(this,arguments)}}()));case 4:return e.next=6,this.execute("moveResize",{windowId:t.id,options:{bounds:n}});case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"addFrameButton",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("addButton",{windowId:t.id,options:n},"ButtonAdded");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"removeFrameButton",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("removeButton",{windowId:t.id,options:n},"ButtonRemoved");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"activate",value:function(){var e=s(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new Promise((function(e,r){n=t.onFocusChanged((function(){e()}))})),e.next=4,Promise.all([this.execute("activate",{windowId:t.id},"FocusChanged"),r]);case 4:return e.abrupt("return",t);case 7:throw e.prev=7,e.t0=e.catch(0),e.t0;case 10:return e.prev=10,n&&n(),e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[0,7,10,13]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"focus",value:function(){var e=s(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new Promise((function(e,r){n=t.onFocusChanged((function(){e()}))})),e.next=4,Promise.all([this.execute("focus",{windowId:t.id},"FocusChanged"),r]);case 4:return e.abrupt("return",t);case 7:throw e.prev=7,e.t0=e.catch(0),e.t0;case 10:return e.prev=10,n&&n(),e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[0,7,10,13]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"maximizeRestore",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("maximizeRestore",{windowId:t.id},"StateChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"maximize",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("maximize",{windowId:t.id},"StateChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"restore",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("restore",{windowId:t.id},"StateChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"minimize",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("minimize",{windowId:t.id},"StateChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"collapse",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("collapse",{windowId:t.id},"StateChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"expand",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("expand",{windowId:t.id},"StateChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"toggleCollapse",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("toggleCollapse",{windowId:t.id},"StateChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"snap",value:function(){var e=s(a().mark((function e(t,n,r){var i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={targetWindowId:n.id},r&&(i.snappingEdge=r),e.next=4,this.execute("snap",{windowId:t.id,options:i},"CompositionChanged","CompositionChanged-".concat(n.id));case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"attachTab",value:function(){var e=s(a().mark((function e(t,n,r){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("attachTab",{windowId:t.id,options:{index:r,sourceWindowId:n.id,targetWindowId:t.id}},"WindowFrameAdded-".concat(n.id),"WindowFrameRemoved-".concat(n.id));case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"detachTab",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=["WindowFrameRemoved","WindowFrameAdded"],nn(null===n||void 0===n?void 0:n.relativeTo)?r.push("BoundsChanged"):(r.push("CompositionChanged"),r.push("CompositionChanged-".concat(n.relativeTo))),e.next=4,this.execute.apply(this,["detachTab",{windowId:t.id,options:n}].concat(r));case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setVisible",value:function(){var e=s(a().mark((function e(t){var n,r,i=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(i.length>1&&void 0!==i[1])||i[1],r=n?"show":"hide",e.next=4,this.execute(r,{windowId:t.id},"VisibilityChanged");case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"showLoader",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("showLoadingAnimation",{windowId:t.id,options:n});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"hideLoader",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("hideLoadingAnimation",{windowId:t.id});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateContext",value:function(){var e=s(a().mark((function e(t,n,r){var i,o,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=this.swapUndefinedToNull(n),s=new Promise((function(e,n){i=t.onContextUpdated((function(){e()}))})),e.next=5,Promise.all([this.execute("updateContext",{windowId:t.id,context:o,replace:r}),s]);case 5:return e.abrupt("return",t);case 8:throw e.prev=8,e.t0=e.catch(0),e.t0;case 11:return e.prev=11,i&&i(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[0,8,11,14]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"lock",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("lockUnlock",{windowId:t.id,options:{lock:!0}},"FrameIsLockedChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unlock",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("lockUnlock",{windowId:t.id,options:{lock:!1}},"FrameIsLockedChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getIcon",value:function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("getIcon",{windowId:t.id,options:{}});case 2:return n=e.sent,e.abrupt("return",n.icon);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setIcon",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("setIcon",{windowId:t.id,options:{dataURL:n}});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setFrameColor",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("setFrameColor",{windowId:t.id,options:{frameColor:n}},"FrameColorChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setTabHeaderVisible",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("setTabHeaderVisible",{windowId:t.id,options:{toShow:n}},"TabHeaderVisibilityChanged");case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"showPopup",value:function(){var e=s(a().mark((function e(t,n){var r,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new Error("The options object is not valid!");case 2:return(r=u({},n)).targetLocation||(r.targetLocation="bottom"),i=u(u({},r),{},{popupBounds:r.size,targetId:t.id,popupId:r.windowId}),e.next=7,this.execute("showPopupWindow",{windowId:t.id,options:i});case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"createFlydown",value:function(){var e=s(a().mark((function e(t,n){var r,i,o=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new Error("The options object is not valid!");case 2:return(r=u({},n)).horizontalOffset||(r.horizontalOffset=0),r.verticalOffset||(r.verticalOffset=0),i=this.reformatFlydownOptions(t,r),e.abrupt("return",this.execute("setFlydownArea",{windowId:t,options:i}).then((function(){var e=i.zones.map((function(e){return e.id}));return i.zones.forEach((function(e){var t="function"===typeof e.flydownSize?e.flydownSize:function(){return e.flydownSize};n.size instanceof Function&&e.flydownSize&&(t=function(){var t=s(a().mark((function t(r,i){var o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.size instanceof Function)){t.next=4;break}return t.next=3,n.size(r,i);case 3:o=t.sent;case 4:if(!(e.flydownSize instanceof Function&&e.flydownSize!==n.size)){t.next=11;break}return t.next=7,e.flydownSize(r,i);case 7:if(t.t0=t.sent,t.t0){t.next=10;break}t.t0=o;case 10:return t.abrupt("return",t.t0);case 11:return t.abrupt("return",o||e.flydownSize);case 12:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),o._registry.clearKey("".concat(i.targetId,"_").concat(e.id)),o._registry.add("".concat(i.targetId,"_").concat(e.id),t)})),{destroy:function(){return o.clearFlydownArea(i.targetId,e)},options:r}})));case 7:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setModalState",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.execute("setModalState",{windowId:t,options:{isModal:n}}));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"handleFlydownBoundsRequested",value:function(){var e=s(a().mark((function e(t,n){var r,i,o,s,c,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){return n.cancel=!0},i={zoneId:n.flydownId,flydownWindowBounds:n.flydownWindowBounds,flydownWindowId:n.flydownWindowId},e.next=4,Promise.all(this._registry.execute("".concat(t,"_").concat(n.flydownId),i,r));case 4:if(1!==(o=e.sent).length){e.next=10;break}return s={height:0,width:0,top:0,left:0},c="object"!==typeof o[0]||Array.isArray(o[0])?s:o[0],l=u(u({},n),{},{flydownWindowBounds:c}),e.abrupt("return",l);case 10:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"handleOnEventRequested",value:function(){var e=s(a().mark((function e(t,n){var r,i,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null!==(r=this.unsubCallbacks[t])&&void 0!==r?r:[],o=!1,e.next=4,Promise.all(i.map((function(e){return new Promise((function(t,r){e((function(){t()}),(function(){r()}),(function(){o=!0}),n)}))})));case 4:return e.abrupt("return",{prevented:o});case 5:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"zoomIn",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("zoomIn",{windowId:t.id});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"zoomOut",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("zoomOut",{windowId:t.id});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setZoomFactor",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("setZoomFactor",{windowId:t.id,options:{zoomFactor:n}});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"showDevTools",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("showDevTools",{windowId:t.id});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"capture",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("captureScreenshot",{windowId:t.id,options:u({},n)});case 2:return r=e.sent.data,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"captureGroup",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("captureGroupScreenshot",{windowId:t[0],options:u({groupWindowIds:t},n)});case 2:return r=e.sent.data,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"flash",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("flash",{windowId:t.id,options:u({},n)});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"configure",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.execute("configure",{windowId:t,options:u({},n)}));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"print",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("print",{windowId:t.id,options:u({},n)});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"printToPDF",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("printToPDF",{windowId:t.id,options:u({},n)});case 2:return r=e.sent.filePath,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"place",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u({},n),n.display&&"current"!==n.display){e.next=5;break}return e.next=4,t.getDisplay();case 4:r.display=e.sent;case 5:return r.display=r.display.index+1,e.abrupt("return",this.execute("place",{windowId:t.id,options:u({},r)}));case 7:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"refresh",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("refresh",{windowId:t.id,options:{ignoreCache:n}});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"download",value:function(){var e=s(a().mark((function e(t,n){var r,i,o=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=o.length>2&&void 0!==o[2]?o[2]:{}).enableDownloadBar=!r.silent,e.next=4,this.execute("downloadURL",{windowId:t.id,options:{url:n,options:r}});case 4:return i=e.sent,e.abrupt("return",{url:n,path:i.fullPath,size:i.fileSize});case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"configureWindow",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("configureWindow",{windowId:t.id,options:n});case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"execute",value:function(){var e=s(a().mark((function e(t,n){var r,i,o,s,c,l=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u(u({},n),{},{command:t}),this._finished=new Promise((function(e){i=e})),e.prev=2,!("undefined"!==typeof window&&window.glueDesktop.versionNum<31200)){e.next=10;break}for(o=l.length,s=new Array(o>2?o-2:0),c=2;c<o;c++)s[c-2]=l[c];return e.next=7,this.executeWithoutToken.apply(this,[r].concat(s));case 7:case 12:return e.abrupt("return",e.sent);case 10:return e.next=12,this.executeWithToken(r);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(2),e.t0;case 18:return e.prev=18,i(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[2,15,18,21]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"ungroup",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={windowId:t.id,options:n},e.next=3,this.execute("ungroup",r);case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateJumpList",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={windowId:t,options:n},e.next=3,this.execute("updateJumplist",r);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getJumpList",value:function(){var e=s(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={windowId:t},e.next=3,this.execute("getJumplist",n);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onClosing",value:function(e,t){var n="undefined"!==typeof window&&window.glue42gd;return n?n.addCloseHandler(e,t):this.nodeHandlers(e,t,"OnClosing")}},{key:"onRefreshing",value:function(e,t){var n="undefined"!==typeof window&&window.glue42gd;return n?n.addRefreshHandler(e,t):this.nodeHandlers(e,t,"OnRefreshing")}},{key:"onNavigating",value:function(e,t){var n="undefined"!==typeof window&&window.glue42gd;return n?n.addWillNavigateHandler(e,t):this.nodeHandlers(e,t,"OnNavigating")}},{key:"goBack",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("goBack",{windowId:t.id});case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"goForward",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute("goForward",{windowId:t.id});case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"nodeHandlers",value:function(e,t,n){var r=this,i="".concat(t,"-").concat(n),o=function(){if(r.unsubCallbacks[i]){var o=r.unsubCallbacks[i];r.unsubCallbacks[i]=o.filter((function(t){return t!==e}))}0===r.unsubCallbacks[i].length&&r.execute(n,{windowId:t,options:{unsubscribe:!0}})};if(this.unsubCallbacks[i])return this.unsubCallbacks[i].push(e),o;this.unsubCallbacks[i]=[e];var a={windowId:t};return this.execute(n,a),o}},{key:"reformatFlydownOptions",value:function(e,t){var n=function(e,n){if(t[n]&&(void 0===e[n]||null===e[n])){var r=t[n];e[n]=r}},r=t.zones.map((function(e){return n(e,"windowId"),n(e,"targetLocation"),!t.size||void 0!==e.flydownSize&&null!==e.flydownSize||(e.flydownSize=t.size),e.flydownBounds=e.flydownSize,e.flydownId=e.windowId,e.targetLocation||(e.targetLocation="bottom"),e}));return u(u({},t),{},{zones:r,targetId:e,flydownBounds:t.size,flydownActiveArea:t.activeArea})}},{key:"clearFlydownArea",value:function(e,t){var n=this;return this.execute("clearFlydownWindowArea",{windowId:e,options:{}}).then((function(){t.forEach((function(t){n._registry.clearKey("".concat(e,"_").concat(t))}))}))}},{key:"executeWithoutToken",value:function(e){for(var t=this,n=[],r=arguments.length,a=new Array(r>1?r-1:0),s=1;s<r;s++)a[s-1]=arguments[s];var u=null===a||void 0===a?void 0:a.filter((function(e){return!nn(e)})).map((function(r){return new Promise((function(o){var a=r.split("-"),s=i(a,2),u=s[0],c=s[1],l=void 0===c?e.windowId:c;n.push(t._registry.add("event",(function(e){e.type===u&&e.windowId===l&&o()})))}))})),c=new Promise((function(n,r){t.agm.invoke("T42.Wnd.Execute",e,t.agmTarget).then((function(e){e.returned&&e.returned.errorMsg?r(e):n(e.returned)})).catch((function(e){return r(e)}))}));return Promise.all([c].concat(o(u))).then((function(e){return e[0]})).finally((function(){n.forEach((function(e){return e()}))}))}},{key:"executeWithToken",value:function(){var e=s(a().mark((function e(t){var n,r,i,o,s,u=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=Ei.generate(),i=new Promise((function(e){n=u._registry.add("event",(function(t){t.token===r&&e()}))})),o=new Promise((function(e,n){t.token=r,u.agm.invoke("T42.Wnd.Execute",t,u.agmTarget).then((function(t){t.returned&&t.returned.errorMsg?n(t):e(t.returned)})).catch((function(e){n(e)}))})),e.next=6,Promise.all([o,i]);case 6:return s=e.sent,e.abrupt("return",s[0]);case 10:throw e.prev=10,e.t0=e.catch(0),e.t0;case 13:return e.prev=13,n&&n(),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[0,10,13,16]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"areBoundsEqual",value:function(e,t){var n=t.bounds,r=t.settings,i=e.height,o=e.width;e.height<r.minHeight&&(i=r.minHeight),e.height>r.maxHeight&&(i=r.maxHeight),e.width<r.minWidth&&(o=r.minWidth),e.width>r.maxWidth&&(o=r.maxWidth);var a=!i||n.height===i,s=!o||n.width===o,u=!e.left||n.left===e.left,c=!e.top||n.top===e.top;return a&&s&&u&&c}},{key:"swapUndefinedToNull",value:function(e){try{for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],o=e[i];"undefined"===typeof o&&(o=null),t[i]=o}return t}catch(a){return e}}}]),e}(),Ui=new qi;function zi(e,t){var n=ji.list;return Object.keys(n).reduce((function(r,i){var o=n[i];return o.API.tabGroupId===t&&o.API.id!==e&&r.push(o),r}),[])}var Gi=function(){function e(t,n,r,i,o,a,s){v(this,e),this._registry=Cr(),this._waitTimeout=1e4,this._agm=t,this._logger=n.subLogger("gd-env"),this._agmInstance=this.normalizeInstance(a),this._windowId=s,this._appManagerGetter=r,this._displayAPIGetter=i,this._channelsAPIGetter=o}return g(e,[{key:"init",value:function(){var e=this;return new Promise((function(t,n){"undefined"===typeof e._agmInstance&&(e._agmInstance="best"),e._agm.registerAsync("T42.Wnd.OnEventWithResponse",(function(t,n,r,i){e.respondToEvent(t).then(r).catch(i)})),new Promise((function(r,i){e._agm.subscribe("T42.Wnd.OnEvent",{waitTimeoutMs:e._waitTimeout,target:e._agmInstance,onData:function(n){e.updateWindow(n.data,t),Ui.handleEvent(n.data)},onConnected:function(t){e._agmInstance=e.normalizeInstance(t),Ui.init(e._agm,e._agmInstance)}}).catch((function(e){n("Can not subscribe for stream T42.Wnd.OnEvent. Err: "+e)}))}))}))}},{key:"executor",get:function(){return Ui}},{key:"open",value:function(e,t,n){var r=u({},n=n||{});return void 0!==r.relativeTo&&"string"!==typeof r.relativeTo&&(r.relativeTo=r.relativeTo.id||""),r.name=e,r.url=t,r.windowState=n.windowState||n.state,delete r.state,this.executor.open(r)}},{key:"createFlydown",value:function(e,t){return this.executor.createFlydown(e,t)}},{key:"showPopup",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ji.get(t),e.next=3,this.executor.showPopup(r.API,n);case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"tabAttached",value:function(e){return this._registry.add("tab-attached",e)}},{key:"tabDetached",value:function(e){return this._registry.add("tab-detached",e)}},{key:"onWindowFrameColorChanged",value:function(e){return this._registry.add("frame-color-changed",e)}},{key:"onEvent",value:function(e){return this._registry.add("window-event",e)}},{key:"my",value:function(){return this._windowId}},{key:"execute",value:function(e,t,n){return this._agm.invoke("T42.Wnd.Execute",{command:e,options:n,windowId:t})}},{key:"onCompositionChanged",value:function(e){return this._registry.add("composition-changed",e)}},{key:"onGroupHeaderVisibilityChanged",value:function(e){return this._registry.add("group-header-changed",e)}},{key:"onWindowGotFocus",value:function(e){return this._registry.add("got-focus",e)}},{key:"onWindowLostFocus",value:function(e){return this._registry.add("lost-focus",e)}},{key:"normalizeInstance",value:function(e){if(e)return{application:e.application,machine:e.machine,user:e.user}}},{key:"respondToEvent",value:function(e){return"ShowFlydownBoundsRequested"===e.type?this.executor.handleFlydownBoundsRequested(e.data.windowId,e.data):"OnClosing"===e.type||"OnRefreshing"===e.type||"OnNavigating"===e.type?this.executor.handleOnEventRequested(e.data.callbackId,e.data.args):Promise.reject("There isn't a handler for ".concat(e.type))}},{key:"updateWindow",value:function(e,t){var n=this,r=this.getExtendedStreamEvent(e);if("Snapshot"===e.type)return e.windows.forEach((function(e){var t=ji.get(e.id);if(t)t.Events.handleUpdate(n.mapToWindowConstructorOptions(e));else{var i=n.createWindow(e.id,e);ji.markReadyToShow(i.API.id)}n._registry.execute("window-event",r)})),void t(this);if("CommandExecuted"!==e.type){if("Created"===e.type){var i=e,o=this.createWindow(i.windowId,i.data||{});return ji.setReadyState(o.API.id),void this._registry.execute("window-event",r)}var u=ji.get(e.windowId);if(u){var c=u.API,l=u.Events;if("BoundsChanged"===e.type){var d=e;l.handleBoundsChanged(d.data)}if("UrlChanged"===e.type){var p=e;ji.setUrlChangedState(p.windowId),l.handleUrlChanged(p.data)}if("TitleChanged"===e.type){var f=e;l.handleTitleChanged(f.data)}if("IsStickyChanged"===e.type){var h=e;l.handleIsStickyChanged(h.data)}if("VisibilityChanged"===e.type&&l.handleVisibilityChanged(e.data),"ContextChanged"===e.type&&l.handleContextUpdated(e.data),"StateChanged"===e.type&&l.handleWindowChangeState(e.data),"FrameColorChanged"===e.type&&(l.handleFrameColorChanged(e.data),this._registry.execute("frame-color-changed",c)),"CompositionChanged"===e.type){var v=e;l.handleCompositionChanged(v.data),this._registry.execute("composition-changed",v.data)}if("GroupHeaderVisibilityChanged"===e.type){var g=e;l.handleGroupHeaderVisibilityChanged(g.data.groupHeaderVisible),this._registry.execute("group-header-changed",g.data)}if("FocusChanged"===e.type){var y=e;this.focusChanged(l,c,y.data)}if("WindowFrameChanged"===e.type&&(l.handleFrameAttached(e.data.frameId,e.data.frameId,e.data.isTabHeaderVisible),this._registry.execute("frame-changed")),"WindowFrameAdded"===e.type){var m=zi(c.id,e.data.frameId),w=e.data;l.handleAttached(w.frameId,w.frameId,w.isTabHeaderVisible,w.isLocked,m).then(s(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(m.length>0)){t.next=4;break}return t.next=3,Ui.finished;case 3:n._registry.execute("tab-attached",c,e.data.frameId,e.data.isTabHeaderVisible);case 4:case"end":return t.stop()}}),t)}))))}if("WindowFrameRemoved"===e.type){var b=c.tabGroupId,k=zi(c.id,b);l.handleDetached(e.data.isLocked,k).then(s(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(k.length>0)){t.next=4;break}return t.next=3,Ui.finished;case 3:n._registry.execute("tab-detached",c,e.data.frameId,c.tabGroupId);case 4:case"end":return t.stop()}}),t)}))))}"TabHeaderVisibilityChanged"===e.type&&l.handleTabHeaderVisibilityChanged(e.data.isTabHeaderVisible),"FrameSelectionChanged"===e.type&&l.handleFrameSelectionChanged(e.data.newWindowId,e.data.prevWindowId),"ButtonClicked"===e.type&&l.handleFrameButtonClicked(e.data),"ButtonAdded"===e.type&&l.handleFrameButtonAdded(e.data),"ButtonRemoved"===e.type&&l.handleFrameButtonRemoved(e.data),"WindowZoomFactorChanged"===e.type&&l.handleZoomFactorChanged(e.data),"Closed"===e.type&&(ji.remove(u),l.handleWindowClose()),"FrameIsLockedChanged"===e.type&&l.handleFrameIsLockedChanged(e.data),"PlacementSettingsChanged"===e.type&&l.handlePlacementSettingsChanged(e.data),this._registry.execute("window-event",r)}else this._logger.error("received update for unknown window. Stream:', ".concat(JSON.stringify(e,null,4)))}else this._registry.execute("window-event",r)}},{key:"createWindow",value:function(e,t){var n=Fi(e,this.mapToWindowConstructorOptions(t),Ui,this._logger,this._appManagerGetter,this._displayAPIGetter,this._channelsAPIGetter,this._agm);return ji.add(n),n}},{key:"focusChanged",value:function(e,t,n){e.handleFocusChanged(n),n?this._registry.execute("got-focus",t):this._registry.execute("lost-focus",t)}},{key:"mapToWindowConstructorOptions",value:function(e){return{name:e.name,context:e.context,bounds:e.bounds,url:e.url,title:e.title,isVisible:e.isVisible,focus:e.isFocused,state:e.state,frameColor:e.frameColor,groupId:e.groupId,neighbours:e.neighbors,isFocused:e.isFocused,isGroupHeaderVisible:e.groupHeaderVisible,isCollapsed:e.isCollapsed,tabGroupId:e.frameId,frameId:e.frameId,mode:e.mode,isTabHeaderVisible:e.isTabHeaderVisible,isTabSelected:e.isActiveTab,settings:e.settings,windowType:e.windowType,zoomFactor:e.zoomFactor,isLocked:e.isLocked,placementSettings:e.placementSettings,isSticky:e.isSticky,tabIndex:e.tabIndex,frameButtons:e.frameButtons,jumpListOptions:e.jumpList,applicationName:e.applicationName}}},{key:"getExtendedStreamEvent",value:function(e){try{if(!e.windowId)return e;var t=ji.get(e.windowId);if(!t)return e;var n=u({state:e.type,windowName:t.API.name},e);return"WindowFrameAdded"===n.state&&(n.state="TabAttached"),"StateChanged"===n.state&&(n.state=n.data.charAt(0).toUpperCase()+n.data.slice(1)),"ButtonAdded"===n.state&&(n.state="FrameButtonAdded"),"ButtonRemoved"===n.state&&(n.state="FrameButtonRemoved"),n}catch(r){return e}}}]),e}(),Bi=function(e,t,n,r,i,o){var a=t;return new Promise((function(t,s){if(2===o)throw a.trace("running in HC"),new Error("GD2 not supported");if(o>=3)a.trace("running in GD 3"),new Gi(e,a,n,r,i,void 0,window.glue42gd.windowId).init().then(t).catch(s);else{var u=new Gi(e,a,n,r,i).init(),c=function(e){return new Promise((function(t,n){return setTimeout((function(){n("timeout waiting for streams")}),e)}))};Promise.race([u,c(1e4)]).then(t).catch(s)}}))},Hi=function(e,t){var n=Cr(),r=[];function i(e){return u.apply(this,arguments)}function u(){return(u=s(a().mark((function e(i){var o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==r.indexOf(i)){e.next=7;break}return r.push(i),(o=ji.get(i)).Events.handleGroupChanged(x,void 0),e.next=6,t.finished;case 6:n.execute("window-added",x,o.API);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e){return l.apply(this,arguments)}function l(){return(l=s(a().mark((function e(i){var o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===(o=r.indexOf(i.API.id))){e.next=7;break}return r.splice(o,1),i.Events.handleGroupChanged(void 0,x),e.next=6,t.finished;case 6:n.execute("window-removed",x,i.API);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e,t,n){var r;"string"===typeof e?r=e:nn(e)||(r=e.id);var i=y(r);if(i)return"function"===typeof t&&t(i),i;"function"===typeof n&&n("No window with ID: ".concat(r))}function p(e){var t=g();return"function"===typeof e&&e(t),t}function f(e,t){return h.apply(this,arguments)}function h(){return h=s(a().mark((function e(n,r){var i,o,s,u=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=u.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=u[s];return e.next=3,t.execute.apply(t,[n,r].concat(o));case 3:return e.abrupt("return",x);case 4:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function v(e){n.execute("header-visibility-changed",x)}function g(){var e=[];return r.forEach((function(t){var n=y(t);"undefined"!==typeof n&&e.push(n)})),e}function y(e){return ji.get(e)?ji.get(e).API:void 0}function m(){return void 0===g().find((function(e){return!e.isGroupHeaderVisible}))}function w(e){return n.add("header-visibility-changed",e)}function b(e){return n.add("window-added",e)}function k(e){return n.add("window-removed",e)}var x={id:e,get windows(){return p()},find:d,get isHeaderVisible(){return m()},showHeader:function(e,t){return Ni.callbackifyPromise((function(){return f.apply(void 0,["setGroupHeaderVisibility",{windowId:r[0],options:{toShow:!0}}].concat(o(r.map((function(e){return"GroupHeaderVisibilityChanged-".concat(e)})))))}),e,t)},hideHeader:function(e,t){return Ni.callbackifyPromise((function(){return f.apply(void 0,["setGroupHeaderVisibility",{windowId:r[0],options:{toShow:!1}}].concat(o(r.map((function(e){return"GroupHeaderVisibilityChanged-".concat(e)})))))}),e,t)},getTitle:function(){var e=s(a().mark((function e(){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.execute("getGroupTitle",{windowId:r[0]});case 2:return n=e.sent,e.abrupt("return",n.title);case 4:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}(),setTitle:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!rn(t)){e.next=2;break}throw new Error("`title` must not be null or undefined.");case 2:return e.abrupt("return",f("setGroupTitle",{windowId:r[0],options:{title:t}}));case 3:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),capture:function(e){return t.captureGroup(r,e)},maximize:function(e,t){return Ni.callbackifyPromise((function(){return f.apply(void 0,["maximizeGroup",{windowId:r[0]}].concat(o(r.map((function(e){return"StateChanged-".concat(e)})))))}),e,t)},restore:function(e,t){return Ni.callbackifyPromise((function(){return f.apply(void 0,["restoreGroup",{windowId:r[0]}].concat(o(r.map((function(e){return"StateChanged-".concat(e)})))))}),e,t)},onHeaderVisibilityChanged:w,onWindowAdded:b,onWindowRemoved:k};return{groupAPI:x,groupInternal:{get windows(){return r},addWindow:i,removeWindow:c,handleGroupHeaderVisibilityChanged:v}}},Vi=function(e,t){var n=Cr(),r={},i=-1,o=ji.list;function a(){return u(e.my())}function s(e){var t=Object.keys(r).map((function(e){if(r[e])return r[e].groupAPI}));return"function"===typeof e&&e(t),t}function u(e,t,n){var i;"string"===typeof e?i=e:nn(e)||(i=e.id);var o=Object.values(r).find((function(e){return e.groupAPI.windows.filter((function(e){return e.id===i})).length}));if(o)return"function"===typeof t&&t(o.groupAPI),o.groupAPI;"function"===typeof n&&n("Cannot find the group of the window.")}function c(e){return n.add("window-moved",e)}function l(t){if(r.hasOwnProperty(t))return r[t];var n=Hi(t,e.executor);return r[t]=n,n}function d(e){0===e.groupAPI.windows.length&&delete r[e.groupAPI.id]}function p(e,t){var n=l(e);return n.groupInternal.addWindow(t),n}function f(e,t){e&&(e.groupInternal.removeWindow(t),d(e))}function h(e){var t=e.groupId,n=e.windowId,r=ji.get(n);if(r){var i=g(r.API);nn(t)?f(i,r):!nn(i)||nn(t)?i.groupAPI.id!==t&&v(r,i.groupAPI.id,t):p(t,r.API.id)}}function v(e,t,i){var o=e.API.id,a=r[t];f(a,e);var s=p(i,o);e.Events.handleGroupChanged(s.groupAPI,a.groupAPI),n.execute("window-moved",o,t,i)}function g(e){var t;return"string"===typeof e?t=e:nn(e)||(t=e.id),Object.values(r).find((function(e){return e.groupInternal.windows.filter((function(e){return e===t})).length}))}return Object.keys(o).forEach((function(e){var t=o[e],n=t.API.groupId,r=t.API.id;rn(n)||p(n,r)})),ji.onRemoved((function(e){f(g(e.API),e)})),e.onCompositionChanged((function(e){h(e)})),e.onGroupHeaderVisibilityChanged((function(e){var t=u(e.windowId);if("undefined"!==typeof t){var n=r[t.id];-1===i&&(i=t.windows.length),0===--i&&(i=-1,n.groupInternal.handleGroupHeaderVisibilityChanged(e))}})),{groupsAPI:{get my(){return a()},list:s,findGroupByWindow:u},groupsEvents:{onWindowMoved:c}}},Ji=function(e,t,n,r,i,o){var a,s,u=Cr(),c=t;ji.init(c);var l=new Promise((function(t,u){Bi(e,c,n,r,i,o).then((function(n){s=n,a=Vi(n),Ri.init(n.executor,e,c),t()})).catch((function(e){var t="Environment detector fails with: ".concat(e);c.error(t),u(t)}))}));function d(){return l}function p(){var e=ji.getIfReady(s.my());return e?e.API:void 0}function f(e,t,n,r,i){return Ni.callbackifyPromise((function(){if(rn(e))throw new Error("The window name is missing.");if(rn(t))throw new Error("The window URL is missing.");if(!nn(n))for(var r=n,i=0,o=["minHeight","maxHeight","minWidth","maxWidth","width","height","top","left"];i<o.length;i++){var a=o[i];if(a in r){var u=r[a];if(nn(u)){delete r[a];continue}if(!Yt(u)){var c="".concat(a," must be a number");throw new Error(c)}if(("width"===r[a]||"height"===r[a])&&u<=0){var l="".concat(a," must be a positive number");throw new Error(l)}}}return s.open(e,t,n)}),r,i)}function h(e,t,n){var r=ji.list,i=Object.keys(r).reduce((function(t,n){var i,o=r[n];return(null===(i=null===o||void 0===o?void 0:o.API)||void 0===i?void 0:i.name)===e&&t.push(o.API),t}),[]);if(i[0])return"function"===typeof t&&t(i[0]),i[0];"function"===typeof n&&n("There is no window with name:"+e)}function v(e,t,n){var r=ji.list,i=Object.keys(r).reduce((function(t,n){var i=r[n];return"undefined"!==typeof i&&i.API.id===e&&t.push(i.API),t}),[]);if(i[0])return"function"===typeof t&&t(i[0]),i[0];"function"===typeof n&&n("There is no window with such id:"+e)}function g(e){var t=ji.list,n=Object.keys(t).map((function(e){return t[e].API}));if("function"!==typeof e)return n;e(n)}function y(e){var t=p(),n=t?t.id:"";return Ui.configure(n,e)}function m(e){return u.add("window-added",e)}function w(e){return u.add("window-removed",e)}function b(e){var t,n=!1;return l.then((function(){n||(t=s.tabAttached(e))})),function(){n=!0,t&&t()}}function k(e){var t,n=!1;return l.then((function(){n||(t=s.tabDetached(e))})),function(){n=!0,t&&t()}}function x(e){var t,n=!1;return l.then((function(){n||(t=s.onWindowFrameColorChanged(e))})),function(){n=!0,t&&t()}}function _(e){var t,n=!1;return l.then((function(){n||(t=s.onWindowGotFocus(e))})),function(){n=!0,t&&t()}}function S(e){var t,n=!1;return l.then((function(){n||(t=s.onWindowLostFocus(e))})),function(){n=!0,t&&t()}}function I(e){var t,n=!1;return l.then((function(){n||(t=s.onEvent(e))})),function(){n=!0,t&&t()}}function C(e,t){return s.createFlydown(e,t)}function T(e,t){return s.showPopup(e,t)}function A(e){u.execute("window-added",e.API)}function E(e){u.execute("window-removed",e.API)}return ji.onReadyWindow(A),ji.onRemoved(E),{my:p,open:f,find:h,findById:v,list:g,ready:d,onWindowAdded:m,windowAdded:m,onWindowRemoved:w,windowRemoved:w,onTabAttached:b,onTabDetached:k,onWindowFrameColorChanged:x,get groups(){return a.groupsAPI},onWindowGotFocus:_,onWindowLostFocus:S,onEvent:I,createFlydown:C,showPopup:T,configure:y}},Ki=new(function(){function e(){v(this,e),this.layouts=[]}return g(e,[{key:"removeWhere",value:function(e){this.layouts=this.layouts.filter(e)}},{key:"add",value:function(e){this.layouts.push(e)}},{key:"all",get:function(){return this.layouts}},{key:"where",value:function(e){return this.layouts.filter(e)}},{key:"first",value:function(e){return this.where(e)[0]}}]),e}()),Qi="T42.HC.GetSaveContext",$i=function(){function e(t,n,r,i){v(this,e),this.config=t,this.activitiesGetter=n,this.callbacks=r,this.logger=i,this.interop=t.agm,this.registerRequestMethods()}return g(e,[{key:"onSaveRequested",value:function(e){return this.callbacks.add("saveRequested",e)}},{key:"isActivityOwner",value:function(){if("undefined"!==typeof htmlContainer){var e=htmlContainer.getContext();return e&&e._t42&&e._t42.activityIsOwner}var t=this.activitiesGetter();if(!t)return!1;if(!t.inActivity)return!1;var n=t.my.window,r=t.my.activity;return!(!r&&!n)&&r.owner.id===n.id}},{key:"registerRequestMethods",value:function(){var e=this;this.interop.register(Qi,(function(t){var n=e.callbacks.execute("saveRequested",t);(null===n||void 0===n?void 0:n.length)>1&&e.logger.warn('Multiple subscriptions for "glue.layouts.onSaveRequested" - only the first one will be used');var r=n[0],i=e.config.autoSaveWindowContext;if("boolean"===typeof i&&i)return{autoSaveWindowContext:i};if(Array.isArray(i)&&i.length>0)return{autoSaveWindowContext:i};var o={windowContext:null===r||void 0===r?void 0:r.windowContext,activityContext:void 0};return e.isActivityOwner()&&(o.activityContext=null===r||void 0===r?void 0:r.activityContext),o}))}}]),e}();function Yi(e){if(!e)return e;if(Array.isArray(e))return e.map((function(e){return Yi(e)}));if("string"===typeof e||"number"===typeof e||"boolean"===typeof e)return e;var t={};return Object.keys(e).reduce((function(t,n){var r=Yi(e[n]),i=n;return n[0].toLowerCase()!==n[0]&&(i=n[0].toLowerCase()+n.substr(1)),t[i]=r,t}),t)}var Xi=g((function e(t){v(this,e),this.name=t.name,this.type=t.type,this.components=t.components,this.context=t.context,this.metadata=t.metadata,this.version=t.version,this.displays=t.displays})),Zi=function(){function e(t,n,r,i){v(this,e),this.config=t,this.stream=n,this.callbacks=r,this.appManager=t.appManager,this.onEvent=n.onEvent,this.provider=new $i(t,t.activityGetter,r,i),n.subscribe()}return g(e,[{key:"setDefaultGlobal",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.config.agm.invoke("T42.ACS.SelectDefaultLayout",{name:t});case 2:return e.abrupt("return");case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"clearDefaultGlobal",value:function(){var e=s(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.config.agm.invoke("T42.ACS.DeselectDefaultLayout");case 2:return e.abrupt("return");case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDefaultGlobal",value:function(){var e=s(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.config.agm.invoke("T42.ACS.GetDefaultLayout");case 2:if(t=e.sent,n=t.returned){e.next=6;break}return e.abrupt("return",void 0);case 6:if(!this.isSlimMode()){e.next=8;break}return e.abrupt("return",n);case 8:return e.abrupt("return",this.list().find((function(e){return e.name===n.name&&"Global"===e.type})));case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"ready",value:function(){return"fullWaitSnapshot"===this.config.mode?this.stream.gotSnapshot:this.stream.ready}},{key:"save",value:function(e){var t=this;return new Promise((function(n,r){var i,o;if(t.verifyNotSlimMode(),nn(e))return r(new Error("layout is required"));if(rn(e.name))return r(new Error("layout.name argument is required"));rn(e.type)&&(e.type="Global"),rn(e.activityId)||(e.type="Activity");var a={name:e.name,type:e.type,context:null!==(i=e.context)&&void 0!==i?i:{},metadata:null!==(o=e.metadata)&&void 0!==o?o:{},options:{}};if("Activity"===e.type){var s=e.activityId;if(!s){if(!t.appManager.myInstance.inActivity)return r(new Error("Current application is not in activity. Cannot save activity layout for it."));s=t.appManager.myInstance.activityId}a.activityId=s}else{if("Global"!==e.type)return r(new Error("layout type ".concat(e.type," is not supported")));Array.isArray(e.ignoreInstances)&&(a.options.ignoreInstances=e.ignoreInstances),Array.isArray(e.instances)&&(a.options.instances=e.instances)}t.invokeMethodAndTrack("T42.ACS.SaveLayout",a,n,r)}))}},{key:"restore",value:function(e){var t=this;return new Promise((function(n,r){var i,o,a;if(t.verifyNotSlimMode(),nn(e))return r(new Error("options argument is required"));if(rn(e.name))return r(new Error("options.name argument is required"));if(rn(e.type)&&(e.type="Global"),rn(e.activityIdToJoin)||(e.type="Activity"),"Activity"===e.type){if(nn(e.setActivityContext)&&(e.setActivityContext=!0),"boolean"!==typeof e.setActivityContext)return r(new Error("`setActivityContext` must hold a boolean value."));e.activityIdToJoin=null!==(i=e.activityIdToJoin)&&void 0!==i?i:t.appManager.myInstance.activityId}if(nn(e.closeRunningInstance)||(e.closeRunningInstances=e.closeRunningInstance),nn(e.closeRunningInstances)&&(e.closeRunningInstances=!0),!on(e.closeRunningInstances))return r(new Error("`closeRunningInstances` must hold a boolean value."));if(nn(e.closeMe)&&(e.closeMe=e.closeRunningInstances),!on(e.closeMe))return r(new Error("`closeMe` must hold a boolean value."));if(!nn(e.context)&&!Zt(e.context))return r(new Error("`context` must hold an object value."));if(!nn(e.timeout)&&"number"!==typeof e.timeout)return r(new Error("`timeout` must hold an number value."));e.context=null!==(o=e.context)&&void 0!==o?o:{};var s={activityToJoin:e.activityIdToJoin,setActivityContext:e.setActivityContext,ignoreActivityWindowTypes:e.ignoreActivityWindowTypes,reuseExistingWindows:e.reuseWindows,closeRunningInstances:e.closeRunningInstances,excludeFromClosing:e.closeMe?[]:[null===(a=t.appManager.myInstance)||void 0===a?void 0:a.id]},u={type:e.type,name:e.name,context:e.context,options:s};e.timeout&&(u.timeout=e.timeout),t.invokeMethodAndTrack("T42.ACS.RestoreLayout",u,n,r,!0)}))}},{key:"remove",value:function(e,t){var n=this;return new Promise((function(r,i){if(n.verifyNotSlimMode(),!t)return i(new Error("name argument is required"));if(!e)return i(new Error("type argument is required"));var o={type:e,name:t};n.invokeMethodAndTrack("T42.ACS.RemoveLayout",o,r,i)}))}},{key:"list",value:function(){return this.verifyNotSlimMode(),Ki.all}},{key:"import",value:function(e,t){var n=this;return new Promise((function(r,i){if(n.verifyNotSlimMode(),!nn(t)&&"merge"!==t&&"replace"!==t)return i(new Error("".concat(t,' is not supported - only "merge" and "replace"')));if(!Array.isArray(e))return i(new Error("layouts arguments is not an array"));var o={mode:t||"replace",layouts:e};n.invokeMethodAndTrack("T42.ACS.ImportLayouts",o,r,i,!0)}))}},{key:"export",value:function(e){var t=this;return new Promise((function(n,r){var i=function(r){var i=t.getObjectValues(r.Layouts).map((function(e){return new Xi(Yi(e))}));e&&(i=i.filter((function(t){return t.type===e}))),n(i)};t.invokeMethodAndTrack("T42.ACS.ExportLayouts",{},i,r,!0)}))}},{key:"rename",value:function(e,t){var n=this;return new Promise((function(r,i){if(n.verifyNotSlimMode(),!e)return i(new Error("layout argument is required"));if(!e.name)return i(new Error("name argument is required"));if(!e.type)return i(new Error("type argument is required"));var o={type:e.type,oldName:e.name,newName:t};n.invokeMethodAndTrack("T42.ACS.RenameLayout",o,r,i)}))}},{key:"updateMetadata",value:function(e){var t=this;return new Promise((function(n,r){if(!e)return r(new Error("layout argument is required"));if(!e.name)return r(new Error("name argument is required"));if(!e.type)return r(new Error("type argument is required"));if(!e.metadata)return r(new Error("metadata argument is required"));var i={name:e.name,type:e.type,metadata:e.metadata};t.invokeMethodAndTrack("T42.ACS.UpdateMetadata",i,n,r,!0)}))}},{key:"hibernate",value:function(e,t){var n=this;return new Promise((function(r,i){if(!e)return i(new Error("name cannot be empty"));var o={name:e,type:"Global",context:(t=t||{}).context||{},metadata:t.metadata||{}};n.invokeMethodAndTrack("T42.ACS.HibernateLayout",o,r,i,!0)}))}},{key:"resume",value:function(e,t,n){var r=this;return new Promise((function(i,o){if(!e)return o(new Error("name cannot be empty"));var a=u({name:e,type:"Global",context:t},n);r.invokeMethodAndTrack("T42.ACS.ResumeLayout",a,i,o,!0)}))}},{key:"getCurrentLayout",value:function(){var e=s(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.config.agm.invoke("T42.ACS.GetCurrentLayout",{},"best",{methodResponseTimeoutMs:12e4});case 2:if(t=e.sent,n=t.returned.layout){e.next=6;break}return e.abrupt("return",void 0);case 6:return this.isSlimMode()||(n=this.list().find((function(e){return e.name===n.name&&e.type===n.type}))),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onAdded",value:function(e){var t=this.callbacks.add("added",e);return Ki.all.length>0&&Ki.all.forEach((function(t){try{e(t)}catch(n){}})),t}},{key:"onRemoved",value:function(e){return this.callbacks.add("removed",e)}},{key:"onChanged",value:function(e){return this.callbacks.add("changed",e)}},{key:"onRestored",value:function(e){return this.callbacks.add("restored",e)}},{key:"onRenamed",value:function(e){return this.callbacks.add("renamed",e)}},{key:"onEvent",value:function(e){return this.stream.onEvent(e)}},{key:"onSaveRequested",value:function(e){return this.provider.onSaveRequested(e)}},{key:"updateAppContextInCurrent",value:function(e){var t=this;return new Promise((function(n,r){if(e&&"object"!==typeof e)return r(new Error("context must be an object"));var i={context:e=null!==e&&void 0!==e?e:{}};t.invokeMethodAndTrack("T42.ACS.UpdateLayoutComponentContext",i,n,r,!0)}))}},{key:"updateDefaultContext",value:function(e){var t=this;return new Promise((function(n,r){if(e&&"object"!==typeof e)return r(new Error("context must be an object"));var i={context:e=null!==e&&void 0!==e?e:{}};t.invokeMethodAndTrack("T42.ACS.UpdateDefaultContext",i,n,r,!0)}))}},{key:"get",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.list().find((function(e){return e.name===t&&e.type===n}))){e.next=3;break}throw new Error("cannot find layout with name=".concat(t," and type=").concat(n));case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getAll",value:function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.list().filter((function(e){return t===e.type})),e.abrupt("return",n);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"isSlimMode",value:function(){return"slim"===this.config.mode}},{key:"verifyNotSlimMode",value:function(){if(this.isSlimMode())throw Error("Operation not allowed in slim mode. Run in full mode.")}},{key:"invokeMethodAndTrack",value:function(e,t,n,r,i){var o,a=i,s=Ei();t.token=s;var u=function(){a&&o&&n(o)};i||this.stream.waitFor(s).then((function(){a=!0,u()})).catch((function(e){r(e)}));var c=function(t){if(!t.returned)return r(new Error("No result from method "+e));if(t.returned.status&&"Success"!==t.returned.status&&"PartialSuccess"!==t.returned.status){if("string"===typeof t.returned)return r(new Error(t.returned));if("object"===typeof t.returned)return t.returned.status&&t.returned.failed?r(new Error("".concat(t.returned.status,": ").concat(JSON.stringify(t.returned.failed)))):r(new Error(t.returned))}o=t.returned,u()};this.config.agm.invoke(e,t,"best",{methodResponseTimeoutMs:12e4}).then(c).catch((function(e){return r(e)}))}},{key:"getObjectValues",value:function(e){return e?Object.keys(e).map((function(t){return e[t]})):[]}}]),e}(),eo=function(){function e(t,n){var r=this;v(this,e),this.agm=t,this.callbacks=n,this.ready=new Promise((function(e,t){r.resolveReady=e,r.rejectReady=t})),this.gotSnapshot=new Promise((function(e,t){r.resolveGotSnapshot=e,r.rejectGotSnapshot=t}))}return g(e,[{key:"subscribe",value:function(e){var t=this,n=function(e){return t.getObjectValues(e).map((function(e){return Yi(e)}))};this.checkForLayoutEventMethod()?this.agm.subscribe("T42.ACS.OnLayoutEvent",{waitTimeoutMs:1e4}).then((function(e){e.onData((function(e){var r=e.data;r.IsSnapshot&&t.resolveGotSnapshot(),t.addLayouts(n(r.OnLayoutAdded)),t.removeLayouts(n(r.OnLayoutRemoved)),t.changeLayouts(n(r.OnLayoutChanged)),t.renameLayouts(n(r.OnLayoutRenamed)),t.restoredLayout(n(r.OnLayoutRestored)),t.callbacks.execute("streamEvent",r)})),e.onFailed((function(e){var n="can not subscribe to T42.ACS.OnLayoutEvent "+e;t.rejectReady(n),t.rejectGotSnapshot(n)})),t.resolveReady()})).catch((function(e){var n="Error subscribing for T42.ACS.OnLayoutEvent stream. Err: "+e;t.rejectReady(n),t.rejectGotSnapshot(n)})):(e&&this.resolveReady(),setTimeout((function(){t.subscribe(!0)}),500))}},{key:"onEvent",value:function(e){return this.callbacks.add("streamEvent",e)}},{key:"waitFor",value:function(e,t){var n=this;return t||(t=1e4),new Promise((function(r,i){var o=!1,a=n.onEvent((function(t){t.Token===e&&(o=!0,a(),r())}));setTimeout((function(){o||i("timed out")}),t)}))}},{key:"checkForLayoutEventMethod",value:function(){try{return-1!==this.agm.methods().map((function(e){return e.name})).indexOf("T42.ACS.OnLayoutEvent")}catch(e){return!1}}},{key:"addLayouts",value:function(e){var t=this;e&&e.forEach((function(e){var n=new Xi(e);Ki.add(n),t.callbacks.execute("added",n)}))}},{key:"removeLayouts",value:function(e){var t=this;e&&e.forEach((function(e){Ki.removeWhere((function(n){return!t.compareLayouts(n,e)})),t.callbacks.execute("removed",e)}))}},{key:"changeLayouts",value:function(e){var t=this;e&&e.forEach((function(e){Ki.removeWhere((function(n){return!t.compareLayouts(n,e)})),Ki.add(new Xi(e)),t.callbacks.execute("changed",e)}))}},{key:"renameLayouts",value:function(e){var t=this;e&&e.forEach((function(e){var n=Ki.first((function(n){return t.compareLayouts(n,{type:e.type,name:e.oldName})}));if(!n)throw Error("received rename event for unknown layout with type "+e.type+" and name "+e.oldName);n.name=e.newName,t.callbacks.execute("renamed",n)}))}},{key:"compareLayouts",value:function(e,t){return e.name===t.name&&e.type===t.type}},{key:"getObjectValues",value:function(e){return e?Object.keys(e).map((function(t){return e[t]})):[]}},{key:"restoredLayout",value:function(e){var t=this;e&&e.forEach((function(e){var n=Ki.first((function(n){return t.compareLayouts(n,{type:e.type,name:e.name})}));t.callbacks.execute("restored",n)}))}}]),e}();function to(e){if(!e.agm)throw Error("config.agm is required");if(!e.logger)throw Error("config.logger is required");e.mode=e.mode||"slim";var t,n=e.logger,r=Cr();return e.mode,t=new eo(e.agm,r),new Zi(e,t,r,n)}var no,ro,io,oo="T42.Displays.Command",ao="T42.Displays.OnEvent",so=function(){function e(t,n){var r=this;v(this,e),this._agm=t,this._logger=n,this._registry=Cr(),this._registered=!1,this.all=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.callGD(no.GetAll,{});case 2:return t=e.sent,e.abrupt("return",t.map(r.decorateDisplay));case 4:case"end":return e.stop()}}),e)}))),this.get=function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.callGD(no.Get,{id:t});case 2:return n=e.sent,e.abrupt("return",r.decorateDisplay(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getPrimary=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.all();case 2:return t=e.sent.find((function(e){return e.isPrimary})),e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),this.capture=function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.callGD(no.Capture,u({},t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.captureAll=function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.callGD(no.CaptureAll,u({},t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getMousePosition=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.callGD(no.GetMousePosition);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),this.callGD=function(){var e=s(a().mark((function e(t,n){var i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._agm.invoke(oo,{options:u({},n),command:t});case 2:return i=e.sent,e.abrupt("return",i.returned.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.decorateDisplay=function(e){var t=u(u({},e),{},{capture:function(t){return r.capture({id:e.id,size:t})}}),n=t.workArea;return n.x=n.left,n.y=t.workArea.top,t}}return g(e,[{key:"getByWindowId",value:function(e){return this.callGD(no.GetByWindowId,{id:e})}},{key:"onDisplayChanged",value:function(e){return this.register(),this._registry.add("on-display-changed",e)}},{key:"register",value:function(){var e=this;this._registered||(this._registered=!0,this._agm.register(ao,(function(t,n){var r=t.event,i=t.data;"display-changed"===r?e._registry.execute("on-display-changed",i.displays.map(e.decorateDisplay)):e._logger.warn("unknown event - ".concat(r))})))}}]),e}();function uo(e,t){return co.apply(this,arguments)}function co(){return(co=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ro=t,"undefined"!==typeof window&&window.glue42gd&&(io=window.glue42gd.windowId),io){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,ro.register("T42.Channels.Command",(function(e){var t=e.command;if(!t)throw new Error("missing command argument");if("join"!==t){if("leave"!==t){if("get"===t)return{id:n.current()};throw new Error("unknown command ".concat(t))}n.leaveNoSelectorSwitch()}else{var r=e.channel;if(!r)throw new Error("missing argument id");n.joinNoSelectorSwitch(r)}}));case 6:ro.invoke("T42.Channels.Announce",{swId:io,instance:ro.instance.instance});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lo(e,t){return po.apply(this,arguments)}function po(){return(po=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ro.invoke("T42.Channels.Announce",{swId:null!==n&&void 0!==n?n:io,command:"switchChannel",data:{newChannel:t}});case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e.Capture="capture",e.CaptureAll="captureAll",e.GetAll="getAll",e.Get="get",e.GetByWindowId="getByWindowId",e.GetMousePosition="getMousePosition"}(no||(no={}));var fo="___channel___",ho="latest_fdc3_type",vo=function(){function e(t){v(this,e),this.contexts=t}return g(e,[{key:"subscribe",value:function(e){this.callback=e}},{key:"subscribeFor",value:function(e,t){if(!this.isChannel(e))return Promise.reject(new Error("Channel with name: ".concat(e," doesn't exist!")));var n=this.createContextName(e);return this.contexts.subscribe(n,(function(e,n,r,i,o){t(e.data,e,null===o||void 0===o?void 0:o.updaterId)}))}},{key:"switchChannel",value:function(){var e=s(a().mark((function e(t){var n,r=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.unsubscribe(),n=this.createContextName(t),e.next=4,this.contexts.subscribe(n,(function(e,t,n,i,o){r.callback&&r.callback(e.data,e,null===o||void 0===o?void 0:o.updaterId)}));case 4:this.unsubscribeFunc=e.sent;case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"leave",value:function(){this.callback&&this.callback({},void 0),this.unsubscribe()}},{key:"all",value:function(){return this.contexts.all().filter((function(e){return e.startsWith(fo)})).map((function(e){return e.substr(fo.length)}))}},{key:"getContextData",value:function(e){var t=this;return new Promise((function(n,i){if(!t.isChannel(e))return i(new Error("A channel with name: ".concat(e," doesn't exist!")));var o=t.createContextName(e);t.contexts.subscribe(o,(function(e){if(e[ho]){e.latest_fdc3_type;var t=r(e,y);n(t)}n(e)})).then((function(e){return e()}))}))}},{key:"updateChannel",value:function(e,t){var n=this.createContextName(e);return this.contexts.update(n,t)}},{key:"updateData",value:function(e,t){var n=this.createContextName(e),r=this.getFDC3Type(t);if(this.contexts.setPathSupported){var i=Object.keys(t).map((function(e){return{path:"data."+e,value:t[e]}}));return r&&i.push({path:ho,value:r}),this.contexts.setPaths(n,i)}return r&&(t[ho]=r),this.contexts.update(n,{data:t})}},{key:"isChannel",value:function(e){return this.all().some((function(t){return t===e}))}},{key:"unsubscribe",value:function(){this.unsubscribeFunc&&this.unsubscribeFunc()}},{key:"createContextName",value:function(e){return fo+e}},{key:"getFDC3Type",value:function(e){var t=Object.keys(e).filter((function(e){return 0===e.indexOf("fdc3_")}));if(0!==t.length){if(t.length>1)throw new Error("FDC3 does not support updating of multiple context keys");return t[0].split("_").slice(1).join("_")}}}]),e}(),go=function(){function e(t,n,r,i){v(this,e),this.shared=t,this.interop=n,this.getWindows=r,this.logger=i,this.subsKey="subs",this.changedKey="changed",this.isInitialJoin=!0,this.registry=Cr(),this.pendingReplays={},this.shared.subscribe(this.handler.bind(this)),"undefined"!==typeof window&&"undefined"!==typeof window.glue42gd&&(this.currentContext=window.glue42gd.initialChannel,this.currentContext&&this.joinNoSelectorSwitch(this.currentContext))}return g(e,[{key:"subscribe",value:function(e){var t=this;if("function"!==typeof e)throw new Error("Please provide the callback as a function!");var n=Ei();if(this.pendingReplays[n]=!0,this.lastUpdate){var r=Object.assign({},this.lastUpdate);setTimeout((function(){t.pendingReplays[n]&&(t.lastUpdate&&(r=t.lastUpdate),e(r.context.data,r.context,r.updaterId)),delete t.pendingReplays[n]}),0)}var i=this.registry.add(this.subsKey,e);return function(){t.pendingReplays[n]=!1,i()}}},{key:"subscribeFor",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"===typeof t){e.next=2;break}throw new Error("Please provide the name as a string!");case 2:if("function"===typeof n){e.next=4;break}throw new Error("Please provide the callback as a function!");case 4:return e.next=6,this.shared.subscribeFor(t,n);case 6:return r=e.sent,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"publish",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"===typeof t){e.next=2;break}throw new Error("Please provide the data as an object!");case 2:if(!n){e.next=8;break}if("string"===typeof n){e.next=5;break}throw new Error("Please provide the name as a string!");case 5:if(this.shared.isChannel(n)){e.next=7;break}return e.abrupt("return",Promise.reject(new Error("A channel with name: ".concat(n," doesn't exist!"))));case 7:return e.abrupt("return",this.shared.updateData(n,t));case 8:if(this.currentContext){e.next=10;break}throw new Error("Not joined to any channel!");case 10:return e.abrupt("return",this.shared.updateData(this.currentContext,t));case 11:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"all",value:function(){var e=this.shared.all();return Promise.resolve(e)}},{key:"list",value:function(){var e=s(a().mark((function e(){var t,n,r=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.all();case 2:return t=e.sent,e.next=5,Promise.all(t.map((function(e){return r.get(e)})));case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"get",value:function(e){return"string"!==typeof e?Promise.reject(new Error("Please provide the channel name as a string!")):this.shared.getContextData(e)}},{key:"getMy",value:function(){return this.currentContext?this.get(this.currentContext):Promise.resolve(void 0)}},{key:"join",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}return e.abrupt("return",lo(t,n));case 2:return e.abrupt("return",this.joinCore(t));case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"joinNoSelectorSwitch",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.joinCore(t,!1));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"leave",value:function(e){return e?lo(void 0,e):this.leaveCore()}},{key:"leaveNoSelectorSwitch",value:function(){return this.leaveCore(!1)}},{key:"current",value:function(){return this.currentContext}},{key:"my",value:function(){return this.current()}},{key:"changed",value:function(e){var t=this;if("function"!==typeof e)throw new Error("Please provide the callback as a function!");return this.current()&&setTimeout((function(){e(t.current())}),0),this.registry.add(this.changedKey,e)}},{key:"onChanged",value:function(e){return this.changed(e)}},{key:"add",value:function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"===typeof t){e.next=2;break}throw new Error("Please provide the info as an object!");case 2:if("undefined"!==typeof t.name){e.next=4;break}throw new Error("info.name is missing!");case 4:if("string"===typeof t.name){e.next=6;break}throw new Error("Please provide the info.name as a string!");case 6:if("undefined"!==typeof t.meta){e.next=8;break}throw new Error("info.meta is missing!");case 8:if("object"===typeof t.meta){e.next=10;break}throw new Error("Please provide the info.meta as an object!");case 10:if("undefined"!==typeof t.meta.color){e.next=12;break}throw new Error("info.meta.color is missing!");case 12:if("string"===typeof t.meta.color){e.next=14;break}throw new Error("Please provide the info.meta.color as a string!");case 14:return n={name:t.name,meta:t.meta||{},data:t.data||{}},e.next=17,this.shared.updateChannel(t.name,n);case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getWindowsOnChannel",value:function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWindowsWithChannels({channels:[t]});case 2:return n=e.sent,e.abrupt("return",n.map((function(e){return e.window})));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getWindowsWithChannels",value:function(){var e=s(a().mark((function e(t){var n,r,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.interop.invoke("T42.Channels.Announce",{command:"getChannelsInfo",data:{filter:t}});case 3:if(r=e.sent,i=this.getWindows(),!(null===(n=null===r||void 0===r?void 0:r.returned)||void 0===n?void 0:n.windows)){e.next=7;break}return e.abrupt("return",r.returned.windows.map((function(e){return{window:i.findById(e.windowId),channel:e.channel,application:e.application}})));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.logger.error("Error getting all channel enabled windows. This method is available since Glue42 3.12",e.t0);case 12:return e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,this,[[0,9]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handler",value:function(e,t,n){this.lastUpdate={context:t,updaterId:n},this.pendingReplays={},this.registry.execute(this.subsKey,e,t,n)}},{key:"joinCore",value:function(){var e=s(a().mark((function e(t){var n,r,i,o=this,s=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(s.length>1&&void 0!==s[1])||s[1],"string"===typeof t){e.next=3;break}throw new Error("Please provide the channel name as a string!");case 3:if(this.isInitialJoin||t!==this.currentContext){e.next=5;break}return e.abrupt("return");case 5:if(this.isInitialJoin=!1,(r=function(e){return o.shared.all().includes(e)})(t)){e.next=11;break}return i=new Promise((function(e,n){var i,o=setInterval((function(){r(t)&&(clearTimeout(i),clearInterval(o),e())}),100);i=setTimeout((function(){return clearInterval(o),n(new Error("A channel with name: ".concat(t," doesn't exist!")))}),3e3)})),e.next=11,i;case 11:return this.currentContext=t,this.lastUpdate=void 0,e.next=15,this.shared.switchChannel(t);case 15:n&&lo(t),this.registry.execute(this.changedKey,t);case 17:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"leaveCore",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.currentContext=void 0,this.registry.execute(this.changedKey,void 0),this.shared.leave(),e&&lo(),Promise.resolve()}}]),e}();function yo(e,t,n,r){var i=new vo(e),o=new go(i,t,n,r);return uo(t,o),{subscribe:o.subscribe.bind(o),subscribeFor:o.subscribeFor.bind(o),publish:o.publish.bind(o),all:o.all.bind(o),list:o.list.bind(o),get:o.get.bind(o),join:o.join.bind(o),leave:o.leave.bind(o),current:o.current.bind(o),my:o.my.bind(o),changed:o.changed.bind(o),onChanged:o.onChanged.bind(o),add:o.add.bind(o),getWindowsOnChannel:o.getWindowsOnChannel.bind(o),getWindowsWithChannels:o.getWindowsWithChannels.bind(o),getMy:o.getMy.bind(o),ready:function(){return e.ready()}}}var mo="T42.Hotkeys.Command",wo="T42.Hotkeys.Invoke",bo="register",ko="unregister",xo="unregisterAll",_o=function(){function e(t){v(this,e),this.agm=t,this.registry=Cr(),this.firstHotkey=!0,this.hotkeys=new Map}return g(e,[{key:"register",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof t){e.next=2;break}throw new Error("Hotkey parameter missing");case 2:if("string"!==typeof t){e.next=6;break}t={hotkey:t},e.next=9;break;case 6:if(t.hotkey){e.next=8;break}throw new Error("Info's hotkey parameter missing");case 8:t={hotkey:t.hotkey,description:t.description};case 9:if(r=this.formatHotkey(t.hotkey),!this.hotkeys.has(r)){e.next=12;break}throw new Error("Shortcut for ".concat(r," already registered"));case 12:if(!this.firstHotkey){e.next=16;break}return this.firstHotkey=!1,e.next=16,this.registerInvokeAGMMethod();case 16:return this.registry.add(r,n),e.next=19,this.agm.invoke(mo,{command:bo,hotkey:r,description:t.description});case 19:this.hotkeys.set(r,t);case 20:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"unregister",value:function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof t){e.next=2;break}throw new Error("hotkey parameter missing");case 2:if("string"===typeof t){e.next=4;break}throw new Error("hotkey parameter must be string");case 4:return n=this.formatHotkey(t),e.next=7,this.agm.invoke(mo,{command:ko,hotkey:n});case 7:this.hotkeys.delete(n),this.registry.clearKey(n);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unregisterAll",value:function(){var e=s(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.agm.invoke(mo,{command:xo});case 2:this.hotkeys.clear(),this.registry.clear();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isRegistered",value:function(e){var t=this.formatHotkey(e);return this.hotkeys.has(t)}},{key:"registerInvokeAGMMethod",value:function(){var e=this;this.agm.register(wo,(function(t){var n=t.key.toLowerCase(),r=e.hotkeys.get(n);e.registry.execute(n,r)}))}},{key:"formatHotkey",value:function(e){if(e)return e.replace(/\s/g,"").toLowerCase()}}]),e}();function So(e){var t=new _o(e);return{register:t.register.bind(t),unregister:t.unregister.bind(t),unregisterAll:t.unregisterAll.bind(t),isRegistered:t.isRegistered.bind(t),ready:function(){return Promise.resolve()}}}var Io="5.16.1",Co=function(e){function t(e,t,r){if("boolean"!==typeof e||e){var i=n(e,t,r);return"object"===typeof e?(e.mode=i,e):{mode:i}}}function n(e,t,r){return"object"===typeof e?n(e.mode,t,r)+"":"undefined"===typeof e?"boolean"!==typeof t||t?t+"":void 0:"boolean"===typeof e?e?(void 0===r?t:r)+"":void 0:e+""}var r=!1,i="startOnly",o="trackMyTypeAndInitiatedFromMe",a="slim",s="boolean"!==typeof e.exposeGlue||e.exposeGlue;return{layouts:t(e.layouts,a),activities:t(e.activities,o),appManager:t(e.appManager,r,i),windows:t(e.windows,!0),channels:t(e.channels||!1,!1),displays:t(e.displays,!0),exposeGlue:s}},To=function(){function e(t){v(this,e),this.options=t,this.callbacks=Cr(),this.actions=t.actions,this.body=t.body,this.badge=t.badge,this.data=t.data,this.dir=t.dir,this.icon=t.icon,this.image=t.image,this.lang=t.lang,this.renotify=t.renotify,this.requireInteraction=t.requireInteraction,this.silent=t.silent,this.tag=t.tag,this.timestamp=t.timestamp,this.title=t.title}return g(e,[{key:"close",value:function(){throw new Error("Method not implemented.")}},{key:"addEventListener",value:function(e,t,n){this.callbacks.add(e,t)}},{key:"removeEventListener",value:function(e,t,n){}},{key:"dispatchEvent",value:function(e){return this.callbacks.execute(e.type,e),!0}}]),e}(),Ao=function(){function e(t){v(this,e),this.interop=t}return g(e,[{key:"toggle",value:function(){return this.interop.invoke("T42.Notifications.Show")}},{key:"show",value:function(){return this.interop.invoke("T42.Notifications.Show",{show:!0})}},{key:"hide",value:function(){return this.interop.invoke("T42.Notifications.Hide")}},{key:"isVisible",value:function(){throw new Error("Method not implemented.")}}]),e}(),Eo=0,Po=function(){function e(t){v(this,e),this.interop=t,this.methodsRegistered=!1,this.NOTIFICATIONS_CONFIGURE_METHOD_NAME="T42.Notifications.Configure",this.methodNameRoot="T42.Notifications.Handler-"+Ei(),this.nextId=0,this.notifications={},this.panel=new Ao(t)}return g(e,[{key:"maxActions",get:function(){return 2}},{key:"raise",value:function(){var e=s(a().mark((function e(t){var n,r,i,o,s,u,l,d,p,f,h,v,g,y,m,w,b=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("invalid options - should be an object");case 2:if(t.title){e.next=4;break}throw new Error("invalid options - should have title");case 4:if(this.methodsRegistered){e.next=10;break}for(s=[],u=Eo;u<this.maxActions;u++)s.push(this.interop.register(this.methodNameRoot+"_"+u,this.handleNotificationAction.bind(this)));return e.next=9,Promise.all(s);case 9:this.methodsRegistered=!0;case 10:if(l=String(this.nextId++),d=null!==(n=t.type)&&void 0!==n?n:"Notification",p={title:t.title,type:d,severity:null!==(r=t.severity)&&void 0!==r?r:"None",description:t.body,glueRoutingDetailMethodName:this.methodNameRoot+"_"+Eo,actions:[],sourceId:l,source:t.source},t.actions){f=t.actions.slice(0,this.maxActions),h=Eo,v=c(f);try{for(y=function(){var e=g.value,t={g42notificationId:l,g42action:e.action,g42interopMethod:null===(i=e.interop)||void 0===i?void 0:i.method,g42interopTarget:null===(o=e.interop)||void 0===o?void 0:o.target},n=Object.keys(t).map((function(e){return{name:e,value:{stringValue:t[e]}}})),r={name:b.methodNameRoot+"_"+h,description:e.title,displayName:e.title,parameters:n};p.actions.push(r),h++},v.s();!(g=v.n()).done;)y()}catch(a){v.e(a)}finally{v.f()}}return t.icon&&(p.attributes=p.attributes||[],p.attributes.push({key:"icon",value:{stringValue:t.icon}})),t.data&&(p.attributes=p.attributes||[],m=JSON.stringify(t.data),p.attributes.push({key:"data",value:{stringValue:m}})),"number"===typeof t.panelExpiry&&(p.attributes=p.attributes||[],p.attributes.push({key:"panelExpiry",value:{stringValue:t.panelExpiry+""}})),"number"===typeof t.toastExpiry&&(p.attributes=p.attributes||[],p.attributes.push({key:"toastExpiry",value:{stringValue:t.toastExpiry+""}})),e.next=20,this.interop.invoke("T42.GNS.Publish.RaiseNotification",{notification:p});case 20:return w=new To(t),this.notifications[l]=w,e.abrupt("return",w);case 23:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setFilter",value:function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.interop.invoke("T42.Notifications.Filter",t);case 2:return n=e.sent,e.abrupt("return",n.returned);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFilter",value:function(){var e=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.interop.invoke("T42.Notifications.Filter");case 2:return t=e.sent,e.abrupt("return",t.returned);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"configure",value:function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&!Array.isArray(t)){e.next=2;break}throw new Error("Invalid options - should be an object.");case 2:if(0!==Object.values(t).length){e.next=4;break}throw new Error("The argument must be a non-empty object.");case 4:return Object.values(t).forEach((function(e){if(void 0!==typeof e&&"boolean"!==typeof e)throw new Error("Expected type of option values - boolean.")})),e.next=7,this.interop.invoke(this.NOTIFICATIONS_CONFIGURE_METHOD_NAME,t);case 7:return n=e.sent,e.abrupt("return",n.returned);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleNotificationAction",value:function(e){if(e.g42notificationId){var t=e,n=t.g42notificationId,r=this.notifications[n];if(!r)return;var i={type:"onaction",action:t.g42action};r.onaction&&r.onaction(i);var o=(r.actions||[]).find((function(e){return e.action===t.g42action})).interop;o&&this.interop.invoke(o.method,o.arguments||{},o.target||"best"),r.dispatchEvent(i)}else if(e.notification&&e.notification.sourceNotificationId){var a=e.notification.sourceNotificationId,s=this.notifications[a];if(!s)return;var u={type:"onclick"};s.onclick&&s.onclick(u);var c=s.options.clickInterop;c&&this.interop.invoke(c.method,c.arguments||{},c.target||"best"),s.dispatchEvent(u)}}}]),e}(),Mo="T42.Themes.Configuration",Ro=function(){function e(t){v(this,e),this.core=t,this.registry=Cr(),this.isSubscribed=!1,this.getConfiguration()}return g(e,[{key:"list",value:function(){var e=s(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getConfiguration();case 2:if(this.getMethodName){e.next=4;break}throw new Error("not supported");case 4:return e.next=6,this.getAll();case 6:return e.abrupt("return",e.sent.returned.all);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getCurrent",value:function(){var e=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getConfiguration();case 2:if(this.getMethodName){e.next=4;break}throw new Error("not supported");case 4:return e.next=6,this.getAll();case 6:return t=e.sent,e.abrupt("return",t.returned.all.find((function(e){return e.name===t.returned.selected})));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"select",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getConfiguration();case 2:if(this.setMethodName){e.next=4;break}throw new Error("not supported");case 4:return e.next=6,this.core.interop.invoke(this.setMethodName,{theme:t});case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onChanged",value:function(e){return this.subscribe(),this.registry.add("changed",e)}},{key:"getConfiguration",value:function(){var e=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.sharedContextName){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.core.interop.invoke(Mo);case 5:t=e.sent,this.sharedContextName=t.returned.sharedContextName,this.getMethodName=t.returned.getThemesMethodName,this.setMethodName=t.returned.setThemesMethodName,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return");case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAll",value:function(){var e=s(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getConfiguration();case 2:return e.next=4,this.core.interop.invoke(this.getMethodName);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"subscribe",value:function(){var e=s(a().mark((function e(){var t=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getConfiguration();case 2:if(!this.isSubscribed){e.next=4;break}return e.abrupt("return");case 4:this.isSubscribed=!0,this.core.contexts.subscribe(this.sharedContextName,(function(e){e&&e.all&&e.selected&&t.registry.execute("changed",e.all.find((function(t){return t.name===e.selected})))}));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}();function Oo(e){var t=new Ro(e);return{list:t.list.bind(t),getCurrent:t.getCurrent.bind(t),select:t.select.bind(t),onChanged:t.onChanged.bind(t),ready:function(){return Promise.resolve()}}}var jo="Tick42.FDC3.Intents.",No="T42.Intents.Resolver.Control",Lo=400,Do=440,Wo=["applicationName","applicationTitle","type"],Fo="intentsResolver",qo=function(){function e(t,n,r,i,o){v(this,e),this.interop=t,this.windows=n,this.logger=r,this.appManager=o,this.myIntents=new Set,this.intentsResolverResponsePromises={},this.useIntentsResolverUI=!0,this.checkIfIntentsResolverIsEnabled(i,o)}return g(e,[{key:"find",value:function(){var e=s(a().mark((function e(t){var n,r,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.all();case 2:if(n=e.sent,"undefined"!==typeof t){e.next=5;break}return e.abrupt("return",n);case 5:if("string"!==typeof t){e.next=7;break}return e.abrupt("return",n.filter((function(e){return e.name===t})));case 7:if("object"===typeof t){e.next=9;break}throw new Error("Please provide the intentFilter as a string or an object!");case 9:return t.contextType&&(r=t.contextType.toLowerCase(),n=n.filter((function(e){return e.handlers.some((function(e){var t;return null===(t=e.contextTypes)||void 0===t?void 0:t.some((function(e){return e.toLowerCase()===r}))}))}))),t.resultType&&(i=t.resultType.toLowerCase(),n=n.filter((function(e){return e.handlers.some((function(e){var t;return(null===(t=e.resultType)||void 0===t?void 0:t.toLowerCase())===i}))}))),t.name&&(n=n.filter((function(e){return e.name===t.name}))),e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"raise",value:function(){var e=s(a().mark((function e(t){var n,r,i,o,s,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("string"!==typeof t&&"object"!==typeof t||"object"===typeof t&&"string"!==typeof t.intent)){e.next=2;break}throw new Error("Please provide the intent as a string or an object with an intent property!");case 2:return"string"===typeof t&&(t={intent:t}),e.next=5,this.get(t.intent);case 5:if("undefined"!==typeof e.sent){e.next=8;break}throw new Error("Intent ".concat(t.intent," not found."));case 8:if(!t.target){e.next=11;break}return this.logger.trace("Intents Resolver won't be used. Target is provided in Intent Request - ".concat(JSON.stringify(t))),e.abrupt("return",this.raiseIntent(t));case 11:if(this.useIntentsResolverUI){e.next=14;break}return this.logger.trace("Intent Resolver is disabled. Raising intent to first found handler"),e.abrupt("return",this.raiseIntent(t));case 14:if(this.appManager.application(this.intentsResolverAppName)){e.next=18;break}return this.logger.trace("Intent Resolver Application with name ".concat(this.intentsResolverAppName," not found. Intents Resolver won't be used for handling raised intents")),e.abrupt("return",this.raiseIntent(t));case 18:return e.next=20,this.getIntentHandlers(t.intent);case 20:if(e.t0=e.sent.length,1!==e.t0){e.next=24;break}return e.abrupt("return",this.raiseIntent(t));case 24:return e.next=26,this.registerIntentResolverMethod();case 26:return n=e.sent,e.next=29,this.openIntentResolverApplication(t,n);case 29:return r=e.sent,e.next=32,this.intentsResolverResponsePromises[r.id].promise;case 32:return i=e.sent,o=i.handler,this.stopIntensResolverInstance(r.id),s="app"===o.type?{app:o.applicationName}:{instance:o.instanceId},c=u(u({},t),{},{target:s}),this.logger.trace("Intent handler chosen by the user: ".concat(JSON.stringify(s))),e.abrupt("return",this.raiseIntent(c));case 39:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"all",value:function(){var e=s(a().mark((function e(){var t,n,r,i,o,u,l,d,p,f,h,v,g,y,m,w,b,k,x,_,S=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.interop.invoke("T42.ACS.GetApplications",{withIntentsInfo:!0});case 3:n=e.sent,t=n.returned.applications,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),this.logger.error("Failed to get the applications!",e.t0),e.abrupt("return",[]);case 11:r={},i=t.filter((function(e){return e.intents&&e.intents.length>0})),o=c(i);try{for(o.s();!(u=o.n()).done;){l=u.value,d=c(l.intents);try{for(d.s();!(p=d.n()).done;)f=p.value,(h=r[f.name])||(h={name:f.name,handlers:[]},r[f.name]=h),v={applicationName:l.name,applicationTitle:l.title||"",applicationDescription:l.caption,displayName:f.displayName,contextTypes:f.contexts,applicationIcon:l.icon,type:"app",resultType:f.resultType},h.handlers.push(v)}catch(I){d.e(I)}finally{d.f()}}}catch(I){o.e(I)}finally{o.f()}if(g=this.interop.servers(),y=g.map((function(e){return e.windowId})).filter((function(e){return"undefined"!==typeof e})),m="T42.Wnd.GetInfo",!this.interop.methods().some((function(e){return e.name===m}))){e.next=29;break}return e.prev=20,e.next=23,this.interop.invoke(m,{ids:y});case 23:b=e.sent,w=b.returned.windows,e.next=29;break;case 27:e.prev=27,e.t1=e.catch(20);case 29:k=c(g),e.prev=30,_=a().mark((function e(){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x.value,e.next=3,Promise.all(n.getMethods().filter((function(e){return e.name.startsWith(jo)})).map(function(){var e=s(a().mark((function e(i){var o,s,u,c,l,d,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.name.replace(jo,""),(s=r[o])||(s={name:o,handlers:[]},r[o]=s),u=i.flags.intent,(c=t.find((function(e){return e.name===n.application})))&&c.intents&&(l=c.intents.find((function(e){return e.name===o}))),e.next=8,S.windowsIdToTitle(n.windowId,w);case 8:d=e.sent,p={instanceId:n.instance,applicationName:n.application,applicationIcon:u.icon||(null===c||void 0===c?void 0:c.icon),applicationTitle:(null===c||void 0===c?void 0:c.title)||"",applicationDescription:u.description||(null===c||void 0===c?void 0:c.caption),displayName:u.displayName||(null===l||void 0===l?void 0:l.displayName),contextTypes:u.contextTypes||(null===l||void 0===l?void 0:l.contexts),instanceTitle:d,type:"instance",resultType:(null===l||void 0===l?void 0:l.resultType)||u.resultType},s.handlers.push(p);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)})),k.s();case 33:if((x=k.n()).done){e.next=37;break}return e.delegateYield(_(),"t2",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t3=e.catch(30),k.e(e.t3);case 42:return e.prev=42,k.f(),e.finish(42);case 45:return e.abrupt("return",Object.values(r));case 46:case"end":return e.stop()}}),e,this,[[0,7],[20,27],[30,39,42,45]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"addIntentListener",value:function(e,t){var n=this;if("string"!==typeof e&&"object"!==typeof e||"object"===typeof e&&"string"!==typeof e.intent)throw new Error("Please provide the intent as a string or an object with an intent property!");if("function"!==typeof t)throw new Error("Please provide the handler as a function!");var i,o="string"===typeof e?e:e.intent,a="".concat(jo).concat(o),s={};if(this.myIntents.has(o))throw new Error("Intent listener for intent ".concat(o," already registered!"));this.myIntents.add(o);var u={unsubscribe:function(){n.myIntents.delete(o),i.then((function(){return n.interop.unregister(a)})).catch((function(e){return n.logger.trace("Unregistration of a method with name ".concat(a," failed with reason: ").concat(e))}))}};return"object"===typeof e&&(e.intent,s=r(e,m)),(i=this.interop.register({name:a,flags:{intent:s}},(function(e){if(n.myIntents.has(o))return t(e)}))).catch((function(e){n.myIntents.delete(o),n.logger.warn("Registration of a method with name ".concat(a," failed with reason: ").concat(e))})),u}},{key:"get",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.all();case 2:return e.abrupt("return",e.sent.find((function(e){return e.name===t})));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"raiseIntent",value:function(){var e=s(a().mark((function e(t){var n,r,i,o,s,u,c,l,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.intent,e.next=3,this.get(n);case 3:if("undefined"!==typeof(r=e.sent)){e.next=6;break}throw new Error("Intent ".concat(n," not found."));case 6:if(i=!r.handlers.some((function(e){return"app"===e.type})),o=t.target||(i?"reuse":"startNew"),u=r.handlers.find((function(e){return"app"===e.type})),"startNew"!==o){e.next=13;break}s=u,e.next=27;break;case 13:if("reuse"!==o){e.next=18;break}c=r.handlers.find((function(e){return"instance"===e.type})),s=c||u,e.next=27;break;case 18:if(!o.instance){e.next=22;break}s=r.handlers.find((function(e){return"instance"===e.type&&e.instanceId===o.instance})),e.next=27;break;case 22:if(!o.app){e.next=26;break}s=r.handlers.find((function(e){return"app"===e.type&&e.applicationName===o.app})),e.next=27;break;case 26:throw new Error("Invalid intent target: ".concat(JSON.stringify(o)));case 27:if(s){e.next=29;break}throw new Error("Can not raise intent for request ".concat(JSON.stringify(t)," - can not find intent handler."));case 29:if(l=s.instanceId,"app"!==s.type){e.next=34;break}return e.next=33,this.invokeStartApp(s.applicationName,t.context,t.options);case 33:l=e.sent;case 34:return e.next=36,this.raiseIntentToInstance(l,n,t.context);case 36:return(d=e.sent).request=t,d.handler=s,e.abrupt("return",d);case 40:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"raiseIntentToInstance",value:function(){var e=s(a().mark((function e(t,n,r){var i,o,s,u=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i="".concat(jo).concat(n),o=this.interop.servers().find((function(e){return e.instance===t}))){e.next=5;break}return e.next=5,new Promise((function(e,n){var r,i=u.interop.serverAdded((function(n){n.instance===t&&(o=n,e(),clearTimeout(r),i())}));r=setTimeout((function(){i(),n(new Error("Can not find interop server for instance ".concat(t)))}),3e4)}));case 5:if(o.getMethods().find((function(e){return e.name===i}))){e.next=9;break}return e.next=9,new Promise((function(e,n){var r,o=u.interop.methodAdded((function(t){t.name===i&&(e(),clearTimeout(r),o())}));r=setTimeout((function(){o(),n(new Error("Can not find interop method ".concat(i," for instance ").concat(t)))}),12e4)}));case 9:return e.next=11,this.interop.invoke(i,r,{instance:t});case 11:return s=e.sent,this.windows.findById(t).focus(),e.abrupt("return",{result:s.returned});case 15:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"windowsIdToTitle",value:function(){var e=s(a().mark((function e(t,n){var r,i,o,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"===typeof n){e.next=2;break}return e.abrupt("return",null===(r=n.find((function(e){return e.id===t})))||void 0===r?void 0:r.title);case 2:return o=null===(i=this.windows)||void 0===i?void 0:i.findById(t),e.next=5,null===o||void 0===o?void 0:o.getTitle();case 5:return s=e.sent,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"openIntentResolverApplication",value:function(){var e=s(a().mark((function e(t,n){var r,i,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={intent:t.intent,callerId:this.interop.instance.instance,methodName:n},e.next=3,this.composeStartOptions();case 3:return i=e.sent,e.next=6,this.appManager.application(this.intentsResolverAppName).start(r,i);case 6:return o=e.sent,this.subscribeOnInstanceStopped(o),this.createResponsePromise(t.intent,o.id,n),e.abrupt("return",o);case 10:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"registerIntentResolverMethod",value:function(){var e=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=No+Ei(),e.next=3,this.interop.register(t,this.resolverResponseHandler.bind(this));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"resolverResponseHandler",value:function(e,t){var n=t.instance,r=this.validateIntentsResolverResponse(e);r||(this.logger.trace("Intent Resolver sent invalid response. Error: ".concat(r.error)),this.intentsResolverResponsePromises[n].reject(r.error),this.stopIntensResolverInstance(n));var i=r.ok;this.intentsResolverResponsePromises[n].resolve(i),this.cleanUpIntentResolverPromise(n)}},{key:"composeStartOptions",value:function(){var e=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.windows.my().getBounds();case 2:return t=e.sent,e.abrupt("return",{top:(t.height-Do)/2+t.top,left:(t.width-Lo)/2+t.left});case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"createResponsePromise",value:function(e,t,n){var r,i,o=new Promise((function(e,t){r=e,i=t}));this.intentsResolverResponsePromises[t]={intent:e,resolve:r,reject:i,promise:o,methodName:n}}},{key:"invokeStartApp",value:function(){var e=s(a().mark((function e(t,n,r){var i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.interop.invoke("T42.ACS.StartApplication",{Name:t,options:r});case 2:return i=e.sent,e.abrupt("return",i.returned.Id);case 4:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"subscribeOnInstanceStopped",value:function(e){var t=this,n=e.onStopped((function(e){var r=t.intentsResolverResponsePromises[e.id];if(!r)return n();r.reject("Cannot resolve raise intent ".concat(r.intent," - User closed ").concat(t.intentsResolverAppName," app without choosing an intent handler")),t.cleanUpIntentResolverPromise(e.id),n()}))}},{key:"getIntentHandlers",value:function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find(t);case 2:return n=e.sent,e.abrupt("return",n.reduce((function(e,t){return e.concat.apply(e,o(t.handlers))}),[]));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"cleanUpIntentResolverPromise",value:function(){var e=s(a().mark((function e(t){var n,r=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.intentsResolverResponsePromises[t]){e.next=3;break}return e.abrupt("return");case 3:this.interop.unregister(n.methodName).catch((function(e){return r.logger.warn(e)})),delete this.intentsResolverResponsePromises[t];case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"validateIntentsResolverResponse",value:function(e){if(Object.keys(e).some((function(e){return"intent"!==e&&"handler"!==e})))return{isValid:!1,error:"Response is not a valid object. Expected { intent: string, handler: IntentHandler }"};if("string"!==typeof e.intent)return{isValid:!1,error:"Response object has invalid 'intent' key. Expected a string, got ".concat(typeof e.intent)};if("object"!==typeof e.handler)return{isValid:!1,error:"Response object has invalid 'handler' key. Expected an object, got ".concat(typeof e.handler)};var t=Wo.every((function(t){return t in e.handler}));return t?{isValid:!0,ok:{intent:e.intent,handler:u({},e.handler)}}:{isValid:!1,error:"Handler in Response object does not provide the compulsory key: ".concat(t)}}},{key:"stopIntensResolverInstance",value:function(e){var t=this,n=this.appManager.application(this.intentsResolverAppName).instances.find((function(t){return t.id===e}));n&&n.stop().catch((function(e){return t.logger.error(e)}))}},{key:"checkIfIntentsResolverIsEnabled",value:function(e,t){var n,r,i;t?(this.useIntentsResolverUI="boolean"!==typeof(null===(n=e.intents)||void 0===n?void 0:n.enableIntentsResolverUI)||e.intents.enableIntentsResolverUI,this.intentsResolverAppName=null!==(i=null===(r=e.intents)||void 0===r?void 0:r.intentsResolverAppName)&&void 0!==i?i:Fo):this.useIntentsResolverUI=!1}}]),e}(),Uo=function(){function e(){v(this,e),this.initialized=!1,this.details=[],this.reject=function(){},this.resolve=function(){}}return g(e,[{key:"init",value:function(e){var t=this;this.initialized=!0,this.addCall(e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}},{key:"addCall",value:function(e){this.details.push({date:new Date,config:e})}},{key:"done",value:function(e){this.resolve(e)}},{key:"error",value:function(e){this.reject(e)}}]),e}(),zo=function(){function e(t,n){v(this,e),this.appName=t,this.interop=n,this.registry=Cr(),this.interopMethodRegistered=!1}return g(e,[{key:"get",value:function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.interop.invoke("T42.Prefs.Get",{app:null!==t&&void 0!==t?t:this.appName});case 2:return n=e.sent,e.abrupt("return",n.returned);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"set",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyDataObject(t),e.next=3,this.interop.invoke("T42.Prefs.Set",{app:null!==(r=null===n||void 0===n?void 0:n.app)&&void 0!==r?r:this.appName,data:t,merge:!1});case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"setFor",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyApp(t),this.verifyDataObject(n),e.abrupt("return",this.set(n,{app:t}));case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"update",value:function(){var e=s(a().mark((function e(t,n){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyDataObject(t),e.next=3,this.interop.invoke("T42.Prefs.Set",{app:null!==(r=null===n||void 0===n?void 0:n.app)&&void 0!==r?r:this.appName,data:t,merge:!0});case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"updateFor",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyApp(t),this.verifyDataObject(n),e.abrupt("return",this.update(n,{app:t}));case 3:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"clear",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.interop.invoke("T42.Prefs.Set",{app:null!==t&&void 0!==t?t:this.appName,clear:!0});case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"clearFor",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyApp(t),e.next=3,this.interop.invoke("T42.Prefs.Set",{app:t,clear:!0});case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getAll",value:function(){var e=s(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.interop.invoke("T42.Prefs.Get");case 2:return t=e.sent,e.abrupt("return",t.returned);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clearAll",value:function(){var e=s(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.interop.invoke("T42.Prefs.Set",{clear:!0});case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"subscribe",value:function(e){return this.verifyCallback(e),this.subscribeFor(this.appName,e)}},{key:"subscribeFor",value:function(e,t){var n=this;this.verifyApp(e),this.verifyCallback(t);var r=this.registry.add(e,t);return this.registerInteropIfNeeded().then((function(){n.interop.invoke("T42.Prefs.Get",{app:e,subscribe:!0})})),function(){r()}}},{key:"registerInteropIfNeeded",value:function(){var e=s(a().mark((function e(){var t=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.interopMethodRegistered){e.next=2;break}return e.abrupt("return");case 2:return this.interopMethodRegistered=!0,e.next=5,this.interop.register("T42.Prefs.Update",(function(e){t.registry.execute(e.app,e)}));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"verifyApp",value:function(e){if(!e)throw new Error("app should be defined");if(!Xt(e))throw new Error("app should be a string")}},{key:"verifyDataObject",value:function(e){if(!e)throw new Error("data should be defined");if(!Zt(e))throw new Error("data should be an object")}},{key:"verifyCallback",value:function(e){if(!an(e))throw new Error("callback should be defined")}}]),e}(),Go=function(){function e(t,n){v(this,e),this.methodName=t,this.interop=n}return g(e,[{key:"get",value:function(){var e=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.invoke("get-cookies",{filter:t});case 2:return n=e.sent,e.abrupt("return",n.returned.cookies);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"set",value:function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCookieObject(t),e.next=3,this.invoke("set-cookie",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"remove",value:function(){var e=s(a().mark((function e(t,n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xt(t)){e.next=2;break}throw new Error("url should be a string");case 2:if(Xt(n)){e.next=4;break}throw new Error("name should be a string");case 4:return e.next=6,this.invoke("remove-cookie",{url:t,name:n});case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"invoke",value:function(e,t){return this.interop.invoke(this.methodName,{command:e,args:t})}},{key:"verifyCookieObject",value:function(e){if(!e)throw new Error("cookie should be defined");if(!Zt(e))throw new Error("cookie should be an object")}}]),e}();function Bo(e,t){var n=new Go(t,e);return{get:n.get.bind(n),remove:n.remove.bind(n),set:n.set.bind(n),ready:function(){return Promise.resolve()}}}var Ho=function(){function e(t){v(this,e),this.config=t,this.glue42EventName="Glue42",this.events={notifyStarted:{name:"notifyStarted",handle:this.handleNotifyStarted.bind(this)},requestGlue:{name:"requestGlue",handle:this.handleRequestGlue.bind(this)}}}return g(e,[{key:"start",value:function(e){Ni.isNode()||(this.glue=e,this.wireCustomEventListener(),this.announceStarted())}},{key:"wireCustomEventListener",value:function(){var e=this;window.addEventListener(this.glue42EventName,(function(t){var n=t.detail;if(n&&n.glue42){var r=n.glue42.event,i=e.events[r];i&&i.handle(n.glue42.message)}}))}},{key:"announceStarted",value:function(){this.send("start")}},{key:"handleRequestGlue",value:function(){this.config.exposeGlue?this.send("requestGlueResponse",{glue:this.glue}):this.send("requestGlueResponse",{error:"Will not give access to the underlying Glue API, because it was explicitly denied upon initialization."})}},{key:"handleNotifyStarted",value:function(){this.announceStarted()}},{key:"send",value:function(e,t){var n={glue42:{event:e,message:t}},r=new CustomEvent(this.glue42EventName,{detail:n});window.dispatchEvent(r)}}]),e}(),Vo=new Uo,Jo=function(){var e=s(a().mark((function e(t){var n,r,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!1,Vo.initialized||(n=!0,Vo.init(t)),!(r="undefined"!==typeof window&&window.glue42gd)){e.next=7;break}if(n){e.next=7;break}return Vo.addCall(t),e.abrupt("return",Vo.promise);case 7:return e.next=9,Ko(t,r);case 9:return i=e.sent,Vo.resolve(i),e.abrupt("return",i);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ko=function(){var e=s(a().mark((function e(t,n){var r,i,o,s,u,c,l,d,p,f,h,v,g,y,m,w,b,k,x,_,S,I,C,T,A,E;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A=function(e){T.push(e)},I=function(e,t,n){var r=t.subLogger(e);if(n&&n.logger){var i=n.logger;i.console&&r.consoleLevel(i.console),i.publish&&r.publishLevel(i.publish)}return r},S=function(e){var t=Bo(e.interop,r);return A(t),t},_=function(e){var r,i,o=null!==(i=null!==(r=t.application)&&void 0!==r?r:null===n||void 0===n?void 0:n.application)&&void 0!==i?i:e.interop.instance.application,a=new zo(o,e.interop);return A(a),a},x=function(e){if(e.contexts){var t=Oo(e);return A(t),t}},k=function(e){if(o.displays){var t=I("displays",e.logger,o.displays);return l=new so(e.agm,t),A(l),l}},b=function(e){var t=new Po(e.interop);return A(t),t},w=function(e){var n=new qo(e.agm,c,e.logger.subLogger("intents"),t,s);return A(n),n},m=function(e){var t=So(e.agm);return A(t),t},y=function(e){if(o.channels&&e.contexts){var t=I("channels",e.logger,o.channels);return d=yo(e.contexts,e.agm,(function(){return c}),t),A(d),d}},g=function(e){var t;if(o.layouts){var n=I("layouts",e.logger,o.layouts),r=o.layouts,a=to({agm:e.agm,appManager:s,activityGetter:function(){return u},logger:n,mode:r.mode,autoSaveWindowContext:null!==(t=r.autoSaveWindowContext)&&void 0!==t&&t,gdMajorVersion:i});return A(a),a}},v=function(e){if(o.appManager){var t=I("appManager",e.logger,o.appManager);return s=Qr({agm:e.agm,windows:c,logger:t,activities:u,mode:o.appManager.mode,gdMajorVersion:i}),A(s),s}},h=function(e){var t;if(o.activities&&ur.checkIsUsingGW3Implementation&&ur.checkIsUsingGW3Implementation(e.connection)){var r=I("activity",e.logger,o.activities);return u=new ur({connection:e.connection,contexts:e.contexts,agm:e.agm,logger:r,logLevel:"info",disableAutoAnnounce:!1,disposeRequestHandling:"exit",announcementInfo:null,windows:c,appManagerGetter:function(){return s},mode:o.activities.mode,typesToTrack:o.activities.typesToTrack,activityId:null===(t=null===n||void 0===n?void 0:n.activityInfo)||void 0===t?void 0:t.activityId,gdMajorVersion:i}).api,A(u),u}},f=function(e){if(o.windows){var t=I("windows",e.logger,o.windows);return c=Ji(e.agm,t,(function(){return s}),(function(){return l}),(function(){return d}),i),A(c),c}},r="T42.GD.Execute",i=Ni.getGDMajorVersion(),o=Co(t=t||{}),t.gateway=t.gateway||{},p=new Ho(o),C={libs:[{name:"windows",create:f},{name:"activities",create:h},{name:"appManager",create:v},{name:"layouts",create:g},{name:"channels",create:y},{name:"hotkeys",create:m},{name:"displays",create:k},{name:"intents",create:w},{name:"notifications",create:b},{name:"themes",create:x},{name:"prefs",create:_},{name:"cookies",create:S}],version:Io,enrichGlue:function(e){e.config.activities=o.activities,e.config.windows=o.windows,e.config.appManager=o.appManager,e.config.layouts=o.layouts,e.config.channels=o.channels,e.config.displays=o.displays}},T=[],"undefined"!==typeof window&&(window.glueFactoryLog||(window.glueFactoryLog=[]),window.glueFactoryLog.push(T)),e.next=25,Qt(t,C);case 25:if(E=e.sent,!Array.isArray(null===t||void 0===t?void 0:t.libraries)||!t.libraries.length){e.next=29;break}return e.next=29,Promise.all(t.libraries.map((function(e){return e(E,t)})));case 29:return p.start(E),e.abrupt("return",E);case 31:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();Jo.coreVersion=Qt.version,Jo.version=Io,Jo.calls=Vo;var Qo=Jo,$o=!0;if("undefined"!==typeof window){var Yo=window.glue42gd;Yo&&Yo.autoInjected&&(Qo=window.Glue,$o=!1),$o&&(window.Glue=Qo),delete window.GlueCore}return Qo.default=Qo,Qo}()},888:function(e,t,n){"use strict";var r=n(47);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,o,a){if(a!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return n.PropTypes=n,n}},7:function(e,t,n){e.exports=n(888)()},47:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},463:function(e,t,n){"use strict";var r=n(791),i=n(296);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)a.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,p=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},h={};function v(e,t,n,r,i,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function m(e){return e[1].toUpperCase()}function w(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(h,e)||!d.call(f,e)&&(p.test(e)?h[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,m);g[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,m);g[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,m);g[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),x=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),T=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var O=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var j=Symbol.iterator;function N(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=j&&e[j]||e["@@iterator"])?e:null}var L,D=Object.assign;function W(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var F=!1;function q(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),o=r.stack.split("\n"),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||i[a]!==o[s]){var u="\n"+i[a].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=a&&0<=s);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?W(e):""}function U(e){switch(e.tag){case 5:return W(e.type);case 16:return W("Lazy");case 13:return W("Suspense");case 19:return W("SuspenseList");case 0:case 2:case 15:return e=q(e.type,!1);case 11:return e=q(e.type.render,!1);case 1:return e=q(e.type,!0);default:return""}}function z(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case x:return"Portal";case I:return"Profiler";case S:return"StrictMode";case E:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case M:return null!==(t=e.displayName||null)?t:z(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return z(e(t))}catch(n){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return z(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function B(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function V(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return D({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function $(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=B(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&w(e,"checked",t,!1)}function X(e,t){Y(e,t);var n=B(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,B(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+B(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return D({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:B(n)}}function oe(e,t){var n=B(t.value),r=B(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,le,de=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function pe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},he=["Webkit","ms","Moz","O"];function ve(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=ve(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(fe).forEach((function(e){he.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ye=D({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function me(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function we(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var xe=null,_e=null,Se=null;function Ie(e){if(e=wi(e)){if("function"!==typeof xe)throw Error(o(280));var t=e.stateNode;t&&(t=ki(t),xe(e.stateNode,e.type,t))}}function Ce(e){_e?Se?Se.push(e):Se=[e]:_e=e}function Te(){if(_e){var e=_e,t=Se;if(Se=_e=null,Ie(e),t)for(e=0;e<t.length;e++)Ie(t[e])}}function Ae(e,t){return e(t)}function Ee(){}var Pe=!1;function Me(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return Ae(e,t,n)}finally{Pe=!1,(null!==_e||null!==Se)&&(Ee(),Te())}}function Re(e,t){var n=e.stateNode;if(null===n)return null;var r=ki(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Oe=!1;if(l)try{var je={};Object.defineProperty(je,"passive",{get:function(){Oe=!0}}),window.addEventListener("test",je,je),window.removeEventListener("test",je,je)}catch(le){Oe=!1}function Ne(e,t,n,r,i,o,a,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Le=!1,De=null,We=!1,Fe=null,qe={onError:function(e){Le=!0,De=e}};function Ue(e,t,n,r,i,o,a,s,u){Le=!1,De=null,Ne.apply(qe,arguments)}function ze(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Be(e){if(ze(e)!==e)throw Error(o(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=ze(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return Be(i),e;if(a===r)return Be(i),t;a=a.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=a;else{for(var s=!1,u=i.child;u;){if(u===n){s=!0,n=i,r=a;break}if(u===r){s=!0,r=i,n=a;break}u=u.sibling}if(!s){for(u=a.child;u;){if(u===n){s=!0,n=a,r=i;break}if(u===r){s=!0,r=a,n=i;break}u=u.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?Ve(e):null}function Ve(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ve(e);if(null!==t)return t;e=e.sibling}return null}var Je=i.unstable_scheduleCallback,Ke=i.unstable_cancelCallback,Qe=i.unstable_shouldYield,$e=i.unstable_requestPaint,Ye=i.unstable_now,Xe=i.unstable_getCurrentPriorityLevel,Ze=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,ot=null;var at=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var ct=64,lt=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~i;0!==s?r=dt(s):0!==(o&=a)&&(r=dt(o))}else 0!==(a=n&~i)?r=dt(a):0!==o&&(r=dt(o));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&0!==(4194240&o)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-at(t)),r|=e[n],t&=~i;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ht(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function mt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-at(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var wt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var kt,xt,_t,St,It,Ct=!1,Tt=[],At=null,Et=null,Pt=null,Mt=new Map,Rt=new Map,Ot=[],jt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":Et=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":Mt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function Lt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=wi(t))&&xt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Dt(e){var t=mi(e.target);if(null!==t){var n=ze(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void It(e.priority,(function(){_t(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Wt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=wi(n))&&xt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Ft(e,t,n){Wt(e)&&n.delete(t)}function qt(){Ct=!1,null!==At&&Wt(At)&&(At=null),null!==Et&&Wt(Et)&&(Et=null),null!==Pt&&Wt(Pt)&&(Pt=null),Mt.forEach(Ft),Rt.forEach(Ft)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,qt)))}function zt(e){function t(t){return Ut(t,e)}if(0<Tt.length){Ut(Tt[0],e);for(var n=1;n<Tt.length;n++){var r=Tt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==At&&Ut(At,e),null!==Et&&Ut(Et,e),null!==Pt&&Ut(Pt,e),Mt.forEach(t),Rt.forEach(t),n=0;n<Ot.length;n++)(r=Ot[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ot.length&&null===(n=Ot[0]).blockedOn;)Dt(n),null===n.blockedOn&&Ot.shift()}var Gt=b.ReactCurrentBatchConfig,Bt=!0;function Ht(e,t,n,r){var i=wt,o=Gt.transition;Gt.transition=null;try{wt=1,Jt(e,t,n,r)}finally{wt=i,Gt.transition=o}}function Vt(e,t,n,r){var i=wt,o=Gt.transition;Gt.transition=null;try{wt=4,Jt(e,t,n,r)}finally{wt=i,Gt.transition=o}}function Jt(e,t,n,r){if(Bt){var i=Qt(e,t,n,r);if(null===i)Br(e,t,r,Kt,n),Nt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return At=Lt(At,e,t,n,r,i),!0;case"dragenter":return Et=Lt(Et,e,t,n,r,i),!0;case"mouseover":return Pt=Lt(Pt,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return Mt.set(o,Lt(Mt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Rt.set(o,Lt(Rt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Nt(e,r),4&t&&-1<jt.indexOf(e)){for(;null!==i;){var o=wi(i);if(null!==o&&kt(o),null===(o=Qt(e,t,n,r))&&Br(e,t,r,Kt,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else Br(e,t,r,null,n)}}var Kt=null;function Qt(e,t,n,r){if(Kt=null,null!==(e=mi(e=ke(r))))if(null===(t=ze(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function $t(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Yt=null,Xt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Xt,r=n.length,i="value"in Yt?Yt.value:Yt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return Zt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,i,o){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return D(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=on(cn),dn=D({},cn,{view:0,detail:0}),pn=on(dn),fn=D({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:In,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(an=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=an=0,un=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),hn=on(fn),vn=on(D({},fn,{dataTransfer:0})),gn=on(D({},dn,{relatedTarget:0})),yn=on(D({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),mn=D({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),wn=on(mn),bn=on(D({},cn,{data:0})),kn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_n={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=_n[e])&&!!t[e]}function In(){return Sn}var Cn=D({},dn,{key:function(e){if(e.key){var t=kn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:In,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=on(Cn),An=on(D({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),En=on(D({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:In})),Pn=on(D({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Mn=D({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rn=on(Mn),On=[9,13,27,32],jn=l&&"CompositionEvent"in window,Nn=null;l&&"documentMode"in document&&(Nn=document.documentMode);var Ln=l&&"TextEvent"in window&&!Nn,Dn=l&&(!jn||Nn&&8<Nn&&11>=Nn),Wn=String.fromCharCode(32),Fn=!1;function qn(e,t){switch(e){case"keyup":return-1!==On.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var zn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function Hn(e,t,n,r){Ce(r),0<(t=Vr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Vn=null,Jn=null;function Kn(e){Wr(e,0)}function Qn(e){if(J(bi(e)))return e}function $n(e,t){if("change"===e)return t}var Yn=!1;if(l){var Xn;if(l){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Xn=Zn}else Xn=!1;Yn=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){Vn&&(Vn.detachEvent("onpropertychange",nr),Jn=Vn=null)}function nr(e){if("value"===e.propertyName&&Qn(Jn)){var t=[];Hn(t,Jn,e,ke(e)),Me(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Jn=n,(Vn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Jn)}function or(e,t){if("click"===e)return Qn(t)}function ar(e,t){if("input"===e||"change"===e)return Qn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!sr(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function hr(e){var t=pr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=lr(n,o);var a=lr(n,r);i&&a&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vr=l&&"documentMode"in document&&11>=document.documentMode,gr=null,yr=null,mr=null,wr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;wr||null==gr||gr!==K(r)||("selectionStart"in(r=gr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},mr&&ur(mr,r)||(mr=r,0<(r=Vr(yr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function kr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var xr={animationend:kr("Animation","AnimationEnd"),animationiteration:kr("Animation","AnimationIteration"),animationstart:kr("Animation","AnimationStart"),transitionend:kr("Transition","TransitionEnd")},_r={},Sr={};function Ir(e){if(_r[e])return _r[e];if(!xr[e])return e;var t,n=xr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Sr)return _r[e]=n[t];return e}l&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete xr.animationend.animation,delete xr.animationiteration.animation,delete xr.animationstart.animation),"TransitionEvent"in window||delete xr.transitionend.transition);var Cr=Ir("animationend"),Tr=Ir("animationiteration"),Ar=Ir("animationstart"),Er=Ir("transitionend"),Pr=new Map,Mr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rr(e,t){Pr.set(e,t),u(t,[e])}for(var Or=0;Or<Mr.length;Or++){var jr=Mr[Or];Rr(jr.toLowerCase(),"on"+(jr[0].toUpperCase()+jr.slice(1)))}Rr(Cr,"onAnimationEnd"),Rr(Tr,"onAnimationIteration"),Rr(Ar,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(Er,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nr));function Dr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,s,u,c){if(Ue.apply(this,arguments),Le){if(!Le)throw Error(o(198));var l=De;Le=!1,De=null,We||(We=!0,Fe=l)}}(r,t,void 0,e),e.currentTarget=null}function Wr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==o&&i.isPropagationStopped())break e;Dr(i,s,c),o=u}else for(a=0;a<r.length;a++){if(u=(s=r[a]).instance,c=s.currentTarget,s=s.listener,u!==o&&i.isPropagationStopped())break e;Dr(i,s,c),o=u}}}if(We)throw e=Fe,We=!1,Fe=null,e}function Fr(e,t){var n=t[vi];void 0===n&&(n=t[vi]=new Set);var r=e+"__bubble";n.has(r)||(Gr(t,e,2,!1),n.add(r))}function qr(e,t,n){var r=0;t&&(r|=4),Gr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function zr(e){if(!e[Ur]){e[Ur]=!0,a.forEach((function(t){"selectionchange"!==t&&(Lr.has(t)||qr(t,!1,e),qr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,qr("selectionchange",!1,t))}}function Gr(e,t,n,r){switch($t(t)){case 1:var i=Ht;break;case 4:i=Vt;break;default:i=Jt}n=i.bind(null,t,n,e),i=void 0,!Oe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Br(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var u=a.tag;if((3===u||4===u)&&((u=a.stateNode.containerInfo)===i||8===u.nodeType&&u.parentNode===i))return;a=a.return}for(;null!==s;){if(null===(a=mi(s)))return;if(5===(u=a.tag)||6===u){r=o=a;continue e}s=s.parentNode}}r=r.return}Me((function(){var r=o,i=ke(n),a=[];e:{var s=Pr.get(e);if(void 0!==s){var u=ln,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=Tn;break;case"focusin":c="focus",u=gn;break;case"focusout":c="blur",u=gn;break;case"beforeblur":case"afterblur":u=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=hn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=vn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=En;break;case Cr:case Tr:case Ar:u=yn;break;case Er:u=Pn;break;case"scroll":u=pn;break;case"wheel":u=Rn;break;case"copy":case"cut":case"paste":u=wn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=An}var l=0!==(4&t),d=!l&&"scroll"===e,p=l?null!==s?s+"Capture":null:s;l=[];for(var f,h=r;null!==h;){var v=(f=h).stateNode;if(5===f.tag&&null!==v&&(f=v,null!==p&&(null!=(v=Re(h,p))&&l.push(Hr(h,v,f)))),d)break;h=h.return}0<l.length&&(s=new u(s,c,null,n,i),a.push({event:s,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!mi(c)&&!c[hi])&&(u||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?mi(c):null)&&(c!==(d=ze(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=hn,v="onMouseLeave",p="onMouseEnter",h="mouse","pointerout"!==e&&"pointerover"!==e||(l=An,v="onPointerLeave",p="onPointerEnter",h="pointer"),d=null==u?s:bi(u),f=null==c?s:bi(c),(s=new l(v,h+"leave",u,n,i)).target=d,s.relatedTarget=f,v=null,mi(i)===r&&((l=new l(p,h+"enter",c,n,i)).target=f,l.relatedTarget=d,v=l),d=v,u&&c)e:{for(p=c,h=0,f=l=u;f;f=Jr(f))h++;for(f=0,v=p;v;v=Jr(v))f++;for(;0<h-f;)l=Jr(l),h--;for(;0<f-h;)p=Jr(p),f--;for(;h--;){if(l===p||null!==p&&l===p.alternate)break e;l=Jr(l),p=Jr(p)}l=null}else l=null;null!==u&&Kr(a,s,u,l,!1),null!==c&&null!==d&&Kr(a,d,c,l,!0)}if("select"===(u=(s=r?bi(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var g=$n;else if(Bn(s))if(Yn)g=ar;else{g=ir;var y=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=or);switch(g&&(g=g(e,r))?Hn(a,g,n,i):(y&&y(e,s,r),"focusout"===e&&(y=s._wrapperState)&&y.controlled&&"number"===s.type&&ee(s,"number",s.value)),y=r?bi(r):window,e){case"focusin":(Bn(y)||"true"===y.contentEditable)&&(gr=y,yr=r,mr=null);break;case"focusout":mr=yr=gr=null;break;case"mousedown":wr=!0;break;case"contextmenu":case"mouseup":case"dragend":wr=!1,br(a,n,i);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":br(a,n,i)}var m;if(jn)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else zn?qn(e,n)&&(w="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(w="onCompositionStart");w&&(Dn&&"ko"!==n.locale&&(zn||"onCompositionStart"!==w?"onCompositionEnd"===w&&zn&&(m=en()):(Xt="value"in(Yt=i)?Yt.value:Yt.textContent,zn=!0)),0<(y=Vr(r,w)).length&&(w=new bn(w,e,null,n,i),a.push({event:w,listeners:y}),m?w.data=m:null!==(m=Un(n))&&(w.data=m))),(m=Ln?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Fn=!0,Wn);case"textInput":return(e=t.data)===Wn&&Fn?null:e;default:return null}}(e,n):function(e,t){if(zn)return"compositionend"===e||!jn&&qn(e,t)?(e=en(),Zt=Xt=Yt=null,zn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Dn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Vr(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),a.push({event:i,listeners:r}),i.data=m))}Wr(a,t)}))}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Vr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Re(e,n))&&r.unshift(Hr(e,o,i)),null!=(o=Re(e,t))&&r.push(Hr(e,o,i))),e=e.return}return r}function Jr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,i){for(var o=t._reactName,a=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,i?null!=(u=Re(n,o))&&a.unshift(Hr(n,u,s)):i||null!=(u=Re(n,o))&&a.push(Hr(n,u,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Qr=/\r\n?/g,$r=/\u0000|\uFFFD/g;function Yr(e){return("string"===typeof e?e:""+e).replace(Qr,"\n").replace($r,"")}function Xr(e,t,n){if(t=Yr(t),Yr(e)!==t&&n)throw Error(o(425))}function Zr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,oi="function"===typeof Promise?Promise:void 0,ai="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof oi?function(e){return oi.resolve(null).then(e).catch(si)}:ri;function si(e){setTimeout((function(){throw e}))}function ui(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void zt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);zt(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function li(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),pi="__reactFiber$"+di,fi="__reactProps$"+di,hi="__reactContainer$"+di,vi="__reactEvents$"+di,gi="__reactListeners$"+di,yi="__reactHandles$"+di;function mi(e){var t=e[pi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[hi]||n[pi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=li(e);null!==e;){if(n=e[pi])return n;e=li(e)}return t}n=(e=n).parentNode}return null}function wi(e){return!(e=e[pi]||e[hi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function bi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function ki(e){return e[fi]||null}var xi=[],_i=-1;function Si(e){return{current:e}}function Ii(e){0>_i||(e.current=xi[_i],xi[_i]=null,_i--)}function Ci(e,t){_i++,xi[_i]=e.current,e.current=t}var Ti={},Ai=Si(Ti),Ei=Si(!1),Pi=Ti;function Mi(e,t){var n=e.type.contextTypes;if(!n)return Ti;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Ri(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Oi(){Ii(Ei),Ii(Ai)}function ji(e,t,n){if(Ai.current!==Ti)throw Error(o(168));Ci(Ai,t),Ci(Ei,n)}function Ni(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(o(108,G(e)||"Unknown",i));return D({},n,r)}function Li(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ti,Pi=Ai.current,Ci(Ai,e),Ci(Ei,Ei.current),!0}function Di(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=Ni(e,t,Pi),r.__reactInternalMemoizedMergedChildContext=e,Ii(Ei),Ii(Ai),Ci(Ai,e)):Ii(Ei),Ci(Ei,n)}var Wi=null,Fi=!1,qi=!1;function Ui(e){null===Wi?Wi=[e]:Wi.push(e)}function zi(){if(!qi&&null!==Wi){qi=!0;var e=0,t=wt;try{var n=Wi;for(wt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Wi=null,Fi=!1}catch(i){throw null!==Wi&&(Wi=Wi.slice(e+1)),Je(Ze,zi),i}finally{wt=t,qi=!1}}return null}var Gi=[],Bi=0,Hi=null,Vi=0,Ji=[],Ki=0,Qi=null,$i=1,Yi="";function Xi(e,t){Gi[Bi++]=Vi,Gi[Bi++]=Hi,Hi=e,Vi=t}function Zi(e,t,n){Ji[Ki++]=$i,Ji[Ki++]=Yi,Ji[Ki++]=Qi,Qi=e;var r=$i;e=Yi;var i=32-at(r)-1;r&=~(1<<i),n+=1;var o=32-at(t)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,$i=1<<32-at(t)+i|n<<i|r,Yi=o+e}else $i=1<<o|n<<i|r,Yi=e}function eo(e){null!==e.return&&(Xi(e,1),Zi(e,1,0))}function to(e){for(;e===Hi;)Hi=Gi[--Bi],Gi[Bi]=null,Vi=Gi[--Bi],Gi[Bi]=null;for(;e===Qi;)Qi=Ji[--Ki],Ji[Ki]=null,Yi=Ji[--Ki],Ji[Ki]=null,$i=Ji[--Ki],Ji[Ki]=null}var no=null,ro=null,io=!1,oo=null;function ao(e,t){var n=Mc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function so(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,ro=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qi?{id:$i,overflow:Yi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Mc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,ro=null,!0);default:return!1}}function uo(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function co(e){if(io){var t=ro;if(t){var n=t;if(!so(e,t)){if(uo(e))throw Error(o(418));t=ci(n.nextSibling);var r=no;t&&so(e,t)?ao(r,n):(e.flags=-4097&e.flags|2,io=!1,no=e)}}else{if(uo(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,no=e}}}function lo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function po(e){if(e!==no)return!1;if(!io)return lo(e),io=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ro)){if(uo(e))throw fo(),Error(o(418));for(;t;)ao(e,t),t=ci(t.nextSibling)}if(lo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=no?ci(e.stateNode.nextSibling):null;return!0}function fo(){for(var e=ro;e;)e=ci(e.nextSibling)}function ho(){ro=no=null,io=!1}function vo(e){null===oo?oo=[e]:oo.push(e)}var go=b.ReactCurrentBatchConfig;function yo(e,t){if(e&&e.defaultProps){for(var n in t=D({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var mo=Si(null),wo=null,bo=null,ko=null;function xo(){ko=bo=wo=null}function _o(e){var t=mo.current;Ii(mo),e._currentValue=t}function So(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Io(e,t){wo=e,ko=bo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bs=!0),e.firstContext=null)}function Co(e){var t=e._currentValue;if(ko!==e)if(e={context:e,memoizedValue:t,next:null},null===bo){if(null===wo)throw Error(o(308));bo=e,wo.dependencies={lanes:0,firstContext:e}}else bo=bo.next=e;return t}var To=null;function Ao(e){null===To?To=[e]:To.push(e)}function Eo(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ao(t)):(n.next=i.next,i.next=n),t.interleaved=n,Po(e,r)}function Po(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Mo=!1;function Ro(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Oo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function jo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function No(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Au)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Po(e,n)}return null===(i=r.interleaved)?(t.next=t,Ao(r)):(t.next=i.next,i.next=t),r.interleaved=t,Po(e,n)}function Lo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,mt(e,n)}}function Do(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Wo(e,t,n,r){var i=e.updateQueue;Mo=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var u=s,c=u.next;u.next=null,null===a?o=c:a.next=c,a=u;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==a&&(null===s?l.firstBaseUpdate=c:s.next=c,l.lastBaseUpdate=u))}if(null!==o){var d=i.baseState;for(a=0,l=c=u=null,s=o;;){var p=s.lane,f=s.eventTime;if((r&p)===p){null!==l&&(l=l.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=e,v=s;switch(p=t,f=n,v.tag){case 1:if("function"===typeof(h=v.payload)){d=h.call(f,d,p);break e}d=h;break e;case 3:h.flags=-65537&h.flags|128;case 0:if(null===(p="function"===typeof(h=v.payload)?h.call(f,d,p):h)||void 0===p)break e;d=D({},d,p);break e;case 2:Mo=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(p=i.effects)?i.effects=[s]:p.push(s))}else f={eventTime:f,lane:p,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(c=l=f,u=d):l=l.next=f,a|=p;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(p=s).next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}if(null===l&&(u=d),i.baseState=u,i.firstBaseUpdate=c,i.lastBaseUpdate=l,null!==(t=i.shared.interleaved)){i=t;do{a|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);Lu|=a,e.lanes=a,e.memoizedState=d}}function Fo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var qo=(new r.Component).refs;function Uo(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:D({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var zo={isMounted:function(e){return!!(e=e._reactInternals)&&ze(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),o=jo(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=No(e,o,i))&&(nc(t,e,i,r),Lo(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),o=jo(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=No(e,o,i))&&(nc(t,e,i,r),Lo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),i=jo(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=No(e,i,r))&&(nc(t,e,r,n),Lo(t,e,r))}};function Go(e,t,n,r,i,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(i,o))}function Bo(e,t,n){var r=!1,i=Ti,o=t.contextType;return"object"===typeof o&&null!==o?o=Co(o):(i=Ri(t)?Pi:Ai.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?Mi(e,i):Ti),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=zo,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function Ho(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&zo.enqueueReplaceState(t,t.state,null)}function Vo(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=qo,Ro(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=Co(o):(o=Ri(t)?Pi:Ai.current,i.context=Mi(e,o)),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(Uo(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&zo.enqueueReplaceState(i,i.state,null),Wo(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function Jo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=i.refs;t===qo&&(t=i.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Ko(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Qo(e){return(0,e._init)(e._payload)}function $o(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Oc(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Dc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type;return o===_?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===R&&Qo(o)===t.type)?((r=i(t,n.props)).ref=Jo(e,t,n),r.return=e,r):((r=jc(n.type,n.key,n.props,null,e.mode,r)).ref=Jo(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Wc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Nc(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function p(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Dc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case k:return(n=jc(t.type,t.key,t.props,null,e.mode,n)).ref=Jo(e,null,t),n.return=e,n;case x:return(t=Wc(t,e.mode,n)).return=e,t;case R:return p(e,(0,t._init)(t._payload),n)}if(te(t)||N(t))return(t=Nc(t,e.mode,n,null)).return=e,t;Ko(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case k:return n.key===i?c(e,t,n,r):null;case x:return n.key===i?l(e,t,n,r):null;case R:return f(e,t,(i=n._init)(n._payload),r)}if(te(n)||N(n))return null!==i?null:d(e,t,n,r,null);Ko(e,n)}return null}function h(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case k:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case x:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case R:return h(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||N(r))return d(t,e=e.get(n)||null,r,i,null);Ko(t,r)}return null}function v(i,o,s,u){for(var c=null,l=null,d=o,v=o=0,g=null;null!==d&&v<s.length;v++){d.index>v?(g=d,d=null):g=d.sibling;var y=f(i,d,s[v],u);if(null===y){null===d&&(d=g);break}e&&d&&null===y.alternate&&t(i,d),o=a(y,o,v),null===l?c=y:l.sibling=y,l=y,d=g}if(v===s.length)return n(i,d),io&&Xi(i,v),c;if(null===d){for(;v<s.length;v++)null!==(d=p(i,s[v],u))&&(o=a(d,o,v),null===l?c=d:l.sibling=d,l=d);return io&&Xi(i,v),c}for(d=r(i,d);v<s.length;v++)null!==(g=h(d,i,v,s[v],u))&&(e&&null!==g.alternate&&d.delete(null===g.key?v:g.key),o=a(g,o,v),null===l?c=g:l.sibling=g,l=g);return e&&d.forEach((function(e){return t(i,e)})),io&&Xi(i,v),c}function g(i,s,u,c){var l=N(u);if("function"!==typeof l)throw Error(o(150));if(null==(u=l.call(u)))throw Error(o(151));for(var d=l=null,v=s,g=s=0,y=null,m=u.next();null!==v&&!m.done;g++,m=u.next()){v.index>g?(y=v,v=null):y=v.sibling;var w=f(i,v,m.value,c);if(null===w){null===v&&(v=y);break}e&&v&&null===w.alternate&&t(i,v),s=a(w,s,g),null===d?l=w:d.sibling=w,d=w,v=y}if(m.done)return n(i,v),io&&Xi(i,g),l;if(null===v){for(;!m.done;g++,m=u.next())null!==(m=p(i,m.value,c))&&(s=a(m,s,g),null===d?l=m:d.sibling=m,d=m);return io&&Xi(i,g),l}for(v=r(i,v);!m.done;g++,m=u.next())null!==(m=h(v,i,g,m.value,c))&&(e&&null!==m.alternate&&v.delete(null===m.key?g:m.key),s=a(m,s,g),null===d?l=m:d.sibling=m,d=m);return e&&v.forEach((function(e){return t(i,e)})),io&&Xi(i,g),l}return function e(r,o,a,u){if("object"===typeof a&&null!==a&&a.type===_&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case k:e:{for(var c=a.key,l=o;null!==l;){if(l.key===c){if((c=a.type)===_){if(7===l.tag){n(r,l.sibling),(o=i(l,a.props.children)).return=r,r=o;break e}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===R&&Qo(c)===l.type){n(r,l.sibling),(o=i(l,a.props)).ref=Jo(r,l,a),o.return=r,r=o;break e}n(r,l);break}t(r,l),l=l.sibling}a.type===_?((o=Nc(a.props.children,r.mode,u,a.key)).return=r,r=o):((u=jc(a.type,a.key,a.props,null,r.mode,u)).ref=Jo(r,o,a),u.return=r,r=u)}return s(r);case x:e:{for(l=a.key;null!==o;){if(o.key===l){if(4===o.tag&&o.stateNode.containerInfo===a.containerInfo&&o.stateNode.implementation===a.implementation){n(r,o.sibling),(o=i(o,a.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=Wc(a,r.mode,u)).return=r,r=o}return s(r);case R:return e(r,o,(l=a._init)(a._payload),u)}if(te(a))return v(r,o,a,u);if(N(a))return g(r,o,a,u);Ko(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==o&&6===o.tag?(n(r,o.sibling),(o=i(o,a)).return=r,r=o):(n(r,o),(o=Dc(a,r.mode,u)).return=r,r=o),s(r)):n(r,o)}}var Yo=$o(!0),Xo=$o(!1),Zo={},ea=Si(Zo),ta=Si(Zo),na=Si(Zo);function ra(e){if(e===Zo)throw Error(o(174));return e}function ia(e,t){switch(Ci(na,t),Ci(ta,e),Ci(ea,Zo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ii(ea),Ci(ea,t)}function oa(){Ii(ea),Ii(ta),Ii(na)}function aa(e){ra(na.current);var t=ra(ea.current),n=ue(t,e.type);t!==n&&(Ci(ta,e),Ci(ea,n))}function sa(e){ta.current===e&&(Ii(ea),Ii(ta))}var ua=Si(0);function ca(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var la=[];function da(){for(var e=0;e<la.length;e++)la[e]._workInProgressVersionPrimary=null;la.length=0}var pa=b.ReactCurrentDispatcher,fa=b.ReactCurrentBatchConfig,ha=0,va=null,ga=null,ya=null,ma=!1,wa=!1,ba=0,ka=0;function xa(){throw Error(o(321))}function _a(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function Sa(e,t,n,r,i,a){if(ha=a,va=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,pa.current=null===e||null===e.memoizedState?ss:us,e=n(r,i),wa){a=0;do{if(wa=!1,ba=0,25<=a)throw Error(o(301));a+=1,ya=ga=null,t.updateQueue=null,pa.current=cs,e=n(r,i)}while(wa)}if(pa.current=as,t=null!==ga&&null!==ga.next,ha=0,ya=ga=va=null,ma=!1,t)throw Error(o(300));return e}function Ia(){var e=0!==ba;return ba=0,e}function Ca(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ya?va.memoizedState=ya=e:ya=ya.next=e,ya}function Ta(){if(null===ga){var e=va.alternate;e=null!==e?e.memoizedState:null}else e=ga.next;var t=null===ya?va.memoizedState:ya.next;if(null!==t)ya=t,ga=e;else{if(null===e)throw Error(o(310));e={memoizedState:(ga=e).memoizedState,baseState:ga.baseState,baseQueue:ga.baseQueue,queue:ga.queue,next:null},null===ya?va.memoizedState=ya=e:ya=ya.next=e}return ya}function Aa(e,t){return"function"===typeof t?t(e):t}function Ea(e){var t=Ta(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=ga,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}r.baseQueue=i=a,n.pending=null}if(null!==i){a=i.next,r=r.baseState;var u=s=null,c=null,l=a;do{var d=l.lane;if((ha&d)===d)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var p={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=p,s=r):c=c.next=p,va.lanes|=d,Lu|=d}l=l.next}while(null!==l&&l!==a);null===c?s=r:c.next=u,sr(r,t.memoizedState)||(bs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{a=i.lane,va.lanes|=a,Lu|=a,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Pa(e){var t=Ta(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);sr(a,t.memoizedState)||(bs=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Ma(){}function Ra(e,t){var n=va,r=Ta(),i=t(),a=!sr(r.memoizedState,i);if(a&&(r.memoizedState=i,bs=!0),r=r.queue,Ba(Na.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==ya&&1&ya.memoizedState.tag){if(n.flags|=2048,Fa(9,ja.bind(null,n,r,i,t),void 0,null),null===Eu)throw Error(o(349));0!==(30&ha)||Oa(n,t,i)}return i}function Oa(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=va.updateQueue)?(t={lastEffect:null,stores:null},va.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function ja(e,t,n,r){t.value=n,t.getSnapshot=r,La(t)&&Da(e)}function Na(e,t,n){return n((function(){La(t)&&Da(e)}))}function La(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Da(e){var t=Po(e,1);null!==t&&nc(t,e,1,-1)}function Wa(e){var t=Ca();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Aa,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,va,e),[t.memoizedState,e]}function Fa(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=va.updateQueue)?(t={lastEffect:null,stores:null},va.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function qa(){return Ta().memoizedState}function Ua(e,t,n,r){var i=Ca();va.flags|=e,i.memoizedState=Fa(1|t,n,void 0,void 0===r?null:r)}function za(e,t,n,r){var i=Ta();r=void 0===r?null:r;var o=void 0;if(null!==ga){var a=ga.memoizedState;if(o=a.destroy,null!==r&&_a(r,a.deps))return void(i.memoizedState=Fa(t,n,o,r))}va.flags|=e,i.memoizedState=Fa(1|t,n,o,r)}function Ga(e,t){return Ua(8390656,8,e,t)}function Ba(e,t){return za(2048,8,e,t)}function Ha(e,t){return za(4,2,e,t)}function Va(e,t){return za(4,4,e,t)}function Ja(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ka(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,za(4,4,Ja.bind(null,t,e),n)}function Qa(){}function $a(e,t){var n=Ta();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&_a(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ya(e,t){var n=Ta();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&_a(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Xa(e,t,n){return 0===(21&ha)?(e.baseState&&(e.baseState=!1,bs=!0),e.memoizedState=n):(sr(n,t)||(n=vt(),va.lanes|=n,Lu|=n,e.baseState=!0),t)}function Za(e,t){var n=wt;wt=0!==n&&4>n?n:4,e(!0);var r=fa.transition;fa.transition={};try{e(!1),t()}finally{wt=n,fa.transition=r}}function es(){return Ta().memoizedState}function ts(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))is(t,n);else if(null!==(n=Eo(e,t,n,r))){nc(n,e,r,ec()),os(n,t,r)}}function ns(e,t,n){var r=tc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))is(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(i.hasEagerState=!0,i.eagerState=s,sr(s,a)){var u=t.interleaved;return null===u?(i.next=i,Ao(t)):(i.next=u.next,u.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=Eo(e,t,i,r))&&(nc(n,e,r,i=ec()),os(n,t,r))}}function rs(e){var t=e.alternate;return e===va||null!==t&&t===va}function is(e,t){wa=ma=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function os(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,mt(e,n)}}var as={readContext:Co,useCallback:xa,useContext:xa,useEffect:xa,useImperativeHandle:xa,useInsertionEffect:xa,useLayoutEffect:xa,useMemo:xa,useReducer:xa,useRef:xa,useState:xa,useDebugValue:xa,useDeferredValue:xa,useTransition:xa,useMutableSource:xa,useSyncExternalStore:xa,useId:xa,unstable_isNewReconciler:!1},ss={readContext:Co,useCallback:function(e,t){return Ca().memoizedState=[e,void 0===t?null:t],e},useContext:Co,useEffect:Ga,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ua(4194308,4,Ja.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ua(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ua(4,2,e,t)},useMemo:function(e,t){var n=Ca();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ca();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,va,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ca().memoizedState=e},useState:Wa,useDebugValue:Qa,useDeferredValue:function(e){return Ca().memoizedState=e},useTransition:function(){var e=Wa(!1),t=e[0];return e=Za.bind(null,e[1]),Ca().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=va,i=Ca();if(io){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Eu)throw Error(o(349));0!==(30&ha)||Oa(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,Ga(Na.bind(null,r,a,e),[e]),r.flags|=2048,Fa(9,ja.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=Ca(),t=Eu.identifierPrefix;if(io){var n=Yi;t=":"+t+"R"+(n=($i&~(1<<32-at($i)-1)).toString(32)+n),0<(n=ba++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ka++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},us={readContext:Co,useCallback:$a,useContext:Co,useEffect:Ba,useImperativeHandle:Ka,useInsertionEffect:Ha,useLayoutEffect:Va,useMemo:Ya,useReducer:Ea,useRef:qa,useState:function(){return Ea(Aa)},useDebugValue:Qa,useDeferredValue:function(e){return Xa(Ta(),ga.memoizedState,e)},useTransition:function(){return[Ea(Aa)[0],Ta().memoizedState]},useMutableSource:Ma,useSyncExternalStore:Ra,useId:es,unstable_isNewReconciler:!1},cs={readContext:Co,useCallback:$a,useContext:Co,useEffect:Ba,useImperativeHandle:Ka,useInsertionEffect:Ha,useLayoutEffect:Va,useMemo:Ya,useReducer:Pa,useRef:qa,useState:function(){return Pa(Aa)},useDebugValue:Qa,useDeferredValue:function(e){var t=Ta();return null===ga?t.memoizedState=e:Xa(t,ga.memoizedState,e)},useTransition:function(){return[Pa(Aa)[0],Ta().memoizedState]},useMutableSource:Ma,useSyncExternalStore:Ra,useId:es,unstable_isNewReconciler:!1};function ls(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i,digest:null}}function ds(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ps(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fs="function"===typeof WeakMap?WeakMap:Map;function hs(e,t,n){(n=jo(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Bu||(Bu=!0,Hu=r),ps(0,t)},n}function vs(e,t,n){(n=jo(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){ps(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){ps(0,t),"function"!==typeof r&&(null===Vu?Vu=new Set([this]):Vu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function gs(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new fs;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Ic.bind(null,e,t,n),t.then(e,e))}function ys(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ms(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=jo(-1,1)).tag=2,No(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var ws=b.ReactCurrentOwner,bs=!1;function ks(e,t,n,r){t.child=null===e?Xo(t,null,n,r):Yo(t,e.child,n,r)}function xs(e,t,n,r,i){n=n.render;var o=t.ref;return Io(t,i),r=Sa(e,t,n,r,o,i),n=Ia(),null===e||bs?(io&&n&&eo(t),t.flags|=1,ks(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Bs(e,t,i))}function _s(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||Rc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=jc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ss(e,t,o,r,i))}if(o=e.child,0===(e.lanes&i)){var a=o.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(a,r)&&e.ref===t.ref)return Bs(e,t,i)}return t.flags|=1,(e=Oc(o,r)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(ur(o,r)&&e.ref===t.ref){if(bs=!1,t.pendingProps=r=o,0===(e.lanes&i))return t.lanes=e.lanes,Bs(e,t,i);0!==(131072&e.flags)&&(bs=!0)}}return Ts(e,t,n,r,i)}function Is(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ci(Ou,Ru),Ru|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ci(Ou,Ru),Ru|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Ci(Ou,Ru),Ru|=r}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Ci(Ou,Ru),Ru|=r;return ks(e,t,i,n),t.child}function Cs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ts(e,t,n,r,i){var o=Ri(n)?Pi:Ai.current;return o=Mi(t,o),Io(t,i),n=Sa(e,t,n,r,o,i),r=Ia(),null===e||bs?(io&&r&&eo(t),t.flags|=1,ks(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Bs(e,t,i))}function As(e,t,n,r,i){if(Ri(n)){var o=!0;Li(t)}else o=!1;if(Io(t,i),null===t.stateNode)Gs(e,t),Bo(t,n,r),Vo(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var u=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=Co(c):c=Mi(t,c=Ri(n)?Pi:Ai.current);var l=n.getDerivedStateFromProps,d="function"===typeof l||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==r||u!==c)&&Ho(t,a,r,c),Mo=!1;var p=t.memoizedState;a.state=p,Wo(t,r,a,i),u=t.memoizedState,s!==r||p!==u||Ei.current||Mo?("function"===typeof l&&(Uo(t,n,l,r),u=t.memoizedState),(s=Mo||Go(t,n,s,r,p,u,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),a.props=r,a.state=u,a.context=c,r=s):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Oo(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:yo(t.type,s),a.props=c,d=t.pendingProps,p=a.context,"object"===typeof(u=n.contextType)&&null!==u?u=Co(u):u=Mi(t,u=Ri(n)?Pi:Ai.current);var f=n.getDerivedStateFromProps;(l="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==d||p!==u)&&Ho(t,a,r,u),Mo=!1,p=t.memoizedState,a.state=p,Wo(t,r,a,i);var h=t.memoizedState;s!==d||p!==h||Ei.current||Mo?("function"===typeof f&&(Uo(t,n,f,r),h=t.memoizedState),(c=Mo||Go(t,n,c,r,p,h,u)||!1)?(l||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,h,u),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,h,u)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=h),a.props=r,a.state=h,a.context=u,r=c):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),r=!1)}return Es(e,t,n,r,o,i)}function Es(e,t,n,r,i,o){Cs(e,t);var a=0!==(128&t.flags);if(!r&&!a)return i&&Di(t,n,!1),Bs(e,t,o);r=t.stateNode,ws.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=Yo(t,e.child,null,o),t.child=Yo(t,null,s,o)):ks(e,t,s,o),t.memoizedState=r.state,i&&Di(t,n,!0),t.child}function Ps(e){var t=e.stateNode;t.pendingContext?ji(0,t.pendingContext,t.pendingContext!==t.context):t.context&&ji(0,t.context,!1),ia(e,t.containerInfo)}function Ms(e,t,n,r,i){return ho(),vo(i),t.flags|=256,ks(e,t,n,r),t.child}var Rs,Os,js,Ns={dehydrated:null,treeContext:null,retryLane:0};function Ls(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ds(e,t,n){var r,i=t.pendingProps,a=ua.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Ci(ua,1&a),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=i.children,e=i.fallback,s?(i=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&i)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Lc(u,i,0,null),e=Nc(e,i,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ls(n),t.memoizedState=Ns,e):Ws(t,u));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,i,a,s){if(n)return 256&t.flags?(t.flags&=-257,Fs(e,t,s,r=ds(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,i=t.mode,r=Lc({mode:"visible",children:r.children},i,0,null),(a=Nc(a,i,s,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&Yo(t,e.child,null,s),t.child.memoizedState=Ls(s),t.memoizedState=Ns,a);if(0===(1&t.mode))return Fs(e,t,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var u=r.dgst;return r=u,Fs(e,t,s,r=ds(a=Error(o(419)),r,void 0))}if(u=0!==(s&e.childLanes),bs||u){if(null!==(r=Eu)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==a.retryLane&&(a.retryLane=i,Po(e,i),nc(r,e,i,-1))}return vc(),Fs(e,t,s,r=ds(Error(o(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Tc.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,ro=ci(i.nextSibling),no=t,io=!0,oo=null,null!==e&&(Ji[Ki++]=$i,Ji[Ki++]=Yi,Ji[Ki++]=Qi,$i=e.id,Yi=e.overflow,Qi=t),(t=Ws(t,r.children)).flags|=4096,t)}(e,t,u,i,r,a,n);if(s){s=i.fallback,u=t.mode,r=(a=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&u)&&t.child!==a?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Oc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==r?s=Oc(r,s):(s=Nc(s,u,n,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,u=null===(u=e.child.memoizedState)?Ls(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Ns,i}return e=(s=e.child).sibling,i=Oc(s,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Ws(e,t){return(t=Lc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fs(e,t,n,r){return null!==r&&vo(r),Yo(t,e.child,null,n),(e=Ws(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function qs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),So(e.return,t,n)}function Us(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function zs(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(ks(e,t,r.children,n),0!==(2&(r=ua.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&qs(e,n,t);else if(19===e.tag)qs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ci(ua,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ca(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Us(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ca(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Us(t,!0,n,null,o);break;case"together":Us(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Gs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Bs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Lu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Oc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Oc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Hs(e,t){if(!io)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Vs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Js(e,t,n){var r=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vs(t),null;case 1:case 17:return Ri(t.type)&&Oi(),Vs(t),null;case 3:return r=t.stateNode,oa(),Ii(Ei),Ii(Ai),da(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(po(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(ac(oo),oo=null))),Vs(t),null;case 5:sa(t);var i=ra(na.current);if(n=t.type,null!==e&&null!=t.stateNode)Os(e,t,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return Vs(t),null}if(e=ra(ea.current),po(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[pi]=t,r[fi]=a,e=0!==(1&t.mode),n){case"dialog":Fr("cancel",r),Fr("close",r);break;case"iframe":case"object":case"embed":Fr("load",r);break;case"video":case"audio":for(i=0;i<Nr.length;i++)Fr(Nr[i],r);break;case"source":Fr("error",r);break;case"img":case"image":case"link":Fr("error",r),Fr("load",r);break;case"details":Fr("toggle",r);break;case"input":$(r,a),Fr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Fr("invalid",r);break;case"textarea":ie(r,a),Fr("invalid",r)}for(var u in me(n,a),i=null,a)if(a.hasOwnProperty(u)){var c=a[u];"children"===u?"string"===typeof c?r.textContent!==c&&(!0!==a.suppressHydrationWarning&&Xr(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Xr(r.textContent,c,e),i=["children",""+c]):s.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&Fr("scroll",r)}switch(n){case"input":V(r),Z(r,a,!0);break;case"textarea":V(r),ae(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=Zr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[pi]=t,e[fi]=r,Rs(e,t),t.stateNode=e;e:{switch(u=we(n,r),n){case"dialog":Fr("cancel",e),Fr("close",e),i=r;break;case"iframe":case"object":case"embed":Fr("load",e),i=r;break;case"video":case"audio":for(i=0;i<Nr.length;i++)Fr(Nr[i],e);i=r;break;case"source":Fr("error",e),i=r;break;case"img":case"image":case"link":Fr("error",e),Fr("load",e),i=r;break;case"details":Fr("toggle",e),i=r;break;case"input":$(e,r),i=Q(e,r),Fr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=D({},r,{value:void 0}),Fr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Fr("invalid",e)}for(a in me(n,i),c=i)if(c.hasOwnProperty(a)){var l=c[a];"style"===a?ge(e,l):"dangerouslySetInnerHTML"===a?null!=(l=l?l.__html:void 0)&&de(e,l):"children"===a?"string"===typeof l?("textarea"!==n||""!==l)&&pe(e,l):"number"===typeof l&&pe(e,""+l):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=l&&"onScroll"===a&&Fr("scroll",e):null!=l&&w(e,a,l,u))}switch(n){case"input":V(e),Z(e,r,!1);break;case"textarea":V(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+B(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?ne(e,!!r.multiple,a,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Vs(t),null;case 6:if(e&&null!=t.stateNode)js(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(n=ra(na.current),ra(ea.current),po(t)){if(r=t.stateNode,n=t.memoizedProps,r[pi]=t,(a=r.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Xr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xr(r.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[pi]=t,t.stateNode=r}return Vs(t),null;case 13:if(Ii(ua),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==ro&&0!==(1&t.mode)&&0===(128&t.flags))fo(),ho(),t.flags|=98560,a=!1;else if(a=po(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(o(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(o(317));a[pi]=t}else ho(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Vs(t),a=!1}else null!==oo&&(ac(oo),oo=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ua.current)?0===ju&&(ju=3):vc())),null!==t.updateQueue&&(t.flags|=4),Vs(t),null);case 4:return oa(),null===e&&zr(t.stateNode.containerInfo),Vs(t),null;case 10:return _o(t.type._context),Vs(t),null;case 19:if(Ii(ua),null===(a=t.memoizedState))return Vs(t),null;if(r=0!==(128&t.flags),null===(u=a.rendering))if(r)Hs(a,!1);else{if(0!==ju||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=ca(e))){for(t.flags|=128,Hs(a,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=14680066,null===(u=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,e=u.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ci(ua,1&ua.current|2),t.child}e=e.sibling}null!==a.tail&&Ye()>zu&&(t.flags|=128,r=!0,Hs(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ca(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Hs(a,!0),null===a.tail&&"hidden"===a.tailMode&&!u.alternate&&!io)return Vs(t),null}else 2*Ye()-a.renderingStartTime>zu&&1073741824!==n&&(t.flags|=128,r=!0,Hs(a,!1),t.lanes=4194304);a.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=a.last)?n.sibling=u:t.child=u,a.last=u)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ye(),t.sibling=null,n=ua.current,Ci(ua,r?1&n|2:1&n),t):(Vs(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ru)&&(Vs(t),6&t.subtreeFlags&&(t.flags|=8192)):Vs(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Ks(e,t){switch(to(t),t.tag){case 1:return Ri(t.type)&&Oi(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return oa(),Ii(Ei),Ii(Ai),da(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return sa(t),null;case 13:if(Ii(ua),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));ho()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ii(ua),null;case 4:return oa(),null;case 10:return _o(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Rs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Os=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,ra(ea.current);var o,a=null;switch(n){case"input":i=Q(e,i),r=Q(e,r),a=[];break;case"select":i=D({},i,{value:void 0}),r=D({},r,{value:void 0}),a=[];break;case"textarea":i=re(e,i),r=re(e,r),a=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(l in me(n,r),n=null,i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&null!=i[l])if("style"===l){var u=i[l];for(o in u)u.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in r){var c=r[l];if(u=null!=i?i[l]:void 0,r.hasOwnProperty(l)&&c!==u&&(null!=c||null!=u))if("style"===l)if(u){for(o in u)!u.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&u[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(a||(a=[]),a.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(a=a||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&Fr("scroll",e),a||u===c||(a=[])):(a=a||[]).push(l,c))}n&&(a=a||[]).push("style",n);var l=a;(t.updateQueue=l)&&(t.flags|=4)}},js=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qs=!1,$s=!1,Ys="function"===typeof WeakSet?WeakSet:Set,Xs=null;function Zs(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Sc(e,t,r)}else n.current=null}function eu(e,t,n){try{n()}catch(r){Sc(e,t,r)}}var tu=!1;function nu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&eu(t,n,o)}i=i.next}while(i!==r)}}function ru(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function iu(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ou(e){var t=e.alternate;null!==t&&(e.alternate=null,ou(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[pi],delete t[fi],delete t[vi],delete t[gi],delete t[yi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function au(e){return 5===e.tag||3===e.tag||4===e.tag}function su(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||au(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}function cu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cu(e,t,n),e=e.sibling;null!==e;)cu(e,t,n),e=e.sibling}var lu=null,du=!1;function pu(e,t,n){for(n=n.child;null!==n;)fu(e,t,n),n=n.sibling}function fu(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(it,n)}catch(s){}switch(n.tag){case 5:$s||Zs(n,t);case 6:var r=lu,i=du;lu=null,pu(e,t,n),du=i,null!==(lu=r)&&(du?(e=lu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):lu.removeChild(n.stateNode));break;case 18:null!==lu&&(du?(e=lu,n=n.stateNode,8===e.nodeType?ui(e.parentNode,n):1===e.nodeType&&ui(e,n),zt(e)):ui(lu,n.stateNode));break;case 4:r=lu,i=du,lu=n.stateNode.containerInfo,du=!0,pu(e,t,n),lu=r,du=i;break;case 0:case 11:case 14:case 15:if(!$s&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var o=i,a=o.destroy;o=o.tag,void 0!==a&&(0!==(2&o)||0!==(4&o))&&eu(n,t,a),i=i.next}while(i!==r)}pu(e,t,n);break;case 1:if(!$s&&(Zs(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Sc(n,t,s)}pu(e,t,n);break;case 21:pu(e,t,n);break;case 22:1&n.mode?($s=(r=$s)||null!==n.memoizedState,pu(e,t,n),$s=r):pu(e,t,n);break;default:pu(e,t,n)}}function hu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ys),t.forEach((function(t){var r=Ac.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function vu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var a=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:lu=u.stateNode,du=!1;break e;case 3:case 4:lu=u.stateNode.containerInfo,du=!0;break e}u=u.return}if(null===lu)throw Error(o(160));fu(a,s,i),lu=null,du=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(l){Sc(i,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gu(t,e),t=t.sibling}function gu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vu(t,e),yu(e),4&r){try{nu(3,e,e.return),ru(3,e)}catch(g){Sc(e,e.return,g)}try{nu(5,e,e.return)}catch(g){Sc(e,e.return,g)}}break;case 1:vu(t,e),yu(e),512&r&&null!==n&&Zs(n,n.return);break;case 5:if(vu(t,e),yu(e),512&r&&null!==n&&Zs(n,n.return),32&e.flags){var i=e.stateNode;try{pe(i,"")}catch(g){Sc(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var a=e.memoizedProps,s=null!==n?n.memoizedProps:a,u=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===u&&"radio"===a.type&&null!=a.name&&Y(i,a),we(u,s);var l=we(u,a);for(s=0;s<c.length;s+=2){var d=c[s],p=c[s+1];"style"===d?ge(i,p):"dangerouslySetInnerHTML"===d?de(i,p):"children"===d?pe(i,p):w(i,d,p,l)}switch(u){case"input":X(i,a);break;case"textarea":oe(i,a);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var h=a.value;null!=h?ne(i,!!a.multiple,h,!1):f!==!!a.multiple&&(null!=a.defaultValue?ne(i,!!a.multiple,a.defaultValue,!0):ne(i,!!a.multiple,a.multiple?[]:"",!1))}i[fi]=a}catch(g){Sc(e,e.return,g)}}break;case 6:if(vu(t,e),yu(e),4&r){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(g){Sc(e,e.return,g)}}break;case 3:if(vu(t,e),yu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{zt(t.containerInfo)}catch(g){Sc(e,e.return,g)}break;case 4:default:vu(t,e),yu(e);break;case 13:vu(t,e),yu(e),8192&(i=e.child).flags&&(a=null!==i.memoizedState,i.stateNode.isHidden=a,!a||null!==i.alternate&&null!==i.alternate.memoizedState||(Uu=Ye())),4&r&&hu(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?($s=(l=$s)||d,vu(t,e),$s=l):vu(t,e),yu(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!d&&0!==(1&e.mode))for(Xs=e,d=e.child;null!==d;){for(p=Xs=d;null!==Xs;){switch(h=(f=Xs).child,f.tag){case 0:case 11:case 14:case 15:nu(4,f,f.return);break;case 1:Zs(f,f.return);var v=f.stateNode;if("function"===typeof v.componentWillUnmount){r=f,n=f.return;try{t=r,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(g){Sc(r,n,g)}}break;case 5:Zs(f,f.return);break;case 22:if(null!==f.memoizedState){ku(p);continue}}null!==h?(h.return=f,Xs=h):ku(p)}d=d.sibling}e:for(d=null,p=e;;){if(5===p.tag){if(null===d){d=p;try{i=p.stateNode,l?"function"===typeof(a=i.style).setProperty?a.setProperty("display","none","important"):a.display="none":(u=p.stateNode,s=void 0!==(c=p.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,u.style.display=ve("display",s))}catch(g){Sc(e,e.return,g)}}}else if(6===p.tag){if(null===d)try{p.stateNode.nodeValue=l?"":p.memoizedProps}catch(g){Sc(e,e.return,g)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===e)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;null===p.sibling;){if(null===p.return||p.return===e)break e;d===p&&(d=null),p=p.return}d===p&&(d=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:vu(t,e),yu(e),4&r&&hu(e);case 21:}}function yu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(au(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(pe(i,""),r.flags&=-33),cu(e,su(e),i);break;case 3:case 4:var a=r.stateNode.containerInfo;uu(e,su(e),a);break;default:throw Error(o(161))}}catch(s){Sc(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function mu(e,t,n){Xs=e,wu(e,t,n)}function wu(e,t,n){for(var r=0!==(1&e.mode);null!==Xs;){var i=Xs,o=i.child;if(22===i.tag&&r){var a=null!==i.memoizedState||Qs;if(!a){var s=i.alternate,u=null!==s&&null!==s.memoizedState||$s;s=Qs;var c=$s;if(Qs=a,($s=u)&&!c)for(Xs=i;null!==Xs;)u=(a=Xs).child,22===a.tag&&null!==a.memoizedState?xu(i):null!==u?(u.return=a,Xs=u):xu(i);for(;null!==o;)Xs=o,wu(o,t,n),o=o.sibling;Xs=i,Qs=s,$s=c}bu(e)}else 0!==(8772&i.subtreeFlags)&&null!==o?(o.return=i,Xs=o):bu(e)}}function bu(e){for(;null!==Xs;){var t=Xs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:$s||ru(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!$s)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:yo(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Fo(t,a,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Fo(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var d=l.memoizedState;if(null!==d){var p=d.dehydrated;null!==p&&zt(p)}}}break;default:throw Error(o(163))}$s||512&t.flags&&iu(t)}catch(f){Sc(t,t.return,f)}}if(t===e){Xs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Xs=n;break}Xs=t.return}}function ku(e){for(;null!==Xs;){var t=Xs;if(t===e){Xs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Xs=n;break}Xs=t.return}}function xu(e){for(;null!==Xs;){var t=Xs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ru(4,t)}catch(u){Sc(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(u){Sc(t,i,u)}}var o=t.return;try{iu(t)}catch(u){Sc(t,o,u)}break;case 5:var a=t.return;try{iu(t)}catch(u){Sc(t,a,u)}}}catch(u){Sc(t,t.return,u)}if(t===e){Xs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Xs=s;break}Xs=t.return}}var _u,Su=Math.ceil,Iu=b.ReactCurrentDispatcher,Cu=b.ReactCurrentOwner,Tu=b.ReactCurrentBatchConfig,Au=0,Eu=null,Pu=null,Mu=0,Ru=0,Ou=Si(0),ju=0,Nu=null,Lu=0,Du=0,Wu=0,Fu=null,qu=null,Uu=0,zu=1/0,Gu=null,Bu=!1,Hu=null,Vu=null,Ju=!1,Ku=null,Qu=0,$u=0,Yu=null,Xu=-1,Zu=0;function ec(){return 0!==(6&Au)?Ye():-1!==Xu?Xu:Xu=Ye()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Au)&&0!==Mu?Mu&-Mu:null!==go.transition?(0===Zu&&(Zu=vt()),Zu):0!==(e=wt)?e:e=void 0===(e=window.event)?16:$t(e.type)}function nc(e,t,n,r){if(50<$u)throw $u=0,Yu=null,Error(o(185));yt(e,n,r),0!==(2&Au)&&e===Eu||(e===Eu&&(0===(2&Au)&&(Du|=n),4===ju&&sc(e,Mu)),rc(e,r),1===n&&0===Au&&0===(1&t.mode)&&(zu=Ye()+500,Fi&&zi()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-at(o),s=1<<a,u=i[a];-1===u?0!==(s&n)&&0===(s&r)||(i[a]=ft(s,t)):u<=t&&(e.expiredLanes|=s),o&=~s}}(e,t);var r=pt(e,e===Eu?Mu:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Fi=!0,Ui(e)}(uc.bind(null,e)):Ui(uc.bind(null,e)),ai((function(){0===(6&Au)&&zi()})),n=null;else{switch(bt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ec(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if(Xu=-1,Zu=0,0!==(6&Au))throw Error(o(327));var n=e.callbackNode;if(xc()&&e.callbackNode!==n)return null;var r=pt(e,e===Eu?Mu:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var i=Au;Au|=2;var a=hc();for(Eu===e&&Mu===t||(Gu=null,zu=Ye()+500,pc(e,t));;)try{mc();break}catch(u){fc(e,u)}xo(),Iu.current=a,Au=i,null!==Pu?t=0:(Eu=null,Mu=0,t=ju)}if(0!==t){if(2===t&&(0!==(i=ht(e))&&(r=i,t=oc(e,i))),1===t)throw n=Nu,pc(e,0),sc(e,r),rc(e,Ye()),n;if(6===t)sc(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!sr(o(),i))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=gc(e,r))&&(0!==(a=ht(e))&&(r=a,t=oc(e,a))),1===t))throw n=Nu,pc(e,0),sc(e,r),rc(e,Ye()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:kc(e,qu,Gu);break;case 3:if(sc(e,r),(130023424&r)===r&&10<(t=Uu+500-Ye())){if(0!==pt(e,0))break;if(((i=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(kc.bind(null,e,qu,Gu),t);break}kc(e,qu,Gu);break;case 4:if(sc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var s=31-at(r);a=1<<s,(s=t[s])>i&&(i=s),r&=~a}if(r=i,10<(r=(120>(r=Ye()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Su(r/1960))-r)){e.timeoutHandle=ri(kc.bind(null,e,qu,Gu),r);break}kc(e,qu,Gu);break;default:throw Error(o(329))}}}return rc(e,Ye()),e.callbackNode===n?ic.bind(null,e):null}function oc(e,t){var n=Fu;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=qu,qu=n,null!==t&&ac(t)),e}function ac(e){null===qu?qu=e:qu.push.apply(qu,e)}function sc(e,t){for(t&=~Wu,t&=~Du,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),r=1<<n;e[n]=-1,t&=~r}}function uc(e){if(0!==(6&Au))throw Error(o(327));xc();var t=pt(e,0);if(0===(1&t))return rc(e,Ye()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var r=ht(e);0!==r&&(t=r,n=oc(e,r))}if(1===n)throw n=Nu,pc(e,0),sc(e,t),rc(e,Ye()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,kc(e,qu,Gu),rc(e,Ye()),null}function cc(e,t){var n=Au;Au|=1;try{return e(t)}finally{0===(Au=n)&&(zu=Ye()+500,Fi&&zi())}}function lc(e){null!==Ku&&0===Ku.tag&&0===(6&Au)&&xc();var t=Au;Au|=1;var n=Tu.transition,r=wt;try{if(Tu.transition=null,wt=1,e)return e()}finally{wt=r,Tu.transition=n,0===(6&(Au=t))&&zi()}}function dc(){Ru=Ou.current,Ii(Ou)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Pu)for(n=Pu.return;null!==n;){var r=n;switch(to(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Oi();break;case 3:oa(),Ii(Ei),Ii(Ai),da();break;case 5:sa(r);break;case 4:oa();break;case 13:case 19:Ii(ua);break;case 10:_o(r.type._context);break;case 22:case 23:dc()}n=n.return}if(Eu=e,Pu=e=Oc(e.current,null),Mu=Ru=t,ju=0,Nu=null,Wu=Du=Lu=0,qu=Fu=null,null!==To){for(t=0;t<To.length;t++)if(null!==(r=(n=To[t]).interleaved)){n.interleaved=null;var i=r.next,o=n.pending;if(null!==o){var a=o.next;o.next=i,r.next=a}n.pending=r}To=null}return e}function fc(e,t){for(;;){var n=Pu;try{if(xo(),pa.current=as,ma){for(var r=va.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ma=!1}if(ha=0,ya=ga=va=null,wa=!1,ba=0,Cu.current=null,null===n||null===n.return){ju=1,Nu=t,Pu=null;break}e:{var a=e,s=n.return,u=n,c=t;if(t=Mu,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,d=u,p=d.tag;if(0===(1&d.mode)&&(0===p||11===p||15===p)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var h=ys(s);if(null!==h){h.flags&=-257,ms(h,s,u,0,t),1&h.mode&&gs(a,l,t),c=l;var v=(t=h).updateQueue;if(null===v){var g=new Set;g.add(c),t.updateQueue=g}else v.add(c);break e}if(0===(1&t)){gs(a,l,t),vc();break e}c=Error(o(426))}else if(io&&1&u.mode){var y=ys(s);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),ms(y,s,u,0,t),vo(ls(c,u));break e}}a=c=ls(c,u),4!==ju&&(ju=2),null===Fu?Fu=[a]:Fu.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Do(a,hs(0,c,t));break e;case 1:u=c;var m=a.type,w=a.stateNode;if(0===(128&a.flags)&&("function"===typeof m.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===Vu||!Vu.has(w)))){a.flags|=65536,t&=-t,a.lanes|=t,Do(a,vs(a,u,t));break e}}a=a.return}while(null!==a)}bc(n)}catch(b){t=b,Pu===n&&null!==n&&(Pu=n=n.return);continue}break}}function hc(){var e=Iu.current;return Iu.current=as,null===e?as:e}function vc(){0!==ju&&3!==ju&&2!==ju||(ju=4),null===Eu||0===(268435455&Lu)&&0===(268435455&Du)||sc(Eu,Mu)}function gc(e,t){var n=Au;Au|=2;var r=hc();for(Eu===e&&Mu===t||(Gu=null,pc(e,t));;)try{yc();break}catch(i){fc(e,i)}if(xo(),Au=n,Iu.current=r,null!==Pu)throw Error(o(261));return Eu=null,Mu=0,ju}function yc(){for(;null!==Pu;)wc(Pu)}function mc(){for(;null!==Pu&&!Qe();)wc(Pu)}function wc(e){var t=_u(e.alternate,e,Ru);e.memoizedProps=e.pendingProps,null===t?bc(e):Pu=t,Cu.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Js(n,t,Ru)))return void(Pu=n)}else{if(null!==(n=Ks(n,t)))return n.flags&=32767,void(Pu=n);if(null===e)return ju=6,void(Pu=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Pu=t);Pu=t=e}while(null!==t);0===ju&&(ju=5)}function kc(e,t,n){var r=wt,i=Tu.transition;try{Tu.transition=null,wt=1,function(e,t,n,r){do{xc()}while(null!==Ku);if(0!==(6&Au))throw Error(o(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-at(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}(e,a),e===Eu&&(Pu=Eu=null,Mu=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Ju||(Ju=!0,Ec(tt,(function(){return xc(),null}))),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Tu.transition,Tu.transition=null;var s=wt;wt=1;var u=Au;Au|=4,Cu.current=null,function(e,t){if(ei=Bt,fr(e=pr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(k){n=null;break e}var s=0,u=-1,c=-1,l=0,d=0,p=e,f=null;t:for(;;){for(var h;p!==n||0!==i&&3!==p.nodeType||(u=s+i),p!==a||0!==r&&3!==p.nodeType||(c=s+r),3===p.nodeType&&(s+=p.nodeValue.length),null!==(h=p.firstChild);)f=p,p=h;for(;;){if(p===e)break t;if(f===n&&++l===i&&(u=s),f===a&&++d===r&&(c=s),null!==(h=p.nextSibling))break;f=(p=f).parentNode}p=h}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Bt=!1,Xs=t;null!==Xs;)if(e=(t=Xs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Xs=e;else for(;null!==Xs;){t=Xs;try{var v=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var g=v.memoizedProps,y=v.memoizedState,m=t.stateNode,w=m.getSnapshotBeforeUpdate(t.elementType===t.type?g:yo(t.type,g),y);m.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(o(163))}}catch(k){Sc(t,t.return,k)}if(null!==(e=t.sibling)){e.return=t.return,Xs=e;break}Xs=t.return}v=tu,tu=!1}(e,n),gu(n,e),hr(ti),Bt=!!ei,ti=ei=null,e.current=n,mu(n,e,i),$e(),Au=u,wt=s,Tu.transition=a}else e.current=n;if(Ju&&(Ju=!1,Ku=e,Qu=i),0===(a=e.pendingLanes)&&(Vu=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Ye()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((i=t[n]).value,{componentStack:i.stack,digest:i.digest});if(Bu)throw Bu=!1,e=Hu,Hu=null,e;0!==(1&Qu)&&0!==e.tag&&xc(),0!==(1&(a=e.pendingLanes))?e===Yu?$u++:($u=0,Yu=e):$u=0,zi()}(e,t,n,r)}finally{Tu.transition=i,wt=r}return null}function xc(){if(null!==Ku){var e=bt(Qu),t=Tu.transition,n=wt;try{if(Tu.transition=null,wt=16>e?16:e,null===Ku)var r=!1;else{if(e=Ku,Ku=null,Qu=0,0!==(6&Au))throw Error(o(331));var i=Au;for(Au|=4,Xs=e.current;null!==Xs;){var a=Xs,s=a.child;if(0!==(16&Xs.flags)){var u=a.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for(Xs=l;null!==Xs;){var d=Xs;switch(d.tag){case 0:case 11:case 15:nu(8,d,a)}var p=d.child;if(null!==p)p.return=d,Xs=p;else for(;null!==Xs;){var f=(d=Xs).sibling,h=d.return;if(ou(d),d===l){Xs=null;break}if(null!==f){f.return=h,Xs=f;break}Xs=h}}}var v=a.alternate;if(null!==v){var g=v.child;if(null!==g){v.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}Xs=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,Xs=s;else e:for(;null!==Xs;){if(0!==(2048&(a=Xs).flags))switch(a.tag){case 0:case 11:case 15:nu(9,a,a.return)}var m=a.sibling;if(null!==m){m.return=a.return,Xs=m;break e}Xs=a.return}}var w=e.current;for(Xs=w;null!==Xs;){var b=(s=Xs).child;if(0!==(2064&s.subtreeFlags)&&null!==b)b.return=s,Xs=b;else e:for(s=w;null!==Xs;){if(0!==(2048&(u=Xs).flags))try{switch(u.tag){case 0:case 11:case 15:ru(9,u)}}catch(x){Sc(u,u.return,x)}if(u===s){Xs=null;break e}var k=u.sibling;if(null!==k){k.return=u.return,Xs=k;break e}Xs=u.return}}if(Au=i,zi(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(it,e)}catch(x){}r=!0}return r}finally{wt=n,Tu.transition=t}}return!1}function _c(e,t,n){e=No(e,t=hs(0,t=ls(n,t),1),1),t=ec(),null!==e&&(yt(e,1,t),rc(e,t))}function Sc(e,t,n){if(3===e.tag)_c(e,e,n);else for(;null!==t;){if(3===t.tag){_c(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Vu||!Vu.has(r))){t=No(t,e=vs(t,e=ls(n,e),1),1),e=ec(),null!==t&&(yt(t,1,e),rc(t,e));break}}t=t.return}}function Ic(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Eu===e&&(Mu&n)===n&&(4===ju||3===ju&&(130023424&Mu)===Mu&&500>Ye()-Uu?pc(e,0):Wu|=n),rc(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=ec();null!==(e=Po(e,t))&&(yt(e,t,n),rc(e,n))}function Tc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cc(e,n)}function Ac(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Cc(e,n)}function Ec(e,t){return Je(e,t)}function Pc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mc(e,t,n,r){return new Pc(e,t,n,r)}function Rc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Oc(e,t){var n=e.alternate;return null===n?((n=Mc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function jc(e,t,n,r,i,a){var s=2;if(r=e,"function"===typeof e)Rc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case _:return Nc(n.children,i,a,t);case S:s=8,i|=8;break;case I:return(e=Mc(12,n,t,2|i)).elementType=I,e.lanes=a,e;case E:return(e=Mc(13,n,t,i)).elementType=E,e.lanes=a,e;case P:return(e=Mc(19,n,t,i)).elementType=P,e.lanes=a,e;case O:return Lc(n,i,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:s=10;break e;case T:s=9;break e;case A:s=11;break e;case M:s=14;break e;case R:s=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Mc(s,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function Nc(e,t,n,r){return(e=Mc(7,e,r,t)).lanes=n,e}function Lc(e,t,n,r){return(e=Mc(22,e,r,t)).elementType=O,e.lanes=n,e.stateNode={isHidden:!1},e}function Dc(e,t,n){return(e=Mc(6,e,null,t)).lanes=n,e}function Wc(e,t,n){return(t=Mc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function qc(e,t,n,r,i,o,a,s,u){return e=new Fc(e,t,n,s,u),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Mc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ro(o),e}function Uc(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:x,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function zc(e){if(!e)return Ti;e:{if(ze(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ri(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Ri(n))return Ni(e,n,t)}return t}function Gc(e,t,n,r,i,o,a,s,u){return(e=qc(n,r,!0,e,0,o,0,s,u)).context=zc(null),n=e.current,(o=jo(r=ec(),i=tc(n))).callback=void 0!==t&&null!==t?t:null,No(n,o,i),e.current.lanes=i,yt(e,i,r),rc(e,r),e}function Bc(e,t,n,r){var i=t.current,o=ec(),a=tc(i);return n=zc(n),null===t.context?t.context=n:t.pendingContext=n,(t=jo(o,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=No(i,t,a))&&(nc(e,i,a,o),Lo(e,i,a)),a}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Vc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Jc(e,t){Vc(e,t),(e=e.alternate)&&Vc(e,t)}_u=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ei.current)bs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bs=!1,function(e,t,n){switch(t.tag){case 3:Ps(t),ho();break;case 5:aa(t);break;case 1:Ri(t.type)&&Li(t);break;case 4:ia(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ci(mo,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ci(ua,1&ua.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ds(e,t,n):(Ci(ua,1&ua.current),null!==(e=Bs(e,t,n))?e.sibling:null);Ci(ua,1&ua.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return zs(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ci(ua,ua.current),r)break;return null;case 22:case 23:return t.lanes=0,Is(e,t,n)}return Bs(e,t,n)}(e,t,n);bs=0!==(131072&e.flags)}else bs=!1,io&&0!==(1048576&t.flags)&&Zi(t,Vi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Gs(e,t),e=t.pendingProps;var i=Mi(t,Ai.current);Io(t,n),i=Sa(null,t,r,e,i,n);var a=Ia();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ri(r)?(a=!0,Li(t)):a=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Ro(t),i.updater=zo,t.stateNode=i,i._reactInternals=t,Vo(t,r,e,n),t=Es(null,t,r,!0,a,n)):(t.tag=0,io&&a&&eo(t),ks(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Gs(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Rc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===M)return 14}return 2}(r),e=yo(r,e),i){case 0:t=Ts(null,t,r,e,n);break e;case 1:t=As(null,t,r,e,n);break e;case 11:t=xs(null,t,r,e,n);break e;case 14:t=_s(null,t,r,yo(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ts(e,t,r,i=t.elementType===r?i:yo(r,i),n);case 1:return r=t.type,i=t.pendingProps,As(e,t,r,i=t.elementType===r?i:yo(r,i),n);case 3:e:{if(Ps(t),null===e)throw Error(o(387));r=t.pendingProps,i=(a=t.memoizedState).element,Oo(e,t),Wo(t,r,null,n);var s=t.memoizedState;if(r=s.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Ms(e,t,r,n,i=ls(Error(o(423)),t));break e}if(r!==i){t=Ms(e,t,r,n,i=ls(Error(o(424)),t));break e}for(ro=ci(t.stateNode.containerInfo.firstChild),no=t,io=!0,oo=null,n=Xo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ho(),r===i){t=Bs(e,t,n);break e}ks(e,t,r,n)}t=t.child}return t;case 5:return aa(t),null===e&&co(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,s=i.children,ni(r,i)?s=null:null!==a&&ni(r,a)&&(t.flags|=32),Cs(e,t),ks(e,t,s,n),t.child;case 6:return null===e&&co(t),null;case 13:return Ds(e,t,n);case 4:return ia(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Yo(t,null,r,n):ks(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,xs(e,t,r,i=t.elementType===r?i:yo(r,i),n);case 7:return ks(e,t,t.pendingProps,n),t.child;case 8:case 12:return ks(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,s=i.value,Ci(mo,r._currentValue),r._currentValue=s,null!==a)if(sr(a.value,s)){if(a.children===i.children&&!Ei.current){t=Bs(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var u=a.dependencies;if(null!==u){s=a.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=jo(-1,n&-n)).tag=2;var l=a.updateQueue;if(null!==l){var d=(l=l.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),l.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),So(a.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),So(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}ks(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Io(t,n),r=r(i=Co(i)),t.flags|=1,ks(e,t,r,n),t.child;case 14:return i=yo(r=t.type,t.pendingProps),_s(e,t,r,i=yo(r.type,i),n);case 15:return Ss(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:yo(r,i),Gs(e,t),t.tag=1,Ri(r)?(e=!0,Li(t)):e=!1,Io(t,n),Bo(t,r,i),Vo(t,r,i,n),Es(null,t,r,!0,e,n);case 19:return zs(e,t,n);case 22:return Is(e,t,n)}throw Error(o(156,t.tag))};var Kc="function"===typeof reportError?reportError:function(e){console.error(e)};function Qc(e){this._internalRoot=e}function $c(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function el(e,t,n,r,i){var o=n._reactRootContainer;if(o){var a=o;if("function"===typeof i){var s=i;i=function(){var e=Hc(a);s.call(e)}}Bc(t,a,e,i)}else a=function(e,t,n,r,i){if(i){if("function"===typeof r){var o=r;r=function(){var e=Hc(a);o.call(e)}}var a=Gc(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=a,e[hi]=a.current,zr(8===e.nodeType?e.parentNode:e),lc(),a}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var s=r;r=function(){var e=Hc(u);s.call(e)}}var u=qc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=u,e[hi]=u.current,zr(8===e.nodeType?e.parentNode:e),lc((function(){Bc(t,u,n,r)})),u}(n,t,e,i,r);return Hc(a)}$c.prototype.render=Qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Bc(e,t,null,null)},$c.prototype.unmount=Qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;lc((function(){Bc(null,e,null,null)})),t[hi]=null}},$c.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ot.length&&0!==t&&t<Ot[n].priority;n++);Ot.splice(n,0,e),0===n&&Dt(e)}},kt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(mt(t,1|n),rc(t,Ye()),0===(6&Au)&&(zu=Ye()+500,zi()))}break;case 13:lc((function(){var t=Po(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}})),Jc(e,1)}},xt=function(e){if(13===e.tag){var t=Po(e,134217728);if(null!==t)nc(t,e,134217728,ec());Jc(e,134217728)}},_t=function(e){if(13===e.tag){var t=tc(e),n=Po(e,t);if(null!==n)nc(n,e,t,ec());Jc(e,t)}},St=function(){return wt},It=function(e,t){var n=wt;try{return wt=e,t()}finally{wt=n}},xe=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=ki(r);if(!i)throw Error(o(90));J(r),X(r,i)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ae=cc,Ee=lc;var tl={usingClientEntryPoint:!1,Events:[wi,bi,ki,Ce,Te,cc]},nl={findFiberByHostInstance:mi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rl={bundleType:nl.bundleType,version:nl.version,rendererPackageName:nl.rendererPackageName,rendererConfig:nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:nl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var il=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!il.isDisabled&&il.supportsFiber)try{it=il.inject(rl),ot=il}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(o(200));return Uc(e,t,null,n)},t.createRoot=function(e,t){if(!Yc(e))throw Error(o(299));var n=!1,r="",i=Kc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=qc(e,1,!1,null,0,n,0,r,i),e[hi]=t.current,zr(8===e.nodeType?e.parentNode:e),new Qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return lc(e)},t.hydrate=function(e,t,n){if(!Xc(t))throw Error(o(200));return el(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yc(e))throw Error(o(405));var r=null!=n&&n.hydratedSources||null,i=!1,a="",s=Kc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Gc(t,null,e,1,null!=n?n:null,i,0,a,s),e[hi]=t.current,zr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new $c(t)},t.render=function(e,t,n){if(!Xc(t))throw Error(o(200));return el(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Xc(e))throw Error(o(40));return!!e._reactRootContainer&&(lc((function(){el(null,null,e,!1,(function(){e._reactRootContainer=null,e[hi]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Xc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return el(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},250:function(e,t,n){"use strict";var r=n(164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},374:function(e,t,n){"use strict";var r=n(791),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)a.call(t,r)&&!u.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:l,props:o,_owner:s.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},117:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),f=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||h}function m(){}function w(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||h}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},m.prototype=y.prototype;var b=w.prototype=new m;b.constructor=w,v(b,y.prototype),b.isPureReactComponent=!0;var k=Array.isArray,x=Object.prototype.hasOwnProperty,_={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function I(e,t,r){var i,o={},a=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)x.call(t,i)&&!S.hasOwnProperty(i)&&(o[i]=t[i]);var u=arguments.length-2;if(1===u)o.children=r;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];o.children=c}if(e&&e.defaultProps)for(i in u=e.defaultProps)void 0===o[i]&&(o[i]=u[i]);return{$$typeof:n,type:e,key:a,ref:s,props:o,_owner:_.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function E(e,t,i,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return a=a(u=e),e=""===o?"."+A(u,0):o,k(a)?(i="",null!=e&&(i=e.replace(T,"$&/")+"/"),E(a,t,i,"",(function(e){return e}))):null!=a&&(C(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,i+(!a.key||u&&u.key===a.key?"":(""+a.key).replace(T,"$&/")+"/")+e)),t.push(a)),1;if(u=0,o=""===o?".":o+":",k(e))for(var c=0;c<e.length;c++){var l=o+A(s=e[c],c);u+=E(s,t,i,l,a)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)u+=E(s=s.value,t,i,l=o+A(s,c++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function P(e,t,n){if(null==e)return e;var r=[],i=0;return E(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function M(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R={current:null},O={transition:null},j={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:O,ReactCurrentOwner:_};t.Children={map:P,forEach:function(e,t,n){P(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=i,t.Profiler=a,t.PureComponent=w,t.StrictMode=o,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=j,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=v({},e.props),o=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=_.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)x.call(t,c)&&!S.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){u=Array(c);for(var l=0;l<c;l++)u[l]=arguments[l+2];i.children=u}return{$$typeof:n,type:e.type,key:o,ref:a,props:i,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=I,t.createFactory=function(e){var t=I.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:M}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=O.transition;O.transition={};try{e()}finally{O.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return R.current.useCallback(e,t)},t.useContext=function(e){return R.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return R.current.useDeferredValue(e)},t.useEffect=function(e,t){return R.current.useEffect(e,t)},t.useId=function(){return R.current.useId()},t.useImperativeHandle=function(e,t,n){return R.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return R.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return R.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return R.current.useMemo(e,t)},t.useReducer=function(e,t,n){return R.current.useReducer(e,t,n)},t.useRef=function(e){return R.current.useRef(e)},t.useState=function(e){return R.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return R.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return R.current.useTransition()},t.version="18.2.0"},791:function(e,t,n){"use strict";e.exports=n(117)},184:function(e,t,n){"use strict";e.exports=n(374)},813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var s=2*(r+1)-1,u=e[s],c=s+1,l=e[c];if(0>o(u,n))c<i&&0>o(l,u)?(e[r]=l,e[c]=n,r=c):(e[r]=u,e[s]=n,r=s);else{if(!(c<i&&0>o(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var c=[],l=[],d=1,p=null,f=3,h=!1,v=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,m="function"===typeof clearTimeout?clearTimeout:null,w="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(l);null!==t;){if(null===t.callback)i(l);else{if(!(t.startTime<=e))break;i(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function k(e){if(g=!1,b(e),!v)if(null!==r(c))v=!0,O(x);else{var t=r(l);null!==t&&j(k,t.startTime-e)}}function x(e,n){v=!1,g&&(g=!1,m(C),C=-1),h=!0;var o=f;try{for(b(n),p=r(c);null!==p&&(!(p.expirationTime>n)||e&&!E());){var a=p.callback;if("function"===typeof a){p.callback=null,f=p.priorityLevel;var s=a(p.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?p.callback=s:p===r(c)&&i(c),b(n)}else i(c);p=r(c)}if(null!==p)var u=!0;else{var d=r(l);null!==d&&j(k,d.startTime-n),u=!1}return u}finally{p=null,f=o,h=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,S=!1,I=null,C=-1,T=5,A=-1;function E(){return!(t.unstable_now()-A<T)}function P(){if(null!==I){var e=t.unstable_now();A=e;var n=!0;try{n=I(!0,e)}finally{n?_():(S=!1,I=null)}}else S=!1}if("function"===typeof w)_=function(){w(P)};else if("undefined"!==typeof MessageChannel){var M=new MessageChannel,R=M.port2;M.port1.onmessage=P,_=function(){R.postMessage(null)}}else _=function(){y(P,0)};function O(e){I=e,S||(S=!0,_())}function j(e,n){C=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||h||(v=!0,O(x))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,o){var a=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(l,e),null===r(c)&&e===r(l)&&(g?(m(C),C=-1):g=!0,j(k,o-a))):(e.sortIndex=s,n(c,e),v||h||(v=!0,O(x))),e},t.unstable_shouldYield=E,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},296:function(e,t,n){"use strict";e.exports=n(813)},559:function(e){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},897:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},372:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},405:function(e,t,n){var r=n(897);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},115:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},156:function(e){function t(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=e.apply(n,r);function s(e){t(a,i,o,s,u,"next",e)}function u(e){t(a,i,o,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},690:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},728:function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},704:function(e,t,n){var r=n(116);e.exports=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}},e.exports.__esModule=!0,e.exports.default=e.exports},389:function(e,t,n){var r=n(808),i=n(617),o=n(993);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var a=r(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return o(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},416:function(e){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},588:function(e,t,n){var r=n(753);function i(){return"undefined"!==typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=i=function(e,t,n){var i=r(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},e.exports.__esModule=!0,e.exports.default=e.exports),i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},808:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},655:function(e,t,n){var r=n(15);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},617:function(e){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},498:function(e){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},872:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(u){s=!0,i=u}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}},e.exports.__esModule=!0,e.exports.default=e.exports},218:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},281:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},122:function(e,t,n){var r=n(416);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},e.exports.__esModule=!0,e.exports.default=e.exports},215:function(e,t,n){var r=n(71);e.exports=function(e,t){if(null==e)return{};var n,i,o=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o},e.exports.__esModule=!0,e.exports.default=e.exports},71:function(e){e.exports=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i},e.exports.__esModule=!0,e.exports.default=e.exports},993:function(e,t,n){var r=n(698).default,i=n(115);e.exports=function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},61:function(e,t,n){var r=n(698).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(M){d=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),s=new A(r||[]);return a(o,"_invoke",{value:S(e,n,s)}),o}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(M){return{type:"throw",arg:M}}}t.wrap=p;var h={};function v(){}function g(){}function y(){}var m={};d(m,u,(function(){return this}));var w=Object.getPrototypeOf,b=w&&w(w(E([])));b&&b!==n&&o.call(b,u)&&(m=b);var k=y.prototype=v.prototype=Object.create(m);function x(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function n(i,a,s,u){var c=f(e[i],e,a);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==r(d)&&o.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;a(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function S(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return P()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=I(a,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=f(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function I(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,I(e,t),"throw"===t.method))return h;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var r=f(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,h;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function E(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:P}}function P(){return{value:void 0,done:!0}}return g.prototype=y,a(k,"constructor",{value:y,configurable:!0}),a(y,"constructor",{value:g,configurable:!0}),g.displayName=d(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,d(e,l,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(_.prototype),d(_.prototype,c,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new _(p(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(k),d(k,l,"Generator"),d(k,u,(function(){return this})),d(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=E,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},15:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},424:function(e,t,n){var r=n(372),i=n(872),o=n(116),a=n(218);e.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},753:function(e,t,n){var r=n(808);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},861:function(e,t,n){var r=n(405),i=n(498),o=n(116),a=n(281);e.exports=function(e){return r(e)||i(e)||o(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},698:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},116:function(e,t,n){var r=n(897);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,r){return n.f[r](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+".2fbcdd4b.chunk.js"},n.miniCssF=function(e){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={},t="intents-resolver:";n.l=function(r,i,o,a){if(e[r])e[r].push(i);else{var s,u;if(void 0!==o)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+o){s=d;break}}s||(u=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+o),s.src=r),e[r]=[i];var p=function(t,n){s.onerror=s.onload=null,clearTimeout(f);var i=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((function(e){return e(n)})),t)return t(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),u&&document.head.appendChild(s)}}}(),n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="./",function(){var e={179:0};n.f.j=function(t,r){var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise((function(n,r){i=e[t]=[n,r]}));r.push(i[2]=o);var a=n.p+n.u(t),s=new Error;n.l(a,(function(r){if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",s.name="ChunkLoadError",s.type=o,s.request=a,i[1](s)}}),"chunk-"+t,t)}};var t=function(t,r){var i,o,a=r[0],s=r[1],u=r[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(u)u(n)}for(t&&t(r);c<a.length;c++)o=a[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.webpackChunkintents_resolver=self.webpackChunkintents_resolver||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}(),function(){"use strict";var e=n(791),t=n(250);function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function o(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(){l=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(M){u=function(e,t,n){return e[t]=n}}function d(e,t,n,i){var o=t&&t.prototype instanceof h?t:h,a=Object.create(o.prototype),s=new T(i||[]);return r(a,"_invoke",{value:_(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(M){return{type:"throw",arg:M}}}e.wrap=d;var f={};function h(){}function v(){}function g(){}var y={};u(y,o,(function(){return this}));var m=Object.getPrototypeOf,w=m&&m(m(A([])));w&&w!==t&&n.call(w,o)&&(y=w);var b=g.prototype=h.prototype=Object.create(y);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function i(r,o,a,s){var u=p(e[r],e,o);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==c(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(u.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function _(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return E()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=S(a,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function S(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=p(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,f;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function A(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return v.prototype=g,r(b,"constructor",{value:g,configurable:!0}),r(g,"constructor",{value:v,configurable:!0}),v.displayName=u(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,u(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},k(x.prototype),u(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new x(d(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(b),u(b,s,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=A,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;C(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:A(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}function d(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){d(o,r,i,a,s,"next",e)}function s(e){d(o,r,i,a,s,"throw",e)}a(void 0)}))}}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(M){s=!0,i=M}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var h=n(7);function v(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))}var g=(0,e.createContext)(null),y=(0,e.memo)((function(t){var n=t.children,r=t.fallback,i=void 0===r?null:r,o=t.settings,a=function(t){var n=f((0,e.useState)(null),2),r=n[0],i=n[1];return(0,e.useEffect)((function(){v(void 0,void 0,void 0,l().mark((function e(){var n,r,o,a,s,u,c,d,p,f,h,v,g,y,m,w;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t.web||!t.webPlatform){e.next=3;break}throw new Error("Cannot initialize, because the settings are over-specified: defined are both web and webPlatform. Please set one or the other");case 3:if("undefined"===typeof window.glue42gd){e.next=12;break}return h=(null===(n=t.desktop)||void 0===n?void 0:n.factory)||(null===(r=t.web)||void 0===r?void 0:r.factory)||(null===(o=t.webPlatform)||void 0===o?void 0:o.factory)||window.Glue,v=(null===(a=t.desktop)||void 0===a?void 0:a.config)||(null===(s=t.web)||void 0===s?void 0:s.config)||(null===(u=t.webPlatform)||void 0===u?void 0:u.config),e.next=9,h(v);case 9:return g=e.sent,i(g.glue||g),e.abrupt("return");case 12:return y=(null===(c=t.web)||void 0===c?void 0:c.config)||(null===(d=t.webPlatform)||void 0===d?void 0:d.config),m=(null===(p=t.web)||void 0===p?void 0:p.factory)||(null===(f=t.webPlatform)||void 0===f?void 0:f.factory)||window.GlueWeb||window.GlueWebPlatform,e.next=16,m(y);case 16:w=e.sent,i(w.glue||w),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),console.error(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})))}),[]),r}(void 0===o?{}:o);return a?e.createElement(g.Provider,{value:a},n):e.createElement(e.Fragment,null,i)}));y.propTypes={children:h.node,settings:h.object,fallback:h.node},y.displayName="GlueProvider";var m=n(184),w=function(){var t=(0,e.useContext)(g),n=f((0,e.useState)([]),2),r=n[0],i=n[1],a=function(){var e=p(l().mark((function e(){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=t.themes)||void 0===n?void 0:n.getCurrent();case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return");case 5:document.querySelector("html").classList.add(r.name);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s=function(){var e=p(l().mark((function e(){var n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.querySelector("html"),!((r=n.getBoundingClientRect().height)>800)){e.next=4;break}return e.abrupt("return");case 4:if(i=t.windows.my(),!window.glue42core){e.next=7;break}return e.abrupt("return",i.moveResize({height:r+100,width:400}));case 7:return e.abrupt("return",i.resizeTo(void 0,r+50));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=function(){var e=p(l().mark((function e(n){var i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.find((function(e){return"app"===e.type?e.applicationName===n:e.instanceId===n})),e.next=3,t.intents.resolver.sendResponse(u(u({},i),{},{id:void 0}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,e.useEffect)((function(){a(),t.intents.resolver.onHandlerAdded((function(e){i((function(t){var n=u(u({},e),{},{id:"app"===e.type?e.applicationName:e.instanceId});return[].concat(o(t),[n])}))})),t.intents.resolver.onHandlerRemoved((function(e){i((function(t){var n=u(u({},e),{},{id:"app"===e.type?e.applicationName:e.instanceId});return t.filter((function(e){return e.id!==n.id}))}))}))}),[]),(0,e.useEffect)((function(){s()}),[r]),(0,m.jsxs)("div",{className:"container-fluid",children:[!t&&(0,m.jsx)("div",{className:"tick42-loader active",children:(0,m.jsx)("div",{className:"tick42-loader-text",children:"Loading ..."})}),(0,m.jsx)("div",{className:"row mt-3",children:(0,m.jsx)("div",{className:"col",children:(0,m.jsxs)("h3",{style:{margin:0},children:["Choose an app to ",t.intents.resolver.intent]})})}),(0,m.jsx)("div",{className:"row mt-3",children:(0,m.jsx)("div",{className:"col",children:(0,m.jsx)("h5",{children:"Start new:"})})}),(0,m.jsx)("ul",{className:"list-group",children:r.filter((function(e){return"app"===e.type})).map((function(e){return(0,m.jsxs)("li",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center",onClick:function(){return c(e.id)},children:[(0,m.jsxs)("span",{children:[e.applicationIcon?(0,m.jsx)("img",{src:"data:image/png;base64, "+e.applicationIcon,alt:"",style:{width:16},className:"mr-3"}):(0,m.jsx)("i",{className:"icon-app mr-3"}),e.applicationTitle||e.applicationName]}),(0,m.jsx)("span",{className:"badge badge-info badge-pill",children:"app"})]},e.id)}))}),!!r.filter((function(e){return"instance"===e.type})).length&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"row mt-3",children:(0,m.jsx)("div",{className:"col",children:(0,m.jsx)("h5",{children:"Use already running:"})})}),(0,m.jsx)("ul",{className:"list-group",children:r.filter((function(e){return"instance"===e.type})).map((function(e){return(0,m.jsxs)("li",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center",onClick:function(){return c(e.id)},children:[(0,m.jsxs)("span",{children:[e.applicationIcon?(0,m.jsx)("img",{src:"data:image/png;base64, "+e.applicationIcon,alt:"",style:{width:16},className:"mr-3"}):(0,m.jsx)("i",{className:"icon-app mr-3"}),e.applicationTitle||e.applicationName]}),(0,m.jsx)("span",{className:"badge badge-secondary badge-pill",children:"inst"})]},e.id)}))})]})]})},b=function(e){e&&e instanceof Function&&n.e(787).then(n.bind(n,787)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,o=t.getLCP,a=t.getTTFB;n(e),r(e),i(e),o(e),a(e)}))};function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function S(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function I(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}var C={logger:"info",gateway:{webPlatform:{}},libraries:[],exposeGlue:!0},T=function(e){var t,n,r,i,o=!!(null===(r=null===(n=null===(t=e)||void 0===t?void 0:t.gateway)||void 0===n?void 0:n.webPlatform)||void 0===r?void 0:r.port),a=Object.assign({},C,e,{isPlatformInternal:o});return a.systemLogger&&(a.logger=null!==(i=a.systemLogger.level)&&void 0!==i?i:"info"),a},A=function(){var e=window.glue42core;if(e&&e.webStarted)throw new Error("The Glue42 Core Web has already been started for this application.");e?e.webStarted=!0:window.glue42core={webStarted:!0}},E=function(e){var t,n,r,i={windows:!0,layouts:"full",appManager:"full",channels:!0,libraries:null!==(t=null===e||void 0===e?void 0:e.libraries)&&void 0!==t?t:[],logger:null!==(r=null===(n=null===e||void 0===e?void 0:e.systemLogger)||void 0===n?void 0:n.level)&&void 0!==r?r:"warn"};return window.Glue(i)},P=function(e){return{ok:!0,result:e}},M=function(e){return{ok:!1,error:e}},R=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},O=function(e,t){return!0===t.ok?t.result:e},j=function(e){if(!0===e.ok)return e.result;throw e.error},N=function(e,t){return!0===t.ok?P(e(t.result)):t},L=function(e,t,n){return!1===t.ok?t:!1===n.ok?n:P(e(t.result,n.result))},D=function(e,t){return!0===t.ok?t:M(e(t.error))},W=function(e,t){return!0===t.ok?e(t.result):t},F=(Object.freeze({ok:P,isOk:function(e){return!0===e.ok},err:M,isErr:function(e){return!1===e.ok},asPromise:R,withDefault:O,withException:j,successes:function(e){return e.reduce((function(e,t){return!0===t.ok?e.concat(t.result):e}),[])},map:N,map2:L,mapError:D,andThen:W}),function(){return F=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},F.apply(this,arguments)});function q(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if(typeof e!==typeof t)return!1;if("object"===typeof e){if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!q(e[n],t[n]))return!1;return!0}var r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(n=0;n<r.length;n++){if(!t.hasOwnProperty(r[n]))return!1;if(!q(e[r[n]],t[r[n]]))return!1}return!0}}var U=function(e){return Array.isArray(e)},z=function(e){return"object"===typeof e&&null!==e&&!U(e)},G=function(e,t){return"expected "+e+", got "+function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}}(t)},B=function(e){return e.map((function(e){return"string"===typeof e?"."+e:"["+e+"]"})).join("")},H=function(e,t){var n=t.at,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["at"]);return F({at:e+(n||"")},r)},V=function(){function e(t){var n=this;this.decode=t,this.run=function(e){return D((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),n.decode(e))},this.runPromise=function(e){return R(n.run(e))},this.runWithException=function(e){return j(n.run(e))},this.map=function(t){return new e((function(e){return N(t,n.decode(e))}))},this.andThen=function(t){return new e((function(e){return W((function(n){return t(n).decode(e)}),n.decode(e))}))},this.where=function(t,r){return n.andThen((function(n){return t(n)?e.succeed(n):e.fail(r)}))}}return e.string=function(){return new e((function(e){return"string"===typeof e?P(e):M({message:G("a string",e)})}))},e.number=function(){return new e((function(e){return"number"===typeof e?P(e):M({message:G("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"===typeof e?P(e):M({message:G("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return q(e,t)?P(t):M({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(z(e)&&t){var n={};for(var r in t)if(t.hasOwnProperty(r)){var i=t[r].decode(e[r]);if(!0!==i.ok)return void 0===e[r]?M({message:"the key '"+r+"' is required but was not present"}):M(H("."+r,i.error));void 0!==i.result&&(n[r]=i.result)}return P(n)}return z(e)?P(e):M({message:G("an object",e)})}))},e.array=function(t){return new e((function(e){if(U(e)&&t){return e.reduce((function(e,n,r){return L((function(e,t){return e.concat([t])}),e,function(e,n){return D((function(e){return H("["+n+"]",e)}),t.decode(e))}(n,r))}),P([]))}return U(e)?P(e):M({message:G("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(U(e)){if(e.length!==t.length)return M({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e[r]);if(!i.ok)return M(H("["+r+"]",i.error));n[r]=i.result}return P(n)}return M({message:G("a tuple of length "+t.length,e)})}))},e.union=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.oneOf.apply(e,[t,n].concat(r))},e.intersection=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new e((function(e){return[t,n].concat(r).reduce((function(t,n){return L(Object.assign,t,n.decode(e))}),P({}))}))},e.anyJson=function(){return new e((function(e){return P(e)}))},e.unknownJson=function(){return new e((function(e){return P(e)}))},e.dict=function(t){return new e((function(e){if(z(e)){var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=t.decode(e[r]);if(!0!==i.ok)return M(H("."+r,i.error));n[r]=i.result}return P(n)}return M({message:G("an object",e)})}))},e.optional=function(t){return new e((function(e){return void 0===e||null===e?P(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new e((function(e){for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e);if(!0===i.ok)return i;n[r]=i.error}var o=n.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return M({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},e.withDefault=function(t,n){return new e((function(e){return P(O(t,n.decode(e)))}))},e.valueAt=function(t,n){return new e((function(e){for(var r=e,i=0;i<t.length;i++){if(void 0===r)return M({at:B(t.slice(0,i+1)),message:"path does not exist"});if("string"===typeof t[i]&&!z(r))return M({at:B(t.slice(0,i+1)),message:G("an object",r)});if("number"===typeof t[i]&&!U(r))return M({at:B(t.slice(0,i+1)),message:G("an array",r)});r=r[t[i]]}return D((function(e){return void 0===r?{at:B(t),message:"path does not exist"}:H(B(t),e)}),n.decode(r))}))},e.succeed=function(t){return new e((function(e){return P(t)}))},e.fail=function(t){return new e((function(e){return M({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),J=V.string,K=V.number,Q=V.boolean,$=V.anyJson,Y=V.constant,X=V.object,Z=V.array,ee=V.optional,te=V.oneOf,ne=V.lazy,re=J().where((function(e){return e.length>0}),"Expected a non-empty string"),ie=K().where((function(e){return e>=0}),"Expected a non-negative number"),oe=te(Y("system"),Y("windows"),Y("appManager"),Y("layouts"),Y("intents"),Y("notifications"),Y("channels"),Y("extension")),ae=te(Y("openWindow"),Y("windowHello"),Y("windowAdded"),Y("windowRemoved"),Y("getBounds"),Y("getFrameBounds"),Y("getUrl"),Y("moveResize"),Y("focus"),Y("close"),Y("getTitle"),Y("setTitle")),se=te(Y("appHello"),Y("appDirectoryStateChange"),Y("instanceStarted"),Y("instanceStopped"),Y("applicationStart"),Y("instanceStop"),Y("clear")),ue=te(Y("layoutAdded"),Y("layoutChanged"),Y("layoutRemoved"),Y("get"),Y("getAll"),Y("export"),Y("import"),Y("remove"),Y("clientSaveRequest"),Y("getGlobalPermissionState"),Y("checkGlobalActivated"),Y("requestGlobalPermission")),ce=te(Y("raiseNotification"),Y("requestPermission"),Y("notificationShow"),Y("notificationClick"),Y("getPermission")),le=te(Y("top"),Y("left"),Y("right"),Y("bottom")),de=X({top:K(),left:K(),width:ie,height:ie}),pe=ee(X({top:ee(K()),left:ee(K()),width:ee(ie),height:ee(ie),context:ee($()),relativeTo:ee(re),relativeDirection:ee(le),windowId:ee(re)})),fe=X({name:re,url:re,options:pe}),he=X({windowId:ee(re)}),ve=X({windowId:re,name:re}),ge=X({windowId:re}),ye=X({windows:Z(ve),isWorkspaceFrame:Q()}),me=X({windowId:re,title:J()}),we=X({windowId:re,top:ee(K()),left:ee(K()),width:ee(ie),height:ee(ie),relative:ee(Q())}),be=X({windowId:re,bounds:X({top:K(),left:K(),width:ie,height:ie})}),ke=X({bounds:X({top:K(),left:K(),width:ie,height:ie})}),xe=X({windowId:re,url:re}),_e=$(),Se=X({top:ee(K()),left:ee(K()),width:ee(ie),height:ee(ie)}),Ie=X({id:re,applicationName:re}),Ce=X({url:re,top:ee(K()),left:ee(K()),width:ee(ie),height:ee(ie)}),Te=X({name:re,displayName:ee(J()),contexts:ee(Z(J())),customConfig:ee(X())}),Ae=X({name:re,title:ee(re),version:ee(re),appId:ee(re),manifest:re,manifestType:re,tooltip:ee(re),description:ee(re),contactEmail:ee(re),supportEmail:ee(re),publisher:ee(re),images:ee(Z(X({url:ee(re)}))),icons:ee(Z(X({icon:ee(re)}))),customConfig:$(),intents:ee(Z(Te))}),Ee=X({name:re,type:re.where((function(e){return"window"===e}),"Expected a value of window"),title:ee(re),version:ee(re),customProperties:ee($()),icon:ee(J()),caption:ee(J()),details:Ce,intents:ee(Z(Te)),hidden:ee(Q())}),Pe=te(Ee,Ae),Me=(X({definitions:Z(Pe),mode:te(Y("replace"),Y("merge"))}),X({name:re})),Re=X({definitions:Z(Ee)}),Oe=X({name:re,type:re.where((function(e){return"window"===e}),"Expected a value of window"),instances:Z(Ie),userProperties:ee($()),title:ee(re),version:ee(re),icon:ee(re),caption:ee(re)}),je=X({name:re,type:re.where((function(e){return"window"===e}),"Expected a value of window"),userProperties:$(),title:ee(re),version:ee(re),icon:ee(re),caption:ee(re)}),Ne=X({appsAdded:Z(je),appsChanged:Z(je),appsRemoved:Z(je)}),Le=X({apps:Z(Oe)}),De=X({id:re}),We=X({name:re,waitForAGMReady:Q(),id:ee(re),context:ee($()),top:ee(K()),left:ee(K()),width:ee(ie),height:ee(ie),relativeTo:ee(re),relativeDirection:ee(te(Y("top"),Y("left"),Y("right"),Y("bottom"))),forceChromeTab:ee(Q())}),Fe=te(Y("Global"),Y("Activity"),Y("ApplicationDefault"),Y("Swimlane"),Y("Workspace")),qe=te(Y("application"),Y("activity")),Ue=X({context:ee($()),bounds:de,createArgs:X({name:ee(re),url:ee(re),context:ee($())}),windowState:ee(re),restoreState:ee(re),instanceId:re,isCollapsed:ee(Q()),isSticky:ee(Q()),restoreSettings:X({groupId:ee(re),groupZOrder:ee(K())})}),ze=X({type:Y("window"),componentType:ee(qe),application:re,state:Ue}),Ge=X({type:Y("window"),config:X({appName:re,url:ee(re),title:ee(J()),allowExtract:ee(Q()),allowReorder:ee(Q()),showCloseButton:ee(Q()),isMaximized:ee(Q())})}),Be=X({type:Y("group"),config:$(),children:Z(te(Ge))}),He=X({type:Y("column"),config:$(),children:Z(te(Be,Ge,ne((function(){return He})),ne((function(){return Ve}))))}),Ve=X({type:Y("row"),config:$(),children:Z(te(He,Be,Ge,ne((function(){return Ve}))))}),Je=X({config:$(),context:$(),children:Z(te(Ve,He,Be,Ge))}),Ke=X({type:Y("Workspace"),application:ee(re),state:Je}),Qe=X({bounds:de,instanceId:re,selectedWorkspace:ie,workspaces:Z(Je),windowState:ee(re),restoreState:ee(re)}),$e=X({type:Y("workspaceFrame"),application:re,componentType:ee(qe),state:Qe}),Ye=X({name:re,type:Fe,components:Z(te(ze,Ke,$e)),context:ee($()),metadata:ee($())}),Xe=X({name:re,context:ee($()),metadata:ee($()),instances:ee(Z(re)),ignoreInstances:ee(Z(re))}),Ze=X({name:re,context:ee($()),closeRunningInstance:ee(Q()),closeMe:ee(Q()),timeout:ee(ie)}),et=X({name:re,type:Fe,context:ee($()),metadata:ee($())}),tt=X({name:re,type:Fe}),nt=X({layout:Xe}),rt=X({layout:Ze}),it=X({type:Fe}),ot=X({layouts:Z(Ye)}),at=te(Y("replace"),Y("merge")),st=X({layouts:Z(Ye),mode:at}),ut=X({summaries:Z(et)}),ct=X({layout:Ye}),lt=X({layout:ee(Ye)}),dt=te(Y("findIntent"),Y("getIntents"),Y("raiseIntent")),pt=X({applicationName:re,applicationTitle:J(),applicationDescription:ee(J()),applicationIcon:ee(J()),type:te(Y("app"),Y("instance")),displayName:ee(J()),contextTypes:ee(Z(re)),instanceId:ee(J()),instanceTitle:ee(J()),resultType:ee(J())}),ft=X({intent:re,handler:pt}),ht=X({name:re,handlers:Z(pt)}),vt=te(Y("startNew"),Y("reuse"),X({app:ee(re),instance:ee(re)})),gt=X({type:ee(re),data:ee(X())}),yt=X({intents:Z(ht)}),mt=X({name:ee(re),contextType:ee(re),resultType:ee(re)}),wt=te(re,mt),bt=X({filter:ee(mt)}),kt=X({intent:re,target:ee(vt),context:ee(gt),options:ee(pe)}),xt=te(re,kt),_t=X({request:kt,handler:pt,result:$()}),St=X({intent:re,contextTypes:ee(Z(re)),displayName:ee(J()),icon:ee(J()),description:ee(J()),resultType:ee(J())}),It=te(re,St),Ct=function(e){return re.where((function(t){return e.includes(t)}),"Expected a valid channel name")},Tt=X({method:re,arguments:ee($()),target:ee(te(Y("all"),Y("best")))}),At=X({action:J(),title:re,icon:ee(J()),interop:ee(Tt)}),Et=X({badge:ee(J()),body:ee(J()),data:ee($()),dir:ee(te(Y("auto"),Y("ltr"),Y("rtl"))),icon:ee(J()),image:ee(J()),lang:ee(J()),renotify:ee(Q()),requireInteraction:ee(Q()),silent:ee(Q()),tag:ee(J()),timestamp:ee(ie),vibrate:ee(Z(K()))}),Pt=X({title:re,clickInterop:ee(Tt),actions:ee(Z(At)),focusPlatformOnDefaultClick:ee(Q()),badge:ee(J()),body:ee(J()),data:ee($()),dir:ee(te(Y("auto"),Y("ltr"),Y("rtl"))),icon:ee(J()),image:ee(J()),lang:ee(J()),renotify:ee(Q()),requireInteraction:ee(Q()),silent:ee(Q()),tag:ee(J()),timestamp:ee(ie),vibrate:ee(Z(K()))}),Mt=X({name:re,meta:X({color:re}),data:ee(X())}),Rt=X({settings:Pt,id:re}),Ot=X({permissionGranted:Q()}),jt=X({permission:te(Y("default"),Y("granted"),Y("denied"))}),Nt=X({definition:Et,action:ee(J()),id:ee(re)}),Lt=X({layoutType:te(Y("Global"),Y("Workspace")),layoutName:re,context:ee($())}),Dt=X({windowContext:ee($())}),Wt=X({state:te(Y("prompt"),Y("denied"),Y("granted"))}),Ft=X({isAvailable:Q()}),qt={openWindow:{name:"openWindow",dataDecoder:fe,resultDecoder:ve},windowHello:{name:"windowHello",dataDecoder:he,resultDecoder:ye},windowAdded:{name:"windowAdded",dataDecoder:ve},windowRemoved:{name:"windowRemoved",dataDecoder:ge},getBounds:{name:"getBounds",dataDecoder:ge,resultDecoder:be},getFrameBounds:{name:"getFrameBounds",dataDecoder:ge,resultDecoder:ke},getUrl:{name:"getUrl",dataDecoder:ge,resultDecoder:xe},moveResize:{name:"moveResize",dataDecoder:we},focus:{name:"focus",dataDecoder:ge},close:{name:"close",dataDecoder:ge},getTitle:{name:"getTitle",dataDecoder:ge,resultDecoder:me},setTitle:{name:"setTitle",dataDecoder:me}};function Ut(e){if(e&&e.errorHandling&&"function"!==typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"===typeof e.errorHandling&&e.errorHandling,n={};function r(n,r){var i=n instanceof Error?n:new Error(n);if(t)t(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t,i){var o=n[e];return o||(o=[],n[e]=o),o.push(t),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=n[e])||void 0===o?void 0:o.includes(t))try{Array.isArray(i)?t.apply(void 0,i):t.apply(void 0,[i])}catch(M){r(M,e)}}))}),0),function(){var r=n[e];r&&(r=r.reduce((function(e,n,r){return n===t&&e.length===r||e.push(n),e}),[]),n[e]=r)}},execute:function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=n[e];if(!o||0===o.length)return[];var a=[];return o.forEach((function(n){try{var i=n.apply(void 0,t);a.push(i)}catch(M){a.push(void 0),r(M,e)}})),a},clear:function(){n={}},clearKey:function(e){n[e]&&delete n[e]}}}Ut.default=Ut;var zt=Ut,Gt=function(){function e(t,n,r){k(this,e),this._id=t,this._name=n,this._bridge=r,this.registry=zt(),this.myCtxKey="___window___".concat(this.id)}return _(e,[{key:"id",get:function(){return this._id.slice()}},{key:"name",get:function(){return this._name.slice()}},{key:"clean",value:function(){this.ctxUnsubscribe&&this.ctxUnsubscribe()}},{key:"toApi",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t,n=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._bridge.contextLib.subscribe(this.myCtxKey,(function(e){return n.registry.execute("context-updated",e)}));case 2:return this.ctxUnsubscribe=e.sent,t={id:this.id,name:this.name,getURL:this.getURL.bind(this),moveResize:this.moveResize.bind(this),resizeTo:this.resizeTo.bind(this),moveTo:this.moveTo.bind(this),focus:this.focus.bind(this),close:this.close.bind(this),getTitle:this.getTitle.bind(this),setTitle:this.setTitle.bind(this),getBounds:this.getBounds.bind(this),getContext:this.getContext.bind(this),updateContext:this.updateContext.bind(this),setContext:this.setContext.bind(this),onContextUpdated:this.onContextUpdated.bind(this)},this.me=Object.freeze(t),e.abrupt("return",this.me);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"getURL",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._bridge.send("windows",qt.getUrl,{windowId:this.id});case 2:return t=e.sent,e.abrupt("return",t.url);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"moveResize",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Se.runWithException(e),r=Object.assign({},n,{windowId:this.id,relative:!1}),t.next=4,this._bridge.send("windows",qt.moveResize,r);case 4:return t.abrupt("return",this.me);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"resizeTo",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("undefined"!==typeof e||"undefined"!==typeof t){n.next=2;break}return n.abrupt("return",this.me);case 2:return"undefined"!==typeof e&&ie.runWithException(e),"undefined"!==typeof t&&ie.runWithException(t),r=Object.assign({},{width:e,height:t},{windowId:this.id,relative:!0}),n.next=7,this._bridge.send("windows",qt.moveResize,r);case 7:return n.abrupt("return",this.me);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"moveTo",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("undefined"!==typeof e||"undefined"!==typeof t){n.next=2;break}return n.abrupt("return",this.me);case 2:return"undefined"!==typeof e&&K().runWithException(e),"undefined"!==typeof t&&K().runWithException(t),r=Object.assign({},{top:e,left:t},{windowId:this.id,relative:!0}),n.next=7,this._bridge.send("windows",qt.moveResize,r);case 7:return n.abrupt("return",this.me);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"focus",value:function(){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Platform"!==this.name){e.next=4;break}window.open(void 0,this.id),e.next=6;break;case 4:return e.next=6,this._bridge.send("windows",qt.focus,{windowId:this.id});case 6:return e.abrupt("return",this.me);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"close",value:function(){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._bridge.send("windows",qt.close,{windowId:this.id});case 2:return e.abrupt("return",this.me);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getTitle",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._bridge.send("windows",qt.getTitle,{windowId:this.id});case 2:return t=e.sent,e.abrupt("return",t.title);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"setTitle",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=re.runWithException(e),t.next=3,this._bridge.send("windows",qt.setTitle,{windowId:this.id,title:n});case 3:return t.abrupt("return",this.me);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getBounds",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._bridge.send("windows",qt.getBounds,{windowId:this.id});case 2:return t=e.sent,e.abrupt("return",t.bounds);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getContext",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._bridge.contextLib.get(this.myCtxKey);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"updateContext",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=_e.runWithException(e),t.next=3,this._bridge.contextLib.update(this.myCtxKey,n);case 3:return t.abrupt("return",this.me);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"setContext",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=_e.runWithException(e),t.next=3,this._bridge.contextLib.set(this.myCtxKey,n);case 3:return t.abrupt("return",this.me);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"onContextUpdated",value:function(e){var t=this;if("function"!==typeof e)throw new Error("Cannot subscribe to context changes, because the provided callback is not a function!");return this.registry.add("context-updated",(function(n){e(n,t.me)}))}}]),e}(),Bt=function(){function e(){k(this,e),this.registry=zt(),this.allWindowProjections=[]}return _(e,[{key:"start",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.logger=e.logger.subLogger("windows.controller.web"),this.logger.trace("starting the web windows controller"),this.publicWindowId=t.publicWindowId,this.actualWindowId=t.actualWindowId,this.addWindowOperationExecutors(),this.ioc=t,this.bridge=t.bridge,this.logger.trace("set the public window id: ".concat(this.publicWindowId," and actual window id: ").concat(this.actualWindowId,", set the bridge operations and ioc, registering with the platform now")),this.platformRegistration=this.registerWithPlatform(),n.next=11,this.platformRegistration;case 11:this.logger.trace("registration with the platform successful, attaching the windows property to glue and returning"),r=this.toApi(),e.windows=r;case 14:case"end":return n.stop()}}),n,this)})))}},{key:"handleBridgeMessage",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.platformRegistration;case 2:if(n=ae.runWithException(e.operation),(r=qt[n]).execute){t.next=6;break}return t.abrupt("return");case 6:return i=e.data,r.dataDecoder&&(i=r.dataDecoder.runWithException(e.data)),t.next=10,r.execute(i);case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"open",value:function(e,t,n){return I(this,void 0,void 0,l().mark((function r(){var i,o,a;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return re.runWithException(e),re.runWithException(t),i=pe.runWithException(n),r.next=5,this.bridge.send("windows",qt.openWindow,{name:e,url:t,options:i});case 5:return o=r.sent,r.next=8,this.ioc.buildWebWindow(o.windowId,o.name);case 8:return a=r.sent,r.abrupt("return",a.api);case 10:case"end":return r.stop()}}),r,this)})))}},{key:"list",value:function(){return this.allWindowProjections.map((function(e){return e.api}))}},{key:"findById",value:function(e){var t;return re.runWithException(e),null===(t=this.allWindowProjections.find((function(t){return t.id===e})))||void 0===t?void 0:t.api}},{key:"toApi",value:function(){return{open:this.open.bind(this),my:this.my.bind(this),list:this.list.bind(this),findById:this.findById.bind(this),onWindowAdded:this.onWindowAdded.bind(this),onWindowRemoved:this.onWindowRemoved.bind(this)}}},{key:"addWindowOperationExecutors",value:function(){qt.windowAdded.execute=this.handleWindowAdded.bind(this),qt.windowRemoved.execute=this.handleWindowRemoved.bind(this),qt.getBounds.execute=this.handleGetBounds.bind(this),qt.getFrameBounds.execute=this.handleGetBounds.bind(this),qt.getTitle.execute=this.handleGetTitle.bind(this),qt.getUrl.execute=this.handleGetUrl.bind(this),qt.moveResize.execute=this.handleMoveResize.bind(this),qt.setTitle.execute=this.handleSetTitle.bind(this)}},{key:"my",value:function(){return Object.assign({},this.me)}},{key:"onWindowAdded",value:function(e){if("function"!==typeof e)throw new Error("Cannot subscribe to window added, because the provided callback is not a function!");return this.registry.add("window-added",e)}},{key:"onWindowRemoved",value:function(e){if("function"!==typeof e)throw new Error("Cannot subscribe to window removed, because the provided callback is not a function!");return this.registry.add("window-removed",e)}},{key:"sayHello",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bridge.send("windows",qt.windowHello,{windowId:this.actualWindowId});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"registerWithPlatform",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t,n,r,i,a,s,u=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sayHello();case 2:if(n=e.sent,r=n.windows,i=n.isWorkspaceFrame,this.logger.trace("the platform responded to the hello message"),i){e.next=14;break}if(this.logger.trace("i am not treated as a workspace frame, setting my window"),a=r.find((function(e){return e.windowId===u.publicWindowId}))){e.next=11;break}throw new Error("Cannot initialize the window library, because I received no information about me from the platform");case 11:return e.next=13,this.ioc.buildWebWindow(this.publicWindowId,a.name);case 13:this.me=e.sent.api;case 14:return e.next=16,Promise.all(r.map((function(e){return u.ioc.buildWebWindow(e.windowId,e.name)})));case 16:s=e.sent,this.logger.trace("all windows projections are completed, building the list collection"),(t=this.allWindowProjections).push.apply(t,o(s));case 19:case"end":return e.stop()}}),e,this)})))}},{key:"handleWindowAdded",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.allWindowProjections.some((function(t){return t.id===e.windowId}))){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.ioc.buildWebWindow(e.windowId,e.name);case 4:n=t.sent,this.allWindowProjections.push(n),this.registry.execute("window-added",n.api);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"handleWindowRemoved",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.allWindowProjections.find((function(t){return t.id===e.windowId}))){t.next=3;break}return t.abrupt("return");case 3:this.allWindowProjections=this.allWindowProjections.filter((function(t){return t.id!==e.windowId})),n.model.clean(),this.registry.execute("window-removed",n.api);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"handleGetBounds",value:function(){var e;return I(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{windowId:null===(e=this.me)||void 0===e?void 0:e.id,bounds:{top:window.screenTop,left:window.screenLeft,width:window.innerWidth,height:window.innerHeight}});case 1:case"end":return t.stop()}}),t,this)})))}},{key:"handleGetTitle",value:function(){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{windowId:this.me.id,title:document.title});case 1:case"end":return e.stop()}}),e,this)})))}},{key:"handleGetUrl",value:function(){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{windowId:this.me.id,url:window.location.href});case 1:case"end":return e.stop()}}),e,this)})))}},{key:"handleMoveResize",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i,o,a,s;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n="number"===typeof e.top?e.top:e.relative?0:window.screenTop,r="number"===typeof e.left?e.left:e.relative?0:window.screenLeft,i="number"===typeof e.height?e.height:e.relative?0:window.innerHeight,o="number"===typeof e.width?e.width:e.relative?0:window.innerWidth,a=e.relative?window.moveBy:window.moveTo,s=e.relative?window.resizeBy:window.resizeTo,a(r,n),s(o,i);case 8:case"end":return t.stop()}}),t)})))}},{key:"handleSetTitle",value:function(e){return I(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:document.title=e.title;case 1:case"end":return t.stop()}}),t)})))}}]),e}(),Ht=function(e,t,n){return new Promise((function(r,i){var o=!0,a=setTimeout((function(){if(o){o=!1;var e=n||"Promise timeout hit: ".concat(t);i(e)}}),t);e().then((function(e){o&&(o=!1,clearTimeout(a),r(e))})).catch((function(e){o&&(o=!1,clearTimeout(a),i(e))}))}))},Vt="T42.Web.Platform.Control",Jt="T42.Web.Platform.Stream",Kt=function(){function e(t,n){k(this,e),this.coreGlue=t,this.communicationId=n,this.platformMethodTimeoutMs=1e4}return _(e,[{key:"contextLib",get:function(){return this.coreGlue.contexts}},{key:"interopInstance",get:function(){return this.coreGlue.interop.instance.instance}},{key:"start",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i,o,a=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.controllers=e,t.next=3,Promise.all([this.checkWaitMethod(Vt),this.checkWaitMethod(Jt)]);case 3:return n=this.communicationId,t.next=6,Promise.all([this.coreGlue.interop.subscribe(Jt,n?{target:{instance:this.communicationId}}:void 0),this.coreGlue.interop.registerAsync("T42.Web.Client.Control",(function(e,t,n,r){return a.passMessageController(e,n,r)}))]);case 6:r=t.sent,i=f(r,1),o=i[0],this.sub=o,this.sub.onData((function(e){return a.passMessageController(e.data)}));case 11:case"end":return t.stop()}}),t,this)})))}},{key:"getInteropInstance",value:function(e){var t=this.coreGlue.interop.servers().find((function(t){return t.windowId&&t.windowId===e}));return{application:null===t||void 0===t?void 0:t.application,applicationName:null===t||void 0===t?void 0:t.applicationName,peerId:null===t||void 0===t?void 0:t.peerId,instance:null===t||void 0===t?void 0:t.instance,windowId:null===t||void 0===t?void 0:t.windowId}}},{key:"send",value:function(e,t,n,r){return I(this,void 0,void 0,l().mark((function i(){var o;return l().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!t.dataDecoder){i.next=8;break}i.prev=1,t.dataDecoder.runWithException(n),i.next=8;break;case 5:throw i.prev=5,i.t0=i.catch(1),new Error("Unexpected internal outgoing validation error: ".concat(i.t0.message,", for operation: ").concat(t.name," and input: ").concat(JSON.stringify(i.t0.input)));case 8:return i.prev=8,i.next=11,this.transmitMessage(e,t,n,r);case 11:return o=i.sent,t.resultDecoder&&t.resultDecoder.runWithException(o),i.abrupt("return",o);case 16:if(i.prev=16,i.t1=i.catch(8),!i.t1.kind){i.next=20;break}throw new Error("Unexpected internal incoming validation error: ".concat(i.t1.message,", for operation: ").concat(t.name," and input: ").concat(JSON.stringify(i.t1.input)));case 20:throw new Error(i.t1.message);case 21:case"end":return i.stop()}}),i,this,[[1,5],[8,16]])})))}},{key:"checkWaitMethod",value:function(e){var t,n,r,i=this;return t=function(t){if(i.coreGlue.interop.methods().some((function(t){var n=t.name===e,r=!i.communicationId||t.getServers().some((function(e){return e.instance===i.communicationId}));return n&&r})))return t();var n=i.coreGlue.interop.serverMethodAdded((function(r){var o=r.method,a=r.server,s=!i.communicationId||a.instance===i.communicationId;o.name===e&&s&&(n(),t())}))},n=this.platformMethodTimeoutMs,r="Cannot initiate Glue Web, because a system method's discovery timed out: ".concat(e),new Promise((function(e,i){var o=setTimeout((function(){var e=r||"Promise timeout hit: ".concat(n);i(e)}),n);new Promise(t).then((function(t){clearTimeout(o),e(t)})).catch((function(e){clearTimeout(o),i(e)}))}))}},{key:"passMessageController",value:function(e,t,n){var r=oe.run(e.domain);if(r.ok){var i=r.result;this.controllers[i].handleBridgeMessage(e).then((function(e){t&&t(e)})).catch((function(e){n&&n(e),console.warn(e)}))}else n&&n("Cannot execute this client control, because of domain validation error: ".concat(JSON.stringify(r.error)))}},{key:"transmitMessage",value:function(e,t,n,r){return I(this,void 0,void 0,l().mark((function i(){var o,a,s,u,c;return l().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o={domain:e,data:n,operation:t.name},s="Internal Platform Communication Error. Attempted operation: ".concat(JSON.stringify(t.name)," with data: ").concat(JSON.stringify(n),". "),u=this.communicationId,i.prev=3,i.next=6,this.coreGlue.interop.invoke(Vt,o,u?{instance:this.communicationId}:void 0,r);case 6:if(a=i.sent){i.next=9;break}throw new Error("Received unsupported result from the platform - empty result");case 9:if(Array.isArray(a.all_return_values)&&0!==a.all_return_values.length){i.next=11;break}throw new Error("Received unsupported result from the platform - empty values collection");case 11:i.next=19;break;case 13:if(i.prev=13,i.t0=i.catch(3),!(i.t0&&i.t0.all_errors&&i.t0.all_errors.length)){i.next=18;break}throw c=i.t0.all_errors[0].message,new Error("".concat(s," -> Inner message: ").concat(c));case 18:throw new Error("".concat(s," -> Inner message: ").concat(i.t0.message));case 19:return i.abrupt("return",a.all_return_values[0].returned);case 20:case"end":return i.stop()}}),i,this,[[3,13]])})))}}]),e}(),Qt={appHello:{name:"appHello",dataDecoder:he,resultDecoder:Le},appDirectoryStateChange:{name:"appDirectoryStateChange",dataDecoder:Ne},instanceStarted:{name:"instanceStarted",dataDecoder:Ie},instanceStopped:{name:"instanceStopped",dataDecoder:Ie},applicationStart:{name:"applicationStart",dataDecoder:We,resultDecoder:Ie},instanceStop:{name:"instanceStop",dataDecoder:De},import:{name:"import"},remove:{name:"remove",dataDecoder:Me},export:{name:"export",resultDecoder:Re},clear:{name:"clear"}},$t=function(){function e(){k(this,e),this.baseApplicationsTimeoutMS=6e4,this.appImportTimeoutMS=20,this.registry=zt(),this.applications=[],this.instances=[]}return _(e,[{key:"start",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.logger=e.logger.subLogger("appManger.controller.web"),this.logger.trace("starting the web appManager controller"),this.publicWindowId=t.publicWindowId,this.actualWindowId=t.actualWindowId,this.addOperationsExecutors(),this.ioc=t,this.bridge=t.bridge,this.platformRegistration=this.registerWithPlatform(),n.next=10,this.platformRegistration;case 10:this.logger.trace("registration with the platform successful, attaching the appManager property to glue and returning"),r=this.toApi(),e.appManager=r;case 13:case"end":return n.stop()}}),n,this)})))}},{key:"handleBridgeMessage",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.platformRegistration;case 2:if(n=se.runWithException(e.operation),(r=Qt[n]).execute){t.next=6;break}return t.abrupt("return");case 6:return i=e.data,r.dataDecoder&&(i=r.dataDecoder.runWithException(e.data)),t.next=10,r.execute(i);case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"onInstanceStarted",value:function(e){if("function"!==typeof e)throw new Error("onInstanceStarted requires a single argument of type function");return this.registry.add("instance-started",e,this.instances)}},{key:"onInstanceStopped",value:function(e){if("function"!==typeof e)throw new Error("onInstanceStopped requires a single argument of type function");return this.registry.add("instance-stopped",e)}},{key:"startApplication",value:function(e,t,n){var r,i,o;return I(this,void 0,void 0,l().mark((function a(){var s,u,c;return l().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s={name:e,waitForAGMReady:null===(r=null===n||void 0===n?void 0:n.waitForAGMReady)||void 0===r||r,context:t,top:null===n||void 0===n?void 0:n.top,left:null===n||void 0===n?void 0:n.left,width:null===n||void 0===n?void 0:n.width,height:null===n||void 0===n?void 0:n.height,relativeTo:null===n||void 0===n?void 0:n.relativeTo,relativeDirection:null===n||void 0===n?void 0:n.relativeDirection,id:null===(i=n)||void 0===i?void 0:i.reuseId,forceChromeTab:null===(o=n)||void 0===o?void 0:o.forceTab},a.next=3,this.bridge.send("appManager",Qt.applicationStart,s);case 3:return u=a.sent,c=this.applications.find((function(e){return e.name===u.applicationName})),a.abrupt("return",this.ioc.buildInstance(u,c));case 6:case"end":return a.stop()}}),a,this)})))}},{key:"getApplication",value:function(e){var t=re.runWithException(e);return this.applications.find((function(e){return e.name===t}))}},{key:"toApi",value:function(){return{myInstance:this.me,inMemory:{import:this.import.bind(this),remove:this.remove.bind(this),export:this.export.bind(this),clear:this.clear.bind(this)},application:this.getApplication.bind(this),applications:this.getApplications.bind(this),instances:this.getInstances.bind(this),onAppAdded:this.onAppAdded.bind(this),onAppChanged:this.onAppChanged.bind(this),onAppRemoved:this.onAppRemoved.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)}}},{key:"addOperationsExecutors",value:function(){Qt.appDirectoryStateChange.execute=this.handleAppDirectoryStateChange.bind(this),Qt.instanceStarted.execute=this.handleInstanceStartedMessage.bind(this),Qt.instanceStopped.execute=this.handleInstanceStoppedMessage.bind(this)}},{key:"handleAppDirectoryStateChange",value:function(e){return I(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.appsAdded.forEach(this.handleApplicationAddedMessage.bind(this)),e.appsChanged.forEach(this.handleApplicationChangedMessage.bind(this)),e.appsRemoved.forEach(this.handleApplicationRemovedMessage.bind(this));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"onAppAdded",value:function(e){if("function"!==typeof e)throw new Error("onAppAdded requires a single argument of type function");return this.registry.add("application-added",e,this.applications)}},{key:"onAppRemoved",value:function(e){if("function"!==typeof e)throw new Error("onAppRemoved requires a single argument of type function");return this.registry.add("application-removed",e)}},{key:"onAppChanged",value:function(e){if("function"!==typeof e)throw new Error("onAppChanged requires a single argument of type function");return this.registry.add("application-changed",e)}},{key:"handleApplicationAddedMessage",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.applications.some((function(t){return t.name===e.name}))){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.ioc.buildApplication(e,[]);case 4:r=t.sent,i=this.instances.filter((function(e){return e.application.name===r.name})),(n=r.instances).push.apply(n,o(i)),this.applications.push(r),this.registry.execute("application-added",r);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"handleApplicationRemovedMessage",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.applications.findIndex((function(t){return t.name===e.name})),!(n<0)){t.next=3;break}return t.abrupt("return");case 3:r=this.applications[n],this.applications.splice(n,1),this.registry.execute("application-removed",r);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"handleApplicationChangedMessage",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.applications.find((function(t){return t.name===e.name}))){t.next=3;break}return t.abrupt("return",this.handleApplicationAddedMessage(e));case 3:n.title=e.title,n.version=e.version,n.icon=e.icon,n.caption=e.caption,n.userProperties=e.userProperties,this.registry.execute("application-changed",n);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"handleInstanceStartedMessage",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.instances.some((function(t){return t.id===e.id}))){t.next=2;break}return t.abrupt("return");case 2:if(n=this.applications.find((function(t){return t.name===e.applicationName}))){t.next=5;break}throw new Error("Cannot add instance: ".concat(e.id,", because there is no application definition associated with it"));case 5:r=this.ioc.buildInstance(e,n),this.instances.push(r),n.instances.push(r),this.registry.execute("instance-started",r);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"handleInstanceStoppedMessage",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=this.instances.find((function(t){return t.id===e.id})))&&(r=this.instances.findIndex((function(t){return t.id===e.id})),this.instances.splice(r,1)),(i=this.applications.find((function(t){return t.instances.some((function(t){return t.id===e.id}))})))&&(o=i.instances.findIndex((function(t){return t.id===e.id})),i.instances.splice(o,1)),n){t.next=6;break}return t.abrupt("return");case 6:this.registry.execute("instance-stopped",n);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"import",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"replace";return I(this,void 0,void 0,l().mark((function n(){var r,i;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(at.runWithException(t),Array.isArray(e)){n.next=3;break}throw new Error("Import must be called with an array of definitions");case 3:if(!(e.length>1e4)){n.next=5;break}throw new Error("Cannot import more than 10000 app definitions in Glue42 Core.");case 5:return r=e.reduce((function(e,t){var n=Pe.run(t);return n.ok?e.valid.push(t):e.invalid.push({app:null===t||void 0===t?void 0:t.name,error:JSON.stringify(n.error)}),e}),{valid:[],invalid:[]}),i=this.baseApplicationsTimeoutMS+this.appImportTimeoutMS*r.valid.length,n.next=9,this.bridge.send("appManager",Qt.import,{definitions:r.valid,mode:t},{methodResponseTimeoutMs:i});case 9:return n.abrupt("return",{imported:r.valid.map((function(e){return e.name})),errors:r.invalid});case 10:case"end":return n.stop()}}),n,this)})))}},{key:"remove",value:function(e){return I(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return re.runWithException(e),t.next=3,this.bridge.send("appManager",Qt.remove,{name:e},{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS});case 3:case"end":return t.stop()}}),t,this)})))}},{key:"clear",value:function(){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bridge.send("appManager",Qt.clear,void 0,{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS});case 2:case"end":return e.stop()}}),e,this)})))}},{key:"export",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bridge.send("appManager",Qt.export,void 0,{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS});case 2:return t=e.sent,e.abrupt("return",t.definitions);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getApplications",value:function(){return this.applications.slice()}},{key:"getInstances",value:function(){return this.instances.slice()}},{key:"registerWithPlatform",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t,n=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bridge.send("appManager",Qt.appHello,{windowId:this.actualWindowId},{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS});case 2:return t=e.sent,this.logger.trace("the platform responded to the hello message with a full list of apps"),e.next=6,Promise.all(t.apps.map((function(e){return n.ioc.buildApplication(e,e.instances)})));case 6:this.applications=e.sent,this.instances=this.applications.reduce((function(e,t){return e.push.apply(e,o(t.instances)),e}),[]),this.me=this.findMyInstance(),this.logger.trace("all applications were parsed and saved. I am ".concat(this.me?"NOT a":"a"," valid instance"));case 10:case"end":return e.stop()}}),e,this)})))}},{key:"findMyInstance",value:function(){var e,t=this,n=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}(this.applications);try{for(n.s();!(e=n.n()).done;){var r=e.value.instances.find((function(e){return e.id===t.publicWindowId}));if(r)return r}}catch(M){n.e(M)}finally{n.f()}}}]),e}(),Yt=function(){function e(t,n,r){k(this,e),this.data=t,this.bridge=n,this.application=r,this.myCtxKey="___instance___".concat(this.data.id)}return _(e,[{key:"toApi",value:function(){var e=this.bridge.getInteropInstance(this.data.id),t={id:this.data.id,agm:e,application:this.application,stop:this.stop.bind(this),getContext:this.getContext.bind(this)};return this.me=Object.freeze(t),this.me}},{key:"getContext",value:function(){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.bridge.contextLib.get(this.myCtxKey));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"stop",value:function(){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bridge.send("appManager",Qt.instanceStop,{id:this.data.id});case 2:case"end":return e.stop()}}),e,this)})))}}]),e}(),Xt=function(){function e(t,n,r){k(this,e),this.data=t,this.instances=n,this.controller=r}return _(e,[{key:"toApi",value:function(){var e={name:this.data.name,title:this.data.title,version:this.data.version,icon:this.data.icon,caption:this.data.caption,userProperties:this.data.userProperties,instances:this.instances,start:this.start.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)};return this.me=e,this.me}},{key:"onInstanceStarted",value:function(e){var t=this;if("function"!==typeof e)throw new Error("OnInstanceStarted requires a single argument of type function");return this.controller.onInstanceStarted((function(n){n.application.name===t.data.name&&e(n)}))}},{key:"onInstanceStopped",value:function(e){var t=this;if("function"!==typeof e)throw new Error("OnInstanceStarted requires a single argument of type function");return this.controller.onInstanceStopped((function(n){n.application.name===t.data.name&&e(n)}))}},{key:"start",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.controller.startApplication(this.data.name,e,t));case 1:case"end":return n.stop()}}),n,this)})))}}]),e}(),Zt={layoutAdded:{name:"layoutAdded",dataDecoder:Ye},layoutChanged:{name:"layoutChanged",dataDecoder:Ye},layoutRemoved:{name:"layoutRemoved",dataDecoder:Ye},get:{name:"get",dataDecoder:tt,resultDecoder:lt},getAll:{name:"getAll",dataDecoder:it,resultDecoder:ut},export:{name:"export",dataDecoder:it,resultDecoder:ot},import:{name:"import",dataDecoder:st},remove:{name:"remove",dataDecoder:tt},save:{name:"save",dataDecoder:nt,resultDecoder:ct},restore:{name:"restore",dataDecoder:rt},clientSaveRequest:{name:"clientSaveRequest",dataDecoder:Lt,resultDecoder:Dt},getGlobalPermissionState:{name:"getGlobalPermissionState",resultDecoder:Wt},requestGlobalPermission:{name:"requestGlobalPermission",resultDecoder:Ft},checkGlobalActivated:{name:"checkGlobalActivated",resultDecoder:Ft}},en=function(){function e(){k(this,e),this.defaultLayoutRestoreTimeoutMS=12e4,this.registry=zt()}return _(e,[{key:"start",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.logger=e.logger.subLogger("layouts.controller.web"),this.logger.trace("starting the web layouts controller"),this.bridge=t.bridge,this.windowsController=t.windowsController,this.addOperationsExecutors(),r=this.toApi(),this.logger.trace("no need for platform registration, attaching the layouts property to glue and returning"),e.layouts=r;case 8:case"end":return n.stop()}}),n,this)})))}},{key:"handleBridgeMessage",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=ue.runWithException(e.operation),(r=Zt[n]).execute){t.next=4;break}return t.abrupt("return");case 4:return i=e.data,r.dataDecoder&&(i=r.dataDecoder.runWithException(e.data)),t.next=8,r.execute(i);case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))}},{key:"toApi",value:function(){var e={get:this.get.bind(this),getAll:this.getAll.bind(this),export:this.export.bind(this),import:this.import.bind(this),save:this.save.bind(this),restore:this.restore.bind(this),remove:this.remove.bind(this),onAdded:this.onAdded.bind(this),onChanged:this.onChanged.bind(this),onRemoved:this.onRemoved.bind(this),onSaveRequested:this.subscribeOnSaveRequested.bind(this),getMultiScreenPermissionState:this.getGlobalPermissionState.bind(this),requestMultiScreenPermission:this.requestGlobalPermission.bind(this),getGlobalTypeState:this.checkGlobalActivated.bind(this)};return Object.freeze(e)}},{key:"addOperationsExecutors",value:function(){Zt.layoutAdded.execute=this.handleOnAdded.bind(this),Zt.layoutChanged.execute=this.handleOnChanged.bind(this),Zt.layoutRemoved.execute=this.handleOnRemoved.bind(this),Zt.clientSaveRequest.execute=this.handleSaveRequest.bind(this)}},{key:"get",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return re.runWithException(e),Fe.runWithException(t),n.next=4,this.bridge.send("layouts",Zt.get,{name:e,type:t});case 4:return r=n.sent,n.abrupt("return",r.layout);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"getAll",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Fe.runWithException(e),t.next=3,this.bridge.send("layouts",Zt.getAll,{type:e});case 3:return n=t.sent,t.abrupt("return",n.summaries);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"export",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Fe.runWithException(e),t.next=3,this.bridge.send("layouts",Zt.export,{type:e});case 3:return n=t.sent,t.abrupt("return",n.layouts);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"import",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"replace";return I(this,void 0,void 0,l().mark((function n(){var r,i,o=this;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(at.runWithException(t),Array.isArray(e)){n.next=3;break}throw new Error("Import must be called with an array of layouts");case 3:if(!(e.length>1e3)){n.next=5;break}throw new Error("Cannot import more than 1000 layouts at once in Glue42 Core.");case 5:return r=e.reduce((function(e,t){var n=Ye.run(t);return n.ok?e.valid.push(t):o.logger.warn("A layout with name: ".concat(t.name," was not imported, because of error: ").concat(JSON.stringify(n.error))),e}),{valid:[]}),i=e.filter((function(e){return r.valid.some((function(t){return t.name===e.name}))})),n.next=9,this.bridge.send("layouts",Zt.import,{layouts:i,mode:t});case 9:case"end":return n.stop()}}),n,this)})))}},{key:"save",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Xe.runWithException(e),t.next=3,this.bridge.send("layouts",Zt.save,{layout:e});case 3:return n=t.sent,t.abrupt("return",n.layout);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"restore",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Ze.runWithException(e),n=e.timeout?2*e.timeout:this.defaultLayoutRestoreTimeoutMS,t.next=4,this.bridge.send("layouts",Zt.restore,{layout:e},{methodResponseTimeoutMs:n});case 4:case"end":return t.stop()}}),t,this)})))}},{key:"remove",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Fe.runWithException(e),re.runWithException(t),n.next=4,this.bridge.send("layouts",Zt.remove,{type:e,name:t});case 4:case"end":return n.stop()}}),n,this)})))}},{key:"handleSaveRequest",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n={},this.saveRequestSubscription)try{r=this.saveRequestSubscription(e),n.windowContext=null===r||void 0===r?void 0:r.windowContext}catch(i){this.logger.warn("An error was thrown by the onSaveRequested callback, ignoring the callback: ".concat(JSON.stringify(i)))}return t.abrupt("return",n);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getGlobalPermissionState",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bridge.send("layouts",Zt.getGlobalPermissionState,void 0);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"requestGlobalPermission",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getGlobalPermissionState();case 2:if("denied"!==(t=e.sent.state)){e.next=5;break}return e.abrupt("return",{permissionGranted:!1});case 5:if("granted"!==t){e.next=7;break}return e.abrupt("return",{permissionGranted:!0});case 7:if("Platform"===this.windowsController.my().name){e.next=10;break}throw new Error("Cannot request permission for multi-window placement from any app other than the Platform.");case 10:return e.next=12,this.bridge.send("layouts",Zt.requestGlobalPermission,void 0,{methodResponseTimeoutMs:18e4});case 12:return n=e.sent,e.abrupt("return",{permissionGranted:n.isAvailable});case 14:case"end":return e.stop()}}),e,this)})))}},{key:"checkGlobalActivated",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bridge.send("layouts",Zt.checkGlobalActivated,void 0);case 2:return t=e.sent,e.abrupt("return",{activated:t.isAvailable});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"onAdded",value:function(e){return this.export("Global").then((function(t){return t.forEach((function(t){return e(t)}))})).catch((function(){})),this.export("Workspace").then((function(t){return t.forEach((function(t){return e(t)}))})).catch((function(){})),this.registry.add(Zt.layoutAdded.name,e)}},{key:"onChanged",value:function(e){return this.registry.add(Zt.layoutChanged.name,e)}},{key:"onRemoved",value:function(e){return this.registry.add(Zt.layoutRemoved.name,e)}},{key:"subscribeOnSaveRequested",value:function(e){var t=this;if("function"!==typeof e)throw new Error("Cannot subscribe to onSaveRequested, because the provided argument is not a valid callback function.");if(this.saveRequestSubscription)throw new Error("Cannot subscribe to onSaveRequested, because this client has already subscribed and only one subscription is supported. Consider unsubscribing from the initial one.");return this.saveRequestSubscription=e,function(){delete t.saveRequestSubscription}}},{key:"handleOnAdded",value:function(e){return I(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.registry.execute(Zt.layoutAdded.name,e);case 1:case"end":return t.stop()}}),t,this)})))}},{key:"handleOnChanged",value:function(e){return I(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.registry.execute(Zt.layoutChanged.name,e);case 1:case"end":return t.stop()}}),t,this)})))}},{key:"handleOnRemoved",value:function(e){return I(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.registry.execute(Zt.layoutRemoved.name,e);case 1:case"end":return t.stop()}}),t,this)})))}}]),e}(),tn={raiseNotification:{name:"raiseNotification",dataDecoder:Rt},requestPermission:{name:"requestPermission",resultDecoder:Ot},notificationShow:{name:"notificationShow",dataDecoder:Nt},notificationClick:{name:"notificationClick",dataDecoder:Nt},getPermission:{name:"getPermission",resultDecoder:jt}};var nn=1;var rn,on,an,sn={nextValue:function(){return(nn=(9301*nn+49297)%233280)/233280},seed:function(e){nn=e}},un="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function cn(){an=!1}function ln(e){if(e){if(e!==rn){if(e.length!==un.length)throw new Error("Custom alphabet for shortid must be "+un.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+un.length+" unique characters. These characters were not unique: "+t.join(", "));rn=e,cn()}}else rn!==un&&(rn=un,cn())}function dn(){return an||(an=function(){rn||ln(un);for(var e,t=rn.split(""),n=[],r=sn.nextValue();t.length>0;)r=sn.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}())}var pn={get:function(){return rn||un},characters:function(e){return ln(e),rn},seed:function(e){sn.seed(e),on!==e&&(cn(),on=e)},lookup:function(e){return dn()[e]},shuffled:dn},fn="object"===typeof window&&(window.crypto||window.msCrypto),hn=fn&&fn.getRandomValues?function(e){return fn.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t},vn=function(e,t,n){for(var r=(2<<Math.log(t.length-1)/Math.LN2)-1,i=-~(1.6*r*n/t.length),o="";;)for(var a=e(i),s=i;s--;)if((o+=t[a[s]&r]||"").length===+n)return o};var gn,yn,mn=function(e){for(var t,n=0,r="";!t;)r+=vn(hn,pn.get(),1),t=e<Math.pow(16,n+1),n++;return r};var wn=function(e){var t="",n=Math.floor(.001*(Date.now()-1567752802062));return n===yn?gn++:(gn=0,yn=n),t+=mn(7),t+=mn(e),gn>0&&(t+=mn(gn)),t+=mn(n)};var bn,kn,xn,_n=function(e){return!(!e||"string"!==typeof e||e.length<6)&&!new RegExp("[^"+pn.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)},Sn=(bn=function(e){var t=0;function n(){return wn(t)}e.exports=n,e.exports.generate=n,e.exports.seed=function(t){return pn.seed(t),e.exports},e.exports.worker=function(n){return t=n,e.exports},e.exports.characters=function(e){return void 0!==e&&pn.characters(e),pn.shuffled()},e.exports.isValid=_n},bn(xn={path:kn,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}((void 0===t||null===t)&&xn.path)}},xn.exports),xn.exports),In=Sn,Cn=function(){function e(){k(this,e),this.notifications={}}return _(e,[{key:"start",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.logger=e.logger.subLogger("notifications.controller.web"),this.logger.trace("starting the web notifications controller"),this.bridge=t.bridge,this.coreGlue=e,this.notificationsSettings=t.config.notifications,this.buildNotificationFunc=t.buildNotification,r=this.toApi(),this.addOperationExecutors(),e.notifications=r,this.logger.trace("notifications are ready");case 10:case"end":return n.stop()}}),n,this)})))}},{key:"handleBridgeMessage",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=ce.runWithException(e.operation),(r=tn[n]).execute){t.next=4;break}return t.abrupt("return");case 4:return i=e.data,r.dataDecoder&&(i=r.dataDecoder.runWithException(e.data)),t.next=8,r.execute(i);case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))}},{key:"toApi",value:function(){var e={raise:this.raise.bind(this),requestPermission:this.requestPermission.bind(this),getPermission:this.getPermission.bind(this)};return Object.freeze(e)}},{key:"getPermission",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bridge.send("notifications",tn.getPermission,void 0);case 2:return t=e.sent,e.abrupt("return",t.permission);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"requestPermission",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bridge.send("notifications",tn.requestPermission,void 0);case 2:return t=e.sent,e.abrupt("return",t.permissionGranted);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"raise",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Pt.runWithException(e),t.next=3,this.requestPermission();case 3:if(t.sent){t.next=6;break}throw new Error("Cannot raise the notification, because the user has declined the permission request");case 6:return r=In.generate(),t.next=9,this.bridge.send("notifications",tn.raiseNotification,{settings:n,id:r});case 9:return i=this.buildNotificationFunc(e),this.notifications[r]=i,t.abrupt("return",i);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"addOperationExecutors",value:function(){tn.notificationShow.execute=this.handleNotificationShow.bind(this),tn.notificationClick.execute=this.handleNotificationClick.bind(this)}},{key:"handleNotificationShow",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.id){t.next=2;break}return t.abrupt("return");case 2:(n=this.notifications[e.id])&&n.onshow&&n.onshow();case 4:case"end":return t.stop()}}),t,this)})))}},{key:"handleNotificationClick",value:function(e){var t,n,r,i,o;return I(this,void 0,void 0,l().mark((function a(){var s;return l().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!e.action&&(null===(t=this.notificationsSettings)||void 0===t?void 0:t.defaultClick)&&this.notificationsSettings.defaultClick(this.coreGlue,e.definition),e.action&&(null===(r=null===(n=this.notificationsSettings)||void 0===n?void 0:n.actionClicks)||void 0===r?void 0:r.some((function(t){return t.action===e.action})))&&(null===(o=null===(i=this.notificationsSettings)||void 0===i?void 0:i.actionClicks)||void 0===o?void 0:o.find((function(t){return t.action===e.action}))).handler(this.coreGlue,e.definition),e.id){a.next=4;break}return a.abrupt("return");case 4:(s=this.notifications[e.id])&&s.onclick&&(s.onclick(),delete this.notifications[e.id]);case 6:case"end":return a.stop()}}),a,this)})))}}]),e}(),Tn={getIntents:{name:"getIntents",resultDecoder:yt},findIntent:{name:"findIntent",dataDecoder:bt,resultDecoder:yt},raiseIntent:{name:"raiseIntent",dataDecoder:kt,resultDecoder:_t}},An=function(){function e(){k(this,e),this.myIntents=new Set,this.useIntentsResolverUI=!0,this.intentsResolverResponsePromises={}}return _(e,[{key:"start",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.logger=e.logger.subLogger("intents.controller.web"),this.logger.trace("starting the web intents controller"),this.bridge=t.bridge,this.interop=e.interop,this.appManager=t.appManagerController,this.windowsManager=t.windowsController,this.checkIfIntentsResolverIsEnabled(t.config),r=this.toApi(),this.logger.trace("no need for platform registration, attaching the intents property to glue and returning"),e.intents=r;case 10:case"end":return n.stop()}}),n,this)})))}},{key:"handleBridgeMessage",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=dt.runWithException(e.operation),(r=Tn[n]).execute){t.next=4;break}return t.abrupt("return");case 4:return i=e.data,r.dataDecoder&&(i=r.dataDecoder.runWithException(e.data)),t.next=8,r.execute(i);case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))}},{key:"toApi",value:function(){return{raise:this.raise.bind(this),all:this.all.bind(this),addIntentListener:this.addIntentListener.bind(this),find:this.find.bind(this)}}},{key:"raise",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i,o,a,s,u,c;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=xt.runWithException(e),!(r="string"===typeof n?{intent:n}:n).target){t.next=5;break}return this.logger.trace("Intents Resolver won't be used. Target is provided in Intent Request - ".concat(JSON.stringify(r))),t.abrupt("return",this.raiseIntent(r));case 5:if(this.useIntentsResolverUI){t.next=8;break}return this.logger.trace("Intent Resolver is disabled. Raising intent to first found handler"),t.abrupt("return",this.raiseIntent(r));case 8:if(this.appManager.getApplication(this.intentsResolverAppName)){t.next=12;break}return this.logger.trace("Intent Resolver Application with name ".concat(this.intentsResolverAppName," not found. Intents Resolver won't be used for handling raised intents")),t.abrupt("return",this.raiseIntent(r));case 12:return t.next=14,this.find(r.intent);case 14:if(t.t0=t.sent[0].handlers.length,!(1===t.t0)){t.next=19;break}return this.logger.trace("Intents Resolver won't be used - intent has only one handler."),t.abrupt("return",this.raiseIntent(r));case 19:return t.next=21,this.registerIntentResolverMethod();case 21:return i=t.sent,this.logger.trace("Registered interop method ".concat(i)),t.next=25,this.openIntentResolverApplication(r,i);case 25:return o=t.sent,t.next=28,this.intentsResolverResponsePromises[o.id].promise;case 28:return a=t.sent,s=a.handler,this.stopIntensResolverInstance(o.id),u="app"===s.type?{app:s.applicationName}:{instance:s.instanceId},this.logger.trace("Intent handler chosen by the user: ".concat(JSON.stringify(u))),c=Object.assign(Object.assign({},r),{target:u}),t.abrupt("return",this.raiseIntent(c));case 35:case"end":return t.stop()}}),t,this)})))}},{key:"raiseIntent",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.bridge.send("intents",Tn.raiseIntent,e),t.abrupt("return",n);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"all",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bridge.send("intents",Tn.getIntents,void 0);case 2:return t=e.sent,e.abrupt("return",t.intents);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"addIntentListener",value:function(e,t){var n,r=this;if(It.runWithException(e),"function"!==typeof t)throw new Error("Cannot add intent listener, because the provided handler is not a function!");var i="string"===typeof e?e:e.intent,o="".concat("Tick42.FDC3.Intents.").concat(i);if(this.myIntents.has(i))throw new Error("Intent listener for intent ".concat(i," already registered!"));this.myIntents.add(i);var a={unsubscribe:function(){r.myIntents.delete(i),n.then((function(){return r.interop.unregister(o)})).catch((function(e){return r.logger.trace("Unregistration of a method with name ".concat(o," failed with reason: ").concat(e))}))}},s={};"object"===typeof e&&(s=S(e,["intent"]));return(n=this.interop.register({name:o,flags:{intent:s}},(function(e){if(r.myIntents.has(i))return t(e)}))).catch((function(e){r.myIntents.delete(i),r.logger.warn("Registration of a method with name ".concat(o," failed with reason: ").concat(e))})),a}},{key:"find",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=void 0,"undefined"!==typeof e&&("string"===typeof(r=wt.runWithException(e))?n={filter:{name:r}}:"object"===typeof r&&(n={filter:r})),t.next=4,this.bridge.send("intents",Tn.findIntent,n);case 4:return i=t.sent,t.abrupt("return",i.intents);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"createResponsePromise",value:function(e,t,n){var r=function(){},i=function(){},o=new Promise((function(e,t){r=e,i=t}));this.intentsResolverResponsePromises[t]={intent:e,resolve:r,reject:i,promise:o,methodName:n}}},{key:"resolverResponseHandler",value:function(e,t){var n=ft.run(e),r=t.instance;if(!n.ok)return this.logger.trace("Intent Resolver sent invalid response. Error: ".concat(n.error)),this.intentsResolverResponsePromises[r].reject(n.error.message),void this.stopIntensResolverInstance(r);this.intentsResolverResponsePromises[r].resolve(n.result)}},{key:"stopIntensResolverInstance",value:function(e){var t=this,n=this.appManager.getApplication(this.intentsResolverAppName).instances.find((function(t){return t.id===e}));n&&n.stop().catch((function(e){return t.logger.error(e)}))}},{key:"registerIntentResolverMethod",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="T42.Intents.Resolver.Control"+In(),e.next=3,this.interop.register(t,this.resolverResponseHandler.bind(this));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"openIntentResolverApplication",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r,i,o;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={intent:e.intent,callerId:this.interop.instance.instance,methodName:t},n.next=3,this.composeStartOptions();case 3:return i=n.sent,n.next=6,this.appManager.getApplication(this.intentsResolverAppName).start(r,i);case 6:return o=n.sent,this.subscribeOnInstanceStopped(o),this.createResponsePromise(e.intent,o.id,t),n.abrupt("return",o);case 10:case"end":return n.stop()}}),n,this)})))}},{key:"cleanUpIntentResolverPromise",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.intentsResolverResponsePromises[e]){t.next=3;break}return t.abrupt("return");case 3:this.interop.unregister(n.methodName).catch((function(e){return r.logger.warn(e)})),delete this.intentsResolverResponsePromises[e];case 6:case"end":return t.stop()}}),t,this)})))}},{key:"composeStartOptions",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.windowsManager.my().getBounds();case 2:return t=e.sent,e.abrupt("return",{top:(t.height-440)/2+t.top,left:(t.width-400)/2+t.left,width:400,height:440});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"subscribeOnInstanceStopped",value:function(e){var t=this,n=e.application.onInstanceStopped((function(r){if(r.id===e.id){var i=t.intentsResolverResponsePromises[r.id];if(!i)return n();i.reject("Cannot resolve raise intent ".concat(i.intent," - User closed ").concat(t.intentsResolverAppName," app without choosing an intent handler")),t.cleanUpIntentResolverPromise(r.id),n()}}))}},{key:"checkIfIntentsResolverIsEnabled",value:function(e){var t,n,r;this.useIntentsResolverUI="boolean"!==typeof(null===(t=e.intents)||void 0===t?void 0:t.enableIntentsResolverUI)||e.intents.enableIntentsResolverUI,this.intentsResolverAppName=null!==(r=null===(n=e.intents)||void 0===n?void 0:n.intentsResolverAppName)&&void 0!==r?r:"intentsResolver"}}]),e}(),En={name:"platformUnload"},Pn={name:"transportSwitchRequest"},Mn={name:"transportSwitchResponse"},Rn={name:"getCurrentTransport"},On={name:"getCurrentTransportResponse"},jn={name:"checkPreferredLogic"},Nn={name:"checkPreferredConnection"},Ln={name:"checkPreferredLogicResponse"},Dn={name:"checkPreferredConnectionResponse"},Wn="web-platform",Fn="latest_fdc3_type",qn={addChannel:{name:"addChannel",dataDecoder:Mt}},Un=function(){function e(){var t=this;k(this,e),this.registry=zt(),this.GlueWebChannelsPrefix="___channel___",this.SubsKey="subs",this.ChangedKey="changed",this.replaySubscribe=function(e,n){t.get(n).then((function(n){if("object"===typeof n.data&&Object.keys(n.data).length){var r=t.createContextName(n.name);return t.contexts.subscribe(r,(function(t,n,r,i,o){e(t.data,t,null===o||void 0===o?void 0:o.updaterId)}))}})).then((function(e){e&&"function"===typeof e&&e()})).catch((function(e){return t.logger.trace(e)}))}}return _(e,[{key:"start",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.logger=e.logger.subLogger("channels.controller.web"),this.logger.trace("starting the web channels controller"),this.contexts=e.contexts,this.bridge=t.bridge,this.logger.trace("no need for platform registration, attaching the channels property to glue and returning"),r=this.toApi(),e.channels=r;case 7:case"end":return n.stop()}}),n,this)})))}},{key:"handleBridgeMessage",value:function(){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"list",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t,n,r=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getAllChannelNames(),e.next=3,Promise.all(t.map((function(e){return r.get(e)})));case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"my",value:function(){return this.current()}},{key:"join",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getAllChannelNames(),Ct(n).runWithException(e),t.next=4,this.switchToChannel(e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"onChanged",value:function(e){return this.changed(e)}},{key:"leave",value:function(){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.switchToChannel();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"toApi",value:function(){var e={subscribe:this.subscribe.bind(this),subscribeFor:this.subscribeFor.bind(this),publish:this.publish.bind(this),all:this.all.bind(this),list:this.list.bind(this),get:this.get.bind(this),join:this.join.bind(this),leave:this.leave.bind(this),current:this.current.bind(this),my:this.my.bind(this),changed:this.changed.bind(this),onChanged:this.onChanged.bind(this),add:this.add.bind(this)};return Object.freeze(e)}},{key:"createContextName",value:function(e){return"".concat(this.GlueWebChannelsPrefix).concat(e)}},{key:"getAllChannelNames",value:function(){var e=this;return this.contexts.all().filter((function(t){return t.startsWith(e.GlueWebChannelsPrefix)})).map((function(t){return t.replace(e.GlueWebChannelsPrefix,"")}))}},{key:"unsubscribe",value:function(){this.unsubscribeFunc&&(this.unsubscribeFunc(),this.unsubscribeFunc=void 0)}},{key:"switchToChannel",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.unsubscribe(),this.currentChannelName=e,"undefined"===typeof e){t.next=7;break}return n=this.createContextName(e),t.next=6,this.contexts.subscribe(n,(function(e,t,n,i,o){r.registry.execute(r.SubsKey,e.data,e,null===o||void 0===o?void 0:o.updaterId)}));case 6:this.unsubscribeFunc=t.sent;case 7:this.registry.execute(this.ChangedKey,e);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"updateData",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r,i,o;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.createContextName(e),i=this.getFDC3Type(t),!this.contexts.setPathSupported){n.next=9;break}return o=Object.keys(t).map((function(e){return{path:"data.".concat(e),value:t[e]}})),i&&o.push({path:Fn,value:i}),n.next=7,this.contexts.setPaths(r,o);case 7:n.next=12;break;case 9:return i&&(t[Fn]=i),n.next=12,this.contexts.update(r,{data:t});case 12:case"end":return n.stop()}}),n,this)})))}},{key:"getFDC3Type",value:function(e){var t=Object.keys(e).filter((function(e){return 0===e.indexOf("fdc3_")}));if(0!==t.length){if(t.length>1)throw new Error("FDC3 does not support updating of multiple context keys");return t[0].split("_").slice(1).join("_")}}},{key:"subscribe",value:function(e){if("function"!==typeof e)throw new Error("Cannot subscribe to channels, because the provided callback is not a function!");var t=this.current();return t&&this.replaySubscribe(e,t),this.registry.add(this.SubsKey,e)}},{key:"subscribeFor",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r,i;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.getAllChannelNames(),Ct(r).runWithException(e),"function"===typeof t){n.next=4;break}throw new Error("Cannot subscribe to channel ".concat(e,", because the provided callback is not a function!"));case 4:return i=this.createContextName(e),n.abrupt("return",this.contexts.subscribe(i,(function(e,n,r,i,o){t(e.data,e,null===o||void 0===o?void 0:o.updaterId)})));case 6:case"end":return n.stop()}}),n,this)})))}},{key:"publish",value:function(e,t){if("object"!==typeof e)throw new Error("Cannot publish to channel, because the provided data is not an object!");if("undefined"!==typeof t){var n=this.getAllChannelNames();return Ct(n).runWithException(t),this.updateData(t,e)}if("undefined"===typeof this.currentChannelName)throw new Error("Cannot publish to channel, because not joined to a channel!");return this.updateData(this.currentChannelName,e)}},{key:"all",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getAllChannelNames(),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e,this)})))}},{key:"get",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r,i,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getAllChannelNames(),Ct(n).runWithException(e),r=this.createContextName(e),t.next=5,this.contexts.get(r);case 5:if(!(i=t.sent).latest_fdc3_type){t.next=9;break}return o=S(i,["latest_fdc3_type"]),t.abrupt("return",Object.assign({},o));case 9:return t.abrupt("return",i);case 10:case"end":return t.stop()}}),t,this)})))}},{key:"current",value:function(){return this.currentChannelName}},{key:"changed",value:function(e){if("function"!==typeof e)throw new Error("Cannot subscribe to channel changed, because the provided callback is not a function!");return this.registry.add(this.ChangedKey,e)}},{key:"add",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Mt.runWithException(e),!this.getAllChannelNames().includes(n.name)){t.next=4;break}throw new Error("There's an already existing channel with such name");case 4:return t.next=6,this.bridge.send("channels",qn.addChannel,n);case 6:return t.abrupt("return",n);case 7:case"end":return t.stop()}}),t,this)})))}}]),e}(),zn={getEnvironment:{name:"getEnvironment",resultDecoder:_e},getBase:{name:"getBase",resultDecoder:_e}},Gn=function(){function e(){k(this,e)}return _(e,[{key:"start",value:function(e,t){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.bridge=t.bridge,e.next=3,this.setEnvironment();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"handleBridgeMessage",value:function(){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"setEnvironment",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t,n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bridge.send("system",zn.getEnvironment,void 0);case 2:return t=e.sent,e.next=5,this.bridge.send("system",zn.getBase,void 0);case 5:n=e.sent,r=Object.assign({},window.glue42core,n,{environment:t}),window.glue42core=Object.freeze(r);case 8:case"end":return e.stop()}}),e,this)})))}}]),e}(),Bn=_((function e(t){k(this,e),this.onclick=function(){},this.onshow=function(){},this.badge=t.badge,this.body=t.body,this.data=t.data,this.dir=t.dir,this.icon=t.icon,this.image=t.image,this.lang=t.lang,this.renotify=t.renotify,this.requireInteraction=t.requireInteraction,this.silent=t.silent,this.tag=t.tag,this.timestamp=t.timestamp,this.vibrate=t.vibrate})),Hn=(te(Y("clientHello")),{clientHello:{name:"clientHello",resultDecoder:X({widget:X({inject:Q()})})}}),Vn=function(){function e(){k(this,e),this.channels=[],this.contentCommands={widgetVisualizationPermission:{name:"widgetVisualizationPermission",handle:this.handleWidgetVisualizationPermission.bind(this)},changeChannel:{name:"changeChannel",handle:this.handleChangeChannel.bind(this)}}}return _(e,[{key:"start",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r=this;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.logger=e.logger.subLogger("extension.controller.web"),this.windowId=t.publicWindowId,this.logger.trace("starting the extension web controller"),this.bridge=t.bridge,this.channelsController=t.channelsController,this.eventsDispatcher=t.eventsDispatcher,n.prev=6,n.next=9,this.registerWithPlatform();case 9:n.next=14;break;case 11:return n.prev=11,n.t0=n.catch(6),n.abrupt("return");case 14:return n.next=16,this.channelsController.list();case 16:this.channels=n.sent,this.eventsDispatcher.onContentMessage(this.handleContentMessage.bind(this)),this.channelsController.onChanged((function(e){r.eventsDispatcher.sendContentMessage({command:"channelChange",newChannel:e})}));case 19:case"end":return n.stop()}}),n,this,[[6,11]])})))}},{key:"handleBridgeMessage",value:function(e){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"handleContentMessage",value:function(e){if(e&&"string"===typeof e.command){var t=this.contentCommands[e.command];t&&t.handle(e)}}},{key:"registerWithPlatform",value:function(){return I(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("registering with the platform"),e.next=3,this.bridge.send("extension",Hn.clientHello,{windowId:this.windowId});case 3:this.config=e.sent,this.logger.trace("the platform responded to the hello message with a valid extension config");case 5:case"end":return e.stop()}}),e,this)})))}},{key:"handleWidgetVisualizationPermission",value:function(){var e;return I(this,void 0,void 0,l().mark((function t(){var n,r=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(e=this.config)||void 0===e?void 0:e.widget.inject){t.next=2;break}return t.abrupt("return",this.eventsDispatcher.sendContentMessage({command:"permissionResponse",allowed:!1}));case 2:n=this.channels.find((function(e){return e.name===r.channelsController.my()})),this.eventsDispatcher.sendContentMessage({command:"permissionResponse",allowed:!0,channels:this.channels,currentChannel:n});case 4:case"end":return t.stop()}}),t,this)})))}},{key:"handleChangeChannel",value:function(e){return I(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("no-channel"!==e.name){t.next=4;break}return t.next=3,this.channelsController.leave();case 3:return t.abrupt("return");case 4:return t.next=6,this.channelsController.join(e.name);case 6:case"end":return t.stop()}}),t,this)})))}}]),e}(),Jn=function(){function e(t){k(this,e),this.config=t,this.registry=zt(),this.glue42EventName="Glue42",this.events={notifyStarted:{name:"notifyStarted",handle:this.handleNotifyStarted.bind(this)},contentInc:{name:"contentInc",handle:this.handleContentInc.bind(this)},requestGlue:{name:"requestGlue",handle:this.handleRequestGlue.bind(this)}}}return _(e,[{key:"start",value:function(e){this.glue=e,this.wireCustomEventListener(),this.announceStarted()}},{key:"sendContentMessage",value:function(e){this.send("contentOut","glue42core",e)}},{key:"onContentMessage",value:function(e){return this.registry.add("content-inc",e)}},{key:"wireCustomEventListener",value:function(){var e=this;window.addEventListener(this.glue42EventName,(function(t){var n,r=t.detail,i=null!==(n=null===r||void 0===r?void 0:r.glue42)&&void 0!==n?n:null===r||void 0===r?void 0:r.glue42core;if(i){var o=i.event,a=e.events[o];a&&a.handle(i.message)}}))}},{key:"announceStarted",value:function(){this.send("start","glue42")}},{key:"handleRequestGlue",value:function(){this.config.exposeGlue?this.send("requestGlueResponse","glue42",{glue:this.glue}):this.send("requestGlueResponse","glue42",{error:"Will not give access to the underlying Glue API, because it was explicitly denied upon initialization."})}},{key:"handleNotifyStarted",value:function(){this.announceStarted()}},{key:"handleContentInc",value:function(e){this.registry.execute("content-inc",e)}},{key:"send",value:function(e,t,n){var r={};r[t]={event:e,message:n};var i=new CustomEvent(this.glue42EventName,{detail:r});window.dispatchEvent(i)}}]),e}(),Kn=function(){function e(t){k(this,e),this.coreGlue=t,this.transactionTimeout=15e3,this.transactionLocks={},this.reconnectCounter=0,this.logger=this.coreGlue.logger.subLogger("web.preferred.connection.controller")}return _(e,[{key:"start",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isPlatformInternal){t.next=3;break}return this.logger.trace("This is an internal client to the platform, skipping all client preferred communication logic."),t.abrupt("return");case 3:if(this.coreGlue.connection.transport.name()===Wn){t.next=6;break}throw new Error("Cannot initiate the Glue Web Bridge, because the initial connection was not handled by a Web Platform transport.");case 6:if(this.coreGlue.connection.transport.isPreferredActivated){t.next=9;break}return this.logger.trace("The platform of this client was configured without a preferred connection, skipping the rest of the initialization."),t.abrupt("return");case 9:return this.webPlatformTransport=this.coreGlue.connection.transport,this.webPlatformMessagesUnsubscribe=this.webPlatformTransport.onMessage(this.handleWebPlatformMessage.bind(this)),t.next=13,this.getCurrentPlatformTransportState();case 13:return n=t.sent,t.next=16,this.checkSwitchTransport(n);case 16:case"end":return t.stop()}}),t,this)})))}},{key:"handleWebPlatformMessage",value:function(e){if("string"!==typeof e){var t=this.coreGlue.connection.transport.name()===Wn,n=e.type,r=e.args,i=e.transactionId;return n===Pn.name?this.handleTransportSwitchRequest(r,i):n!==En.name||t?n===On.name?this.handleGetCurrentTransportResponse(r,i):n===jn.name?this.handleCheckPreferredLogic(i):n===Nn.name?this.handleCheckPreferredConnection(r,i):void 0:this.handlePlatformUnload()}}},{key:"reEstablishPlatformPort",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.webPlatformTransport.connect();case 3:e.next=12;break;case 5:if(e.prev=5,e.t0=e.catch(0),this.logger.trace("Error when re-establishing port connection to the platform: ".concat(JSON.stringify(e.t0))),--this.reconnectCounter,!(this.reconnectCounter>0)){e.next=11;break}return e.abrupt("return",this.reEstablishPlatformPort());case 11:this.logger.warn("This client lost connection to the platform while connected to a preferred GW and was not able to re-connect to the platform.");case 12:return this.logger.trace("The connection to the platform was re-established, closing the connection to the web gateway."),this.reconnectCounter=0,this.webPlatformTransport.close(),e.next=17,this.getCurrentPlatformTransportState();case 17:return t=e.sent,e.next=20,this.checkSwitchTransport(t);case 20:case"end":return e.stop()}}),e,this,[[0,5]])})))}},{key:"checkSwitchTransport",value:function(e){return I(this,void 0,void 0,l().mark((function t(){var n,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=this.coreGlue.connection.transport.name())!==e.transportName){t.next=4;break}return this.logger.trace("A check switch was requested, but the platform transport and my transport are identical, no switch is necessary"),t.abrupt("return");case 4:return this.logger.trace("A check switch was requested and a transport switch is necessary, because this client is now on ".concat(n,", but it should reconnect to ").concat(JSON.stringify(e))),t.next=7,this.coreGlue.connection.switchTransport(e);case 7:r=t.sent,this.setConnected(),this.logger.trace("The transport switch was completed with result: ".concat(JSON.stringify(r)));case 10:case"end":return t.stop()}}),t,this)})))}},{key:"getCurrentPlatformTransportState",value:function(){return I(this,void 0,void 0,l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.trace("Requesting the current transport state of the platform."),t=this.setTransaction(Rn.name),this.sendPlatformMessage(Rn.name,t.id),e.next=5,t.lock;case 5:return n=e.sent,this.logger.trace("The platform responded with transport state: ".concat(JSON.stringify(n))),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"setTransaction",value:function(e){var t=this,n={},r=In.generate(),i=new Promise((function(i,o){var a=!0;n.lift=function(e){a=!1,delete t.transactionLocks[r],i(e)},n.fail=function(e){a=!1,delete t.transactionLocks[r],o(e)},setTimeout((function(){a&&(a=!1,t.logger.warn("Transaction for operation: ".concat(e," timed out.")),delete t.transactionLocks[r],o("Transaction for operation: ".concat(e," timed out.")))}),t.transactionTimeout)}));return n.lock=i,n.id=r,this.transactionLocks[r]=n,n}},{key:"sendPlatformMessage",value:function(e,t,n){this.logger.trace("Sending a platform message of type: ".concat(e,", id: ").concat(t," and args: ").concat(JSON.stringify(n))),this.webPlatformTransport.sendObject({glue42core:{type:e,args:n,transactionId:t}})}},{key:"handleTransportSwitchRequest",value:function(e,t){var n=this;this.logger.trace("Received a transport switch request with id: ".concat(t," and data: ").concat(JSON.stringify(e))),this.coreGlue.connection.switchTransport(e.switchSettings).then((function(e){n.logger.trace("The transport switch was completed with result: ".concat(JSON.stringify(e))),n.setConnected(),n.sendPlatformMessage(Mn.name,t,{success:e.success})})).catch((function(e){n.logger.error(e),n.sendPlatformMessage(Mn.name,t,{success:!1})}))}},{key:"handlePlatformUnload",value:function(){this.reconnectCounter=5,this.logger.trace("The platform was unloaded while I am connected to a preferred connection, re-establishing the port connection."),this.reEstablishPlatformPort()}},{key:"handleGetCurrentTransportResponse",value:function(e,t){this.logger.trace("Got a current transport response from the platform with id: ".concat(t," and data: ").concat(JSON.stringify(e)));var n=e.transportState,r=this.transactionLocks[t];null===r||void 0===r||r.lift(n)}},{key:"handleCheckPreferredLogic",value:function(e){var t=this;setTimeout((function(){return t.sendPlatformMessage(Ln.name,e)}),0)}},{key:"handleCheckPreferredConnection",value:function(e,t){var n=this,r=e.url;this.logger.trace("Testing the possible connection to: ".concat(r)),this.checkPreferredConnection(r).then((function(e){n.logger.trace("The connection to ".concat(r," is possible")),n.sendPlatformMessage(Dn.name,t,e)})).catch((function(e){n.logger.trace("The connection to ".concat(r," is not possible")),n.sendPlatformMessage(Dn.name,t,{error:e})}))}},{key:"checkPreferredConnection",value:function(e){return new Promise((function(t){var n=new WebSocket(e);n.onerror=function(){return t({live:!1})},n.onopen=function(){n.close(),t({live:!0})}}))}},{key:"setConnected",value:function(){this.webPlatformTransport.manualSetReadyState()}}]),e}(),Qn=function(){function e(){k(this,e),this.controllers={windows:this.windowsController,appManager:this.appManagerController,layouts:this.layoutsController,notifications:this.notificationsController,intents:this.intentsController,channels:this.channelsController,system:this.systemController,extension:this.extensionController}}return _(e,[{key:"communicationId",get:function(){return this._communicationId}},{key:"publicWindowId",get:function(){if(!this._publicWindowId)throw new Error("Accessing undefined public window id.");return this._publicWindowId}},{key:"actualWindowId",get:function(){return this._actualWindowId}},{key:"windowsController",get:function(){return this._windowsControllerInstance||(this._windowsControllerInstance=new Bt),this._windowsControllerInstance}},{key:"appManagerController",get:function(){return this._appManagerControllerInstance||(this._appManagerControllerInstance=new $t),this._appManagerControllerInstance}},{key:"layoutsController",get:function(){return this._layoutsControllerInstance||(this._layoutsControllerInstance=new en),this._layoutsControllerInstance}},{key:"notificationsController",get:function(){return this._notificationsControllerInstance||(this._notificationsControllerInstance=new Cn),this._notificationsControllerInstance}},{key:"intentsController",get:function(){return this._intentsControllerInstance||(this._intentsControllerInstance=new An),this._intentsControllerInstance}},{key:"systemController",get:function(){return this._systemControllerInstance||(this._systemControllerInstance=new Gn),this._systemControllerInstance}},{key:"channelsController",get:function(){return this._channelsControllerInstance||(this._channelsControllerInstance=new Un),this._channelsControllerInstance}},{key:"extensionController",get:function(){return this._extensionController||(this._extensionController=new Vn),this._extensionController}},{key:"eventsDispatcher",get:function(){return this._eventsDispatcher||(this._eventsDispatcher=new Jn(this.config)),this._eventsDispatcher}},{key:"bridge",get:function(){return this._bridgeInstance||(this._bridgeInstance=new Kt(this._coreGlue,this.communicationId)),this._bridgeInstance}},{key:"preferredConnectionController",get:function(){return this._preferredConnectionController||(this._preferredConnectionController=new Kn(this._coreGlue)),this._preferredConnectionController}},{key:"config",get:function(){return this._webConfig}},{key:"defineGlue",value:function(e){this._coreGlue=e,this._publicWindowId=e.connection.transport.publicWindowId,this._actualWindowId=e.interop.instance.windowId,this._communicationId=e.connection.transport.communicationId||window.glue42core.communicationId}},{key:"defineConfig",value:function(e){this._webConfig=e}},{key:"buildWebWindow",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r,i;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=new Gt(e,t,this.bridge),n.next=3,r.toApi();case 3:return i=n.sent,n.abrupt("return",{id:e,model:r,api:i});case 5:case"end":return n.stop()}}),n,this)})))}},{key:"buildNotification",value:function(e){return new Bn(e)}},{key:"buildApplication",value:function(e,t){return I(this,void 0,void 0,l().mark((function n(){var r,i,a,s=this;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=new Xt(e,[],this.appManagerController).toApi(),a=t.map((function(e){return s.buildInstance(e,i)})),(r=i.instances).push.apply(r,o(a)),n.abrupt("return",i);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"buildInstance",value:function(e,t){return new Yt(e,this.bridge,t).toApi()}}]),e}(),$n="2.10.0",Yn=function(e,t){return Yn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},Yn(e,t)};function Xn(e,t){function n(){this.constructor=e}Yn(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Zn=function(){return Zn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Zn.apply(this,arguments)};function er(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function tr(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function nr(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var rr=1,ir=2,or=3,ar=4;function sr(e){return e.type===or?"timestamp":e.type===ir?"number":e.type===rr?"string":e.type===ar?"object":"unknown"}function ur(e){return e.constructor===Date?"timestamp":"number"===typeof e?"number":"string"===typeof e?"string":"object"===typeof e?"object":"string"}function cr(e){var t={},n=sr(e);if("object"===n){var r=Object.keys(e.value).reduce((function(t,n){var r=ur(e.value[n]);if("object"===r){var i=lr(e.value[n]);t[n]={type:"object",description:"",context:{},composite:i}}else t[n]={type:r,description:"",context:{}};return t}),{});t.composite=r}return t.name=dr(e.path.join("/")+"/"+e.name),t.type=n,t.description=e.description,t.context={},t}function lr(e){return Object.keys(e).reduce((function(t,n){var r=ur(e[n]);return t[n]="object"===r?{type:"object",description:"",context:{},composite:lr(e[n])}:{type:r,description:"",context:{}},t}),{})}function dr(e){return"undefined"!==typeof e&&e.length>0&&"/"!==e[0]?"/"+e:e}function pr(e){return"timestamp"===sr(e)?Date.now():fr(e.value)}function fr(e){return"object"!==typeof e?e:Object.keys(e).reduce((function(t,n){var r=e[n];return"object"===typeof r&&r.constructor!==Date?t[n]=fr(r):r.constructor===Date?t[n]=new Date(r).getTime():r.constructor===Boolean?t[n]=r.toString():t[n]=r,t}),{})}function hr(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?hr(t):t)}),[])}function vr(e){var t=hr(e.root.getAggregateState()),n=t.sort((function(e,t){return e.state?t.state?t.state-e.state:-1:1}))[0],r=function(e){var t="";return e.forEach((function(e,n,r){var i=e.path.join(".");n===r.length-1?t+=i+"."+e.name+": "+e.description:t+=i+"."+e.name+": "+e.description+","})),t.length>100?t.slice(0,100)+"...":t}(t);return{description:r,value:n.state}}var gr=function(e,t,n){if(null===e||"object"!==typeof e)throw new Error("Missing definition");if(null===t||"object"!==typeof t)throw new Error("Missing parent");if(null===n||"object"!==typeof n)throw new Error("Missing transport")},yr=function(){function e(e,t,n,r,i){this.definition=e,this.system=t,this.transport=n,this.value=r,this.type=i,this.path=[],gr(e,t,n),this.path=t.path.slice(0),this.path.push(t.name),this.name=e.name,this.description=e.description,n.createMetric(this)}return Object.defineProperty(e.prototype,"repo",{get:function(){var e;return null===(e=this.system)||void 0===e?void 0:e.repo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.system.path+"/"+name},enumerable:!0,configurable:!0}),e.prototype.update=function(e){return this.value=e,this.transport.updateMetric(this)},e}(),mr=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,ir)||this}return Xn(t,e),t.prototype.incrementBy=function(e){this.update(this.value+e)},t.prototype.increment=function(){this.incrementBy(1)},t.prototype.decrement=function(){this.incrementBy(-1)},t.prototype.decrementBy=function(e){this.incrementBy(-1*e)},t}(yr),wr=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,ar)||this}return Xn(t,e),t.prototype.update=function(e){return this.mergeValues(e),this.transport.updateMetric(this)},t.prototype.mergeValues=function(e){var t=this;return Object.keys(this.value).forEach((function(n){"undefined"!==typeof e[n]&&(t.value[n]=e[n])}))},t}(yr),br=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,rr)||this}return Xn(t,e),t}(yr),kr=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,or)||this}return Xn(t,e),t.prototype.now=function(){this.update(new Date)},t}(yr);function xr(e,t,n,r,i){if(!t)throw new Error("Repository is required");if(!n)throw new Error("Transport is required");var o,a,s=n,u=e,c=i||"",l=t,d=r,p=function e(t){if(!t||!t.parent)return[];var n=e(t.parent);return n.push(t.name),n}(r),f={},h=(a="/",((o=p)&&o.length>0?o.join(a):"")+e),v=t.root,g=[],y=[];function m(e,t,n,r){var i={name:""};i="string"===typeof e?{name:e}:e;var o=y.filter((function(e){return e.name===i.name}));if(o.length>0){var a=o[0];if(a.type!==t)throw new Error("A metric named "+i.name+" is already defined with different type.");return"undefined"!==typeof n&&a.update(n).catch((function(){})),a}var s=r(i);return y.push(s),s}var w={get name(){return u},get description(){return c},get repo(){return l},get parent(){return d},path:p,id:h,root:v,get subSystems(){return g},get metrics(){return y},subSystem:function(e,t){if(!e||0===e.length)throw new Error("name is required");var n=g.filter((function(t){return t.name===e}));if(n.length>0)return n[0];var r=xr(e,l,s,w,t);return g.push(r),r},getState:function(){return f},setState:function(e,t){f={state:e,description:t},s.updateSystem(w,f)},stringMetric:function(e,t){return m(e,rr,t,(function(e){return new br(e,w,s,t)}))},timestampMetric:function(e,t){return m(e,or,t,(function(e){return new kr(e,w,s,t)}))},objectMetric:function(e,t){return m(e,ar,t,(function(e){return new wr(e,w,s,t)}))},numberMetric:function(e,t){return m(e,ir,t,(function(e){return new mr(e,w,s,t)}))},getAggregateState:function(){var e=[];return Object.keys(f).length>0&&e.push({name:u,path:p,state:f.state,description:f.description}),g.forEach((function(t){var n=t.getAggregateState();n.length>0&&e.push.apply(e,n)})),e}};return s.createSystem(w),w}var _r=function(){function e(e,t){t.init(this),this.root=xr("",this,t),this.addSystemMetrics(this.root,e.clickStream||void 0===e.clickStream)}return e.prototype.addSystemMetrics=function(e,t){if("undefined"!==typeof navigator&&e.stringMetric("UserAgent",navigator.userAgent),t&&"undefined"!==typeof document){var n=e.subSystem("ClickStream"),r=function(e){var t;if(e.target){var r=e.target,i=r&&null!==(t=r.getAttribute("class"))&&void 0!==t?t:"";n.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:i,id:r.id,type:"<"+r.tagName.toLowerCase()+">",href:r.href||""}})}};n.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",r):document.attachEvent("onclick",r)}e.stringMetric("StartTime",(new Date).toString());var i=e.stringMetric("StartURL",""),o=e.stringMetric("AppName","");if("undefined"!==typeof window){if("undefined"!==typeof window.location){var a=window.location.href;i.update(a)}"undefined"!==typeof window.glue42gd&&o.update(window.glue42gd.appName)}},e}(),Sr=function(){function e(){}return e.prototype.init=function(e){},e.prototype.createSystem=function(e){return Promise.resolve()},e.prototype.updateSystem=function(e,t){return Promise.resolve()},e.prototype.createMetric=function(e){return Promise.resolve()},e.prototype.updateMetric=function(e){return Promise.resolve()},e}(),Ir=function(){function e(e,t,n){this.api=e,this.lastCount=0,this.initialPublishTimeout=1e4,this.publishInterval=6e4,this.initialPublishTimeout=null!==t&&void 0!==t?t:this.initialPublishTimeout,this.publishInterval=null!==n&&void 0!==n?n:this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}return e.prototype.scheduleCollection=function(){var e=this;setTimeout((function(){e.collect(),setInterval((function(){e.collect()}),e.publishInterval)}),this.initialPublishTimeout)},e.prototype.collect=function(){try{this.collectMemory(),this.collectEntries()}catch(e){}},e.prototype.collectMemory=function(){var e=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:e.totalJSHeapSize,usedJSHeapSize:e.usedJSHeapSize}))},e.prototype.collectEntries=function(){var e=window.performance.getEntries();if(!(e.length<=this.lastCount)){this.lastCount=e.length;var t=e.map((function(e){return e.toJSON()}));this.system.stringMetric("entries",JSON.stringify(t))}},e}(),Cr=function(e){var t;t=e.connection&&"object"===typeof e.connection?function(e,t){var n,r,i=this;if(!e||"object"!==typeof e)throw new Error("Connection is required parameter");var o=function(e){a(e.root)},a=function e(t){s(t),t.metrics.forEach((function(e){u(e)})),t.subSystems.forEach((function(t){e(t)}))},s=function(e){return er(i,void 0,void 0,(function(){var t,i;return tr(this,(function(o){switch(o.label){case 0:return void 0===e.parent?[2]:[4,n];case 1:return o.sent(),t={name:dr(e.path.join("/")+"/"+e.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},i={type:"define",metrics:[t]},r.send(i),[2]}}))}))},u=function(e){return er(i,void 0,void 0,(function(){var t,i,o;return tr(this,(function(a){switch(a.label){case 0:return t=l(e),[4,n];case 1:return a.sent(),i=cr(t),o={type:"define",metrics:[i]},r.send(o),"undefined"!==typeof t.value&&c(t),[2]}}))}))},c=function(e){if(d()){var t=pr(e),n={type:"publish",values:[{name:dr(e.path.join("/")+"/"+e.name),value:t,timestamp:Date.now()}]};return r.sendFireAndForget(n)}return Promise.resolve()},l=function(e){var t=Zn({},e);return"object"===typeof e.value&&null!==e.value&&(t.value=Zn({},e.value)),t},d=function(){var e;try{return(null!==(e=t.canUpdateMetric)&&void 0!==e?e:function(){return!0})()}catch(n){return!0}};return{init:function(i){var a;n=new Promise((function(e){a=e})),(r=e.domain("metrics")).onJoined((function(e){!e&&a&&(a(),a=void 0);var t={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};r.send(t),e&&o(i)})),r.join({system:t.system,service:t.service,instance:t.instance})},createSystem:s,updateSystem:function(t,o){return er(i,void 0,void 0,(function(){var i,a,s;return tr(this,(function(u){switch(u.label){case 0:return[4,n];case 1:return u.sent(),i={type:"publish",values:[{name:dr(t.path.join("/")+"/"+t.name+"/State"),value:{Description:o.description,Value:o.state},timestamp:Date.now()}]},r.send(i),a=vr(t),s={type:"publish",peer_id:e.peerId,values:[{name:"/State",value:{Description:a.description,Value:a.value},timestamp:Date.now()}]},r.send(s),[2]}}))}))},createMetric:u,updateMetric:function(e){return er(i,void 0,void 0,(function(){var t;return tr(this,(function(r){switch(r.label){case 0:return t=l(e),[4,n];case 1:return r.sent(),c(t),[2]}}))}))}}}(e.connection,e):new Sr;var n=new _r(e,t).root;e.disableAutoAppSystem||(n=n.subSystem("App"));var r=function(e){var t,n=e.subSystem("reporting"),r={name:"features"},i=function(e,i,o){if("undefined"===typeof e||""===e)throw new Error("name is mandatory");if("undefined"===typeof i||""===i)throw new Error("action is mandatory");if("undefined"===typeof o||""===o)throw new Error("payload is mandatory");t?t.update({name:e,action:i,payload:o}):t=n.objectMetric(r,{name:e,action:i,payload:o})};return e.featureMetric=i,e}(n);return function(e,t){var n,r;if("undefined"===typeof window)return;var i=null===(r=null===(n=null===window||void 0===window?void 0:window.glue42gd)||void 0===n?void 0:n.metrics)||void 0===r?void 0:r.pagePerformanceMetrics;i&&(t=i);(null===t||void 0===t?void 0:t.enabled)&&new Ir(e,t.initialPublishTimeout,t.publishInterval)}(r,e.pagePerformanceMetrics),r};function Tr(e){if(e&&e.errorHandling&&"function"!==typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"===typeof e.errorHandling&&e.errorHandling,n={};function r(n,r){var i=n instanceof Error?n:new Error(n);if(t)t(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t,i){var o=n[e];return o||(o=[],n[e]=o),o.push(t),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=n[e])||void 0===o?void 0:o.includes(t))try{Array.isArray(i)?t.apply(void 0,i):t.apply(void 0,[i])}catch(M){r(M,e)}}))}),0),function(){var r=n[e];r&&(0===(r=r.reduce((function(e,n,r){return n===t&&e.length===r||e.push(n),e}),[])).length?delete n[e]:n[e]=r)}},execute:function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=n[e];if(!o||0===o.length)return[];var a=[];return o.forEach((function(n){try{var i=n.apply(void 0,t);a.push(i)}catch(M){a.push(void 0),r(M,e)}})),a},clear:function(){n={}},clearKey:function(e){n[e]&&delete n[e]}}}Tr.default=Tr;var Ar=Tr,Er=function(){function e(e,t){var n=this;this.registry=Ar(),this.gw=e.facade,this.gw.connect((function(e,t){n.messageHandler(t)})).then((function(e){n.client=e}))}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.sendObject=function(e){return this.client?(this.client.send(e),Promise.resolve(void 0)):Promise.reject("not connected")},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"in-memory"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),Pr=function(){function e(e,t){var n=this;this.logger=t,this.registry=Ar(),this.worker=new SharedWorker(e),this.worker.port.onmessage=function(e){n.messageHandler(e.data)}}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.sendObject=function(e){return this.worker.port.postMessage(e),Promise.resolve()},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"shared-worker"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),Mr=function(){function e(){}return e.getGDMajorVersion=function(){if("undefined"!==typeof window&&window.glueDesktop&&window.glueDesktop.version){var e=Number(window.glueDesktop.version.substr(0,1));return isNaN(e)?void 0:e}},e.isNode=function(){if("undefined"!==typeof e._isNode)return e._isNode;if("undefined"!==typeof window)return e._isNode=!1,!1;try{e._isNode="[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){e._isNode=!1}return e._isNode},e}(),Rr=function(){function e(){var e=this;this.rejected=!1,this.resolved=!1,this.promise=new Promise((function(t,n){e.resolve=function(n){e.resolved=!0,t(n)},e.reject=function(t){e.rejected=!0,n(t)}}))}return e.delay=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Object.defineProperty(e.prototype,"ended",{get:function(){return this.rejected||this.resolved},enumerable:!0,configurable:!0}),e}(),Or={};function jr(e){var t=Or[e];if(t)return t;var n=[];function r(){return(new Date).getTime()}var i,o,a=r();function s(e,t){var i=null!==t&&void 0!==t?t:r(),o=0;n.length>0&&(o=i-n[n.length-1].time),n.push({name:e,time:i,diff:o})}s("start",a);var u={get startTime(){return a},get endTime(){return i},get period(){return o},stop:function(){return s("end",i=r()),o=i-a},mark:s,marks:n};return Or[e]=u,u}var Nr=Mr.isNode()?n(559):window.WebSocket,Lr=function(){function e(e,t){if(this.startupTimer=jr("connection"),this._running=!0,this._registry=Ar(),this.wsRequests=[],this.settings=e,this.logger=t,!this.settings.ws)throw new Error("ws is missing")}return e.prototype.onMessage=function(e){return this._registry.add("onMessage",e)},e.prototype.send=function(e,t){var n=this;return new Promise((function(t,r){n.waitForSocketConnection((function(){var i;try{null===(i=n.ws)||void 0===i||i.send(e),t()}catch(o){r(o)}}),r)}))},e.prototype.open=function(){var e=this;return this.logger.info("opening ws..."),this._running=!0,new Promise((function(t,n){e.waitForSocketConnection(t,n)}))},e.prototype.close=function(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()},e.prototype.onConnectedChanged=function(e){return this._registry.add("onConnectedChanged",e)},e.prototype.name=function(){return this.settings.ws},e.prototype.reconnect=function(){var e;null===(e=this.ws)||void 0===e||e.close();var t=new Rr;return this.waitForSocketConnection((function(){t.resolve()})),t.promise},e.prototype.waitForSocketConnection=function(e,t){var n;t=null!==t&&void 0!==t?t:function(){},this._running?1!==(null===(n=this.ws)||void 0===n?void 0:n.readyState)?(this.wsRequests.push({callback:e,failed:t}),this.wsRequests.length>1||this.openSocket()):e():t("wait for socket on "+this.settings.ws+" failed - socket closed by user")},e.prototype.openSocket=function(e,t){return er(this,void 0,void 0,(function(){var n=this;return tr(this,(function(r){switch(r.label){case 0:if(this.startupTimer.mark("opening-socket"),void 0===e&&(e=this.settings.reconnectInterval),"undefined"===typeof t&&(t=this.settings.reconnectAttempts),void 0!==t){if(0===t)return this.notifyForSocketState("wait for socket on "+this.settings.ws+" failed - no more retries left"),[2];this.logger.debug("will retry "+t+" more times (every "+e+" ms)")}r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.initiateSocket()];case 2:return r.sent(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState(),[3,4];case 3:return r.sent(),setTimeout((function(){var r=void 0===t?void 0:t-1;n.openSocket(e,r)}),e),[3,4];case 4:return[2]}}))}))},e.prototype.initiateSocket=function(){var e=this,t=new Rr;return this.logger.debug("initiating ws to "+this.settings.ws+"..."),this.ws=new Nr(this.settings.ws||""),this.ws.onerror=function(n){var r="";try{r=JSON.stringify(n)}catch(o){var i=new WeakSet;r=JSON.stringify(n,(function(e,t){if("object"===typeof t&&null!==t){if(i.has(t))return;i.add(t)}return t}))}t.reject("error"),e.notifyStatusChanged(!1,r)},this.ws.onclose=function(n){e.logger.info("ws closed "+n),t.reject("closed"),e.notifyStatusChanged(!1)},this.ws.onopen=function(){var n;e.startupTimer.mark("ws-opened"),e.logger.info("ws opened "+(null===(n=e.settings.identity)||void 0===n?void 0:n.application)),t.resolve(),e.notifyStatusChanged(!0)},this.ws.onmessage=function(t){e._registry.execute("onMessage",t.data)},t.promise},e.prototype.notifyForSocketState=function(e){this.wsRequests.forEach((function(t){e?t.failed&&t.failed(e):t.callback()})),this.wsRequests=[]},e.prototype.notifyStatusChanged=function(e,t){this._registry.execute("onConnectedChanged",e,t)},e}();var Dr=1;var Wr,Fr,qr,Ur={nextValue:function(){return(Dr=(9301*Dr+49297)%233280)/233280},seed:function(e){Dr=e}},zr="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function Gr(){qr=!1}function Br(e){if(e){if(e!==Wr){if(e.length!==zr.length)throw new Error("Custom alphabet for shortid must be "+zr.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+zr.length+" unique characters. These characters were not unique: "+t.join(", "));Wr=e,Gr()}}else Wr!==zr&&(Wr=zr,Gr())}function Hr(){return qr||(qr=function(){Wr||Br(zr);for(var e,t=Wr.split(""),n=[],r=Ur.nextValue();t.length>0;)r=Ur.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}())}var Vr={characters:function(e){return Br(e),Wr},seed:function(e){Ur.seed(e),Fr!==e&&(Gr(),Fr=e)},lookup:function(e){return Hr()[e]},shuffled:Hr},Jr="object"===typeof window&&(window.crypto||window.msCrypto);var Kr=function(){if(!Jr||!Jr.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return Jr.getRandomValues(e),48&e[0]};var Qr=function(e,t){for(var n,r=0,i="";!n;)i+=e(t>>4*r&15|Kr()),n=t<Math.pow(16,r+1),r++;return i};var $r=function(e){var t=Vr.shuffled();return{version:15&t.indexOf(e.substr(0,1)),worker:15&t.indexOf(e.substr(1,1))}};var Yr=function(e){if(!e||"string"!==typeof e||e.length<6)return!1;for(var t=Vr.characters(),n=e.length,r=0;r<n;r++)if(-1===t.indexOf(e[r]))return!1;return!0},Xr=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t,n,r=0;function i(){var e="",i=Math.floor(.001*(Date.now()-1459707606518));return i===n?t++:(t=0,n=i),e+=Qr(Vr.lookup,6),e+=Qr(Vr.lookup,r),t>0&&(e+=Qr(Vr.lookup,t)),e+=Qr(Vr.lookup,i)}e.exports=i,e.exports.generate=i,e.exports.seed=function(t){return Vr.seed(t),e.exports},e.exports.worker=function(t){return r=t,e.exports},e.exports.characters=function(e){return void 0!==e&&Vr.characters(e),Vr.shuffled()},e.exports.decode=$r,e.exports.isValid=Yr})),Zr=(Xr.generate,Xr.seed,Xr.worker,Xr.characters,Xr.decode,Xr.isValid,Xr);function ei(e,t,n,r,i){null==e&&(e="global"),r=r||["success"],i=i||["error"];var o,a=!1,s=!1,u=!1,c=Ar();t.disconnected((function(){u=!1,n.debug("connection is down"),a=!1,s=!0,c.execute("onLeft",{disconnected:!0})})),t.loggedIn((function(){u=!0,s&&(n.debug("connection is now up - trying to reconnect..."),d(o))})),t.on("success",(function(e){return f(e)})),t.on("error",(function(e){return p(e)})),t.on("result",(function(e){return f(e)})),r&&r.forEach((function(e){t.on(e,(function(e){return f(e)}))})),i&&i.forEach((function(e){t.on(e,(function(e){return p(e)}))}));var l={};function d(t){return o=t,new Promise((function(r,i){if(a)r();else{var o;if("global"===e)o=u?Promise.resolve({}):Promise.reject("not connected to gateway");else n.debug("joining domain "+e),o=v({type:"join",destination:e,domain:"global",options:t});o.then((function(){!function(){n.debug("did join "+e),a=!0;var t=s;s=!1,c.execute("onJoined",t)}(),r()})).catch((function(t){n.debug("error joining "+e+" domain: "+JSON.stringify(t)),i(t)}))}}))}function p(t){if(e===t.domain){var n=t.request_id;if(n){var r=l[n];r&&r.error(t)}}}function f(t){if(t.domain===e){var n=t.request_id;if(n){var r=l[n];r&&r.success(t)}}}function h(){return Zr()}function v(r,i,o){o=o||{},r.request_id=r.request_id||h(),r.domain=r.domain||e,o.skipPeerId||(r.peer_id=t.peerId);var a=r.request_id;return new Promise((function(e,s){l[a]={success:function(t){delete l[a],t._tag=i,e(t)},error:function(e){n.warn("GW error - "+JSON.stringify(e)+" for request "+JSON.stringify(r)),delete l[a],e._tag=i,s(e)}},t.send(r,o).catch((function(e){l[a].error({err:e})}))}))}return{join:d,leave:function(){return"global"===e?Promise.resolve():(n.debug("stopping session "+e+"..."),s=!1,v({type:"leave",destination:e,domain:"global"}).then((function(){a=!1,c.execute("onLeft")})).catch((function(){a=!1,c.execute("onLeft")})))},onJoined:function(e){return a&&e(!1),c.add("onJoined",e)},onLeft:function(e){return a||e(),c.add("onLeft",e)},send:v,sendFireAndForget:function(n){return n.request_id=n.request_id?n.request_id:h(),n.domain=n.domain||e,n.peer_id=t.peerId,t.send(n)},on:function(r,i){t.on(r,(function(t){if(t.domain===e)try{i(t)}catch(r){n.error("Callback  failed: "+r+" \n "+r.stack+" \n msg was: "+JSON.stringify(t),r)}}))},loggedIn:function(e){return t.loggedIn(e)},connected:function(e){return t.connected(e)},disconnected:function(e){return t.disconnected(e)},get peerId(){return t.peerId},get domain(){return e}}}var ti=function(){function e(e,t,n){var r=this;this.connection=e,this.settings=t,this.logger=n,this.protocolVersion=3,this.datePrefix="#T42_DATE#",this.datePrefixLen=this.datePrefix.length,this.dateMinLen=this.datePrefixLen+1,this.datePrefixFirstChar=this.datePrefix[0],this.registry=Ar(),this._isLoggedIn=!1,this.shouldTryLogin=!0,this.initialLogin=!0,this.initialLoginAttempts=3,this.sessions=[],e.disconnected((function(){r.handleDisconnected()})),this.ping()}return Object.defineProperty(e.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!0,configurable:!0}),e.prototype.processStringMessage=function(e){var t=this,n=JSON.parse(e,(function(e,n){if("string"!==typeof n)return n;if(n.length<t.dateMinLen)return n;if(n[0]!==t.datePrefixFirstChar)return n;if(n.substring(0,t.datePrefixLen)!==t.datePrefix)return n;try{var r=parseInt(n.substring(t.datePrefixLen,n.length),10);return isNaN(r)?n:new Date(r)}catch(i){return n}}));return{msg:n,msgType:n.type}},e.prototype.createStringMessage=function(e){var t=Date.prototype.toJSON;try{var n=this.datePrefix;return Date.prototype.toJSON=function(){return n+this.getTime()},JSON.stringify(e)}finally{Date.prototype.toJSON=t}},e.prototype.processObjectMessage=function(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}},e.prototype.createObjectMessage=function(e){return e},e.prototype.login=function(e,t){return er(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l,d;return tr(this,(function(p){switch(p.label){case 0:if(this.logger.debug("logging in..."),this.loginConfig=e,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0,n={},this.connection.gatewayToken=e.gatewayToken,!e.gatewayToken)return[3,5];if(!t)return[3,4];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.getNewGWToken()];case 2:return c=p.sent(),e.gatewayToken=c,[3,4];case 3:return r=p.sent(),this.logger.warn("failed to get GW token when reconnecting "+((null===r||void 0===r?void 0:r.message)||r)),[3,4];case 4:return n.method="gateway-token",n.token=e.gatewayToken,this.connection.gatewayToken=e.gatewayToken,[3,10];case 5:return"sspi"!==e.flowName?[3,9]:(n.provider="win",n.method="access-token",e.flowCallback&&e.sessionId?(i=n,[4,e.flowCallback(e.sessionId,null)]):[3,7]);case 6:return i.token=p.sent().data.toString("base64"),[3,8];case 7:throw new Error("Invalid SSPI config");case 8:return[3,10];case 9:if(e.token)n.method="access-token",n.token=e.token;else if(e.username)n.method="secret",n.login=e.username,n.secret=e.password;else{if(!e.provider)throw new Error("invalid auth message"+JSON.stringify(e));n.provider=e.provider,n.providerContext=e.providerContext}p.label=10;case 10:o={type:"hello",identity:this.settings.identity,authentication:n},e.sessionId&&(o.request_id=e.sessionId),this.globalDomain=ei("global",this.connection,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]),a={skipPeerId:!0},this.initialLogin&&(a.retryInterval=this.settings.reconnectInterval,a.maxRetries=this.settings.reconnectAttempts),p.label=11;case 11:p.trys.push([11,19,20,21]),s=void 0,p.label=12;case 12:return[4,this.globalDomain.send(o,void 0,a)];case 13:return"authentication-request"!==(u=p.sent()).type?[3,16]:(c=Buffer.from(u.authentication.token,"base64"),e.flowCallback&&e.sessionId?(l=o.authentication,[4,e.flowCallback(e.sessionId,c)]):[3,15]);case 14:l.token=p.sent().data.toString("base64"),p.label=15;case 15:return o.request_id=e.sessionId,[3,12];case 16:if("welcome"===u.type)return s=u,[3,18];throw"error"===u.type?new Error("Authentication failed: "+u.reason):new Error("Unexpected message type during authentication: "+u.type);case 17:return[3,12];case 18:return this.initialLogin=!1,this.logger.debug("login successful with peerId "+s.peer_id),this.connection.peerId=s.peer_id,this.connection.resolvedIdentity=s.resolved_identity,this.connection.availableDomains=s.available_domains,s.options&&(this.connection.token=s.options.access_token,this.connection.info=s.options.info),this.setLoggedIn(!0),[2,s.resolved_identity];case 19:throw d=p.sent(),this.logger.error("error sending hello message - "+(d.message||d.msg||d.reason||d),d),d;case 20:return e&&e.flowCallback&&e.sessionId&&e.flowCallback(e.sessionId,null),[7];case 21:return[2]}}))}))},e.prototype.logout=function(){return er(this,void 0,void 0,(function(){var e;return tr(this,(function(t){switch(t.label){case 0:return this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer),e=this.sessions.map((function(e){e.leave()})),[4,Promise.all(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this._isLoggedIn&&e(),this.registry.add("onLoggedIn",e)},e.prototype.domain=function(e,t,n,r){var i=this.sessions.filter((function(t){return t.domain===e}))[0];return i||(i=ei(e,this.connection,t,n,r),this.sessions.push(i)),i},e.prototype.handleDisconnected=function(){var e=this;if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.connection.login(this.loginConfig,!0).catch((function(){setTimeout(e.handleDisconnected.bind(e),e.settings.reconnectInterval||1e3)}))}},e.prototype.setLoggedIn=function(e){this._isLoggedIn=e,this._isLoggedIn&&this.registry.execute("onLoggedIn")},e.prototype.ping=function(){var e=this;this.shouldTryLogin&&(this._isLoggedIn&&this.connection.send({type:"ping"}),this.pingTimer=setTimeout((function(){e.ping()}),3e4))},e.prototype.authToken=function(){return this.globalDomain?this.globalDomain.send({type:"create-token"}).then((function(e){return e.token})):Promise.reject(new Error("no global domain session"))},e.prototype.getNewGWToken=function(){if(void 0!==typeof window){var e=window.glue42gd;if(e)return e.getGWToken()}return Promise.reject(new Error("not running in GD"))},e}(),ni=function(){function e(e){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var t=0,n=e;t<n.length;t++){var r=n[t];this.specs[r.name]=r,this.specsNames.push(r.name)}}return e.prototype.init=function(e){var t=this;this.connection=e;for(var n=0,r=this.specsNames;n<r.length;n++)for(var i=r[n],o=function(n){var r=a.subsRefCount[n];if(r||(r=0),r+=1,a.subsRefCount[n]=r,r>1)return"continue";var i=e.on(n,(function(e){return t.processMessage(n,e)}));a.subs[n]=i},a=this,s=0,u=this.specs[i].types;s<u.length;s++){o(u[s])}},e.prototype.processMessage=function(e,t){if(!this.isDone&&t)for(var n=0,r=this.specsNames;n<r.length;n++){var i=r[n];if(-1!==this.specs[i].types.indexOf(e)){var o=this.messages[i]||[];this.messages[i]=o,o.push(t)}}},e.prototype.drain=function(e,t){var n;t&&(this.messages[e]||[]).forEach(t),delete this.messages[e];for(var r=0,i=this.specs[e].types;r<i.length;r++){var o=i[r];this.subsRefCount[o]-=1,this.subsRefCount[o]<=0&&(null===(n=this.connection)||void 0===n||n.off(this.subs[o]),delete this.subs[o],delete this.subsRefCount[o])}delete this.specs[e],this.specs.length||(this.isDone=!0)},e}(),ri=function(e,t,n){return new Promise((function(r,i){var o=setTimeout((function(){i(n||"Promise timeout hit: "+t)}),t);new Promise(e).then((function(e){clearTimeout(o),r(e)})).catch((function(e){clearTimeout(o),i(e)}))}))},ii=function(){function e(e,t,n){this.settings=e,this.logger=t,this.identity=n,this.iAmConnected=!1,this.parentReady=!1,this.rejected=!1,this.children=[],this.extContentAvailable=!1,this.extContentConnecting=!1,this.extContentConnected=!1,this.parentInExtMode=!1,this.webNamespace="g42_core_web",this.parentPingTimeout=5e3,this.connectionRequestTimeout=7e3,this.defaultTargetString="*",this.registry=Ar(),this.messages={connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:this.handleParentReady.bind(this)},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:this.handleClientUnload.bind(this)},manualUnload:{name:"manualUnload",handle:this.handleManualUnload.bind(this)},extConnectionResponse:{name:"extConnectionResponse",handle:this.handleExtConnectionResponse.bind(this)},extSetupRequest:{name:"extSetupRequest",handle:this.handleExtSetupRequest.bind(this)},gatewayDisconnect:{name:"gatewayDisconnect",handle:this.handleGatewayDisconnect.bind(this)},gatewayInternalConnect:{name:"gatewayInternalConnect",handle:this.handleGatewayInternalConnect.bind(this)}},this.extContentAvailable=!!window.glue42ext,this.setUpMessageListener(),this.setUpUnload(),this.setupPlatformUnloadListener(),this.settings.port||(this.parent=window.opener||window.top,this.parentType=window.opener?"opener":-1!==window.name.indexOf("#wsp")?"workspace":"top")}return e.prototype.manualSetReadyState=function(){this.iAmConnected=!0,this.parentReady=!0},Object.defineProperty(e.prototype,"transportWindowId",{get:function(){return this.publicWindowId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"communicationId",{get:function(){return this._communicationId},enumerable:!0,configurable:!0}),e.prototype.sendObject=function(e){return er(this,void 0,void 0,(function(){return tr(this,(function(t){if(this.extContentConnected)return[2,window.postMessage({glue42ExtOut:e},this.defaultTargetString)];if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");return this.port.postMessage(e),[2]}))}))},Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.send=function(){return Promise.reject("not supported")},e.prototype.onConnectedChanged=function(e){return this.registry.add("onConnectedChanged",e)},e.prototype.open=function(){return er(this,void 0,void 0,(function(){return tr(this,(function(e){switch(e.label){case 0:return this.logger.debug("opening a connection to the web platform gateway."),[4,this.connect()];case 1:return e.sent(),this.notifyStatusChanged(!0),[2]}}))}))},e.prototype.close=function(){var e,t,n={glue42core:{type:this.messages.gatewayDisconnect.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};return null===(t=this.port)||void 0===t||t.postMessage(n),this.parentReady=!1,this.notifyStatusChanged(!1,"manual reconnection"),Promise.resolve()},e.prototype.name=function(){return"web-platform"},e.prototype.reconnect=function(){return er(this,void 0,void 0,(function(){return tr(this,(function(e){switch(e.label){case 0:return[4,this.close()];case 1:return e.sent(),[2,Promise.resolve()]}}))}))},e.prototype.connect=function(){return er(this,void 0,void 0,(function(){return tr(this,(function(e){switch(e.label){case 0:return this.settings.port?[4,this.initiateInternalConnection()]:[3,2];case 1:return e.sent(),this.logger.debug("internal web platform connection completed"),[2];case 2:if(!this.parentType||!this.parent)throw new Error("Cannot initiate a connection, because there is no opener, no top and no port.");return this.logger.debug("opening a "+("opener"===this.parentType?"child":"grandchild")+" client web platform connection"),[4,this.waitParent(this.parent,this.parentType)];case 3:return e.sent(),this.parentInExtMode?[4,this.requestConnectionPermissionFromExt()]:[3,5];case 4:e.sent(),e.label=5;case 5:return[4,this.initiateRemoteConnection(this.parent,this.parentType)];case 6:return e.sent(),this.logger.debug("the "+("opener"===this.parentType?"child":"grandchild")+" client is connected"),[2]}}))}))},e.prototype.initiateInternalConnection=function(){var e=this;return new Promise((function(t,n){e.logger.debug("opening an internal web platform connection"),e.port=e.settings.port,e.iAmConnected?e.logger.warn("cannot open a new connection, because this client is currently connected"):(e.port.onmessage=function(r){var i,o;if(!e.iAmConnected||(null===(i=r.data)||void 0===i?void 0:i.glue42core)){var a=null===(o=r.data)||void 0===o?void 0:o.glue42core;a&&(a.type===e.messages.gatewayInternalConnect.name&&a.success&&(e.publicWindowId=e.settings.windowId,e.identity&&e.publicWindowId&&(e.identity.windowId=e.publicWindowId,e.identity.instance=e.publicWindowId),t()),a.type===e.messages.gatewayInternalConnect.name&&a.error&&n(a.error))}else e.registry.execute("onMessage",r.data)},e.port.postMessage({glue42core:{type:e.messages.gatewayInternalConnect.name}}))}))},e.prototype.initiateRemoteConnection=function(e,t){var n=this;return ri((function(r,i){var o;n.connectionResolve=r,n.connectionReject=i,n.myClientId=null!==(o=n.myClientId)&&void 0!==o?o:Zr();var a="workspace"===n.parentType?window.name.substring(0,window.name.indexOf("#wsp")):window.name,s={glue42core:{type:n.messages.connectionRequest.name,clientId:n.myClientId,clientType:"top"===t||"workspace"===t?"grandChild":"child",bridgeInstanceId:a}};if(n.logger.debug("sending connection request to "+t),n.extContentConnecting)return s.glue42core.clientType="child",s.glue42core.bridgeInstanceId=n.myClientId,s.glue42core.parentWindowId=n.parentWindowId,window.postMessage(s,n.defaultTargetString);e.postMessage(s,n.defaultTargetString)}),this.connectionRequestTimeout,"The connection to the opener/top window timed out")},e.prototype.waitParent=function(e,t){return er(this,void 0,void 0,(function(){var n,r,i=this;return tr(this,(function(o){switch(o.label){case 0:if(n="Cannot initiate glue, because this window was not opened or created by a glue client",(r=ri((function(r,o){var a=window.self!==window.top;if("top"===t&&!a)return o(n);i.parentPingResolve=r;var s={glue42core:{type:"opener"===t?i.messages.platformPing.name:i.messages.parentPing.name}};i.logger.debug("checking for "+t+" window availability"),i.parentPingInterval=setInterval((function(){e.postMessage(s,i.defaultTargetString)}),1e3)}),this.parentPingTimeout,n)).catch((function(){i.parentPingInterval&&(clearInterval(i.parentPingInterval),delete i.parentPingInterval)})),!this.extContentAvailable)return[2,r];o.label=1;case 1:return o.trys.push([1,3,,5]),[4,r];case 2:return o.sent(),[2];case 3:return o.sent(),this.logger.debug("the parent check failed, but there is an associated extension content script, requesting permission..."),[4,this.requestConnectionPermissionFromExt()];case 4:return o.sent(),[3,5];case 5:return[2]}}))}))},e.prototype.setUpMessageListener=function(){var e=this;this.settings.port?this.logger.debug("skipping generic message listener, because this is an internal client"):window.addEventListener("message",(function(t){var n,r=null===(n=t.data)||void 0===n?void 0:n.glue42core;if(r&&!e.rejected)if(e.checkMessageTypeValid(r.type)){var i=r.type;e.logger.debug("received valid glue42core message of type: "+i),e.messages[i].handle(t)}else e.logger.error("cannot handle the incoming glue42 core message, because the type is invalid: "+r.type)}))},e.prototype.setUpUnload=function(){var e=this;this.settings.port?this.logger.debug("skipping unload event listener, because this is an internal client"):window.addEventListener("beforeunload",(function(){var t,n;if(!e.extContentConnected){var r={glue42core:{type:e.messages.clientUnload.name,data:{clientId:e.myClientId,ownWindowId:null===(t=e.identity)||void 0===t?void 0:t.windowId}}};e.parent&&e.parent.postMessage(r,e.defaultTargetString),null===(n=e.port)||void 0===n||n.postMessage(r)}}))},e.prototype.handleParentReady=function(e){var t;this.logger.debug("handling the ready signal from the parent, by resoling the pending promise."),this.parentReady=!0;var n=null===(t=e.data)||void 0===t?void 0:t.glue42core;n&&n.extMode&&(this.logger.debug("my parent is connected to its content script, fetching windowId and proceeding with content script connection"),this.parentWindowId=n.extMode.windowId,this.parentInExtMode=!0),this.parentPingResolve&&(this.parentPingResolve(),delete this.parentPingResolve),this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval)},e.prototype.handlePlatformReady=function(){this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve&&(this.parentPingResolve(),delete this.parentPingResolve),this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval)},e.prototype.handleConnectionAccepted=function(e){var t,n=null===(t=e.data)||void 0===t?void 0:t.glue42core;return this.myClientId===n.clientId?this.handleAcceptanceOfMyRequest(n):this.handleAcceptanceOfGrandChildRequest(n,e)},e.prototype.handleAcceptanceOfMyRequest=function(e){var t,n,r,i=this;if(this.logger.debug("handling a connection accepted signal targeted at me."),this.isPreferredActivated=e.isPreferredActivated,this.extContentConnecting)return this.processExtContentConnection(e);if(e.port){if(this.publicWindowId="opener"===this.parentType?window.name:"top"===this.parentType?e.parentWindowId:window.name.substring(0,window.name.indexOf("#wsp")),this.identity&&"top"!==this.parentType&&(this.identity.windowId=null!==(t=this.identity.windowId)&&void 0!==t?t:this.publicWindowId,this.identity.instance=null!==(n=this.identity.instance)&&void 0!==n?n:this.publicWindowId),this.identity&&"top"===this.parentType&&(this.identity.instance=null!==(r=this.identity.instance)&&void 0!==r?r:Zr()),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),this._communicationId=e.communicationId,this.port=e.port,this.port.onmessage=function(e){return i.registry.execute("onMessage",e.data)},this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve;this.logger.error("unable to call the connection resolve, because no connection promise was found")}else this.logger.error("cannot set up my connection, because I was not provided with a port")},e.prototype.processExtContentConnection=function(e){var t=this;if(this.logger.debug("handling a connection accepted signal targeted at me for extension content connection."),this.extContentConnecting=!1,this.extContentConnected=!0,this.publicWindowId=this.parentWindowId||this.myClientId,this.extContentConnecting&&this.identity&&(this.identity.windowId=this.publicWindowId),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),window.addEventListener("message",(function(e){var n,r=null===(n=e.data)||void 0===n?void 0:n.glue42ExtInc;r&&t.registry.execute("onMessage",r)})),this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve},e.prototype.handleAcceptanceOfGrandChildRequest=function(e,t){if(this.extContentConnecting||this.extContentConnected)this.logger.debug("cannot process acceptance of a grandchild, because I am connected to a content script");else{this.logger.debug("handling a connection accepted signal targeted at a grandchild: "+e.clientId);var n=this.children.find((function(t){return t.grandChildId===e.clientId}));n?(n.connected=!0,this.logger.debug("the grandchild connection for "+e.clientId+" is set up, forwarding the success message and the gateway port"),e.parentWindowId=this.publicWindowId,n.source.postMessage(t.data,n.origin,[e.port])):this.logger.error("cannot handle connection accepted for grandchild: "+e.clientId+", because there is no grandchild with this id")}},e.prototype.handleConnectionRejected=function(){this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),this.connectionReject&&(this.connectionReject("The platform connection was rejected. Most likely because this window was not created by a glue API call"),delete this.connectionReject)},e.prototype.handleConnectionRequest=function(e){if(this.extContentConnecting)this.logger.debug("This connection request event is targeted at the extension content");else{var t=e.source,n=e.data.glue42core;if(!n.clientType||"grandChild"!==n.clientType)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source was not opened by a glue API call");if(!n.clientId)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source did not provide a valid id");if("opener"!==this.parentType||!this.parent)return this.rejectConnectionRequest(t,e.origin,"Cannot forward the connection request, because no direct connection to the platform was found");this.logger.debug("handling a connection request for a grandchild: "+n.clientId),this.children.push({grandChildId:n.clientId,source:t,connected:!1,origin:e.origin}),this.logger.debug("grandchild: "+n.clientId+" is prepared, forwarding connection request to the platform"),this.parent.postMessage(e.data,this.defaultTargetString)}},e.prototype.handleParentPing=function(e){if(this.parentReady)if(this.iAmConnected){var t={glue42core:{type:this.messages.parentReady.name}};this.extContentConnected&&(t.glue42core.extMode={windowId:this.myClientId});var n=e.source;this.logger.debug("responding to a parent ping with a ready message"),n.postMessage(t,e.origin)}else this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");else this.logger.debug("my parent is not ready, I am ignoring the parent ping")},e.prototype.setupPlatformUnloadListener=function(){var e=this;this.onMessage((function(t){"platformUnload"===t.type&&(e.logger.debug("detected a web platform unload"),e.parentReady=!1,e.notifyStatusChanged(!1,"Gateway unloaded"))}))},e.prototype.handleManualUnload=function(){var e,t,n={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};if(this.extContentConnected)return window.postMessage({glue42ExtOut:n},this.defaultTargetString);null===(t=this.port)||void 0===t||t.postMessage(n)},e.prototype.handleClientUnload=function(e){var t=e.data.glue42core,n=null===t||void 0===t?void 0:t.data.clientId;n?this.children.find((function(e){return e.grandChildId===n}))?(this.logger.debug("handling grandchild unload for id: "+n),this.children=this.children.filter((function(e){return e.grandChildId!==n}))):this.logger.warn("cannot process grand child unload, because this client is unaware of this grandchild"):this.logger.warn("cannot process grand child unload, because the provided id was not valid")},e.prototype.handlePlatformPing=function(){this.logger.error("cannot handle platform ping, because this is not a platform calls handling component")},e.prototype.notifyStatusChanged=function(e,t){this.iAmConnected=e,this.registry.execute("onConnectedChanged",e,t)},e.prototype.checkMessageTypeValid=function(e){return"string"===typeof e&&!!this.messages[e]},e.prototype.rejectConnectionRequest=function(e,t,n){this.rejected=!0,this.logger.error(n);var r={glue42core:{type:this.messages.connectionRejected.name}};e.postMessage(r,t)},e.prototype.requestConnectionPermissionFromExt=function(){var e=this;return this.waitForContentScript().then((function(){return ri((function(t,n){e.extConnectionResolve=t,e.extConnectionReject=n;e.logger.debug("permission request to the extension content script was sent"),window.postMessage({glue42core:{type:"extSetupRequest"}},e.defaultTargetString)}),e.parentPingTimeout,"Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection timed out")}))},e.prototype.handleExtConnectionResponse=function(e){var t;if(!(null===(t=e.data)||void 0===t?void 0:t.glue42core).approved&&this.extConnectionReject)return this.extConnectionReject("Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection was rejected");this.extConnectionResolve&&(this.extContentConnecting=!0,this.logger.debug("The extension connection was approved, proceeding."),this.extConnectionResolve(),delete this.extConnectionResolve)},e.prototype.handleExtSetupRequest=function(){},e.prototype.handleGatewayDisconnect=function(){},e.prototype.handleGatewayInternalConnect=function(){},e.prototype.waitForContentScript=function(){var e;return!!(null===(e=window.glue42ext)||void 0===e?void 0:e.content)?Promise.resolve():ri((function(e){window.addEventListener("Glue42EXTReady",(function(){e()}))}),this.connectionRequestTimeout,"The content script was available, but was never heard to be ready")},e}(),oi=function(){function e(e){void 0===e&&(e=0),this.minSequenceInterval=e,this.queue=[],this.isExecutingQueue=!1}return e.prototype.enqueue=function(e){var t=this;return new Promise((function(n,r){t.queue.push({action:e,resolve:n,reject:r}),t.executeQueue()}))},e.prototype.executeQueue=function(){return er(this,void 0,void 0,(function(){var e,t,n;return tr(this,(function(r){switch(r.label){case 0:if(this.isExecutingQueue)return[2];this.isExecutingQueue=!0,r.label=1;case 1:if(!this.queue.length)return[3,7];if(!(e=this.queue.shift()))return this.isExecutingQueue=!1,[2];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,e.action()];case 3:return t=r.sent(),e.resolve(t),[3,5];case 4:return n=r.sent(),e.reject(n),[3,5];case 5:return[4,this.intervalBreak()];case 6:return r.sent(),[3,1];case 7:return this.isExecutingQueue=!1,[2]}}))}))},e.prototype.intervalBreak=function(){var e=this;return new Promise((function(t){return setTimeout(t,e.minSequenceInterval)}))},e}(),ai=function(){function e(e,t){if(this.settings=e,this.logger=t,this.messageHandlers={},this.ids=1,this.registry=Ar(),this._connected=!1,this.isTrace=!1,this._swapTransport=!1,this._switchInProgress=!1,this._transportSubscriptions=[],this._sequelizer=new oi,(e=e||{}).reconnectAttempts=e.reconnectAttempts||10,e.reconnectInterval=e.reconnectInterval||1e3,e.inproc)this.transport=new Er(e.inproc,t.subLogger("inMemory"));else if(e.sharedWorker)this.transport=new Pr(e.sharedWorker,t.subLogger("shared-worker"));else if(e.webPlatform)this.transport=new ii(e.webPlatform,t.subLogger("web-platform"),e.identity);else{if(void 0===e.ws)throw new Error("No connection information specified");this.transport=new Lr(e,t.subLogger("ws"))}this.isTrace=t.canPublish("trace"),t.debug("starting with "+this.transport.name()+" transport"),this.protocol=new ti(this,e,t.subLogger("protocol"));var n=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),r=this.transport.onMessage(this.handleTransportMessage.bind(this));this._transportSubscriptions.push(n),this._transportSubscriptions.push(r),this._defaultTransport=this.transport}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;return null===(e=this.protocol)||void 0===e?void 0:e.protocolVersion},enumerable:!0,configurable:!0}),e.prototype.switchTransport=function(e){return er(this,void 0,void 0,(function(){var t=this;return tr(this,(function(n){return[2,this._sequelizer.enqueue((function(){return er(t,void 0,void 0,(function(){var t,n,r;return tr(this,(function(i){switch(i.label){case 0:if(!e||"object"!==typeof e)throw new Error("Cannot switch transports, because the settings are missing or invalid.");if("undefined"===typeof e.type)throw new Error("Cannot switch the transport, because the type is not defined");return this.logger.trace("Starting transport switch with settings: "+JSON.stringify(e)),t="secondary"===e.type?this.getNewSecondaryTransport(e):this._defaultTransport,this._targetTransport=t,this._targetAuth="secondary"===e.type?this.getNewSecondaryAuth(e):this._defaultAuth,n=this.verifyConnection(),this._swapTransport=!0,this._switchInProgress=!0,this.logger.trace("The new transport has been set, closing the current transport"),[4,this.transport.close()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,n];case 3:return i.sent(),r=this.transport===t,this.logger.info("The reconnection after the switch was completed. Was the switch a success: "+r),this._switchInProgress=!1,[2,{success:r}];case 4:return i.sent(),this.logger.info("The reconnection after the switch timed out, reverting back to the default transport."),this.switchTransport({type:"default"}),this._switchInProgress=!1,[2,{success:!1}];case 5:return[2]}}))}))}))]}))}))},e.prototype.onLibReAnnounced=function(e){return this.registry.add("libReAnnounced",e)},e.prototype.setLibReAnnounced=function(e){this.registry.execute("libReAnnounced",e)},e.prototype.send=function(e,t){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){var n=this.protocol.createObjectMessage(e);return this.isTrace&&this.logger.trace(">> "+JSON.stringify(n)),this.transport.sendObject(n,t)}var r=this.protocol.createStringMessage(e);return this.isTrace&&this.logger.trace(">> "+r),this.transport.send(r,t)},e.prototype.on=function(e,t){e=e.toLowerCase(),void 0===this.messageHandlers[e]&&(this.messageHandlers[e]={});var n=this.ids++;return this.messageHandlers[e][n]=t,{type:e,id:n}},e.prototype.off=function(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.protocol.isLoggedIn},enumerable:!0,configurable:!0}),e.prototype.connected=function(e){var t=this;return this.protocol.loggedIn((function(){var n=t.transport.name();e(n)}))},e.prototype.disconnected=function(e){return this.registry.add("disconnected",e)},e.prototype.login=function(e,t){return er(this,void 0,void 0,(function(){var n,r,i;return tr(this,(function(o){switch(o.label){case 0:this._defaultAuth||(this._defaultAuth=e),this._swapTransport&&(this.logger.trace("Detected a transport swap, swapping transports"),n=this.transportSwap(),e=null!==n&&void 0!==n?n:e),this.logger.trace("Starting login for transport: "+this.transport.name()+" and auth "+JSON.stringify(e)),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.transport.open()];case 2:return o.sent(),this.logger.trace("Transport: "+this.transport.name()+" opened, logging in"),jr("connection").mark("transport-opened"),[4,this.protocol.login(e,t)];case 3:return r=o.sent(),this.logger.trace("Logged in with identity: "+JSON.stringify(r)),jr("connection").mark("protocol-logged-in"),[2,r];case 4:throw i=o.sent(),this._switchInProgress&&(this.logger.trace("An error while logging in after a transport swap, preparing a default swap."),this.prepareDefaultSwap()),new Error(i);case 5:return[2]}}))}))},e.prototype.logout=function(){return er(this,void 0,void 0,(function(){return tr(this,(function(e){switch(e.label){case 0:return[4,this.protocol.logout()];case 1:return e.sent(),[4,this.transport.close()];case 2:return e.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this.protocol.loggedIn(e)},e.prototype.domain=function(e,t,n){return this.protocol.domain(e,this.logger.subLogger("domain="+e),t,n)},e.prototype.authToken=function(){return this.protocol.authToken()},e.prototype.reconnect=function(){return this.transport.reconnect()},e.prototype.distributeMessage=function(e,t){var n=this,r=this.messageHandlers[t.toLowerCase()];void 0!==r&&Object.keys(r).forEach((function(t){var i=r[t];if(void 0!==i)try{i(e)}catch(o){try{n.logger.error("Message handler failed with "+o.stack,o)}catch(a){console.log("Message handler failed",o)}}}))},e.prototype.handleConnectionChanged=function(e){this._connected!==e&&(this._connected=e,e?(this.settings.replaySpecs&&this.settings.replaySpecs.length&&(this.replayer=new ni(this.settings.replaySpecs),this.replayer.init(this)),this.registry.execute("connected")):this.registry.execute("disconnected"))},e.prototype.handleTransportMessage=function(e){var t;t="string"===typeof e?this.protocol.processStringMessage(e):this.protocol.processObjectMessage(e),this.isTrace&&this.logger.trace("<< "+JSON.stringify(t)),this.distributeMessage(t.msg,t.msgType)},e.prototype.verifyConnection=function(){var e=this;return ri((function(t){var n,r=function(e,t){var n=e;return function(){0===--n&&t()}}(2,(function(){n&&n(),t()}));n=e.onLibReAnnounced((function(e){return"interop"===e.name||"contexts"===e.name?r():void 0}))}),1e4,"Transport switch timed out waiting for all libraries to be re-announced")},e.prototype.getNewSecondaryTransport=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.url))throw new Error("Missing secondary transport URL.");return new Lr(Object.assign({},this.settings,{ws:e.transportConfig.url,reconnectAttempts:1}),this.logger.subLogger("ws-secondary"))},e.prototype.getNewSecondaryAuth=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.auth))throw new Error("Missing secondary transport auth information.");return e.transportConfig.auth},e.prototype.transportSwap=function(){if(this._swapTransport=!1,this._targetTransport&&this._targetAuth){this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport=this._targetTransport;var e=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),t=this.transport.onMessage(this.handleTransportMessage.bind(this));return this._transportSubscriptions.push(e),this._transportSubscriptions.push(t),this._targetAuth}this.logger.warn("Error while switching transports - either the target transport or auth is not defined: transport defined -> "+!!this._defaultTransport+", auth defined -> "+!!this._targetAuth+". Staying on the current one.")},e.prototype.prepareDefaultSwap=function(){var e=this;this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport.close().catch((function(t){return e.logger.warn("Error closing the "+e.transport.name()+" transport after a failed connection attempt: "+JSON.stringify(t))})),this._targetTransport=this._defaultTransport,this._targetAuth=this._defaultAuth,this._swapTransport=!0},e}(),si=["trace","debug","info","warn","error","off"],ui=function(){function e(e,t,n){this.name=e,this.parent=t,this.subLoggers=[],this.logFn=console,this.customLogFn=!1,this.name=e,this.path=t?t.path+"."+e:e,this.loggerFullName="["+this.path+"]",this.includeTimeAndLevel=!n,n&&(this.logFn=n,this.customLogFn=!0)}return e.prototype.subLogger=function(t){var n=this.subLoggers.filter((function(e){return e.name===t}))[0];if(void 0!==n)return n;Object.keys(this).forEach((function(e){if(e===t)throw new Error("This sub logger name is not allowed.")}));var r=new e(t,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(r),r},e.prototype.publishLevel=function(e){var t;return e&&(this._publishLevel=e),this._publishLevel||(null===(t=this.parent)||void 0===t?void 0:t.publishLevel())},e.prototype.consoleLevel=function(e){var t;return e&&(this._consoleLevel=e),this._consoleLevel||(null===(t=this.parent)||void 0===t?void 0:t.consoleLevel())},e.prototype.log=function(e,t,n){this.publishMessage(t||"info",e,n)},e.prototype.trace=function(e){this.log(e,"trace")},e.prototype.debug=function(e){this.log(e,"debug")},e.prototype.info=function(e){this.log(e,"info")},e.prototype.warn=function(e){this.log(e,"warn")},e.prototype.error=function(e,t){this.log(e,"error")},e.prototype.canPublish=function(e,t){return si.indexOf(e)>=si.indexOf(t||this.consoleLevel()||"trace")},e.prototype.publishMessage=function(t,n,r){var i=this.loggerFullName;if("error"===t&&!r){var o=new Error;o.stack&&(n=n+"\n"+o.stack.split("\n").slice(3).join("\n"))}if(this.canPublish(t,this.publishLevel())){var a=e.Interop;if(a)try{a.methods({name:e.InteropMethodName}).length>0&&a.invoke(e.InteropMethodName,{msg:""+n,logger:i,level:t})}catch(l){}}if(this.canPublish(t)){var s="";if(this.includeTimeAndLevel){var u=new Date;s="["+(u.getHours()+":"+u.getMinutes()+":"+u.getSeconds()+":"+u.getMilliseconds())+"] ["+t+"] "}var c=""+s+i+": "+n;switch(t){case"trace":this.logFn.debug(c);break;case"debug":this.logFn.debug?this.logFn.debug(c):this.logFn.log(c);break;case"info":this.logFn.info(c);break;case"warn":this.logFn.warn(c);break;case"error":this.logFn.error(c,r)}}},e.InteropMethodName="T42.AppLogger.Log",e}(),ci="create-context",li="created",di="destroyed",pi="context-created",fi="context-added",hi="subscribe-context",vi="subscribed-context",gi="unsubscribe-context",yi="destroy-context",mi="context-destroyed",wi="update-context",bi="context-updated",ki="joined",xi={get name(){return"context"},get types(){return[ci,li,di,pi,fi,hi,vi,gi,yi,mi,wi,bi,ki]}},_i="5.7.8";var Si=function(){function e(e,t,n,r){this.updateCallbacks={},this.contextId=e,this.name=t,this.isAnnounced=n,this.activityId=r,this.context={}}return e.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},e.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},e}();function Ii(e,t,n){try{if((null===n||void 0===n?void 0:n.canPublish("trace"))&&(null===n||void 0===n||n.trace("applying context delta "+JSON.stringify(t)+" on context "+JSON.stringify(e))),!t)return e;if(t.reset)return e=Zn({},t.reset);if(e=Ci(e,void 0),t.commands){for(var r=0,i=t.commands;r<i.length;r++){var o=i[r];"remove"===o.type?Mi(e,o.path):"set"===o.type&&Ei(e,o.value,o.path)}return e}var a=t.added,s=t.updated,u=t.removed;return a&&Object.keys(a).forEach((function(t){e[t]=a[t]})),s&&Object.keys(s).forEach((function(t){Ti(t,e,s)})),u&&u.forEach((function(t){delete e[t]})),e}catch(c){return null===n||void 0===n||n.error("error applying context delta "+JSON.stringify(t)+" on context "+JSON.stringify(e),c),e}}function Ci(e,t){if(t=t||new WeakMap,Object(e)!==e)return e;if(e instanceof Set)return new Set(e);if(t.has(e))return t.get(e);var n=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e.constructor?new e.constructor:Object.create(null);return t.set(e,n),Object.assign.apply(Object,nr([n],Object.keys(e).map((function(n){var r;return(r={})[n]=Ci(e[n],t),r}))))}var Ti=function(e,t,n){var r=n[e];if(void 0===r)return t;var i=t[e];return i&&r?"string"===typeof i||"number"===typeof i||"boolean"===typeof i||"string"===typeof r||"number"===typeof r||"boolean"===typeof r||Array.isArray(i)||Array.isArray(r)?(t[e]=r,t):(t[e]=Object.assign({},i,r),t):(t[e]=r,t)};function Ai(e,t){if(e===t)return!0;if(!(e instanceof Object)||!(t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n]){if("object"!==typeof e[n])return!1;if(!Ai(e[n],t[n]))return!1}}for(var n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}function Ei(e,t,n){var r,i=n.split(".");for(r=0;r<i.length-1;r++)e[i[r]]||(e[i[r]]={}),"object"!==typeof e[i[r]]&&(e[i[r]]={}),e=e[i[r]];e[i[r]]=t}function Pi(e,t){return Object.keys(t).every((function(n){return"object"===typeof t[n]?Pi((null===e||void 0===e?void 0:e[n])||{},t[n]||{}):t[n]===(null===e||void 0===e?void 0:e[n])}))}function Mi(e,t){var n,r=t.split(".");for(n=0;n<r.length-1;n++){if(!e[r[n]])return;e=e[r[n]]}delete e[r[n]]}var Ri,Oi=function(){function e(e){var t,n=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._contextNameToId={},this._contextIdToName={},this._protocolVersion=void 0,this._contextsTempCache={},this._contextsSubscriptionsCache=[],this._connection=e.connection,this._logger=e.logger,this._trackAllContexts=e.trackAllContexts,this._reAnnounceKnownContexts=e.reAnnounceKnownContexts,this._gw3Session=this._connection.domain("global",[pi,vi,mi,bi]),this._gw3Session.disconnected(this.resetState.bind(this)),this._gw3Session.onJoined((function(e){if(e)return n._reAnnounceKnownContexts?void n.reInitiateState().then((function(){return n._connection.setLibReAnnounced({name:"contexts"})})):n._connection.setLibReAnnounced({name:"contexts"})})),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(t=this._connection.replayer)||void 0===t||t.drain(xi.name,(function(e){var t=e.type;t&&(t===pi||t===fi||t===li?n.handleContextCreatedMessage(e):t===vi||t===bi||t===ki?n.handleContextUpdatedMessage(e):t!==mi&&t!==di||n.handleContextDestroyedMessage(e))}))}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;if(!this._protocolVersion){var t=this._connection.availableDomains.find((function(e){return"context"===e.uri}));this._protocolVersion=null!==(e=null===t||void 0===t?void 0:t.version)&&void 0!==e?e:1}return this._protocolVersion},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this.protocolVersion>=2},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var e=0,t=this._gw3Subscriptions;e<t.length;e++){var n=t[e];this._connection.off(n)}for(var r in this._gw3Subscriptions.length=0,this._contextNameToData)this._contextNameToId.hasOwnProperty(r)&&delete this._contextNameToData[r]},e.prototype.createContext=function(e,t){var n=this;return this._gw3Session.send({type:ci,domain:"global",name:e,data:t,lifetime:"retained"}).then((function(r){n._contextNameToId[e]=r.context_id,n._contextIdToName[r.context_id]=e;var i=n._contextNameToData[e]||new Si(r.context_id,e,!0,void 0);return i.isAnnounced=!0,i.name=e,i.contextId=r.context_id,i.context=r.data||t,i.hasReceivedSnapshot=!0,n._contextNameToData[e]=i,r.context_id}))},e.prototype.all=function(){var e=this;return Object.keys(this._contextNameToData).filter((function(t){return e._contextNameToData[t].isAnnounced}))},e.prototype.update=function(e,t){var n;return er(this,void 0,void 0,(function(){var r,i,o,a=this;return tr(this,(function(s){switch(s.label){case 0:return(r=this._contextNameToData[e])&&r.isAnnounced?(i=r.context,r.hasCallbacks()?[3,2]:[4,this.get(r.name)]):[2,this.createContext(e,t)];case 1:i=s.sent(),s.label=2;case 2:return o=2===this.protocolVersion?this.calculateContextDeltaV2(i,t):this.calculateContextDeltaV1(i,t),Object.keys(o.added).length||Object.keys(o.updated).length||o.removed.length||(null===(n=o.commands)||void 0===n?void 0:n.length)?[2,this._gw3Session.send({type:wi,domain:"global",context_id:r.contextId,delta:o},{},{skipPeerId:!1}).then((function(e){a.handleUpdated(r,o,{updaterId:e.peer_id})}))]:[2,Promise.resolve()]}}))}))},e.prototype.set=function(e,t){var n=this,r=this._contextNameToData[e];return r&&r.isAnnounced?this._gw3Session.send({type:wi,domain:"global",context_id:r.contextId,delta:{reset:t}},{},{skipPeerId:!1}).then((function(e){n.handleUpdated(r,{reset:t,added:{},removed:[],updated:{}},{updaterId:e.peer_id})})):this.createContext(e,t)},e.prototype.setPath=function(e,t,n){return this.setPathSupported?this.setPaths(e,[{path:t,value:n}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")},e.prototype.setPaths=function(e,t){var n=this;if(!this.setPathSupported)return Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later");var r=this._contextNameToData[e];if(!r||!r.isAnnounced){for(var i={},o=0,a=t;o<a.length;o++){Ei(i,(l=a[o]).value,l.path)}return this.createContext(e,i)}for(var s=[],u=0,c=t;u<c.length;u++){var l;null===(l=c[u]).value?s.push({type:"remove",path:l.path}):s.push({type:"set",path:l.path,value:l.value})}return this._gw3Session.send({type:wi,domain:"global",context_id:r.contextId,delta:{commands:s}},{},{skipPeerId:!1}).then((function(e){n.handleUpdated(r,{added:{},removed:[],updated:{},commands:s},{updaterId:e.peer_id})}))},e.prototype.get=function(e){var t,n=this,r=this._contextNameToData[e];if(!r||!r.isAnnounced)return Promise.resolve({});if(r&&(!r.hasCallbacks()||!r.hasReceivedSnapshot))return new Promise((function(t){n.subscribe(e,(function(e,r,i,o){n.unsubscribe(o),t(e)}))}));var i=null!==(t=null===r||void 0===r?void 0:r.context)&&void 0!==t?t:{};return Promise.resolve(i)},e.prototype.subscribe=function(e,t,n){var r=this,i="undefined"===typeof n?this._nextCallbackSubscriptionNumber:n;"undefined"===typeof n&&(this._nextCallbackSubscriptionNumber+=1),this._contextsSubscriptionsCache.every((function(e){return e.subKey!==r._nextCallbackSubscriptionNumber}))&&this._contextsSubscriptionsCache.push({contextName:e,subKey:i,callback:t});var o=this._contextNameToData[e];if(!o||!o.isAnnounced)return o=o||new Si(void 0,e,!1,void 0),this._contextNameToData[e]=o,o.updateCallbacks[i]=t,Promise.resolve(i);var a=o.hasCallbacks();if(o.updateCallbacks[i]=t,a){if(o.hasReceivedSnapshot)t(s=Ci(o.context),s,[],i);return Promise.resolve(i)}if(o.joinedActivity){if(o.hasReceivedSnapshot)t(s=Ci(o.context),s,[],i);return Promise.resolve(i)}if(o.context&&o.sentExplicitSubscription){var s;if(o.hasReceivedSnapshot)t(s=Ci(o.context),s,[],i);return Promise.resolve(i)}return this.sendSubscribe(o).then((function(){return i}))},e.prototype.unsubscribe=function(e){this._contextsSubscriptionsCache=this._contextsSubscriptionsCache.filter((function(t){return t.subKey!==e}));for(var t=0,n=Object.keys(this._contextNameToData);t<n.length;t++){var r=n[t],i=this._contextNameToData[r];if(!i)return;var o=i.hasCallbacks();delete i.updateCallbacks[e],i.isAnnounced&&o&&!i.hasCallbacks()&&i.sentExplicitSubscription&&this.sendUnsubscribe(i),i.isAnnounced||i.hasCallbacks()||delete this._contextNameToData[r]}},e.prototype.destroy=function(e){var t=this._contextNameToData[e];return t?this._gw3Session.send({type:yi,domain:"global",context_id:t.contextId}).then((function(e){})):Promise.reject("context with "+e+" does not exist")},e.prototype.handleUpdated=function(e,t,n){var r=e.context;e.context=Ii(e.context,t,this._logger),e.hasReceivedSnapshot=!0,this._contextNameToData[e.name]!==e||Ai(r,e.context)||this.invokeUpdateCallbacks(e,t,n)},e.prototype.subscribeToContextCreatedMessages=function(){for(var e=0,t=[fi,pi,li];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextCreatedMessage=function(e){var t=this,n=e.type;n===li?(this._contextNameToId[e.activity_id]=e.context_id,this._contextIdToName[e.context_id]=e.activity_id):n===fi&&(this._contextNameToId[e.name]=e.context_id,this._contextIdToName[e.context_id]=e.name);var r=this._contextIdToName[e.context_id];if(!r)throw new Error("Received created event for context with unknown name: "+e.context_id);if(!this._contextNameToId[r])throw new Error("Received created event for context with unknown id: "+e.context_id);var i=this._contextNameToData[r];if(i){if(i.isAnnounced)return;if(!i.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");i.isAnnounced=!0,i.contextId=e.context_id,i.activityId=e.activity_id,i.sentExplicitSubscription||this.sendSubscribe(i)}else this._contextNameToData[r]=i=new Si(e.context_id,r,!0,e.activity_id),this._trackAllContexts&&this.subscribe(r,(function(){})).then((function(e){return t._systemContextsSubKey=e}))},e.prototype.subscribeToContextUpdatedMessages=function(){for(var e=0,t=[bi,vi,ki];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextUpdatedMessage=function(e){var t=e.type,n=e.context_id,r=this._contextNameToData[this._contextIdToName[n]],i=!r||!r.isAnnounced;if(t===ki)r?(r.contextId=n,r.isAnnounced=!0,r.activityId=e.activity_id):(r=new Si(n,e.activity_id,!0,e.activity_id),this._contextNameToData[e.activity_id]=r,this._contextIdToName[n]=e.activity_id,this._contextNameToId[e.activity_id]=n),r.joinedActivity=!0;else if(!r||!r.isAnnounced)return void(t===vi?((r=r||new Si(n,e.name,!0,void 0)).sentExplicitSubscription=!0,this._contextNameToData[e.name]=r,this._contextIdToName[n]=e.name,this._contextNameToId[e.name]=n):this._logger.error("Received 'update' for unknown context: "+n));var o=r.context;if(r.hasReceivedSnapshot=!0,t===vi)r.context=e.data||{};else if(t===ki)r.context=e.context_snapshot||{};else{if(t!==bi)throw new Error("Unrecognized context update message "+t);r.context=Ii(r.context,e.delta,this._logger)}!i&&Ai(r.context,o)&&t!==vi||this.invokeUpdateCallbacks(r,e.delta,{updaterId:e.updater_id})},e.prototype.invokeUpdateCallbacks=function(e,t,n){if((t=t||{added:{},updated:{},reset:{},removed:[]}).commands){t.added=t.updated=t.reset={},t.removed=[];for(var r=0,i=t.commands;r<i.length;r++){var o=i[r];"remove"===o.type?(-1===o.path.indexOf(".")&&t.removed.push(o.path),Ei(t.updated,null,o.path)):"set"===o.type&&Ei(t.updated,o.value,o.path)}}for(var a in e.updateCallbacks)if(e.updateCallbacks.hasOwnProperty(a))try{(0,e.updateCallbacks[a])(Ci(e.context),Object.assign({},t.added||{},t.updated||{},t.reset||{}),t.removed,parseInt(a,10),n)}catch(M){this._logger.debug("callback error: "+JSON.stringify(M))}},e.prototype.subscribeToContextDestroyedMessages=function(){for(var e=0,t=[mi,di];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextDestroyedMessage=function(e){var t,n;if(e.type===di){if(n=e.activity_id,!(t=this._contextNameToId[n]))return void this._logger.error("Received 'destroyed' for unknown activity: "+e.activity_id)}else if(t=e.context_id,!(n=this._contextIdToName[t]))return void this._logger.error("Received 'destroyed' for unknown context: "+e.context_id);delete this._contextIdToName[t],delete this._contextNameToId[n];var r=this._contextNameToData[n];delete this._contextNameToData[n],r&&r.isAnnounced||this._logger.error("Received 'destroyed' for unknown context: "+t)},e.prototype.sendSubscribe=function(e){return e.sentExplicitSubscription=!0,this._gw3Session.send({type:hi,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.sendUnsubscribe=function(e){return e.sentExplicitSubscription=!1,this._gw3Session.send({type:gi,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.calculateContextDeltaV1=function(e,t){var n={added:{},updated:{},removed:[],reset:void 0};if(e)for(var r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];-1===Object.keys(t).indexOf(o)||null===t[o]||Ai(e[o],t[o])||(n.updated[o]=t[o])}for(var a=0,s=Object.keys(t);a<s.length;a++){o=s[a];e&&-1!==Object.keys(e).indexOf(o)?null===t[o]&&n.removed.push(o):null!==t[o]&&(n.added[o]=t[o])}return n},e.prototype.calculateContextDeltaV2=function(e,t){for(var n,r,i={added:{},updated:{},removed:[],reset:void 0,commands:[]},o=0,a=Object.keys(t);o<a.length;o++){var s=a[o];if(null!==t[s])Ai(e?e[s]:null,t[s])||null===(n=i.commands)||void 0===n||n.push({type:"set",path:s,value:t[s]});else null===(r=i.commands)||void 0===r||r.push({type:"remove",path:s})}return i},e.prototype.resetState=function(){for(var e=this,t=0,n=this._gw3Subscriptions;t<n.length;t++){var r=n[t];this._connection.off(r)}this._systemContextsSubKey&&(this.unsubscribe(this._systemContextsSubKey),delete this._systemContextsSubKey),this._gw3Subscriptions=[],this._contextNameToId={},this._contextIdToName={},delete this._protocolVersion,this._contextsTempCache=Object.keys(this._contextNameToData).reduce((function(t,n){return t[n]=e._contextNameToData[n].context,t}),{}),this._contextNameToData={}},e.prototype.reInitiateState=function(){var e;return er(this,void 0,void 0,(function(){var t,n,r,i,o,a=this;return tr(this,(function(s){switch(s.label){case 0:return this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(e=this._connection.replayer)||void 0===e||e.drain(xi.name,(function(e){var t=e.type;t&&(t===pi||t===fi||t===li?a.handleContextCreatedMessage(e):t===vi||t===bi||t===ki?a.handleContextUpdatedMessage(e):t!==mi&&t!==di||a.handleContextDestroyedMessage(e))})),[4,Promise.all(this._contextsSubscriptionsCache.map((function(e){return a.subscribe(e.contextName,e.callback,e.subKey)})))];case 1:return s.sent(),[4,this.flushQueue()];case 2:for(n in s.sent(),t=[],this._contextsTempCache)t.push(n);r=0,s.label=3;case 3:return r<t.length?(i=t[r],"object"!==typeof this._contextsTempCache[i]||0===Object.keys(this._contextsTempCache[i]).length?[3,6]:(o=this._contextsTempCache[i],this._logger.info("Re-announcing known context: "+i),[4,this.flushQueue()])):[3,7];case 4:return s.sent(),[4,this.update(i,o)];case 5:s.sent(),s.label=6;case 6:return r++,[3,3];case 7:return this._contextsTempCache={},this._logger.info("Contexts are re-announced"),[2]}}))}))},e.prototype.flushQueue=function(){return new Promise((function(e){return setTimeout((function(){return e()}),0)}))},e}(),ji=function(){function e(e){this._bridge=new Oi(e)}return e.prototype.all=function(){return this._bridge.all()},e.prototype.update=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.update(e,t)},e.prototype.set=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.set(e,t)},e.prototype.setPath=function(e,t,n){return this.checkName(e),this.checkPath(t),""===t?(this.checkData(n),this.set(e,n)):this._bridge.setPath(e,t,n)},e.prototype.setPaths=function(e,t){if(this.checkName(e),!Array.isArray(t))throw new Error("Please provide the paths as an array of PathValues!");for(var n=0,r=t;n<r.length;n++){var i=r[n],o=i.path,a=i.value;this.checkPath(o),""===o&&this.checkData(a)}return this._bridge.setPaths(e,t)},e.prototype.subscribe=function(e,t){var n=this;if(this.checkName(e),"function"!==typeof t)throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(e,(function(e,r,i,o,a){return t(e,r,i,(function(){return n._bridge.unsubscribe(o)}),a)})).then((function(e){return function(){n._bridge.unsubscribe(e)}}))},e.prototype.get=function(e){return this.checkName(e),this._bridge.get(e)},e.prototype.ready=function(){return Promise.resolve(this)},e.prototype.destroy=function(e){return this.checkName(e),this._bridge.destroy(e)},Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this._bridge.setPathSupported},enumerable:!0,configurable:!0}),e.prototype.checkName=function(e){if("string"!==typeof e||""===e)throw new Error("Please provide the name as a non-empty string!")},e.prototype.checkPath=function(e){if("string"!==typeof e)throw new Error("Please provide the path as a dot delimited string!")},e.prototype.checkData=function(e){if("object"!==typeof e)throw new Error("Please provide the data as an object!")},e}();function Ni(e,t,n){return"function"!==typeof t&&"function"!==typeof n?e:("function"!==typeof t?t=function(){}:"function"!==typeof n&&(n=function(){}),e.then(t,n))}function Li(e,t,n){var r;void 0===e&&(e=0);var i=function(){r&&clearTimeout(r)};return t.then((function(){i()})).catch((function(){i()})),new Promise((function(t,i){r=setTimeout((function(){return i(n)}),e)}))}!function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(Ri||(Ri={}));var Di=function(){function e(e,t,n,r){this.protocol=e,this.repo=t,this.instance=n,this.configuration=r}return e.prototype.subscribe=function(e,t,n,r,i){var o=this,a=function(e,n,r,a){var s;t.methodResponseTimeout=null!==(s=t.methodResponseTimeout)&&void 0!==s?s:t.waitTimeoutMs,o.protocol.client.subscribe(n,t,e,r,a,i)},s=new Promise((function(n,r){var i,s=function(e){n(e)},u=function(e){r(e)};if(e)if((i="string"===typeof e?{name:e}:e).name){void 0===t&&(t={});var c=t.target;if(void 0===c&&(c="best"),"string"!==typeof c||"all"===c||"best"===c){void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=t.method_response_timeout,void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=o.configuration.methodResponseTimeout)),void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=t.wait_for_method_timeout,void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=o.configuration.waitTimeoutMs));var l=0,d=o.getServerMethodsByFilterAndTarget(i,c);if(d.length>0)a(d,d[0].methods[0],s,u);else{setTimeout((function n(){if(c&&t.waitTimeoutMs)if(l+=500,(d=o.getServerMethodsByFilterAndTarget(i,c)).length>0){var r=d[0].methods[0];a(d,r,s,u)}else if(l>=t.waitTimeoutMs){a(d,"string"===typeof e?{name:e}:e,s,u)}else setTimeout(n,500)}),500)}}else r(new Error('"'+c+'" is not a valid target. Valid targets are "all", "best", or an instance.'))}else r("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");else r("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.")}));return Ni(s,n,r)},e.prototype.servers=function(e){var t=void 0===e?void 0:Zn({},e);return this.getServers(t).map((function(e){return e.server.instance}))},e.prototype.methods=function(e){return e="string"===typeof e?{name:e}:Zn({},e),this.getMethods(e)},e.prototype.methodsForInstance=function(e){return this.getMethodsForInstance(e)},e.prototype.methodAdded=function(e){return this.repo.onMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.repo.onMethodRemoved(e)},e.prototype.serverAdded=function(e){return this.repo.onServerAdded(e)},e.prototype.serverRemoved=function(e){return this.repo.onServerRemoved((function(t,n){e(t,n)}))},e.prototype.serverMethodAdded=function(e){return this.repo.onServerMethodAdded((function(t,n){e({server:t,method:n})}))},e.prototype.serverMethodRemoved=function(e){return this.repo.onServerMethodRemoved((function(t,n){e({server:t,method:n})}))},e.prototype.invoke=function(e,t,n,r,i,o){return er(this,void 0,void 0,(function(){var a,s=this;return tr(this,(function(u){return a=function(){return er(s,void 0,void 0,(function(){var i,o,a,s,u,c,l,d,p,f,h,v,g,y=this;return tr(this,(function(m){switch(m.label){case 0:if(!(i="string"===typeof e?{name:e}:Zn({},e)).name)return[2,Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.")];if(t||(t={}),n||(n="best"),"string"===typeof n&&"all"!==n&&"best"!==n&&"skipMine"!==n)return[2,Promise.reject(new Error('"'+n+'" is not a valid target. Valid targets are "all" and "best".'))];if(r||(r={}),void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=r.method_response_timeout,void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=r.wait_for_method_timeout,void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=this.configuration.waitTimeoutMs)),void 0!==r.waitTimeoutMs&&"number"!==typeof r.waitTimeoutMs)return[2,Promise.reject(new Error('"'+r.waitTimeoutMs+'" is not a valid number for "waitTimeoutMs" '))];if("object"!==typeof t)return[2,Promise.reject(new Error("The method arguments must be an object. method: "+i.name))];if(0!==(o=this.getServerMethodsByFilterAndTarget(i,n)).length)return[3,4];m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this.tryToAwaitForMethods(i,n,r)];case 2:return o=m.sent(),[3,4];case 3:return m.sent(),a=Zn(Zn({},i),{getServers:function(){return[]},supportsStreaming:!1,objectTypes:null!==(h=i.objectTypes)&&void 0!==h?h:[],flags:null!==(g=null===(v=i.flags)||void 0===v?void 0:v.metadata)&&void 0!==g?g:{}}),s={method:a,called_with:t,message:"Can not find a method matching "+JSON.stringify(e)+" with server filter "+JSON.stringify(n),executed_by:void 0,returned:void 0,status:void 0},[2,Promise.reject(s)];case 4:return u=r.methodResponseTimeoutMs,c=r,l=o.map((function(e){var n=Zr(),r=e.methods[0],i=e.server,o=y.protocol.client.invoke(n,r,t,i,c);return Promise.race([o,Li(u,o,{invocationId:n,message:"Invocation timeout ("+u+" ms) reached for method name: "+(null===r||void 0===r?void 0:r.name)+", target instance: "+JSON.stringify(i.instance)+", options: "+JSON.stringify(c),status:Ri.Error})])})),[4,Promise.all(l)];case 5:return d=m.sent(),p=this.getInvocationResultObj(d,i,t),f=d.every((function(e){return e.status===Ri.Error})),f?[2,Promise.reject(p)]:[2,p]}}))}))},[2,Ni(a(),i,o)]}))}))},e.prototype.getInvocationResultObj=function(e,t,n){var r=e.filter((function(e){return e.status===Ri.Success})).reduce((function(e,r){return e=nr(e,[{executed_by:r.instance,returned:r.result,called_with:n,method:t,message:r.message,status:r.status}])}),[]),i=e.filter((function(e){return e.status===Ri.Error})).reduce((function(e,r){return e=nr(e,[{executed_by:r.instance,called_with:n,name:t.name,message:r.message}])}),[]),o=e[0];return{method:t,called_with:n,returned:o.result,executed_by:o.instance,all_return_values:r,all_errors:i,message:o.message,status:o.status}},e.prototype.tryToAwaitForMethods=function(e,t,n){var r=this;return new Promise((function(i,o){if(0!==n.waitTimeoutMs)var a=0,s=setInterval((function(){a+=500;var u=r.getServerMethodsByFilterAndTarget(e,t);if(u.length>0)clearInterval(s),i(u);else if(a>=(n.waitTimeoutMs||1e4))return clearInterval(s),void o()}),500);else o()}))},e.prototype.filterByTarget=function(e,t){var n=this;if("string"!==typeof e){return(Array.isArray(e)?e:[e]).reduce((function(e,r){var i=t.filter((function(e){return n.instanceMatch(r,e.server.instance)}));return e.concat(i)}),[])}if("all"===e)return nr(t);if("best"===e){var r=t.find((function(e){return e.server.instance.isLocal}));if(r)return[r];if(void 0!==t[0])return[t[0]]}else if("skipMine"===e)return t.filter((function(e){return e.server.instance.peerId!==n.instance.peerId}));return[]},e.prototype.instanceMatch=function(e,t){return this.containsProps(e,t)},e.prototype.methodMatch=function(e,t){return this.containsProps(e,t)},e.prototype.containsProps=function(e,t){return Object.keys(e).filter((function(t){return void 0!==e[t]&&null!==e[t]&&"function"!==typeof e[t]&&"object_types"!==t&&"display_name"!==t&&"id"!==t&&"gatewayId"!==t&&"identifier"!==t&&"_"!==t[0]})).every((function(n){var r,i=e[n],o=t[n];switch(n){case"objectTypes":r=(i||[]).every((function(e){return(o||[]).includes(e)}));break;case"flags":r=Pi(o||{},i||{});break;default:r=String(i).toLowerCase()===String(o).toLowerCase()}return r}))},e.prototype.getMethods=function(e){var t=this;return void 0===e?this.repo.getMethods():this.repo.getMethods().filter((function(n){return t.methodMatch(e,n)}))},e.prototype.getMethodsForInstance=function(e){var t=this,n=this.repo.getServers().filter((function(n){return t.instanceMatch(e,n.instance)}));if(0===n.length)return[];var r={};return 1===n.length?r=n[0].methods:n.forEach((function(e){Object.keys(e.methods).forEach((function(t){var n=e.methods[t];r[n.identifier]=n}))})),Object.keys(r).map((function(e){return r[e]}))},e.prototype.getServers=function(e){var t=this,n=this.repo.getServers();return void 0===e?n.map((function(e){return{server:e,methods:[]}})):n.reduce((function(n,r){var i=Object.values(r.methods).filter((function(n){return t.methodMatch(e,n)}));return i.length>0&&n.push({server:r,methods:i}),n}),[])},e.prototype.getServerMethodsByFilterAndTarget=function(e,t){var n=this.getServers(e);return this.filterByTarget(t,n)},e}(),Wi=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.subscription=n}return Object.defineProperty(e.prototype,"stream",{get:function(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instance",{get:function(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance},enumerable:!0,configurable:!0}),e.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},e.prototype.push=function(e){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,e)},e}(),Fi=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.requestContext=n,this.arguments=n.arguments,this.instance=n.instance}return e.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},e.prototype.acceptOnBranch=function(e){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,e)},e.prototype.reject=function(e){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,e)},e}(),qi=function(){function e(e,t){var n=this;this.protocol=e,this.server=t,e.server.onSubRequest((function(e,t){return n.handleSubRequest(e,t)})),e.server.onSubAdded((function(e,t){return n.handleSubAdded(e,t)})),e.server.onSubRemoved((function(e,t){return n.handleSubRemoved(e,t)}))}return e.prototype.handleSubRequest=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionRequestHandler){var n=new Fi(this.protocol,t,e);t.streamCallbacks.subscriptionRequestHandler(n)}},e.prototype.handleSubAdded=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionAddedHandler){var n=new Wi(this.protocol,t,e);t.streamCallbacks.subscriptionAddedHandler(n)}},e.prototype.handleSubRemoved=function(e,t){if(t&&t.streamCallbacks&&"function"===typeof t.streamCallbacks.subscriptionRemovedHandler){var n=new Wi(this.protocol,t,e);t.streamCallbacks.subscriptionRemovedHandler(n)}},e}(),Ui=function(){function e(e,t,n){this.key=e,this.protocol=t,this.repoMethod=n}return e.prototype.subscriptions=function(){var e=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map((function(t){return new Wi(e.protocol,e.repoMethod,t)}))},e.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},e.prototype.push=function(e){this.protocol.server.pushData(this.repoMethod,e,[this.key])},e}(),zi=function(){function e(e,t,n){this._protocol=e,this._repoMethod=t,this._server=n,this.name=this._repoMethod.definition.name}return e.prototype.branches=function(e){var t=this,n=this._protocol.server.getBranchList(this._repoMethod);return e?n.indexOf(e)>-1?new Ui(e,this._protocol,this._repoMethod):void 0:n.map((function(e){return new Ui(e,t._protocol,t._repoMethod)}))},e.prototype.branch=function(e){return this.branches(e)},e.prototype.subscriptions=function(){var e=this;return this._protocol.server.getSubscriptionList(this._repoMethod).map((function(t){return new Wi(e._protocol,e._repoMethod,t)}))},Object.defineProperty(e.prototype,"definition",{get:function(){var e,t=this._repoMethod.definition;return{accepts:t.accepts,description:t.description,displayName:t.displayName,name:t.name,objectTypes:t.objectTypes,returns:t.returns,supportsStreaming:t.supportsStreaming,flags:null===(e=t.flags)||void 0===e?void 0:e.metadata}},enumerable:!0,configurable:!0}),e.prototype.close=function(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)},e.prototype.push=function(e,t){if("string"!==typeof t&&!Array.isArray(t)&&void 0!==t)throw new Error("invalid branches should be string or string array");if("object"!==typeof e)throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,e,t)},e.prototype.updateRepoMethod=function(e){this._repoMethod=e},e}(),Gi=function(){function e(e,t){this.protocol=e,this.serverRepository=t,this.invocations=0,this.currentlyUnregistering={},this.streaming=new qi(e,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return e.prototype.createStream=function(e,t,n,r,i){var o=this,a=new Promise((function(n,r){if(e){var a;if(!(a="string"===typeof e?{name:""+e}:Zn({},e)).name)return r("The \u201cname\u201d property is required for the \u201cstreamDefinition\u201d object and must be unique. Stream definition: "+JSON.stringify(a));if(o.serverRepository.getList().some((function(e){return e.definition.name===a.name})))return r('A stream with the name "'+a.name+'" already exists! Please, provide a unique name for the stream.');a.supportsStreaming=!0,t||(t={}),"function"!==typeof t.subscriptionRequestHandler&&(t.subscriptionRequestHandler=function(e){e.accept()});var s=o.serverRepository.add({definition:a,streamCallbacks:t,protocolState:{}});o.protocol.server.createStream(s).then((function(){var e;i?(e=i,i.updateRepoMethod(s)):e=new zi(o.protocol,s,o),s.stream=e,n(e)})).catch((function(e){s.repoId&&o.serverRepository.remove(s.repoId),r(e)}))}else r("The stream name must be unique! Please, provide either a unique string for a stream name to \u201cglue.interop.createStream()\u201d or a \u201cmethodDefinition\u201d object with a unique \u201cname\u201d property for the stream.")}));return Ni(a,n,r)},e.prototype.register=function(e,t){var n=this;if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");if("function"!==typeof t)return Promise.reject("The second parameter must be a callback function. Method: "+("string"===typeof e?e:e.name));var r=function(e,r){return er(n,void 0,void 0,(function(){var n,i,o;return tr(this,(function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),(n=t(e.args,e.instance))&&"function"===typeof n.then?[4,n]:[3,2];case 1:return i=a.sent(),r(void 0,i),[3,3];case 2:r(void 0,n),a.label=3;case 3:return[3,5];case 4:return(o=a.sent())||(o=""),r(o,o),[3,5];case 5:return[2]}}))}))};return r.userCallback=t,this.registerCore(e,r)},e.prototype.registerAsync=function(e,t){if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a \u201cmethodDefinition\u201d object with a required \u201cname\u201d property.");if("function"!==typeof t)return Promise.reject("The second parameter must be a callback function. Method: "+("string"===typeof e?e:e.name));var n=function(e,n){try{var r=!1,i=function(e){r||n(void 0,e),r=!0},o=function(e){r||(e||(e=""),n(e,e)),r=!0},a=t(e.args,e.instance,i,o);a&&"function"===typeof a.then&&a.then(i).catch(o)}catch(s){n(s,void 0)}};return n.userCallbackAsync=t,this.registerCore(e,n)},e.prototype.unregister=function(e,t){return void 0===t&&(t=!1),er(this,void 0,void 0,(function(){var n,r;return tr(this,(function(i){switch(i.label){case 0:return void 0===e?[2,Promise.reject("Please, provide either a unique string for a name or an object containing a \u201cname\u201d property.")]:"function"!==typeof e?[3,2]:[4,this.unregisterWithPredicate(e,t)];case 1:case 3:return i.sent(),[2];case 2:return void 0===(n="string"===typeof e?{name:e}:e).name?[2,Promise.reject("Method name is required. Cannot find a method if the method name is undefined!")]:(r=this.serverRepository.getList().find((function(e){return e.definition.name===n.name&&(e.definition.supportsStreaming||!1)===t})))?[4,this.removeMethodsOrStreams([r])]:[2,Promise.reject('Method with a name "'+n.name+'" does not exist or is not registered by your application!')]}}))}))},e.prototype.unregisterWithPredicate=function(e,t){return er(this,void 0,void 0,(function(){var n;return tr(this,(function(r){switch(r.label){case 0:return(n=this.serverRepository.getList().filter((function(t){return e(t.definition)})).filter((function(e){return(e.definition.supportsStreaming||!1)===t})))&&0!==n.length?[4,this.removeMethodsOrStreams(n)]:[2,Promise.reject("Could not find a "+(t?"stream":"method")+" matching the specified condition!")];case 1:return r.sent(),[2]}}))}))},e.prototype.removeMethodsOrStreams=function(e){var t=this,n=[];return e.forEach((function(e){var r=t.protocol.server.unregister(e).then((function(){e.repoId&&t.serverRepository.remove(e.repoId)}));n.push(r),t.addAsCurrentlyUnregistering(e.definition.name,r)})),Promise.all(n)},e.prototype.addAsCurrentlyUnregistering=function(e,t){return er(this,void 0,void 0,(function(){var n,r=this;return tr(this,(function(i){return n=new Promise((function(e){return setTimeout(e,5e3)})),this.currentlyUnregistering[e]=Promise.race([t,n]).then((function(){delete r.currentlyUnregistering[e]})),[2]}))}))},e.prototype.registerCore=function(e,t){return er(this,void 0,void 0,(function(){var n,r,i,o=this;return tr(this,(function(a){switch(a.label){case 0:return(n="string"===typeof e?{name:""+e}:Zn({},e)).name?(r=this.currentlyUnregistering[n.name])?[4,r]:[3,2]:[2,Promise.reject("Please, provide a (unique) string value for the \u201cname\u201d property in the \u201cmethodDefinition\u201d object: "+JSON.stringify(e))];case 1:a.sent(),a.label=2;case 2:return this.serverRepository.getList().some((function(e){return e.definition.name===n.name}))?[2,Promise.reject('A method with the name "'+n.name+'" already exists! Please, provide a unique name for the method.')]:n.supportsStreaming?[2,Promise.reject("When you create methods with \u201cglue.interop.register()\u201d or \u201cglue.interop.registerAsync()\u201d the property \u201csupportsStreaming\u201d cannot be \u201ctrue\u201d. If you want \u201c"+n.name+"\u201d to be a stream, please use the \u201cglue.interop.createStream()\u201d method.")]:(i=this.serverRepository.add({definition:n,theFunction:t,protocolState:{}}),[2,this.protocol.server.register(i).catch((function(e){throw(null===i||void 0===i?void 0:i.repoId)&&o.serverRepository.remove(i.repoId),e}))])}}))}))},e.prototype.onMethodInvoked=function(e,t,n){var r=this;e&&e.theFunction&&e.theFunction(n,(function(n,i){if(void 0!==n&&null!==n)if(n.message&&"string"===typeof n.message)n=n.message;else if("string"!==typeof n)try{n=JSON.stringify(n)}catch(o){n="un-stringifyable error in onMethodInvoked! Top level prop names: "+Object.keys(n)}i?("object"!==typeof i||Array.isArray(i))&&(i={_value:i}):i={},r.protocol.server.methodInvocationResult(e,t,n,i)}))},e}(),Bi=function(){function e(e,t,n){var r=this;this.wrapped={},this.wrapped.getMethods=function(){return e.methodsForInstance(this)},this.wrapped.getStreams=function(){return e.methodsForInstance(this).filter((function(e){return e.supportsStreaming}))},t&&this.refreshWrappedObject(t),n&&(n.loggedIn((function(){r.refresh(n)})),this.refresh(n))}return e.prototype.unwrap=function(){return this.wrapped},e.prototype.refresh=function(e){if(e){var t=null===e||void 0===e?void 0:e.resolvedIdentity,n=Object.assign({},null!==t&&void 0!==t?t:{},{peerId:null===e||void 0===e?void 0:e.peerId});this.refreshWrappedObject(n)}},e.prototype.refreshWrappedObject=function(e){var t,n,r,i,o=this;Object.keys(e).forEach((function(t){o.wrapped[t]=e[t]})),this.wrapped.user=e.user,this.wrapped.instance=e.instance,this.wrapped.application=null!==(t=e.application)&&void 0!==t?t:Zr(),this.wrapped.applicationName=e.applicationName,this.wrapped.pid=null!==(r=null!==(n=e.pid)&&void 0!==n?n:e.process)&&void 0!==r?r:Math.floor(1e10*Math.random()),this.wrapped.machine=e.machine,this.wrapped.environment=e.environment,this.wrapped.region=e.region,this.wrapped.windowId=e.windowId,this.wrapped.isLocal=null===(i=e.isLocal)||void 0===i||i,this.wrapped.api=e.api,this.wrapped.service=e.service,this.wrapped.peerId=e.peerId},e}(),Hi=function(e){return Zn(Zn({},e),{flags:e.flags.metadata||{}})},Vi=function(){function e(e,t){this.logger=e,this.API=t,this.servers={},this.methodsCount={},this.callbacks=Ar();var n=this.API.instance.peerId;this.myServer={id:n,methods:{},instance:this.API.instance,wrapper:this.API.unwrappedInstance},this.servers[n]=this.myServer}return e.prototype.addServer=function(e,t){this.logger.debug("adding server "+t);var n=this.servers[t];if(n)return n.id;var r=new Bi(this.API,e),i={id:t,methods:{},instance:r.unwrap(),wrapper:r};return this.servers[t]=i,this.callbacks.execute("onServerAdded",i.instance),t},e.prototype.removeServerById=function(e,t){var n=this,r=this.servers[e];r?(this.logger.debug("removing server "+e),Object.keys(r.methods).forEach((function(t){n.removeServerMethod(e,t)})),delete this.servers[e],this.callbacks.execute("onServerRemoved",r.instance,t)):this.logger.warn("not aware of server "+e+", my state "+JSON.stringify(Object.keys(this.servers)))},e.prototype.addServerMethod=function(e,t){var n,r=this.servers[e];if(!r)throw new Error("server does not exists");if(!r.methods[t.id]){var i=this.createMethodIdentifier(t),o=this,a={identifier:i,gatewayId:t.id,name:t.name,displayName:t.display_name,description:t.description,version:t.version,objectTypes:t.object_types||[],accepts:t.input_signature,returns:t.result_signature,supportsStreaming:"undefined"!==typeof t.flags&&t.flags.streaming,flags:null!==(n=t.flags)&&void 0!==n?n:{},getServers:function(){return o.getServersByMethod(i)}};a.object_types=a.objectTypes,a.display_name=a.displayName,a.version=a.version,r.methods[t.id]=a;var s=Hi(a);return this.methodsCount[i]||(this.methodsCount[i]=0,this.callbacks.execute("onMethodAdded",s)),this.methodsCount[i]=this.methodsCount[i]+1,this.callbacks.execute("onServerMethodAdded",r.instance,s),a}},e.prototype.removeServerMethod=function(e,t){var n=this.servers[e];if(!n)throw new Error("server does not exists");var r=n.methods[t];delete n.methods[t];var i=Hi(r);this.methodsCount[r.identifier]=this.methodsCount[r.identifier]-1,0===this.methodsCount[r.identifier]&&this.callbacks.execute("onMethodRemoved",i),this.callbacks.execute("onServerMethodRemoved",n.instance,i)},e.prototype.getMethods=function(){return this.extractMethodsFromServers(Object.values(this.servers)).map(Hi)},e.prototype.getServers=function(){return Object.values(this.servers).map(this.hideServerMethodSystemFlags)},e.prototype.onServerAdded=function(e){var t=this.callbacks.add("onServerAdded",e),n=this.getServers().map((function(e){return e.instance}));return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onMethodAdded=function(e){var t=this.callbacks.add("onMethodAdded",e),n=this.getMethods();return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onServerMethodAdded=function(e){var t=this.callbacks.add("onServerMethodAdded",e),n=!1,r=this.getServers();return setTimeout((function(){r.forEach((function(t){var r=t.methods;Object.keys(r).forEach((function(i){n||e(t.instance,r[i])}))}))}),0),function(){n=!0,t()}},e.prototype.onMethodRemoved=function(e){return this.callbacks.add("onMethodRemoved",e)},e.prototype.onServerRemoved=function(e){return this.callbacks.add("onServerRemoved",e)},e.prototype.onServerMethodRemoved=function(e){return this.callbacks.add("onServerMethodRemoved",e)},e.prototype.getServerById=function(e){return this.hideServerMethodSystemFlags(this.servers[e])},e.prototype.reset=function(){var e,t=this;Object.keys(this.servers).forEach((function(e){t.removeServerById(e,"reset")})),this.servers=((e={})[this.myServer.id]=this.myServer,e),this.methodsCount={}},e.prototype.createMethodIdentifier=function(e){var t,n,r=null!==(t=e.input_signature)&&void 0!==t?t:"",i=null!==(n=e.result_signature)&&void 0!==n?n:"";return(e.name+r+i).toLowerCase()},e.prototype.getServersByMethod=function(e){var t=[];return Object.values(this.servers).forEach((function(n){Object.values(n.methods).forEach((function(r){r.identifier===e&&t.push(n.instance)}))})),t},e.prototype.returnUnsubWithDelayedReplay=function(e,t,n){var r=!1;return setTimeout((function(){t.forEach((function(e){r||n(e)}))}),0),function(){r=!0,e()}},e.prototype.hideServerMethodSystemFlags=function(e){var t={};return Object.entries(e.methods).forEach((function(e){var n=e[0],r=e[1];t[n]=Hi(r)})),Zn(Zn({},e),{methods:t})},e.prototype.extractMethodsFromServers=function(e){return Object.values(e).reduce((function(e,t){return nr(e,Object.values(t.methods))}),[])},e}(),Ji=function(){function e(){this.nextId=0,this.methods=[]}return e.prototype.add=function(e){return e.repoId=String(this.nextId),this.nextId+=1,this.methods.push(e),e},e.prototype.remove=function(e){if("string"!==typeof e)return new TypeError("Expecting a string");this.methods=this.methods.filter((function(t){return t.repoId!==e}))},e.prototype.getById=function(e){if("string"===typeof e)return this.methods.find((function(t){return t.repoId===e}))},e.prototype.getList=function(){return this.methods.map((function(e){return e}))},e.prototype.length=function(){return this.methods.length},e.prototype.reset=function(){this.methods=[]},e}(),Ki="onSubscriptionRequest",Qi="onSubscriptionAdded",$i="onSubscriptionRemoved",Yi=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.serverRepository=n,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=Ar(),this.nextStreamId=0,e.on("add-interest",(function(e){r.handleAddInterest(e)})),e.on("remove-interest",(function(e){r.handleRemoveInterest(e)}))}return e.prototype.acceptRequestOnBranch=function(e,t,n){if("string"!==typeof n&&(n=""),"object"!==typeof t.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(t.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var r=this.getStreamId(t,n),i=e.msg.subscription_id,o={id:i,arguments:e.arguments,instance:e.instance,branchKey:n,streamId:r,subscribeMsg:e.msg};t.protocolState.subscriptionsMap[i]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:i,stream_id:r}),this.callbacks.execute(Qi,o,t)},e.prototype.rejectRequest=function(e,t,n){"string"!==typeof n&&(n=""),this.sendSubscriptionFailed("Subscription rejected by user. "+n,e.msg.subscription_id)},e.prototype.pushData=function(e,t,n){var r=this;if("object"===typeof e&&Array.isArray(e.protocolState.branchKeyToStreamIdMap)){if("object"!==typeof t)throw new Error("Invalid arguments. Data must be an object.");"string"===typeof n?n=[n]:(!Array.isArray(n)||n.length<=0)&&(n=[]),e.protocolState.branchKeyToStreamIdMap.filter((function(e){return!n||0===n.length||n.indexOf(e.key)>=0})).map((function(e){return e.streamId})).forEach((function(e){var n={type:"publish",stream_id:e,data:t};r.session.sendFireAndForget(n)}))}},e.prototype.pushDataToSingle=function(e,t,n){if("object"!==typeof n)throw new Error("Invalid arguments. Data must be an object.");var r={type:"post",subscription_id:t.id,data:n};this.session.sendFireAndForget(r)},e.prototype.closeSingleSubscription=function(e,t){e.protocolState.subscriptionsMap&&delete e.protocolState.subscriptionsMap[t.id];var n={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(n);t.instance;this.callbacks.execute($i,t,e)},e.prototype.closeMultipleSubscriptions=function(e,t){var n=this;if("object"===typeof e&&"object"===typeof e.protocolState.subscriptionsMap&&e.protocolState.subscriptionsMap){var r=e.protocolState.subscriptionsMap,i=Object.keys(r).map((function(e){return r[e]}));"string"===typeof t&&(i=i.filter((function(e){return e.branchKey===t}))),i.forEach((function(e){delete r[e.id];var t={type:"drop-subscription",subscription_id:e.id,reason:"Server dropping all subscriptions on stream_id: "+e.streamId};n.session.sendFireAndForget(t)}))}},e.prototype.getSubscriptionList=function(e,t){if("object"!==typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var n=e.protocolState.subscriptionsMap,r=Object.keys(n).map((function(e){return n[e]}));return"string"!==typeof t?r:r.filter((function(e){return e.branchKey===t}))},e.prototype.getBranchList=function(e){if("object"!==typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var t=e.protocolState.subscriptionsMap,n=Object.keys(t).map((function(e){return t[e]})),r=[];return n.forEach((function(e){var t="";"object"===typeof e&&"string"===typeof e.branchKey&&(t=e.branchKey),-1===r.indexOf(t)&&r.push(t)})),r},e.prototype.onSubAdded=function(e){this.onSubscriptionLifetimeEvent(Qi,e)},e.prototype.onSubRequest=function(e){this.onSubscriptionLifetimeEvent(Ki,e)},e.prototype.onSubRemoved=function(e){this.onSubscriptionLifetimeEvent($i,e)},e.prototype.handleRemoveInterest=function(e){var t=this.serverRepository.getById(e.method_id);if("string"===typeof e.subscription_id&&"object"===typeof t&&t.protocolState.subscriptionsMap&&"object"===typeof t.protocolState.subscriptionsMap[e.subscription_id]){var n=t.protocolState.subscriptionsMap[e.subscription_id];delete t.protocolState.subscriptionsMap[e.subscription_id],this.callbacks.execute($i,n,t)}},e.prototype.onSubscriptionLifetimeEvent=function(e,t){this.callbacks.add(e,t)},e.prototype.getNextStreamId=function(){return this.nextStreamId+++""},e.prototype.handleAddInterest=function(e){var t=this.repository.getServerById(e.caller_id).instance,n={msg:e,arguments:e.arguments_kv||{},instance:t},r=this.serverRepository.getById(e.method_id);if(void 0!==r)r.protocolState.subscriptionsMap&&r.protocolState.subscriptionsMap[e.subscription_id]?this.sendSubscriptionFailed("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id):this.callbacks.execute(Ki,n,r);else{var i="No method with id "+e.method_id+" on this server.";this.sendSubscriptionFailed(i,e.subscription_id)}},e.prototype.sendSubscriptionFailed=function(e,t){var n={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:e,request_id:t};this.session.sendFireAndForget(n)},e.prototype.getStreamId=function(e,t){if("string"!==typeof t&&(t=""),!e.protocolState.branchKeyToStreamIdMap)throw new Error("streaming "+e.definition.name+" method without protocol state");var n=e.protocolState.branchKeyToStreamIdMap.filter((function(e){return e.key===t}))[0],r=n?n.streamId:void 0;return"string"===typeof r&&""!==r||(r=this.getNextStreamId(),e.protocolState.branchKeyToStreamIdMap.push({key:t,streamId:r})),r},e}(),Xi=function(){function e(e,t,n,r){var i=this;this.session=e,this.clientRepository=t,this.serverRepository=n,this.logger=r,this.callbacks=Ar(),this.streaming=new Yi(e,t,n),this.session.on("invoke",(function(e){return i.handleInvokeMessage(e)}))}return e.prototype.createStream=function(e){return e.protocolState.subscriptionsMap={},e.protocolState.branchKeyToStreamIdMap=[],this.register(e,!0)},e.prototype.register=function(e,t){var n,r=this,i=e.definition,o=Object.assign({},{metadata:null!==(n=i.flags)&&void 0!==n?n:{}},{streaming:t||!1}),a={type:"register",methods:[{id:e.repoId,name:i.name,display_name:i.displayName,description:i.description,version:i.version,flags:o,object_types:i.objectTypes||i.object_types,input_signature:i.accepts,result_signature:i.returns,restrictions:void 0}]};return this.session.send(a,{methodId:e.repoId}).then((function(){r.logger.debug("registered method "+e.definition.name+" with id "+e.repoId)})).catch((function(t){throw r.logger.warn("failed to register method "+e.definition.name+" with id "+e.repoId+" - "+JSON.stringify(t)),t}))},e.prototype.onInvoked=function(e){this.callbacks.add("onInvoked",e)},e.prototype.methodInvocationResult=function(e,t,n,r){var i;i=n||""===n?{type:"error",request_id:t,reason_uri:"agm.errors.client_error",reason:n,context:r,peer_id:void 0}:{type:"yield",invocation_id:t,peer_id:this.session.peerId,result:r,request_id:void 0},this.session.sendFireAndForget(i)},e.prototype.unregister=function(e){return er(this,void 0,void 0,(function(){var t;return tr(this,(function(n){switch(n.label){case 0:return t={type:"unregister",methods:[e.repoId]},[4,this.session.send(t)];case 1:return n.sent(),[2]}}))}))},e.prototype.getBranchList=function(e){return this.streaming.getBranchList(e)},e.prototype.getSubscriptionList=function(e,t){return this.streaming.getSubscriptionList(e,t)},e.prototype.closeAllSubscriptions=function(e,t){this.streaming.closeMultipleSubscriptions(e,t)},e.prototype.pushData=function(e,t,n){this.streaming.pushData(e,t,n)},e.prototype.pushDataToSingle=function(e,t,n){this.streaming.pushDataToSingle(e,t,n)},e.prototype.closeSingleSubscription=function(e,t){this.streaming.closeSingleSubscription(e,t)},e.prototype.acceptRequestOnBranch=function(e,t,n){this.streaming.acceptRequestOnBranch(e,t,n)},e.prototype.rejectRequest=function(e,t,n){this.streaming.rejectRequest(e,t,n)},e.prototype.onSubRequest=function(e){this.streaming.onSubRequest(e)},e.prototype.onSubAdded=function(e){this.streaming.onSubAdded(e)},e.prototype.onSubRemoved=function(e){this.streaming.onSubRemoved(e)},e.prototype.handleInvokeMessage=function(e){var t=e.invocation_id,n=e.caller_id,r=e.method_id,i=e.arguments_kv,o=this.serverRepository.getList().filter((function(e){return e.repoId===r}))[0];if(void 0!==o){var a={args:i,instance:this.clientRepository.getServerById(n).instance};this.callbacks.execute("onInvoked",o,t,a)}},e}(),Zi=function(){function e(e,t){this.repository=e,this.subscriptionData=t}return Object.defineProperty(e.prototype,"requestArguments",{get:function(){return this.subscriptionData.params.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"servers",{get:function(){var e=this;return this.subscriptionData.trackedServers.filter((function(e){return e.subscriptionId})).map((function(t){return e.repository.getServerById(t.serverId).instance}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverInstance",{get:function(){return this.servers[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stream",{get:function(){return this.subscriptionData.method},enumerable:!0,configurable:!0}),e.prototype.onData=function(e){if("function"!==typeof e)throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(e),1===this.subscriptionData.handlers.onData.length&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach((function(t){e(t)}))},e.prototype.onClosed=function(e){if("function"!==typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(e)},e.prototype.onFailed=function(e){},e.prototype.onConnected=function(e){if("function"!==typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(e)},e.prototype.close=function(){this.subscriptionData.close()},e.prototype.setNewSubscription=function(e){this.subscriptionData=e},e}(),eo=function(){function e(e){this.config=e,this.cache=[],this.timeoutIds=[]}return e.prototype.add=function(e){var t=this,n=Zr();this.cache.push({id:n,element:e});var r=setTimeout((function(){var e=t.cache.findIndex((function(e){return e.id===n}));e<0||t.cache.splice(e,1)}),this.config.ELEMENT_TTL_MS);this.timeoutIds.push(r)},e.prototype.flush=function(){var e=this.cache.map((function(e){return e.element}));return this.timeoutIds.forEach((function(e){return clearInterval(e)})),this.cache=[],this.timeoutIds=[],e},e}(),to="awaitingAccept",no="subscribed",ro="Subscription failed.",io="ClientInitiated",oo=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.logger=n,this.subscriptionsList={},this.timedCache=new eo({ELEMENT_TTL_MS:1e4}),this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(e){var t=e._tag,n=t.subLocalKey,i=r.subscriptionsList[n];if("object"===typeof i&&(i.trackedServers=i.trackedServers.filter((function(e){return e.serverId!==t.serverId})),i.trackedServers.length<=0)){if(clearTimeout(i.timeoutId),i.status===to){var o="string"===typeof e.reason&&""!==e.reason?' Publisher said "'+e.reason+'".':" No reason given.",a="object"===typeof i.params.arguments?JSON.stringify(i.params.arguments):"{}";i.error({message:"Subscription rejected."+o+" Called with:"+a,called_with:i.params.arguments,method:i.method})}else i.status===no&&r.callOnClosedHandlers(i);delete r.subscriptionsList[n]}},this.handleSubscribed=function(e){var t=e._tag.subLocalKey,n=r.subscriptionsList[t];if("object"===typeof n){var i=e._tag.serverId,o=n.trackedServers.filter((function(e){return e.serverId===i}))[0];if("object"===typeof o){o.subscriptionId=e.subscription_id,r.subscriptionIdToLocalKeyMap[e.subscription_id]=t;var a=n.status===to;if(n.status=no,a){var s=!1,u=n.subscription;u?(u.setNewSubscription(n),n.success(u),s=!0):(u=new Zi(r.repository,n),n.subscription=u,n.success(u));for(var c=0,l=n.handlers.onConnected;c<l.length;c++){var d=l[c];try{d(u.serverInstance,s)}catch(p){}}}}}},this.handleEventData=function(e){var t=r.subscriptionIdToLocalKeyMap[e.subscription_id];if("undefined"!==typeof t){var n=r.subscriptionsList[t];if("object"===typeof n){var i=n.trackedServers.filter((function(t){return t.subscriptionId===e.subscription_id}));if(1===i.length){var o=e.oob,a=i[0].serverId,s=function(){return{data:e.data,server:r.repository.getServerById(a).instance,requestArguments:n.params.arguments,message:void 0,private:o}},u=n.handlers.onData,c=n.queued.data;u.length>0?u.forEach((function(e){"function"===typeof e&&e(s())})):c.push(s())}}}},this.handleSubscriptionCancelled=function(e){var t=r.subscriptionIdToLocalKeyMap[e.subscription_id];if("undefined"!==typeof t){var n=r.subscriptionsList[t];if("object"===typeof n){var i=n.trackedServers.length-1;n.trackedServers=n.trackedServers.filter((function(t){return t.subscriptionId!==e.subscription_id||(n.queued.closers.push(t.serverId),!1)})),n.trackedServers.length===i&&(n.trackedServers.length<=0&&(r.timedCache.add(n),clearTimeout(n.timeoutId),r.callOnClosedHandlers(n),delete r.subscriptionsList[t]),delete r.subscriptionIdToLocalKeyMap[e.subscription_id])}}},e.on("subscribed",this.handleSubscribed),e.on("event",this.handleEventData),e.on("subscription-cancelled",this.handleSubscriptionCancelled)}return e.prototype.subscribe=function(e,t,n,r,i,o){var a=this;if(0!==n.length){var s=this.getNextSubscriptionLocalKey(),u=this.registerSubscription(s,e,t,r,i,t.methodResponseTimeout||1e4,o);"object"===typeof u?n.forEach((function(n){var r=n.server.id,i=n.methods.find((function(t){return t.name===e.name}));if(i){u.trackedServers.push({serverId:r,subscriptionId:void 0});var o={type:"subscribe",server_id:r,method_id:i.gatewayId,arguments_kv:t.arguments};a.session.send(o,{serverId:r,subLocalKey:s}).then((function(e){return a.handleSubscribed(e)})).catch((function(e){return a.handleErrorSubscribing(e)}))}else a.logger.error("can not find method "+e.name+" for target "+n.server.id)})):i({method:e,called_with:t.arguments,message:ro+" Unable to register the user callbacks."})}else i({method:e,called_with:t.arguments,message:ro+" No available servers matched the target params."})},e.prototype.drainSubscriptions=function(){var e=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},e},e.prototype.drainSubscriptionsCache=function(){return this.timedCache.flush()},e.prototype.getNextSubscriptionLocalKey=function(){var e=this.nextSubLocalKey;return this.nextSubLocalKey+=1,e},e.prototype.registerSubscription=function(e,t,n,r,i,o,a){var s=this,u={localKey:e,status:to,method:t,params:n,success:r,error:i,trackedServers:[],handlers:{onData:(null===a||void 0===a?void 0:a.handlers.onData)||[],onClosed:(null===a||void 0===a?void 0:a.handlers.onClosed)||[],onConnected:(null===a||void 0===a?void 0:a.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:function(){return s.closeSubscription(e)},subscription:null===a||void 0===a?void 0:a.subscription};return a||(n.onData&&u.handlers.onData.push(n.onData),n.onClosed&&u.handlers.onClosed.push(n.onClosed),n.onConnected&&u.handlers.onConnected.push(n.onConnected)),this.subscriptionsList[e]=u,u.timeoutId=setTimeout((function(){if(void 0!==s.subscriptionsList[e]){var r=s.subscriptionsList[e];r.status===to?(i({method:t,called_with:n.arguments,message:ro+" Subscription attempt timed out after "+o+" ms."}),delete s.subscriptionsList[e]):r.status===no&&r.trackedServers.length>0&&(r.trackedServers=r.trackedServers.filter((function(e){return"undefined"!==typeof e.subscriptionId})),delete r.timeoutId,r.trackedServers.length<=0&&(s.callOnClosedHandlers(r),delete s.subscriptionsList[e]))}}),o),u},e.prototype.callOnClosedHandlers=function(e,t){var n,r=e.queued.closers.length,i=r>0?e.queued.closers[r-1]:null;void 0!==i&&"string"===typeof i&&(n=this.repository.getServerById(i).instance),e.handlers.onClosed.forEach((function(r){"function"===typeof r&&r({message:t||"ServerInitiated",requestArguments:e.params.arguments||{},server:n,stream:e.method})}))},e.prototype.closeSubscription=function(e){var t=this,n=this.subscriptionsList[e];"object"===typeof n&&(n.trackedServers.forEach((function(e){"undefined"!==typeof e.subscriptionId&&(n.queued.closers.push(e.serverId),t.session.sendFireAndForget({type:"unsubscribe",subscription_id:e.subscriptionId,reason_uri:"",reason:io}),delete t.subscriptionIdToLocalKeyMap[e.subscriptionId])})),n.trackedServers=[],this.callOnClosedHandlers(n,io),delete this.subscriptionsList[e])},e}(),ao=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.logger=n,e.on("peer-added",(function(e){return r.handlePeerAdded(e)})),e.on("peer-removed",(function(e){return r.handlePeerRemoved(e)})),e.on("methods-added",(function(e){return r.handleMethodsAddedMessage(e)})),e.on("methods-removed",(function(e){return r.handleMethodsRemovedMessage(e)})),this.streaming=new oo(e,t,n)}return e.prototype.subscribe=function(e,t,n,r,i,o){this.streaming.subscribe(e,t,n,r,i,o)},e.prototype.invoke=function(e,t,n,r){var i=this,o=r.id,a={type:"call",server_id:o,method_id:t.gatewayId,arguments_kv:n};return this.session.send(a,{invocationId:e,serverId:o}).then((function(e){return i.handleResultMessage(e)})).catch((function(e){return i.handleInvocationError(e)}))},e.prototype.drainSubscriptions=function(){return this.streaming.drainSubscriptions()},e.prototype.drainSubscriptionsCache=function(){return this.streaming.drainSubscriptionsCache()},e.prototype.handlePeerAdded=function(e){var t=e.new_peer_id,n=e.identity,r=!e.meta||e.meta.local,i=Number(n.process),o={machine:n.machine,pid:isNaN(i)?n.process:i,instance:n.instance,application:n.application,applicationName:n.applicationName,environment:n.environment,region:n.region,user:n.user,windowId:n.windowId,peerId:t,api:n.api,isLocal:r};this.repository.addServer(o,t)},e.prototype.handlePeerRemoved=function(e){var t=e.removed_id,n=e.reason;this.repository.removeServerById(t,n)},e.prototype.handleMethodsAddedMessage=function(e){var t=this,n=e.server_id;e.methods.forEach((function(e){t.repository.addServerMethod(n,e)}))},e.prototype.handleMethodsRemovedMessage=function(e){var t=this,n=e.server_id,r=e.methods,i=this.repository.getServerById(n);Object.keys(i.methods).forEach((function(e){var o=i.methods[e];r.indexOf(o.gatewayId)>-1&&t.repository.removeServerMethod(n,e)}))},e.prototype.handleResultMessage=function(e){var t=e._tag.invocationId,n=e.result,r=e._tag.serverId;return{invocationId:t,result:n,instance:this.repository.getServerById(r).instance,status:Ri.Success,message:""}},e.prototype.handleInvocationError=function(e){if(this.logger.debug("handle invocation error "+JSON.stringify(e)),"_tag"in e){var t=e._tag.invocationId,n=e._tag.serverId,r=this.repository.getServerById(n),i=e.reason;return{invocationId:t,result:e.context,instance:r.instance,status:Ri.Error,message:i}}return{invocationId:"",message:e.message,status:Ri.Error,error:e}},e}();function so(e,t,n,r,i,o){var a,s=i.logger.subLogger("gw3-protocol"),u=new Promise((function(e){a=e})),c=t.domain("agm",["subscribed"]),l=new Xi(c,n,r,s.subLogger("server")),d=new ao(c,n,s.subLogger("client"));return c.onJoined((function(i){n.addServer(e,t.peerId),i?function(){return er(this,void 0,void 0,(function(){var e,t,n,i,a,u,c,l,p,f,h;return tr(this,(function(v){switch(v.label){case 0:for(s.info("reconnected - will replay registered methods and subscriptions"),d.drainSubscriptionsCache().forEach((function(e){var t=e.method,n=Object.assign({},e.params);s.info("trying to soft-re-subscribe to method "+t.name+", with params: "+JSON.stringify(n)),o.client.subscribe(t,n,void 0,void 0,e).then((function(){return s.info("soft-subscribing to method "+t.name+" DONE")})).catch((function(e){return s.warn("subscribing to method "+t.name+" failed: "+JSON.stringify(e)+"}")}))})),e=[],t=d.drainSubscriptions(),n=function(t){var n=t.method,r=Object.assign({},t.params);s.info("trying to re-subscribe to method "+n.name+", with params: "+JSON.stringify(r)),e.push(o.client.subscribe(n,r,void 0,void 0,t).then((function(){return s.info("subscribing to method "+n.name+" DONE")})))},i=0,a=t;i<a.length;i++)u=a[i],n(u);for(c=r.getList(),r.reset(),l=function(t){var n=t.definition;s.info("re-publishing method "+n.name),t.stream?e.push(o.server.createStream(n,t.streamCallbacks,void 0,void 0,t.stream).then((function(){return s.info("subscribing to method "+n.name+" DONE")}))):t.theFunction&&t.theFunction.userCallback?e.push(o.register(n,t.theFunction.userCallback).then((function(){return s.info("subscribing to method "+n.name+" DONE")}))):t.theFunction&&t.theFunction.userCallbackAsync&&e.push(o.registerAsync(n,t.theFunction.userCallbackAsync).then((function(){return s.info("subscribing to method "+n.name+" DONE")}))),s.info("re-publishing method "+n.name+" DONE")},p=0,f=c;p<f.length;p++)h=f[p],l(h);return[4,Promise.all(e)];case 1:return v.sent(),s.info("Interop is re-announced"),[2]}}))}))}().then((function(){return t.setLibReAnnounced({name:"interop"})})).catch((function(e){return s.warn("Error while re-announcing interop: "+JSON.stringify(e))})):a&&(a({client:d,server:l}),a=void 0)})),c.onLeft((function(){n.reset()})),c.join(),u}var uo=function(){function e(e){var t=this;if("undefined"===typeof e)throw new Error("configuration is required");if("undefined"===typeof e.connection)throw new Error("configuration.connections is required");var n,r=e.connection;if("number"!==typeof e.methodResponseTimeout&&(e.methodResponseTimeout=3e4),"number"!==typeof e.waitTimeoutMs&&(e.waitTimeoutMs=3e4),this.unwrappedInstance=new Bi(this,void 0,r),this.instance=this.unwrappedInstance.unwrap(),this.clientRepository=new Vi(e.logger.subLogger("cRep"),this),this.serverRepository=new Ji,3!==r.protocolVersion)throw new Error("protocol "+r.protocolVersion+" not supported");n=so(this.instance,r,this.clientRepository,this.serverRepository,e,this),this.readyPromise=n.then((function(n){return t.protocol=n,t.client=new Di(t.protocol,t.clientRepository,t.instance,e),t.server=new Gi(t.protocol,t.serverRepository),t}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.serverRemoved=function(e){return this.client.serverRemoved(e)},e.prototype.serverAdded=function(e){return this.client.serverAdded(e)},e.prototype.serverMethodRemoved=function(e){return this.client.serverMethodRemoved(e)},e.prototype.serverMethodAdded=function(e){return this.client.serverMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.client.methodRemoved(e)},e.prototype.methodAdded=function(e){return this.client.methodAdded(e)},e.prototype.methodsForInstance=function(e){return this.client.methodsForInstance(e)},e.prototype.methods=function(e){return this.client.methods(e)},e.prototype.servers=function(e){return this.client.servers(e)},e.prototype.subscribe=function(e,t,n,r){return this.client.subscribe(e,t,n,r)},e.prototype.createStream=function(e,t,n,r){return this.server.createStream(e,t,n,r)},e.prototype.unregister=function(e){return this.server.unregister(e)},e.prototype.registerAsync=function(e,t){return this.server.registerAsync(e,t)},e.prototype.register=function(e,t){return this.server.register(e,t)},e.prototype.invoke=function(e,t,n,r,i,o){return this.client.invoke(e,t,n,r,i,o)},e.prototype.waitForMethod=function(e){var t=new Rr,n=this.client.methodAdded((function(r){r.name===e&&(n(),t.resolve(r))}));return t.promise},e}(),co=["subscribed","success"],lo=function(){function e(e,t){var n=this;this.publish=function(e,t,r){var i=r||{},o=i.routingKey,a=i.target,s=n.removeEmptyValues({type:"publish",topic:e,data:t,peer_id:n.peerId,routing_key:o,target_identity:a});n.session.send(s)},this.subscribe=function(e,t,r){return new Promise((function(i,o){var a=r||{},s=a.routingKey,u=a.target,c=n.removeEmptyValues({type:"subscribe",topic:e,peer_id:n.peerId,routing_key:s,source:u});n.session.send(c).then((function(r){var o=r.subscription_id;n.subscriptions.push({subscription_id:o,topic:e,callback:t,source:u}),i({unsubscribe:function(){return n.session.send({type:"unsubscribe",subscription_id:o,peer_id:n.peerId}),n.subscriptions=n.subscriptions.filter((function(e){return e.subscription_id!==o})),Promise.resolve()}})})).catch((function(e){return o(e)}))}))},this.watchOnEvent=function(){n.session.on("event",(function(e){var t=e.data,r=e.subscription_id,i=e["publisher-identity"],o=n.subscriptions.find((function(e){return e.subscription_id===r}));o&&(o.source?n.keysMatch(o.source,i)&&o.callback(t,o.topic,i):o.callback(t,o.topic,i))}))},this.connection=e,this.logger=t,this.peerId=e.peerId,this.subscriptions=[],this.session=e.domain("bus",co),this.readyPromise=this.session.join(),this.readyPromise.then((function(){n.watchOnEvent()}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.removeEmptyValues=function(e){var t={};return Object.keys(e).forEach((function(n){void 0!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t},e.prototype.keysMatch=function(e,t){var n=Object.keys(e),r=!0;return n.forEach((function(n){e[n]!==t[n]&&(r=!1)})),r},e}(),po=function e(t,n){var r,i=Mr.getGDMajorVersion(),o=Promise.resolve();if(i){if(i<3)throw new Error("GD v2 is not supported. Use v4 of the API to run in that context.");i>=3&&(r=window.glue42gd,o=window.gdPreloadPromise||o)}var a,s,u,c,l,d,p,f=jr("glue"),h=function(e,t,n){var r,i,o,a,s;if(Mr.isNode()){var u={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}._GD_STARTING_CONTEXT_;if(u)try{s=JSON.parse(u)}catch(h){}}function c(){if(e.application)return e.application;if(n)return n.applicationName;if("undefined"!==typeof window&&"undefined"!==typeof window.glue42electron)return window.glue42electron.application;var t=Zr();return Mr.isNode()?s?s.applicationConfig.name:"NodeJS"+t:"undefined"!==typeof window&&"undefined"!==typeof document?document.title+" ("+t+")":t}var l=function(){var r,i,o,a,u,l,d,p,f,h,v,g=e.gateway,y=null!==(r=null===g||void 0===g?void 0:g.protocolVersion)&&void 0!==r?r:3,m=null===g||void 0===g?void 0:g.reconnectInterval,w=null===g||void 0===g?void 0:g.reconnectAttempts,b=null===g||void 0===g?void 0:g.ws,k=null===g||void 0===g?void 0:g.sharedWorker,x=null===g||void 0===g?void 0:g.inproc,_=null!==(i=null===g||void 0===g?void 0:g.webPlatform)&&void 0!==i?i:void 0;n&&(b=n.gwURL),Mr.isNode()&&s&&s.gwURL&&(b=s.gwURL),b||k||x||(b="ws://localhost:8385");var S=c(),I=S;"undefined"!==typeof n?(p=n.windowId,f=n.pid,n.env&&(h=n.env.env,v=n.env.region),I=null!==(o=n.application)&&void 0!==o?o:"glue-app",d=n.appInstanceId):Mr.isNode()?(f=process.pid,s&&(h=s.env,v=s.region,d=s.instanceId)):"undefined"!==typeof(null===window||void 0===window?void 0:window.glue42electron)&&(p=null===window||void 0===window?void 0:window.glue42electron.instanceId,f=null===window||void 0===window?void 0:window.glue42electron.pid,h=null===window||void 0===window?void 0:window.glue42electron.env,v=null===window||void 0===window?void 0:window.glue42electron.region,I=null!==(a=null===window||void 0===window?void 0:window.glue42electron.application)&&void 0!==a?a:"glue-app",d=null===window||void 0===window?void 0:window.glue42electron.instanceId);var C=null!==(l=null===(u=e.gateway)||void 0===u?void 0:u.replaySpecs)&&void 0!==l?l:[];C.push(xi);var T={application:I,applicationName:S,windowId:p,instance:d,process:f,region:v,environment:h,api:t.version||_i};return e.identity&&(T=Object.assign(T,e.identity)),{identity:T,reconnectInterval:m,ws:b,sharedWorker:k,webPlatform:_,inproc:x,protocolVersion:y,reconnectAttempts:w,replaySpecs:C}}(),d=c();if("undefined"!==typeof window){var p=window,f=p.htmlContainer?p.htmlContainer.containerName+"."+p.htmlContainer.application:null===(r=null===p||void 0===p?void 0:p.glue42gd)||void 0===r?void 0:r.application;f&&(d=f)}return{bus:null!==(i=e.bus)&&void 0!==i&&i,application:d,auth:function(){var t,n,r;return"string"===typeof e.auth?{token:e.auth}:e.auth?e.auth:Mr.isNode()&&s&&s.gwToken?{gatewayToken:s.gwToken}:(null===(t=e.gateway)||void 0===t?void 0:t.webPlatform)||(null===(n=e.gateway)||void 0===n?void 0:n.inproc)||(null===(r=e.gateway)||void 0===r?void 0:r.sharedWorker)?{username:"glue42",password:"glue42"}:void 0}(),logger:function(){var t,r,i,o=e.logger,a="warn";return o||(o=a),n&&(i=n.consoleLogLevel),"string"===typeof o?{console:null!==i&&void 0!==i?i:o,publish:a}:{console:null!==(t=null!==i&&void 0!==i?i:o.console)&&void 0!==t?t:a,publish:null!==(r=o.publish)&&void 0!==r?r:a}}(),connection:l,metrics:null===(o=e.metrics)||void 0===o||o,contexts:"undefined"===typeof e.contexts||"boolean"===typeof e.contexts&&e.contexts?{reAnnounceKnownContexts:!0}:"object"===typeof e.contexts&&Object.assign({},{reAnnounceKnownContexts:!0},e.contexts),version:t.version||_i,libs:null!==(a=t.libs)&&void 0!==a?a:[],customLogger:e.customLogger}}(t=t||{},n=n||{},r),v={};function g(t,n,r){(p=u.canPublish("trace"))&&u.trace("registering "+t+" module");var i=function(){n.initTime=r.stop(),n.initEndTime=r.endTime,n.marks=r.marks,p&&u.trace(t+" is ready - "+(r.endTime-r.startTime))};n.initStartTime=r.startTime,n.ready?n.ready().then((function(){i()})):i(),Array.isArray(t)||(t=[t]),t.forEach((function(t){v[t]=n,e[t]=n}))}function y(){var e,t,n,i,o,s=jr("metrics"),l=h.metrics,d=null===r||void 0===r?void 0:r.getMetricsPublishingEnabled,p=h.connection.identity,f=d||function(){return!0},v=null!==(e="boolean"!==typeof l&&l.disableAutoAppSystem)&&void 0!==e&&e;return g("metrics",c=Cr({connection:l?a:void 0,logger:u.subLogger("metrics"),canUpdateMetric:f,system:"Glue42",service:null!==(n=null!==(t=null===p||void 0===p?void 0:p.service)&&void 0!==t?t:null===r||void 0===r?void 0:r.applicationName)&&void 0!==n?n:h.application,instance:null!==(o=null!==(i=null===p||void 0===p?void 0:p.instance)&&void 0!==i?i:null===p||void 0===p?void 0:p.windowId)&&void 0!==o?o:Zr(),disableAutoAppSystem:v,pagePerformanceMetrics:"boolean"!==typeof l?null===l||void 0===l?void 0:l.pagePerformanceMetrics:void 0}),s),Promise.resolve()}function m(){var e=jr("interop"),t={connection:a,logger:u.subLogger("interop")};return s=new uo(t),ui.Interop=s,g(["interop","agm"],s,e),Promise.resolve()}function w(){var e=h.activities&&3===a.protocolVersion;if(h.contexts||e){var t=jr("contexts");return g("contexts",l=new ji({connection:a,logger:u.subLogger("contexts"),trackAllContexts:"object"===typeof h.contexts&&h.contexts.trackAllContexts,reAnnounceKnownContexts:"object"===typeof h.contexts&&h.contexts.reAnnounceKnownContexts}),t),l}var n=a.replayer;n&&n.drain(xi.name)}function b(){return er(this,void 0,void 0,(function(){var e;return tr(this,(function(t){return h.bus?(e=jr("bus"),g("bus",d=new lo(a,u.subLogger("bus")),e),[2,Promise.resolve()]):[2,Promise.resolve()]}))}))}function k(e){try{return e.forEach((function(e){!function(e,t){var n=jr(e),r=t(v);r&&g(e,r,n)}(e.name,e.create)})),Promise.resolve()}catch(t){return Promise.reject(t)}}return o.then((function(){var e,t=jr("logger");return(u=new ui(""+(null===(e=h.connection.identity)||void 0===e?void 0:e.application),void 0,h.customLogger)).consoleLevel(h.logger.console),u.publishLevel(h.logger.publish),u.canPublish("debug")&&u.debug("initializing glue..."),g("logger",u,t),Promise.resolve(void 0)})).then((function(){var e=jr("connection");a=new ai(h.connection,u.subLogger("connection"));var t=Promise.resolve(h.auth);return h.connection&&!h.auth&&(r?t=r.getGWToken().then((function(e){return{gatewayToken:e}})):"undefined"!==typeof window&&(null===window||void 0===window?void 0:window.glue42electron)?"string"===typeof window.glue42electron.gwToken&&(t=Promise.resolve({gatewayToken:window.glue42electron.gwToken})):t=Promise.reject("You need to provide auth information")),t.then((function(t){var n;if(e.mark("auth-promise-resolved"),"[object Object]"!==Object.prototype.toString.call(t))throw new Error("Invalid auth object - "+JSON.stringify(t));return n=t,a.login(n)})).then((function(){return g("connection",a,e),h})).catch((function(e){throw a&&a.logout(),e}))})).then((function(){return Promise.all([y(),m(),w(),b()])})).then((function(){return s.readyPromise})).then((function(){return function(){return er(this,void 0,void 0,(function(){var e,n,r;return tr(this,(function(i){switch(i.label){case 0:if(e="T42.ACS.RegisterInstance",!Mr.isNode()||"undefined"!==typeof{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}._GD_STARTING_CONTEXT_||"undefined"===typeof(null===t||void 0===t?void 0:t.application))return[3,4];if(!(s.methods({name:e}).length>0))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,s.invoke(e,{appName:null===t||void 0===t?void 0:t.application,pid:process.pid})];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),r=n,u.error("Cannot register as an instance: "+JSON.stringify(r.message)),[3,4];case 4:return[2]}}))}))}()})).then((function(){return k(h.libs||[])})).then((function(){var e=Object.keys(v).map((function(e){var t=v[e];return t.ready?t.ready():Promise.resolve()}));return Promise.all(e)})).then((function(){var e={coreVersion:_i,version:h.version};f.stop();var i={feedback:function(e){s&&s.invoke("T42.ACS.Feedback",e,"best")},info:e,logger:u,interop:s,agm:s,connection:a,metrics:c,contexts:l,bus:d,version:h.version,userConfig:t,done:function(){return null===u||void 0===u||u.info("done called by user..."),a.logout()}};if(i.performance={get glueVer(){return h.version},get glueConfig(){return JSON.stringify(t)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var e=Or;return Object.keys(e).map((function(t){var n=e[t];return{name:t,duration:n.endTime-n.startTime,marks:n.marks,startTime:n.startTime,endTime:n.endTime}}))}},Object.keys(v).forEach((function(e){var t=v[e];i[e]=t})),i.config={},Object.keys(h).forEach((function(e){i.config[e]=h[e]})),n&&n.extOptions&&Object.keys(n.extOptions).forEach((function(e){i.config[e]=null===n||void 0===n?void 0:n.extOptions[e]})),(null===n||void 0===n?void 0:n.enrichGlue)&&n.enrichGlue(i),r&&r.updatePerfData&&r.updatePerfData(i.performance),i.agm){var o=function(e,t,n){return function(){return i.logger.warn("glue.js - 'glue.agm."+t+"' method is deprecated, use 'glue.interop."+n+"' instead."),e.apply(i.agm,arguments)}},p=i.agm;p.method_added=o(i.agm.methodAdded,"method_added","methodAdded"),p.method_removed=o(i.agm.methodRemoved,"method_removed","methodRemoved"),p.server_added=o(i.agm.serverAdded,"server_added","serverAdded"),p.server_method_aded=o(i.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),p.server_method_removed=o(i.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return i})).catch((function(e){return Promise.reject({err:e,libs:v})}))};"undefined"!==typeof window&&(window.GlueCore=po),po.version=_i,po.default=po;var fo,ho=(fo=po,function(e){return I(void 0,void 0,void 0,l().mark((function t(){var n,r,i,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.glue42gd){t.next=2;break}return t.abrupt("return",E(e));case 2:return n=new Qn,r=T(e),A(),t.next=7,Ht((function(){return fo(r,{version:$n})}),3e4,"Glue Web initialization timed out, because core didn't resolve");case 7:return i=t.sent,o=i.logger.subLogger("web.main.controller"),n.defineGlue(i),t.next=12,n.preferredConnectionController.start(r);case 12:return t.next=14,n.bridge.start(n.controllers);case 14:return n.defineConfig(r),o.trace("the bridge has been started, initializing all controllers"),t.next=18,Promise.all(Object.values(n.controllers).map((function(e){return e.start(i,n)})));case 18:return o.trace("all controllers reported started, starting all additional libraries"),t.next=21,Promise.all(r.libraries.map((function(e){return e(i,r)})));case 21:return o.trace("all libraries were started"),n.eventsDispatcher.start(i),o.trace("start event dispatched, glue is ready, returning it"),t.abrupt("return",i);case 25:case"end":return t.stop()}}),t)})))});if("undefined"!==typeof window){var vo=window;vo.GlueWeb=ho,delete vo.GlueCore}window.glue42gd||window.glue42core||(window.glue42core={webStarted:!1}),ho.version=$n;var go=ho,yo=n(692),mo=n.n(yo);function wo(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}var bo=function(e){return{ok:!0,result:e}},ko=function(e){return{ok:!1,error:e}},xo=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},_o=function(e,t){return!0===t.ok?t.result:e},So=function(e){if(!0===e.ok)return e.result;throw e.error},Io=function(e,t){return!0===t.ok?bo(e(t.result)):t},Co=function(e,t,n){return!1===t.ok?t:!1===n.ok?n:bo(e(t.result,n.result))},To=function(e,t){return!0===t.ok?t:ko(e(t.error))},Ao=function(e,t){return!0===t.ok?e(t.result):t};Object.freeze({ok:bo,isOk:function(e){return!0===e.ok},err:ko,isErr:function(e){return!1===e.ok},asPromise:xo,withDefault:_o,withException:So,successes:function(e){return e.reduce((function(e,t){return!0===t.ok?e.concat(t.result):e}),[])},map:Io,map2:Co,mapError:To,andThen:Ao});var Eo=function(){return Eo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Eo.apply(this,arguments)};function Po(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if(typeof e!==typeof t)return!1;if("object"===typeof e){if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!Po(e[n],t[n]))return!1;return!0}var r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(n=0;n<r.length;n++){if(!t.hasOwnProperty(r[n]))return!1;if(!Po(e[r[n]],t[r[n]]))return!1}return!0}}var Mo=function(e){return Array.isArray(e)},Ro=function(e){return"object"===typeof e&&null!==e&&!Mo(e)},Oo=function(e,t){return"expected "+e+", got "+function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}}(t)},jo=function(e){return e.map((function(e){return"string"===typeof e?"."+e:"["+e+"]"})).join("")},No=function(e,t){var n=t.at,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["at"]);return Eo({at:e+(n||"")},r)},Lo=function(){function e(t){var n=this;this.decode=t,this.run=function(e){return To((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),n.decode(e))},this.runPromise=function(e){return xo(n.run(e))},this.runWithException=function(e){return So(n.run(e))},this.map=function(t){return new e((function(e){return Io(t,n.decode(e))}))},this.andThen=function(t){return new e((function(e){return Ao((function(n){return t(n).decode(e)}),n.decode(e))}))},this.where=function(t,r){return n.andThen((function(n){return t(n)?e.succeed(n):e.fail(r)}))}}return e.string=function(){return new e((function(e){return"string"===typeof e?bo(e):ko({message:Oo("a string",e)})}))},e.number=function(){return new e((function(e){return"number"===typeof e?bo(e):ko({message:Oo("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"===typeof e?bo(e):ko({message:Oo("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return Po(e,t)?bo(t):ko({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(Ro(e)&&t){var n={};for(var r in t)if(t.hasOwnProperty(r)){var i=t[r].decode(e[r]);if(!0!==i.ok)return void 0===e[r]?ko({message:"the key '"+r+"' is required but was not present"}):ko(No("."+r,i.error));void 0!==i.result&&(n[r]=i.result)}return bo(n)}return Ro(e)?bo(e):ko({message:Oo("an object",e)})}))},e.array=function(t){return new e((function(e){if(Mo(e)&&t){return e.reduce((function(e,n,r){return Co((function(e,t){return e.concat([t])}),e,function(e,n){return To((function(e){return No("["+n+"]",e)}),t.decode(e))}(n,r))}),bo([]))}return Mo(e)?bo(e):ko({message:Oo("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(Mo(e)){if(e.length!==t.length)return ko({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e[r]);if(!i.ok)return ko(No("["+r+"]",i.error));n[r]=i.result}return bo(n)}return ko({message:Oo("a tuple of length "+t.length,e)})}))},e.union=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.oneOf.apply(e,[t,n].concat(r))},e.intersection=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new e((function(e){return[t,n].concat(r).reduce((function(t,n){return Co(Object.assign,t,n.decode(e))}),bo({}))}))},e.anyJson=function(){return new e((function(e){return bo(e)}))},e.unknownJson=function(){return new e((function(e){return bo(e)}))},e.dict=function(t){return new e((function(e){if(Ro(e)){var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=t.decode(e[r]);if(!0!==i.ok)return ko(No("."+r,i.error));n[r]=i.result}return bo(n)}return ko({message:Oo("an object",e)})}))},e.optional=function(t){return new e((function(e){return void 0===e||null===e?bo(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new e((function(e){for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e);if(!0===i.ok)return i;n[r]=i.error}var o=n.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return ko({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},e.withDefault=function(t,n){return new e((function(e){return bo(_o(t,n.decode(e)))}))},e.valueAt=function(t,n){return new e((function(e){for(var r=e,i=0;i<t.length;i++){if(void 0===r)return ko({at:jo(t.slice(0,i+1)),message:"path does not exist"});if("string"===typeof t[i]&&!Ro(r))return ko({at:jo(t.slice(0,i+1)),message:Oo("an object",r)});if("number"===typeof t[i]&&!Mo(r))return ko({at:jo(t.slice(0,i+1)),message:Oo("an array",r)});r=r[t[i]]}return To((function(e){return void 0===r?{at:jo(t),message:"path does not exist"}:No(jo(t),e)}),n.decode(r))}))},e.succeed=function(t){return new e((function(e){return bo(t)}))},e.fail=function(t){return new e((function(e){return ko({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),Do=Lo.string;Lo.number,Lo.boolean,Lo.anyJson,Lo.unknownJson;var Wo=Lo.constant,Fo=Lo.object,qo=Lo.array;Lo.tuple,Lo.dict;var Uo=Lo.optional,zo=Lo.oneOf;Lo.union,Lo.intersection,Lo.withDefault,Lo.valueAt,Lo.succeed,Lo.fail,Lo.lazy;var Go=Do().where((function(e){return e.length>0}),"Expected a non-empty string"),Bo=Fo({callerId:Go,intent:Go,methodName:Go}),Ho=Fo({applicationName:Go,applicationTitle:Do(),applicationDescription:Uo(Do()),applicationIcon:Uo(Do()),type:zo(Wo("app"),Wo("instance")),displayName:Uo(Do()),contextTypes:Uo(qo(Go)),instanceId:Uo(Do()),instanceTitle:Uo(Do()),resultType:Uo(Do())}),Vo=["interop","appManager","intents"],Jo=["myInstance","applications","application","instances","onInstanceStarted","onInstanceStopped","onAppAdded","onAppRemoved"],Ko=function(e){var t=Object.keys(e),n=Vo.filter((function(e){return!t.includes(e)}));if(n.length)throw new Error("Glue is missing the following API".concat(n.length>1?"s":"",": ").concat(n.join(", ")));var r=Object.keys(e.appManager),i=Jo.filter((function(e){return!r.includes(e)}));if(i.length)throw new Error('Glue is not initialized with { "appManager: "full" }. Missing props: '.concat(i.join(", ")))},Qo=function(){function e(){k(this,e)}return _(e,[{key:"initialize",value:function(e){return wo(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Ko(e),this.glue=e,t.next=4,this.glue.appManager.myInstance.getContext();case 4:n=t.sent,Bo.runWithException(n),this._intent=n.intent,this._callerId=n.callerId,this._methodName=n.methodName;case 9:case"end":return t.stop()}}),t,this)})))}},{key:"intent",get:function(){return this._intent}},{key:"sendInteropMethodResponse",value:function(e){return wo(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.isMethodRegistered(),this.isInstanceStillRunning()){t.next=4;break}return this.glue.appManager.myInstance.stop(),t.abrupt("return");case 4:if(n){t.next=6;break}return t.abrupt("return",this.subscribeForServerMethodAdded(e));case 6:return t.abrupt("return",this.glue.interop.invoke(this._methodName,{intent:this.intent,handler:e},{instance:this._callerId}));case 7:case"end":return t.stop()}}),t,this)})))}},{key:"subscribeOnInstanceStarted",value:function(e){var t=this;return this.glue.appManager.onInstanceStarted((function(n){return wo(t,void 0,void 0,l().mark((function t(){var r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extractCurrentIntentInfoFromApp(n.application);case 2:if(r=t.sent){t.next=5;break}return t.abrupt("return");case 5:i=this.buildIntentHandler(n.application,r,n.id),e(i);case 7:case"end":return t.stop()}}),t,this)})))}))}},{key:"subscribeOnInstanceStopped",value:function(e){var t=this;return this.glue.appManager.onInstanceStopped((function(n){return wo(t,void 0,void 0,l().mark((function t(){var r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extractCurrentIntentInfoFromApp(n.application);case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:r=this.buildRemovedIntentHandler(n.application,n.id),e(r);case 7:case"end":return t.stop()}}),t,this)})))}))}},{key:"subscribeOnAppAdded",value:function(e){var t=this;return this.glue.appManager.onAppAdded((function(n){return wo(t,void 0,void 0,l().mark((function t(){var r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extractCurrentIntentInfoFromApp(n);case 2:if(r=t.sent){t.next=5;break}return t.abrupt("return");case 5:i=this.buildIntentHandler(n,r),e(i);case 7:case"end":return t.stop()}}),t,this)})))}))}},{key:"subscribeOnAppRemoved",value:function(e){var t=this;return this.glue.appManager.onAppRemoved((function(n){return wo(t,void 0,void 0,l().mark((function t(){var r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extractCurrentIntentInfoFromApp(n);case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:r=this.buildRemovedIntentHandler(n),e(r);case 7:case"end":return t.stop()}}),t,this)})))}))}},{key:"subscribeForServerMethodAdded",value:function(e){var t=this;return new Promise((function(n,r){var i=t.glue.interop.serverMethodAdded((function(o){var a=o.server,s=o.method;return wo(t,void 0,void 0,l().mark((function t(){var o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.instance===this._callerId&&s.name===this._methodName){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,this.glue.interop.invoke(this._methodName,{intent:this.intent,handler:e},{instance:this._callerId});case 5:o=t.sent,n(o),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),r(t.t0);case 12:i&&i();case 13:case"end":return t.stop()}}),t,this,[[2,9]])})))}))}))}},{key:"extractCurrentIntentInfoFromApp",value:function(e){var t;return wo(this,void 0,void 0,l().mark((function n(){var r,i,o,a=this;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(window.glue42core&&(r=null===(t=e.userProperties.intents)||void 0===t?void 0:t.find((function(e){return e.name===a.intent}))),!window.glue42gd){n.next=13;break}return n.prev=2,n.next=5,this.glue.interop.invoke("T42.ACS.GetApplications",{withIntentsInfo:!0});case 5:o=n.sent,i=o.returned.applications,n.next=12;break;case 9:return n.prev=9,n.t0=n.catch(2),n.abrupt("return");case 12:r=i.find((function(t){var n;return t.name===e.name&&(null===(n=t.intents)||void 0===n?void 0:n.find((function(e){return e.name===a.intent})))}));case 13:return n.abrupt("return",r);case 14:case"end":return n.stop()}}),n,this,[[2,9]])})))}},{key:"buildIntentHandler",value:function(e,t,n){return{applicationName:e.name,applicationTitle:e.title||"",applicationDescription:e.caption,applicationIcon:e.icon,displayName:t.displayName,type:n?"instance":"app",resultType:t.resultType,instanceId:n}}},{key:"buildRemovedIntentHandler",value:function(e,t){return{applicationName:e.name,type:t?"instance":"app",instanceId:t}}},{key:"isMethodRegistered",value:function(){return!!this.glue.interop.methods(this._methodName).length}},{key:"isInstanceStillRunning",value:function(){var e=this;return!!this.glue.interop.servers().find((function(t){return t.windowId===e._callerId}))}}]),e}(),$o=function(){function e(t){k(this,e),this.glueController=t}return _(e,[{key:"toApi",value:function(){var e={intent:this.glueController.intent,sendResponse:this.sendResponse.bind(this),onHandlerAdded:this.onHandlerAdded.bind(this),onHandlerRemoved:this.onHandlerRemoved.bind(this)};return Object.freeze(e)}},{key:"sendResponse",value:function(e){return wo(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ho.runWithException(e),t.abrupt("return",this.glueController.sendInteropMethodResponse(n));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"onHandlerAdded",value:function(e){var t=this.glueController.subscribeOnAppAdded(e),n=this.glueController.subscribeOnInstanceStarted(e);return function(){t(),n()}}},{key:"onHandlerRemoved",value:function(e){var t=this.glueController.subscribeOnInstanceStopped(e),n=this.glueController.subscribeOnAppRemoved(e);return function(){t(),n()}}}]),e}(),Yo=function(){function e(){k(this,e)}return _(e,[{key:"intentsResolver",get:function(){return this._intentsResolver||(this._intentsResolver=new $o(this.glueController).toApi()),this._intentsResolver}},{key:"glueController",get:function(){return this._glueController||(this._glueController=new Qo),this._glueController}}]),e}(),Xo=function(e){return wo(void 0,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Yo,t.prev=1,t.next=4,n.glueController.initialize(e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),new Error("The Intents Resolver API did not initialized successfully. Error: ".concat(t.t0));case 9:e.intents.resolver=n.intentsResolver,Object.freeze(e.intents);case 11:case"end":return t.stop()}}),t,null,[[1,6]])})))};"undefined"!==typeof window&&(window.GlueIntentsResolver=Xo),t.createRoot(document.getElementById("root")).render((0,m.jsx)(y,{settings:{web:{config:{libraries:[Xo],appManager:"full",intents:{enableIntentsResolverUI:!1}},factory:go},desktop:{config:{libraries:[Xo],appManager:"full",intents:{enableIntentsResolverUI:!1}},factory:mo()}},children:(0,m.jsx)(w,{})})),b()}()}();
//# sourceMappingURL=main.53930050.js.map